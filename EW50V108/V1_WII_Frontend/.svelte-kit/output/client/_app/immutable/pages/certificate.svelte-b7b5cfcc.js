import{S as k1,i as I1,s as B1,x as H,y as F,z as q,f as D,t as O,C as J,o as x1,a as Z,e as $s,c as ee,b as U,h as P,g as xn,d as Nn,r as pt,u as yt,a0 as J0,a3 as Zf,a4 as eh,a5 as th,l as Ts,m as Rs,n as ru,p as $t,q as Hg,I as su,J as G0,v as io,F as rh}from"../chunks/index-1ab591d7.js";import{s as N1}from"../chunks/Indicator.svelte_svelte_type_style_lang-28f07d2f.js";import{B as j0}from"../chunks/Button-fa4fdcb7.js";import{F as sh}from"../chunks/FloatingLabelInput-18fc5ed8.js";import{T as W0}from"../chunks/Table-8bee18f9.js";import{T as Q0,a as Tn,b as Se}from"../chunks/TableBodyRow-1cd4c869.js";import{T as Y0,a as at}from"../chunks/TableHeadCell-12b54869.js";import{T as Kh}from"../chunks/TabItem-e3e9e853.js";import{T as T1}from"../chunks/Tabs-c930f01e.js";import{aa as $m,b4 as dd,bo as R1}from"../chunks/configG-8bb2469e.js";import"../chunks/index-6fbc3f26.js";var V1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _1(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function $1(s){var e=s.default;if(typeof e=="function"){var t=function(){return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(r){var a=Object.getOwnPropertyDescriptor(s,r);Object.defineProperty(t,r,a.get?a:{enumerable:!0,get:function(){return s[r]}})}),t}var Yp={exports:{}},Fe={options:{usePureJavaScript:!1}},Fg={},D1=Fg,Dm={};Fg.encode=function(s,e,t){if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');if(t!==void 0&&typeof t!="number")throw new TypeError('"maxline" must be a number.');var r="";if(!(s instanceof Uint8Array))r=L1(s,e);else{var a=0,n=e.length,i=e.charAt(0),o=[0];for(a=0;a<s.length;++a){for(var l=0,u=s[a];l<o.length;++l)u+=o[l]<<8,o[l]=u%n,u=u/n|0;for(;u>0;)o.push(u%n),u=u/n|0}for(a=0;s[a]===0&&a<s.length-1;++a)r+=i;for(a=o.length-1;a>=0;--a)r+=e[o[a]]}if(t){var c=new RegExp(".{1,"+t+"}","g");r=r.match(c).join(`\r
`)}return r};Fg.decode=function(s,e){if(typeof s!="string")throw new TypeError('"input" must be a string.');if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');var t=Dm[e];if(!t){t=Dm[e]=[];for(var r=0;r<e.length;++r)t[e.charCodeAt(r)]=r}s=s.replace(/\s/g,"");for(var a=e.length,n=e.charAt(0),i=[0],r=0;r<s.length;r++){var o=t[s.charCodeAt(r)];if(o===void 0)return;for(var l=0,u=o;l<i.length;++l)u+=i[l]*a,i[l]=u&255,u>>=8;for(;u>0;)i.push(u&255),u>>=8}for(var c=0;s[c]===n&&c<s.length-1;++c)i.push(0);return typeof Buffer<"u"?Buffer.from(i.reverse()):new Uint8Array(i.reverse())};function L1(s,e){var t=0,r=e.length,a=e.charAt(0),n=[0];for(t=0;t<s.length();++t){for(var i=0,o=s.at(t);i<n.length;++i)o+=n[i]<<8,n[i]=o%r,o=o/r|0;for(;o>0;)n.push(o%r),o=o/r|0}var l="";for(t=0;s.at(t)===0&&t<s.length()-1;++t)l+=a;for(t=n.length-1;t>=0;--t)l+=e[n[t]];return l}var Lm=Fe,Om=D1,x=Lm.util=Lm.util||{};(function(){if(typeof process<"u"&&process.nextTick&&!process.browser){x.nextTick=process.nextTick,typeof setImmediate=="function"?x.setImmediate=setImmediate:x.setImmediate=x.nextTick;return}if(typeof setImmediate=="function"){x.setImmediate=function(){return setImmediate.apply(void 0,arguments)},x.nextTick=function(i){return setImmediate(i)};return}if(x.setImmediate=function(i){setTimeout(i,0)},typeof window<"u"&&typeof window.postMessage=="function"){let i=function(o){if(o.source===window&&o.data===s){o.stopPropagation();var l=e.slice();e.length=0,l.forEach(function(u){u()})}};var s="forge.setImmediate",e=[];x.setImmediate=function(o){e.push(o),e.length===1&&window.postMessage(s,"*")},window.addEventListener("message",i,!0)}if(typeof MutationObserver<"u"){var t=Date.now(),r=!0,a=document.createElement("div"),e=[];new MutationObserver(function(){var o=e.slice();e.length=0,o.forEach(function(l){l()})}).observe(a,{attributes:!0});var n=x.setImmediate;x.setImmediate=function(o){Date.now()-t>15?(t=Date.now(),n(o)):(e.push(o),e.length===1&&a.setAttribute("a",r=!r))}}x.nextTick=x.setImmediate})();x.isNodejs=typeof process<"u"&&process.versions&&process.versions.node;x.globalScope=function(){return x.isNodejs?V1:typeof self>"u"?window:self}();x.isArray=Array.isArray||function(s){return Object.prototype.toString.call(s)==="[object Array]"};x.isArrayBuffer=function(s){return typeof ArrayBuffer<"u"&&s instanceof ArrayBuffer};x.isArrayBufferView=function(s){return s&&x.isArrayBuffer(s.buffer)&&s.byteLength!==void 0};function ah(s){if(!(s===8||s===16||s===24||s===32))throw new Error("Only 8, 16, 24, or 32 bits supported: "+s)}x.ByteBuffer=qg;function qg(s){if(this.data="",this.read=0,typeof s=="string")this.data=s;else if(x.isArrayBuffer(s)||x.isArrayBufferView(s))if(typeof Buffer<"u"&&s instanceof Buffer)this.data=s.toString("binary");else{var e=new Uint8Array(s);try{this.data=String.fromCharCode.apply(null,e)}catch{for(var t=0;t<e.length;++t)this.putByte(e[t])}}else(s instanceof qg||typeof s=="object"&&typeof s.data=="string"&&typeof s.read=="number")&&(this.data=s.data,this.read=s.read);this._constructedStringLength=0}x.ByteStringBuffer=qg;var O1=4096;x.ByteStringBuffer.prototype._optimizeConstructedString=function(s){this._constructedStringLength+=s,this._constructedStringLength>O1&&(this.data.substr(0,1),this._constructedStringLength=0)};x.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};x.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0};x.ByteStringBuffer.prototype.putByte=function(s){return this.putBytes(String.fromCharCode(s))};x.ByteStringBuffer.prototype.fillWithByte=function(s,e){s=String.fromCharCode(s);for(var t=this.data;e>0;)e&1&&(t+=s),e>>>=1,e>0&&(s+=s);return this.data=t,this._optimizeConstructedString(e),this};x.ByteStringBuffer.prototype.putBytes=function(s){return this.data+=s,this._optimizeConstructedString(s.length),this};x.ByteStringBuffer.prototype.putString=function(s){return this.putBytes(x.encodeUtf8(s))};x.ByteStringBuffer.prototype.putInt16=function(s){return this.putBytes(String.fromCharCode(s>>8&255)+String.fromCharCode(s&255))};x.ByteStringBuffer.prototype.putInt24=function(s){return this.putBytes(String.fromCharCode(s>>16&255)+String.fromCharCode(s>>8&255)+String.fromCharCode(s&255))};x.ByteStringBuffer.prototype.putInt32=function(s){return this.putBytes(String.fromCharCode(s>>24&255)+String.fromCharCode(s>>16&255)+String.fromCharCode(s>>8&255)+String.fromCharCode(s&255))};x.ByteStringBuffer.prototype.putInt16Le=function(s){return this.putBytes(String.fromCharCode(s&255)+String.fromCharCode(s>>8&255))};x.ByteStringBuffer.prototype.putInt24Le=function(s){return this.putBytes(String.fromCharCode(s&255)+String.fromCharCode(s>>8&255)+String.fromCharCode(s>>16&255))};x.ByteStringBuffer.prototype.putInt32Le=function(s){return this.putBytes(String.fromCharCode(s&255)+String.fromCharCode(s>>8&255)+String.fromCharCode(s>>16&255)+String.fromCharCode(s>>24&255))};x.ByteStringBuffer.prototype.putInt=function(s,e){ah(e);var t="";do e-=8,t+=String.fromCharCode(s>>e&255);while(e>0);return this.putBytes(t)};x.ByteStringBuffer.prototype.putSignedInt=function(s,e){return s<0&&(s+=2<<e-1),this.putInt(s,e)};x.ByteStringBuffer.prototype.putBuffer=function(s){return this.putBytes(s.getBytes())};x.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};x.ByteStringBuffer.prototype.getInt16=function(){var s=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,s};x.ByteStringBuffer.prototype.getInt24=function(){var s=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,s};x.ByteStringBuffer.prototype.getInt32=function(){var s=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,s};x.ByteStringBuffer.prototype.getInt16Le=function(){var s=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,s};x.ByteStringBuffer.prototype.getInt24Le=function(){var s=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,s};x.ByteStringBuffer.prototype.getInt32Le=function(){var s=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,s};x.ByteStringBuffer.prototype.getInt=function(s){ah(s);var e=0;do e=(e<<8)+this.data.charCodeAt(this.read++),s-=8;while(s>0);return e};x.ByteStringBuffer.prototype.getSignedInt=function(s){var e=this.getInt(s),t=2<<s-2;return e>=t&&(e-=t<<1),e};x.ByteStringBuffer.prototype.getBytes=function(s){var e;return s?(s=Math.min(this.length(),s),e=this.data.slice(this.read,this.read+s),this.read+=s):s===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};x.ByteStringBuffer.prototype.bytes=function(s){return typeof s>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+s)};x.ByteStringBuffer.prototype.at=function(s){return this.data.charCodeAt(this.read+s)};x.ByteStringBuffer.prototype.setAt=function(s,e){return this.data=this.data.substr(0,this.read+s)+String.fromCharCode(e)+this.data.substr(this.read+s+1),this};x.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)};x.ByteStringBuffer.prototype.copy=function(){var s=x.createBuffer(this.data);return s.read=this.read,s};x.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this};x.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this};x.ByteStringBuffer.prototype.truncate=function(s){var e=Math.max(0,this.length()-s);return this.data=this.data.substr(this.read,e),this.read=0,this};x.ByteStringBuffer.prototype.toHex=function(){for(var s="",e=this.read;e<this.data.length;++e){var t=this.data.charCodeAt(e);t<16&&(s+="0"),s+=t.toString(16)}return s};x.ByteStringBuffer.prototype.toString=function(){return x.decodeUtf8(this.bytes())};function P1(s,e){e=e||{},this.read=e.readOffset||0,this.growSize=e.growSize||1024;var t=x.isArrayBuffer(s),r=x.isArrayBufferView(s);if(t||r){t?this.data=new DataView(s):this.data=new DataView(s.buffer,s.byteOffset,s.byteLength),this.write="writeOffset"in e?e.writeOffset:this.data.byteLength;return}this.data=new DataView(new ArrayBuffer(0)),this.write=0,s!=null&&this.putBytes(s),"writeOffset"in e&&(this.write=e.writeOffset)}x.DataBuffer=P1;x.DataBuffer.prototype.length=function(){return this.write-this.read};x.DataBuffer.prototype.isEmpty=function(){return this.length()<=0};x.DataBuffer.prototype.accommodate=function(s,e){if(this.length()>=s)return this;e=Math.max(e||this.growSize,s);var t=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),r=new Uint8Array(this.length()+e);return r.set(t),this.data=new DataView(r.buffer),this};x.DataBuffer.prototype.putByte=function(s){return this.accommodate(1),this.data.setUint8(this.write++,s),this};x.DataBuffer.prototype.fillWithByte=function(s,e){this.accommodate(e);for(var t=0;t<e;++t)this.data.setUint8(s);return this};x.DataBuffer.prototype.putBytes=function(s,e){if(x.isArrayBufferView(s)){var t=new Uint8Array(s.buffer,s.byteOffset,s.byteLength),r=t.byteLength-t.byteOffset;this.accommodate(r);var a=new Uint8Array(this.data.buffer,this.write);return a.set(t),this.write+=r,this}if(x.isArrayBuffer(s)){var t=new Uint8Array(s);this.accommodate(t.byteLength);var a=new Uint8Array(this.data.buffer);return a.set(t,this.write),this.write+=t.byteLength,this}if(s instanceof x.DataBuffer||typeof s=="object"&&typeof s.read=="number"&&typeof s.write=="number"&&x.isArrayBufferView(s.data)){var t=new Uint8Array(s.data.byteLength,s.read,s.length());this.accommodate(t.byteLength);var a=new Uint8Array(s.data.byteLength,this.write);return a.set(t),this.write+=t.byteLength,this}if(s instanceof x.ByteStringBuffer&&(s=s.data,e="binary"),e=e||"binary",typeof s=="string"){var n;if(e==="hex")return this.accommodate(Math.ceil(s.length/2)),n=new Uint8Array(this.data.buffer,this.write),this.write+=x.binary.hex.decode(s,n,this.write),this;if(e==="base64")return this.accommodate(Math.ceil(s.length/4)*3),n=new Uint8Array(this.data.buffer,this.write),this.write+=x.binary.base64.decode(s,n,this.write),this;if(e==="utf8"&&(s=x.encodeUtf8(s),e="binary"),e==="binary"||e==="raw")return this.accommodate(s.length),n=new Uint8Array(this.data.buffer,this.write),this.write+=x.binary.raw.decode(n),this;if(e==="utf16")return this.accommodate(s.length*2),n=new Uint16Array(this.data.buffer,this.write),this.write+=x.text.utf16.encode(n),this;throw new Error("Invalid encoding: "+e)}throw Error("Invalid parameter: "+s)};x.DataBuffer.prototype.putBuffer=function(s){return this.putBytes(s),s.clear(),this};x.DataBuffer.prototype.putString=function(s){return this.putBytes(s,"utf16")};x.DataBuffer.prototype.putInt16=function(s){return this.accommodate(2),this.data.setInt16(this.write,s),this.write+=2,this};x.DataBuffer.prototype.putInt24=function(s){return this.accommodate(3),this.data.setInt16(this.write,s>>8&65535),this.data.setInt8(this.write,s>>16&255),this.write+=3,this};x.DataBuffer.prototype.putInt32=function(s){return this.accommodate(4),this.data.setInt32(this.write,s),this.write+=4,this};x.DataBuffer.prototype.putInt16Le=function(s){return this.accommodate(2),this.data.setInt16(this.write,s,!0),this.write+=2,this};x.DataBuffer.prototype.putInt24Le=function(s){return this.accommodate(3),this.data.setInt8(this.write,s>>16&255),this.data.setInt16(this.write,s>>8&65535,!0),this.write+=3,this};x.DataBuffer.prototype.putInt32Le=function(s){return this.accommodate(4),this.data.setInt32(this.write,s,!0),this.write+=4,this};x.DataBuffer.prototype.putInt=function(s,e){ah(e),this.accommodate(e/8);do e-=8,this.data.setInt8(this.write++,s>>e&255);while(e>0);return this};x.DataBuffer.prototype.putSignedInt=function(s,e){return ah(e),this.accommodate(e/8),s<0&&(s+=2<<e-1),this.putInt(s,e)};x.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)};x.DataBuffer.prototype.getInt16=function(){var s=this.data.getInt16(this.read);return this.read+=2,s};x.DataBuffer.prototype.getInt24=function(){var s=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,s};x.DataBuffer.prototype.getInt32=function(){var s=this.data.getInt32(this.read);return this.read+=4,s};x.DataBuffer.prototype.getInt16Le=function(){var s=this.data.getInt16(this.read,!0);return this.read+=2,s};x.DataBuffer.prototype.getInt24Le=function(){var s=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,s};x.DataBuffer.prototype.getInt32Le=function(){var s=this.data.getInt32(this.read,!0);return this.read+=4,s};x.DataBuffer.prototype.getInt=function(s){ah(s);var e=0;do e=(e<<8)+this.data.getInt8(this.read++),s-=8;while(s>0);return e};x.DataBuffer.prototype.getSignedInt=function(s){var e=this.getInt(s),t=2<<s-2;return e>=t&&(e-=t<<1),e};x.DataBuffer.prototype.getBytes=function(s){var e;return s?(s=Math.min(this.length(),s),e=this.data.slice(this.read,this.read+s),this.read+=s):s===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};x.DataBuffer.prototype.bytes=function(s){return typeof s>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+s)};x.DataBuffer.prototype.at=function(s){return this.data.getUint8(this.read+s)};x.DataBuffer.prototype.setAt=function(s,e){return this.data.setUint8(s,e),this};x.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)};x.DataBuffer.prototype.copy=function(){return new x.DataBuffer(this)};x.DataBuffer.prototype.compact=function(){if(this.read>0){var s=new Uint8Array(this.data.buffer,this.read),e=new Uint8Array(s.byteLength);e.set(s),this.data=new DataView(e),this.write-=this.read,this.read=0}return this};x.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this};x.DataBuffer.prototype.truncate=function(s){return this.write=Math.max(0,this.length()-s),this.read=Math.min(this.read,this.write),this};x.DataBuffer.prototype.toHex=function(){for(var s="",e=this.read;e<this.data.byteLength;++e){var t=this.data.getUint8(e);t<16&&(s+="0"),s+=t.toString(16)}return s};x.DataBuffer.prototype.toString=function(s){var e=new Uint8Array(this.data,this.read,this.length());if(s=s||"utf8",s==="binary"||s==="raw")return x.binary.raw.encode(e);if(s==="hex")return x.binary.hex.encode(e);if(s==="base64")return x.binary.base64.encode(e);if(s==="utf8")return x.text.utf8.decode(e);if(s==="utf16")return x.text.utf16.decode(e);throw new Error("Invalid encoding: "+s)};x.createBuffer=function(s,e){return e=e||"raw",s!==void 0&&e==="utf8"&&(s=x.encodeUtf8(s)),new x.ByteBuffer(s)};x.fillString=function(s,e){for(var t="";e>0;)e&1&&(t+=s),e>>>=1,e>0&&(s+=s);return t};x.xorBytes=function(s,e,t){for(var r="",a="",n="",i=0,o=0;t>0;--t,++i)a=s.charCodeAt(i)^e.charCodeAt(i),o>=10&&(r+=n,n="",o=0),n+=String.fromCharCode(a),++o;return r+=n,r};x.hexToBytes=function(s){var e="",t=0;for(s.length&!0&&(t=1,e+=String.fromCharCode(parseInt(s[0],16)));t<s.length;t+=2)e+=String.fromCharCode(parseInt(s.substr(t,2),16));return e};x.bytesToHex=function(s){return x.createBuffer(s).toHex()};x.int32ToBytes=function(s){return String.fromCharCode(s>>24&255)+String.fromCharCode(s>>16&255)+String.fromCharCode(s>>8&255)+String.fromCharCode(s&255)};var un="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",cn=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],zp="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";x.encode64=function(s,e){for(var t="",r="",a,n,i,o=0;o<s.length;)a=s.charCodeAt(o++),n=s.charCodeAt(o++),i=s.charCodeAt(o++),t+=un.charAt(a>>2),t+=un.charAt((a&3)<<4|n>>4),isNaN(n)?t+="==":(t+=un.charAt((n&15)<<2|i>>6),t+=isNaN(i)?"=":un.charAt(i&63)),e&&t.length>e&&(r+=t.substr(0,e)+`\r
`,t=t.substr(e));return r+=t,r};x.decode64=function(s){s=s.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var e="",t,r,a,n,i=0;i<s.length;)t=cn[s.charCodeAt(i++)-43],r=cn[s.charCodeAt(i++)-43],a=cn[s.charCodeAt(i++)-43],n=cn[s.charCodeAt(i++)-43],e+=String.fromCharCode(t<<2|r>>4),a!==64&&(e+=String.fromCharCode((r&15)<<4|a>>2),n!==64&&(e+=String.fromCharCode((a&3)<<6|n)));return e};x.encodeUtf8=function(s){return unescape(encodeURIComponent(s))};x.decodeUtf8=function(s){return decodeURIComponent(escape(s))};x.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:Om.encode,decode:Om.decode}};x.binary.raw.encode=function(s){return String.fromCharCode.apply(null,s)};x.binary.raw.decode=function(s,e,t){var r=e;r||(r=new Uint8Array(s.length)),t=t||0;for(var a=t,n=0;n<s.length;++n)r[a++]=s.charCodeAt(n);return e?a-t:r};x.binary.hex.encode=x.bytesToHex;x.binary.hex.decode=function(s,e,t){var r=e;r||(r=new Uint8Array(Math.ceil(s.length/2))),t=t||0;var a=0,n=t;for(s.length&1&&(a=1,r[n++]=parseInt(s[0],16));a<s.length;a+=2)r[n++]=parseInt(s.substr(a,2),16);return e?n-t:r};x.binary.base64.encode=function(s,e){for(var t="",r="",a,n,i,o=0;o<s.byteLength;)a=s[o++],n=s[o++],i=s[o++],t+=un.charAt(a>>2),t+=un.charAt((a&3)<<4|n>>4),isNaN(n)?t+="==":(t+=un.charAt((n&15)<<2|i>>6),t+=isNaN(i)?"=":un.charAt(i&63)),e&&t.length>e&&(r+=t.substr(0,e)+`\r
`,t=t.substr(e));return r+=t,r};x.binary.base64.decode=function(s,e,t){var r=e;r||(r=new Uint8Array(Math.ceil(s.length/4)*3)),s=s.replace(/[^A-Za-z0-9\+\/\=]/g,""),t=t||0;for(var a,n,i,o,l=0,u=t;l<s.length;)a=cn[s.charCodeAt(l++)-43],n=cn[s.charCodeAt(l++)-43],i=cn[s.charCodeAt(l++)-43],o=cn[s.charCodeAt(l++)-43],r[u++]=a<<2|n>>4,i!==64&&(r[u++]=(n&15)<<4|i>>2,o!==64&&(r[u++]=(i&3)<<6|o));return e?u-t:r.subarray(0,u)};x.binary.base58.encode=function(s,e){return x.binary.baseN.encode(s,zp,e)};x.binary.base58.decode=function(s,e){return x.binary.baseN.decode(s,zp,e)};x.text={utf8:{},utf16:{}};x.text.utf8.encode=function(s,e,t){s=x.encodeUtf8(s);var r=e;r||(r=new Uint8Array(s.length)),t=t||0;for(var a=t,n=0;n<s.length;++n)r[a++]=s.charCodeAt(n);return e?a-t:r};x.text.utf8.decode=function(s){return x.decodeUtf8(String.fromCharCode.apply(null,s))};x.text.utf16.encode=function(s,e,t){var r=e;r||(r=new Uint8Array(s.length*2));var a=new Uint16Array(r.buffer);t=t||0;for(var n=t,i=t,o=0;o<s.length;++o)a[i++]=s.charCodeAt(o),n+=2;return e?n-t:r};x.text.utf16.decode=function(s){return String.fromCharCode.apply(null,new Uint16Array(s.buffer))};x.deflate=function(s,e,t){if(e=x.decode64(s.deflate(x.encode64(e)).rval),t){var r=2,a=e.charCodeAt(1);a&32&&(r=6),e=e.substring(r,e.length-4)}return e};x.inflate=function(s,e,t){var r=s.inflate(x.encode64(e)).rval;return r===null?null:x.decode64(r)};var Jg=function(s,e,t){if(!s)throw new Error("WebStorage not available.");var r;if(t===null?r=s.removeItem(e):(t=x.encode64(JSON.stringify(t)),r=s.setItem(e,t)),typeof r<"u"&&r.rval!==!0){var a=new Error(r.error.message);throw a.id=r.error.id,a.name=r.error.name,a}},Gg=function(s,e){if(!s)throw new Error("WebStorage not available.");var t=s.getItem(e);if(s.init)if(t.rval===null){if(t.error){var r=new Error(t.error.message);throw r.id=t.error.id,r.name=t.error.name,r}t=null}else t=t.rval;return t!==null&&(t=JSON.parse(x.decode64(t))),t},U1=function(s,e,t,r){var a=Gg(s,e);a===null&&(a={}),a[t]=r,Jg(s,e,a)},K1=function(s,e,t){var r=Gg(s,e);return r!==null&&(r=t in r?r[t]:null),r},M1=function(s,e,t){var r=Gg(s,e);if(r!==null&&t in r){delete r[t];var a=!0;for(var n in r){a=!1;break}a&&(r=null),Jg(s,e,r)}},H1=function(s,e){Jg(s,e,null)},z0=function(s,e,t){var r=null;typeof t>"u"&&(t=["web","flash"]);var a,n=!1,i=null;for(var o in t){a=t[o];try{if(a==="flash"||a==="both"){if(e[0]===null)throw new Error("Flash local storage not available.");r=s.apply(this,e),n=a==="flash"}(a==="web"||a==="both")&&(e[0]=localStorage,r=s.apply(this,e),n=!0)}catch(l){i=l}if(n)break}if(!n)throw i;return r};x.setItem=function(s,e,t,r,a){z0(U1,arguments,a)};x.getItem=function(s,e,t,r){return z0(K1,arguments,r)};x.removeItem=function(s,e,t,r){z0(M1,arguments,r)};x.clearItems=function(s,e,t){z0(H1,arguments,t)};x.isEmpty=function(s){for(var e in s)if(s.hasOwnProperty(e))return!1;return!0};x.format=function(s){for(var e=/%./g,t,r,a=0,n=[],i=0;t=e.exec(s);){r=s.substring(i,e.lastIndex-2),r.length>0&&n.push(r),i=e.lastIndex;var o=t[0][1];switch(o){case"s":case"o":a<arguments.length?n.push(arguments[a+++1]):n.push("<?>");break;case"%":n.push("%");break;default:n.push("<%"+o+"?>")}}return n.push(s.substring(i)),n.join("")};x.formatNumber=function(s,e,t,r){var a=s,n=isNaN(e=Math.abs(e))?2:e,i=t===void 0?",":t,o=r===void 0?".":r,l=a<0?"-":"",u=parseInt(a=Math.abs(+a||0).toFixed(n),10)+"",c=u.length>3?u.length%3:0;return l+(c?u.substr(0,c)+o:"")+u.substr(c).replace(/(\d{3})(?=\d)/g,"$1"+o)+(n?i+Math.abs(a-u).toFixed(n).slice(2):"")};x.formatSize=function(s){return s>=1073741824?s=x.formatNumber(s/1073741824,2,".","")+" GiB":s>=1048576?s=x.formatNumber(s/1048576,2,".","")+" MiB":s>=1024?s=x.formatNumber(s/1024,0)+" KiB":s=x.formatNumber(s,0)+" bytes",s};x.bytesFromIP=function(s){return s.indexOf(".")!==-1?x.bytesFromIPv4(s):s.indexOf(":")!==-1?x.bytesFromIPv6(s):null};x.bytesFromIPv4=function(s){if(s=s.split("."),s.length!==4)return null;for(var e=x.createBuffer(),t=0;t<s.length;++t){var r=parseInt(s[t],10);if(isNaN(r))return null;e.putByte(r)}return e.getBytes()};x.bytesFromIPv6=function(s){var e=0;s=s.split(":").filter(function(i){return i.length===0&&++e,!0});for(var t=(8-s.length+e)*2,r=x.createBuffer(),a=0;a<8;++a){if(!s[a]||s[a].length===0){r.fillWithByte(0,t),t=0;continue}var n=x.hexToBytes(s[a]);n.length<2&&r.putByte(0),r.putBytes(n)}return r.getBytes()};x.bytesToIP=function(s){return s.length===4?x.bytesToIPv4(s):s.length===16?x.bytesToIPv6(s):null};x.bytesToIPv4=function(s){if(s.length!==4)return null;for(var e=[],t=0;t<s.length;++t)e.push(s.charCodeAt(t));return e.join(".")};x.bytesToIPv6=function(s){if(s.length!==16)return null;for(var e=[],t=[],r=0,a=0;a<s.length;a+=2){for(var n=x.bytesToHex(s[a]+s[a+1]);n[0]==="0"&&n!=="0";)n=n.substr(1);if(n==="0"){var i=t[t.length-1],o=e.length;!i||o!==i.end+1?t.push({start:o,end:o}):(i.end=o,i.end-i.start>t[r].end-t[r].start&&(r=t.length-1))}e.push(n)}if(t.length>0){var l=t[r];l.end-l.start>0&&(e.splice(l.start,l.end-l.start+1,""),l.start===0&&e.unshift(""),l.end===7&&e.push(""))}return e.join(":")};x.estimateCores=function(s,e){if(typeof s=="function"&&(e=s,s={}),s=s||{},"cores"in x&&!s.update)return e(null,x.cores);if(typeof navigator<"u"&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return x.cores=navigator.hardwareConcurrency,e(null,x.cores);if(typeof Worker>"u")return x.cores=1,e(null,x.cores);if(typeof Blob>"u")return x.cores=2,e(null,x.cores);var t=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(i){var o=Date.now(),l=o+4;self.postMessage({st:o,et:l})})}.toString(),")()"],{type:"application/javascript"}));r([],5,16);function r(i,o,l){if(o===0){var u=Math.floor(i.reduce(function(c,f){return c+f},0)/i.length);return x.cores=Math.max(1,u),URL.revokeObjectURL(t),e(null,x.cores)}a(l,function(c,f){i.push(n(l,f)),r(i,o-1,l)})}function a(i,o){for(var l=[],u=[],c=0;c<i;++c){var f=new Worker(t);f.addEventListener("message",function(g){if(u.push(g.data),u.length===i){for(var v=0;v<i;++v)l[v].terminate();o(null,u)}}),l.push(f)}for(var c=0;c<i;++c)l[c].postMessage(c)}function n(i,o){for(var l=[],u=0;u<i;++u)for(var c=o[u],f=l[u]=[],g=0;g<i;++g)if(u!==g){var v=o[g];(c.st>v.st&&c.st<v.et||v.st>c.st&&v.st<c.et)&&f.push(g)}return l.reduce(function(p,h){return Math.max(p,h.length)},0)}};var er=Fe;er.cipher=er.cipher||{};er.cipher.algorithms=er.cipher.algorithms||{};er.cipher.createCipher=function(s,e){var t=s;if(typeof t=="string"&&(t=er.cipher.getAlgorithm(t),t&&(t=t())),!t)throw new Error("Unsupported algorithm: "+s);return new er.cipher.BlockCipher({algorithm:t,key:e,decrypt:!1})};er.cipher.createDecipher=function(s,e){var t=s;if(typeof t=="string"&&(t=er.cipher.getAlgorithm(t),t&&(t=t())),!t)throw new Error("Unsupported algorithm: "+s);return new er.cipher.BlockCipher({algorithm:t,key:e,decrypt:!0})};er.cipher.registerAlgorithm=function(s,e){s=s.toUpperCase(),er.cipher.algorithms[s]=e};er.cipher.getAlgorithm=function(s){return s=s.toUpperCase(),s in er.cipher.algorithms?er.cipher.algorithms[s]:null};var jg=er.cipher.BlockCipher=function(s){this.algorithm=s.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=s.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=s.decrypt,this.algorithm.initialize(s)};jg.prototype.start=function(s){s=s||{};var e={};for(var t in s)e[t]=s[t];e.decrypt=this._decrypt,this._finish=!1,this._input=er.util.createBuffer(),this.output=s.output||er.util.createBuffer(),this.mode.start(e)};jg.prototype.update=function(s){for(s&&this._input.putBuffer(s);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()};jg.prototype.finish=function(s){s&&(this.mode.name==="ECB"||this.mode.name==="CBC")&&(this.mode.pad=function(t){return s(this.blockSize,t,!1)},this.mode.unpad=function(t){return s(this.blockSize,t,!0)});var e={};return e.decrypt=this._decrypt,e.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,e)||(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,e))||this.mode.afterFinish&&!this.mode.afterFinish(this.output,e))};var Zt=Fe;Zt.cipher=Zt.cipher||{};var We=Zt.cipher.modes=Zt.cipher.modes||{};We.ecb=function(s){s=s||{},this.name="ECB",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};We.ecb.prototype.start=function(s){};We.ecb.prototype.encrypt=function(s,e,t){if(s.length()<this.blockSize&&!(t&&s.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=s.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var r=0;r<this._ints;++r)e.putInt32(this._outBlock[r])};We.ecb.prototype.decrypt=function(s,e,t){if(s.length()<this.blockSize&&!(t&&s.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=s.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var r=0;r<this._ints;++r)e.putInt32(this._outBlock[r])};We.ecb.prototype.pad=function(s,e){var t=s.length()===this.blockSize?this.blockSize:this.blockSize-s.length();return s.fillWithByte(t,t),!0};We.ecb.prototype.unpad=function(s,e){if(e.overflow>0)return!1;var t=s.length(),r=s.at(t-1);return r>this.blockSize<<2?!1:(s.truncate(r),!0)};We.cbc=function(s){s=s||{},this.name="CBC",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};We.cbc.prototype.start=function(s){if(s.iv===null){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else if("iv"in s)this._iv=X0(s.iv,this.blockSize),this._prev=this._iv.slice(0);else throw new Error("Invalid IV parameter.")};We.cbc.prototype.encrypt=function(s,e,t){if(s.length()<this.blockSize&&!(t&&s.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=this._prev[r]^s.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var r=0;r<this._ints;++r)e.putInt32(this._outBlock[r]);this._prev=this._outBlock};We.cbc.prototype.decrypt=function(s,e,t){if(s.length()<this.blockSize&&!(t&&s.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=s.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var r=0;r<this._ints;++r)e.putInt32(this._prev[r]^this._outBlock[r]);this._prev=this._inBlock.slice(0)};We.cbc.prototype.pad=function(s,e){var t=s.length()===this.blockSize?this.blockSize:this.blockSize-s.length();return s.fillWithByte(t,t),!0};We.cbc.prototype.unpad=function(s,e){if(e.overflow>0)return!1;var t=s.length(),r=s.at(t-1);return r>this.blockSize<<2?!1:(s.truncate(r),!0)};We.cfb=function(s){s=s||{},this.name="CFB",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=Zt.util.createBuffer(),this._partialBytes=0};We.cfb.prototype.start=function(s){if(!("iv"in s))throw new Error("Invalid IV parameter.");this._iv=X0(s.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};We.cfb.prototype.encrypt=function(s,e,t){var r=s.length();if(r===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&r>=this.blockSize){for(var a=0;a<this._ints;++a)this._inBlock[a]=s.getInt32()^this._outBlock[a],e.putInt32(this._inBlock[a]);return}var n=(this.blockSize-r)%this.blockSize;n>0&&(n=this.blockSize-n),this._partialOutput.clear();for(var a=0;a<this._ints;++a)this._partialBlock[a]=s.getInt32()^this._outBlock[a],this._partialOutput.putInt32(this._partialBlock[a]);if(n>0)s.read-=this.blockSize;else for(var a=0;a<this._ints;++a)this._inBlock[a]=this._partialBlock[a];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),n>0&&!t)return e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=n,!0;e.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0};We.cfb.prototype.decrypt=function(s,e,t){var r=s.length();if(r===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&r>=this.blockSize){for(var a=0;a<this._ints;++a)this._inBlock[a]=s.getInt32(),e.putInt32(this._inBlock[a]^this._outBlock[a]);return}var n=(this.blockSize-r)%this.blockSize;n>0&&(n=this.blockSize-n),this._partialOutput.clear();for(var a=0;a<this._ints;++a)this._partialBlock[a]=s.getInt32(),this._partialOutput.putInt32(this._partialBlock[a]^this._outBlock[a]);if(n>0)s.read-=this.blockSize;else for(var a=0;a<this._ints;++a)this._inBlock[a]=this._partialBlock[a];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),n>0&&!t)return e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=n,!0;e.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0};We.ofb=function(s){s=s||{},this.name="OFB",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=Zt.util.createBuffer(),this._partialBytes=0};We.ofb.prototype.start=function(s){if(!("iv"in s))throw new Error("Invalid IV parameter.");this._iv=X0(s.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};We.ofb.prototype.encrypt=function(s,e,t){var r=s.length();if(s.length()===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&r>=this.blockSize){for(var a=0;a<this._ints;++a)e.putInt32(s.getInt32()^this._outBlock[a]),this._inBlock[a]=this._outBlock[a];return}var n=(this.blockSize-r)%this.blockSize;n>0&&(n=this.blockSize-n),this._partialOutput.clear();for(var a=0;a<this._ints;++a)this._partialOutput.putInt32(s.getInt32()^this._outBlock[a]);if(n>0)s.read-=this.blockSize;else for(var a=0;a<this._ints;++a)this._inBlock[a]=this._outBlock[a];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),n>0&&!t)return e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=n,!0;e.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0};We.ofb.prototype.decrypt=We.ofb.prototype.encrypt;We.ctr=function(s){s=s||{},this.name="CTR",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=Zt.util.createBuffer(),this._partialBytes=0};We.ctr.prototype.start=function(s){if(!("iv"in s))throw new Error("Invalid IV parameter.");this._iv=X0(s.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};We.ctr.prototype.encrypt=function(s,e,t){var r=s.length();if(r===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&r>=this.blockSize)for(var a=0;a<this._ints;++a)e.putInt32(s.getInt32()^this._outBlock[a]);else{var n=(this.blockSize-r)%this.blockSize;n>0&&(n=this.blockSize-n),this._partialOutput.clear();for(var a=0;a<this._ints;++a)this._partialOutput.putInt32(s.getInt32()^this._outBlock[a]);if(n>0&&(s.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),n>0&&!t)return e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=n,!0;e.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}Z0(this._inBlock)};We.ctr.prototype.decrypt=We.ctr.prototype.encrypt;We.gcm=function(s){s=s||{},this.name="GCM",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=Zt.util.createBuffer(),this._partialBytes=0,this._R=3774873600};We.gcm.prototype.start=function(s){if(!("iv"in s))throw new Error("Invalid IV parameter.");var e=Zt.util.createBuffer(s.iv);this._cipherLength=0;var t;if("additionalData"in s?t=Zt.util.createBuffer(s.additionalData):t=Zt.util.createBuffer(),"tagLength"in s?this._tagLength=s.tagLength:this._tagLength=128,this._tag=null,s.decrypt&&(this._tag=Zt.util.createBuffer(s.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var r=e.length();if(r===12)this._j0=[e.getInt32(),e.getInt32(),e.getInt32(),1];else{for(this._j0=[0,0,0,0];e.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(zd(r*8)))}this._inBlock=this._j0.slice(0),Z0(this._inBlock),this._partialBytes=0,t=Zt.util.createBuffer(t),this._aDataLength=zd(t.length()*8);var a=t.length()%this.blockSize;for(a&&t.fillWithByte(0,this.blockSize-a),this._s=[0,0,0,0];t.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()])};We.gcm.prototype.encrypt=function(s,e,t){var r=s.length();if(r===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&r>=this.blockSize){for(var a=0;a<this._ints;++a)e.putInt32(this._outBlock[a]^=s.getInt32());this._cipherLength+=this.blockSize}else{var n=(this.blockSize-r)%this.blockSize;n>0&&(n=this.blockSize-n),this._partialOutput.clear();for(var a=0;a<this._ints;++a)this._partialOutput.putInt32(s.getInt32()^this._outBlock[a]);if(n<=0||t){if(t){var i=r%this.blockSize;this._cipherLength+=i,this._partialOutput.truncate(this.blockSize-i)}else this._cipherLength+=this.blockSize;for(var a=0;a<this._ints;++a)this._outBlock[a]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),n>0&&!t)return s.read-=this.blockSize,e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=n,!0;e.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),Z0(this._inBlock)};We.gcm.prototype.decrypt=function(s,e,t){var r=s.length();if(r<this.blockSize&&!(t&&r>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),Z0(this._inBlock),this._hashBlock[0]=s.getInt32(),this._hashBlock[1]=s.getInt32(),this._hashBlock[2]=s.getInt32(),this._hashBlock[3]=s.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var a=0;a<this._ints;++a)e.putInt32(this._outBlock[a]^this._hashBlock[a]);r<this.blockSize?this._cipherLength+=r%this.blockSize:this._cipherLength+=this.blockSize};We.gcm.prototype.afterFinish=function(s,e){var t=!0;e.decrypt&&e.overflow&&s.truncate(this.blockSize-e.overflow),this.tag=Zt.util.createBuffer();var r=this._aDataLength.concat(zd(this._cipherLength*8));this._s=this.ghash(this._hashSubkey,this._s,r);var a=[];this.cipher.encrypt(this._j0,a);for(var n=0;n<this._ints;++n)this.tag.putInt32(this._s[n]^a[n]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),e.decrypt&&this.tag.bytes()!==this._tag&&(t=!1),t};We.gcm.prototype.multiply=function(s,e){for(var t=[0,0,0,0],r=e.slice(0),a=0;a<128;++a){var n=s[a/32|0]&1<<31-a%32;n&&(t[0]^=r[0],t[1]^=r[1],t[2]^=r[2],t[3]^=r[3]),this.pow(r,r)}return t};We.gcm.prototype.pow=function(s,e){for(var t=s[3]&1,r=3;r>0;--r)e[r]=s[r]>>>1|(s[r-1]&1)<<31;e[0]=s[0]>>>1,t&&(e[0]^=this._R)};We.gcm.prototype.tableMultiply=function(s){for(var e=[0,0,0,0],t=0;t<32;++t){var r=t/8|0,a=s[r]>>>(7-t%8)*4&15,n=this._m[t][a];e[0]^=n[0],e[1]^=n[1],e[2]^=n[2],e[3]^=n[3]}return e};We.gcm.prototype.ghash=function(s,e,t){return e[0]^=t[0],e[1]^=t[1],e[2]^=t[2],e[3]^=t[3],this.tableMultiply(e)};We.gcm.prototype.generateHashTable=function(s,e){for(var t=8/e,r=4*t,a=16*t,n=new Array(a),i=0;i<a;++i){var o=[0,0,0,0],l=i/r|0,u=(r-1-i%r)*e;o[l]=1<<e-1<<u,n[i]=this.generateSubHashTable(this.multiply(o,s),e)}return n};We.gcm.prototype.generateSubHashTable=function(s,e){var t=1<<e,r=t>>>1,a=new Array(t);a[r]=s.slice(0);for(var n=r>>>1;n>0;)this.pow(a[2*n],a[n]=[]),n>>=1;for(n=2;n<r;){for(var i=1;i<n;++i){var o=a[n],l=a[i];a[n+i]=[o[0]^l[0],o[1]^l[1],o[2]^l[2],o[3]^l[3]]}n*=2}for(a[0]=[0,0,0,0],n=r+1;n<t;++n){var u=a[n^r];a[n]=[s[0]^u[0],s[1]^u[1],s[2]^u[2],s[3]^u[3]]}return a};function X0(s,e){if(typeof s=="string"&&(s=Zt.util.createBuffer(s)),Zt.util.isArray(s)&&s.length>4){var t=s;s=Zt.util.createBuffer();for(var r=0;r<t.length;++r)s.putByte(t[r])}if(s.length()<e)throw new Error("Invalid IV length; got "+s.length()+" bytes and expected "+e+" bytes.");if(!Zt.util.isArray(s)){for(var a=[],n=e/4,r=0;r<n;++r)a.push(s.getInt32());s=a}return s}function Z0(s){s[s.length-1]=s[s.length-1]+1&4294967295}function zd(s){return[s/4294967296|0,s&4294967295]}var gt=Fe;gt.aes=gt.aes||{};gt.aes.startEncrypting=function(s,e,t,r){var a=ed({key:s,output:t,decrypt:!1,mode:r});return a.start(e),a};gt.aes.createEncryptionCipher=function(s,e){return ed({key:s,output:null,decrypt:!1,mode:e})};gt.aes.startDecrypting=function(s,e,t,r){var a=ed({key:s,output:t,decrypt:!0,mode:r});return a.start(e),a};gt.aes.createDecryptionCipher=function(s,e){return ed({key:s,output:null,decrypt:!0,mode:e})};gt.aes.Algorithm=function(s,e){Wg||Zp();var t=this;t.name=s,t.mode=new e({blockSize:16,cipher:{encrypt:function(r,a){return Zd(t._w,r,a,!1)},decrypt:function(r,a){return Zd(t._w,r,a,!0)}}}),t._init=!1};gt.aes.Algorithm.prototype.initialize=function(s){if(!this._init){var e=s.key,t;if(typeof e=="string"&&(e.length===16||e.length===24||e.length===32))e=gt.util.createBuffer(e);else if(gt.util.isArray(e)&&(e.length===16||e.length===24||e.length===32)){t=e,e=gt.util.createBuffer();for(var r=0;r<t.length;++r)e.putByte(t[r])}if(!gt.util.isArray(e)){t=e,e=[];var a=t.length();if(a===16||a===24||a===32){a=a>>>2;for(var r=0;r<a;++r)e.push(t.getInt32())}}if(!gt.util.isArray(e)||!(e.length===4||e.length===6||e.length===8))throw new Error("Invalid key parameter.");var n=this.mode.name,i=["CFB","OFB","CTR","GCM"].indexOf(n)!==-1;this._w=ey(e,s.decrypt&&!i),this._init=!0}};gt.aes._expandKey=function(s,e){return Wg||Zp(),ey(s,e)};gt.aes._updateBlock=Zd;gu("AES-ECB",gt.cipher.modes.ecb);gu("AES-CBC",gt.cipher.modes.cbc);gu("AES-CFB",gt.cipher.modes.cfb);gu("AES-OFB",gt.cipher.modes.ofb);gu("AES-CTR",gt.cipher.modes.ctr);gu("AES-GCM",gt.cipher.modes.gcm);function gu(s,e){var t=function(){return new gt.aes.Algorithm(s,e)};gt.cipher.registerAlgorithm(s,t)}var Wg=!1,mo=4,cr,Xd,Xp,Fi,cs;function Zp(){Wg=!0,Xp=[0,1,2,4,8,16,32,64,128,27,54];for(var s=new Array(256),e=0;e<128;++e)s[e]=e<<1,s[e+128]=e+128<<1^283;cr=new Array(256),Xd=new Array(256),Fi=new Array(4),cs=new Array(4);for(var e=0;e<4;++e)Fi[e]=new Array(256),cs[e]=new Array(256);for(var t=0,r=0,a,n,i,o,l,u,c,e=0;e<256;++e){o=r^r<<1^r<<2^r<<3^r<<4,o=o>>8^o&255^99,cr[t]=o,Xd[o]=t,l=s[o],a=s[t],n=s[a],i=s[n],u=l<<24^o<<16^o<<8^(o^l),c=(a^n^i)<<24^(t^i)<<16^(t^n^i)<<8^(t^a^i);for(var f=0;f<4;++f)Fi[f][t]=u,cs[f][o]=c,u=u<<24|u>>>8,c=c<<24|c>>>8;t===0?t=r=1:(t=a^s[s[s[a^i]]],r^=s[s[r]])}}function ey(s,e){for(var t=s.slice(0),r,a=1,n=t.length,i=n+6+1,o=mo*i,l=n;l<o;++l)r=t[l-1],l%n===0?(r=cr[r>>>16&255]<<24^cr[r>>>8&255]<<16^cr[r&255]<<8^cr[r>>>24]^Xp[a]<<24,a++):n>6&&l%n===4&&(r=cr[r>>>24]<<24^cr[r>>>16&255]<<16^cr[r>>>8&255]<<8^cr[r&255]),t[l]=t[l-n]^r;if(e){var u,c=cs[0],f=cs[1],g=cs[2],v=cs[3],p=t.slice(0);o=t.length;for(var l=0,h=o-mo;l<o;l+=mo,h-=mo)if(l===0||l===o-mo)p[l]=t[h],p[l+1]=t[h+3],p[l+2]=t[h+2],p[l+3]=t[h+1];else for(var d=0;d<mo;++d)u=t[h+d],p[l+(3&-d)]=c[cr[u>>>24]]^f[cr[u>>>16&255]]^g[cr[u>>>8&255]]^v[cr[u&255]];t=p}return t}function Zd(s,e,t,r){var a=s.length/4-1,n,i,o,l,u;r?(n=cs[0],i=cs[1],o=cs[2],l=cs[3],u=Xd):(n=Fi[0],i=Fi[1],o=Fi[2],l=Fi[3],u=cr);var c,f,g,v,p,h,d;c=e[0]^s[0],f=e[r?3:1]^s[1],g=e[2]^s[2],v=e[r?1:3]^s[3];for(var y=3,E=1;E<a;++E)p=n[c>>>24]^i[f>>>16&255]^o[g>>>8&255]^l[v&255]^s[++y],h=n[f>>>24]^i[g>>>16&255]^o[v>>>8&255]^l[c&255]^s[++y],d=n[g>>>24]^i[v>>>16&255]^o[c>>>8&255]^l[f&255]^s[++y],v=n[v>>>24]^i[c>>>16&255]^o[f>>>8&255]^l[g&255]^s[++y],c=p,f=h,g=d;t[0]=u[c>>>24]<<24^u[f>>>16&255]<<16^u[g>>>8&255]<<8^u[v&255]^s[++y],t[r?3:1]=u[f>>>24]<<24^u[g>>>16&255]<<16^u[v>>>8&255]<<8^u[c&255]^s[++y],t[2]=u[g>>>24]<<24^u[v>>>16&255]<<16^u[c>>>8&255]<<8^u[f&255]^s[++y],t[r?1:3]=u[v>>>24]<<24^u[c>>>16&255]<<16^u[f>>>8&255]<<8^u[g&255]^s[++y]}function ed(s){s=s||{};var e=(s.mode||"CBC").toUpperCase(),t="AES-"+e,r;s.decrypt?r=gt.cipher.createDecipher(t,s.key):r=gt.cipher.createCipher(t,s.key);var a=r.start;return r.start=function(n,i){var o=null;i instanceof gt.util.ByteBuffer&&(o=i,i={}),i=i||{},i.output=o,i.iv=n,a.call(r,i)},r}var Df=Fe;Df.pki=Df.pki||{};var eg=Df.pki.oids=Df.oids=Df.oids||{};function X(s,e){eg[s]=e,eg[e]=s}function nt(s,e){eg[s]=e}X("1.2.840.113549.1.1.1","rsaEncryption");X("1.2.840.113549.1.1.4","md5WithRSAEncryption");X("1.2.840.113549.1.1.5","sha1WithRSAEncryption");X("1.2.840.113549.1.1.7","RSAES-OAEP");X("1.2.840.113549.1.1.8","mgf1");X("1.2.840.113549.1.1.9","pSpecified");X("1.2.840.113549.1.1.10","RSASSA-PSS");X("1.2.840.113549.1.1.11","sha256WithRSAEncryption");X("1.2.840.113549.1.1.12","sha384WithRSAEncryption");X("1.2.840.113549.1.1.13","sha512WithRSAEncryption");X("1.3.101.112","EdDSA25519");X("1.2.840.10040.4.3","dsa-with-sha1");X("1.3.14.3.2.7","desCBC");X("1.3.14.3.2.26","sha1");X("1.3.14.3.2.29","sha1WithRSASignature");X("2.16.840.1.101.3.4.2.1","sha256");X("2.16.840.1.101.3.4.2.2","sha384");X("2.16.840.1.101.3.4.2.3","sha512");X("2.16.840.1.101.3.4.2.4","sha224");X("2.16.840.1.101.3.4.2.5","sha512-224");X("2.16.840.1.101.3.4.2.6","sha512-256");X("1.2.840.113549.2.2","md2");X("1.2.840.113549.2.5","md5");X("1.2.840.113549.1.7.1","data");X("1.2.840.113549.1.7.2","signedData");X("1.2.840.113549.1.7.3","envelopedData");X("1.2.840.113549.1.7.4","signedAndEnvelopedData");X("1.2.840.113549.1.7.5","digestedData");X("1.2.840.113549.1.7.6","encryptedData");X("1.2.840.113549.1.9.1","emailAddress");X("1.2.840.113549.1.9.2","unstructuredName");X("1.2.840.113549.1.9.3","contentType");X("1.2.840.113549.1.9.4","messageDigest");X("1.2.840.113549.1.9.5","signingTime");X("1.2.840.113549.1.9.6","counterSignature");X("1.2.840.113549.1.9.7","challengePassword");X("1.2.840.113549.1.9.8","unstructuredAddress");X("1.2.840.113549.1.9.14","extensionRequest");X("1.2.840.113549.1.9.20","friendlyName");X("1.2.840.113549.1.9.21","localKeyId");X("1.2.840.113549.1.9.22.1","x509Certificate");X("1.2.840.113549.1.12.10.1.1","keyBag");X("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag");X("1.2.840.113549.1.12.10.1.3","certBag");X("1.2.840.113549.1.12.10.1.4","crlBag");X("1.2.840.113549.1.12.10.1.5","secretBag");X("1.2.840.113549.1.12.10.1.6","safeContentsBag");X("1.2.840.113549.1.5.13","pkcs5PBES2");X("1.2.840.113549.1.5.12","pkcs5PBKDF2");X("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4");X("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4");X("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC");X("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC");X("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC");X("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC");X("1.2.840.113549.2.7","hmacWithSHA1");X("1.2.840.113549.2.8","hmacWithSHA224");X("1.2.840.113549.2.9","hmacWithSHA256");X("1.2.840.113549.2.10","hmacWithSHA384");X("1.2.840.113549.2.11","hmacWithSHA512");X("1.2.840.113549.3.7","des-EDE3-CBC");X("2.16.840.1.101.3.4.1.2","aes128-CBC");X("2.16.840.1.101.3.4.1.22","aes192-CBC");X("2.16.840.1.101.3.4.1.42","aes256-CBC");X("2.5.4.3","commonName");X("2.5.4.4","surname");X("2.5.4.5","serialNumber");X("2.5.4.6","countryName");X("2.5.4.7","localityName");X("2.5.4.8","stateOrProvinceName");X("2.5.4.9","streetAddress");X("2.5.4.10","organizationName");X("2.5.4.11","organizationalUnitName");X("2.5.4.12","title");X("2.5.4.13","description");X("2.5.4.15","businessCategory");X("2.5.4.17","postalCode");X("2.5.4.42","givenName");X("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName");X("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName");X("2.16.840.1.113730.1.1","nsCertType");X("2.16.840.1.113730.1.13","nsComment");nt("2.5.29.1","authorityKeyIdentifier");nt("2.5.29.2","keyAttributes");nt("2.5.29.3","certificatePolicies");nt("2.5.29.4","keyUsageRestriction");nt("2.5.29.5","policyMapping");nt("2.5.29.6","subtreesConstraint");nt("2.5.29.7","subjectAltName");nt("2.5.29.8","issuerAltName");nt("2.5.29.9","subjectDirectoryAttributes");nt("2.5.29.10","basicConstraints");nt("2.5.29.11","nameConstraints");nt("2.5.29.12","policyConstraints");nt("2.5.29.13","basicConstraints");X("2.5.29.14","subjectKeyIdentifier");X("2.5.29.15","keyUsage");nt("2.5.29.16","privateKeyUsagePeriod");X("2.5.29.17","subjectAltName");X("2.5.29.18","issuerAltName");X("2.5.29.19","basicConstraints");nt("2.5.29.20","cRLNumber");nt("2.5.29.21","cRLReason");nt("2.5.29.22","expirationDate");nt("2.5.29.23","instructionCode");nt("2.5.29.24","invalidityDate");nt("2.5.29.25","cRLDistributionPoints");nt("2.5.29.26","issuingDistributionPoint");nt("2.5.29.27","deltaCRLIndicator");nt("2.5.29.28","issuingDistributionPoint");nt("2.5.29.29","certificateIssuer");nt("2.5.29.30","nameConstraints");X("2.5.29.31","cRLDistributionPoints");X("2.5.29.32","certificatePolicies");nt("2.5.29.33","policyMappings");nt("2.5.29.34","policyConstraints");X("2.5.29.35","authorityKeyIdentifier");nt("2.5.29.36","policyConstraints");X("2.5.29.37","extKeyUsage");nt("2.5.29.46","freshestCRL");nt("2.5.29.54","inhibitAnyPolicy");X("1.3.6.1.4.1.11129.2.4.2","timestampList");X("1.3.6.1.5.5.7.1.1","authorityInfoAccess");X("1.3.6.1.5.5.7.3.1","serverAuth");X("1.3.6.1.5.5.7.3.2","clientAuth");X("1.3.6.1.5.5.7.3.3","codeSigning");X("1.3.6.1.5.5.7.3.4","emailProtection");X("1.3.6.1.5.5.7.3.8","timeStamping");var vt=Fe,ue=vt.asn1=vt.asn1||{};ue.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192};ue.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30};ue.create=function(s,e,t,r,a){if(vt.util.isArray(r)){for(var n=[],i=0;i<r.length;++i)r[i]!==void 0&&n.push(r[i]);r=n}var o={tagClass:s,type:e,constructed:t,composed:t||vt.util.isArray(r),value:r};return a&&"bitStringContents"in a&&(o.bitStringContents=a.bitStringContents,o.original=ue.copy(o)),o};ue.copy=function(s,e){var t;if(vt.util.isArray(s)){t=[];for(var r=0;r<s.length;++r)t.push(ue.copy(s[r],e));return t}return typeof s=="string"?s:(t={tagClass:s.tagClass,type:s.type,constructed:s.constructed,composed:s.composed,value:ue.copy(s.value,e)},e&&!e.excludeBitStringContents&&(t.bitStringContents=s.bitStringContents),t)};ue.equals=function(s,e,t){if(vt.util.isArray(s)){if(!vt.util.isArray(e)||s.length!==e.length)return!1;for(var r=0;r<s.length;++r)if(!ue.equals(s[r],e[r]))return!1;return!0}if(typeof s!=typeof e)return!1;if(typeof s=="string")return s===e;var a=s.tagClass===e.tagClass&&s.type===e.type&&s.constructed===e.constructed&&s.composed===e.composed&&ue.equals(s.value,e.value);return t&&t.includeBitStringContents&&(a=a&&s.bitStringContents===e.bitStringContents),a};ue.getBerValueLength=function(s){var e=s.getByte();if(e!==128){var t,r=e&128;return r?t=s.getInt((e&127)<<3):t=e,t}};function Ou(s,e,t){if(t>e){var r=new Error("Too few bytes to parse DER.");throw r.available=s.length(),r.remaining=e,r.requested=t,r}}var F1=function(s,e){var t=s.getByte();if(e--,t!==128){var r,a=t&128;if(!a)r=t;else{var n=t&127;Ou(s,e,n),r=s.getInt(n<<3)}if(r<0)throw new Error("Negative length: "+r);return r}};ue.fromDer=function(s,e){e===void 0&&(e={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),typeof e=="boolean"&&(e={strict:e,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in e||(e.strict=!0),"parseAllBytes"in e||(e.parseAllBytes=!0),"decodeBitStrings"in e||(e.decodeBitStrings=!0),typeof s=="string"&&(s=vt.util.createBuffer(s));var t=s.length(),r=Mh(s,s.length(),0,e);if(e.parseAllBytes&&s.length()!==0){var a=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw a.byteCount=t,a.remaining=s.length(),a}return r};function Mh(s,e,t,r){var a;Ou(s,e,2);var n=s.getByte();e--;var i=n&192,o=n&31;a=s.length();var l=F1(s,e);if(e-=a-s.length(),l!==void 0&&l>e){if(r.strict){var u=new Error("Too few bytes to read ASN.1 value.");throw u.available=s.length(),u.remaining=e,u.requested=l,u}l=e}var c,f,g=(n&32)===32;if(g)if(c=[],l===void 0)for(;;){if(Ou(s,e,2),s.bytes(2)===String.fromCharCode(0,0)){s.getBytes(2),e-=2;break}a=s.length(),c.push(Mh(s,e,t+1,r)),e-=a-s.length()}else for(;l>0;)a=s.length(),c.push(Mh(s,l,t+1,r)),e-=a-s.length(),l-=a-s.length();if(c===void 0&&i===ue.Class.UNIVERSAL&&o===ue.Type.BITSTRING&&(f=s.bytes(l)),c===void 0&&r.decodeBitStrings&&i===ue.Class.UNIVERSAL&&o===ue.Type.BITSTRING&&l>1){var v=s.read,p=e,h=0;if(o===ue.Type.BITSTRING&&(Ou(s,e,1),h=s.getByte(),e--),h===0)try{a=s.length();var d={strict:!0,decodeBitStrings:!0},y=Mh(s,e,t+1,d),E=a-s.length();e-=E,o==ue.Type.BITSTRING&&E++;var k=y.tagClass;E===l&&(k===ue.Class.UNIVERSAL||k===ue.Class.CONTEXT_SPECIFIC)&&(c=[y])}catch{}c===void 0&&(s.read=v,e=p)}if(c===void 0){if(l===void 0){if(r.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");l=e}if(o===ue.Type.BMPSTRING)for(c="";l>0;l-=2)Ou(s,e,2),c+=String.fromCharCode(s.getInt16()),e-=2;else c=s.getBytes(l),e-=l}var R=f===void 0?null:{bitStringContents:f};return ue.create(i,o,g,c,R)}ue.toDer=function(s){var e=vt.util.createBuffer(),t=s.tagClass|s.type,r=vt.util.createBuffer(),a=!1;if("bitStringContents"in s&&(a=!0,s.original&&(a=ue.equals(s,s.original))),a)r.putBytes(s.bitStringContents);else if(s.composed){s.constructed?t|=32:r.putByte(0);for(var n=0;n<s.value.length;++n)s.value[n]!==void 0&&r.putBuffer(ue.toDer(s.value[n]))}else if(s.type===ue.Type.BMPSTRING)for(var n=0;n<s.value.length;++n)r.putInt16(s.value.charCodeAt(n));else s.type===ue.Type.INTEGER&&s.value.length>1&&(s.value.charCodeAt(0)===0&&(s.value.charCodeAt(1)&128)===0||s.value.charCodeAt(0)===255&&(s.value.charCodeAt(1)&128)===128)?r.putBytes(s.value.substr(1)):r.putBytes(s.value);if(e.putByte(t),r.length()<=127)e.putByte(r.length()&127);else{var i=r.length(),o="";do o+=String.fromCharCode(i&255),i=i>>>8;while(i>0);e.putByte(o.length|128);for(var n=o.length-1;n>=0;--n)e.putByte(o.charCodeAt(n))}return e.putBuffer(r),e};ue.oidToDer=function(s){var e=s.split("."),t=vt.util.createBuffer();t.putByte(40*parseInt(e[0],10)+parseInt(e[1],10));for(var r,a,n,i,o=2;o<e.length;++o){r=!0,a=[],n=parseInt(e[o],10);do i=n&127,n=n>>>7,r||(i|=128),a.push(i),r=!1;while(n>0);for(var l=a.length-1;l>=0;--l)t.putByte(a[l])}return t};ue.derToOid=function(s){var e;typeof s=="string"&&(s=vt.util.createBuffer(s));var t=s.getByte();e=Math.floor(t/40)+"."+t%40;for(var r=0;s.length()>0;)t=s.getByte(),r=r<<7,t&128?r+=t&127:(e+="."+(r+t),r=0);return e};ue.utcTimeToDate=function(s){var e=new Date,t=parseInt(s.substr(0,2),10);t=t>=50?1900+t:2e3+t;var r=parseInt(s.substr(2,2),10)-1,a=parseInt(s.substr(4,2),10),n=parseInt(s.substr(6,2),10),i=parseInt(s.substr(8,2),10),o=0;if(s.length>11){var l=s.charAt(10),u=10;l!=="+"&&l!=="-"&&(o=parseInt(s.substr(10,2),10),u+=2)}if(e.setUTCFullYear(t,r,a),e.setUTCHours(n,i,o,0),u&&(l=s.charAt(u),l==="+"||l==="-")){var c=parseInt(s.substr(u+1,2),10),f=parseInt(s.substr(u+4,2),10),g=c*60+f;g*=6e4,l==="+"?e.setTime(+e-g):e.setTime(+e+g)}return e};ue.generalizedTimeToDate=function(s){var e=new Date,t=parseInt(s.substr(0,4),10),r=parseInt(s.substr(4,2),10)-1,a=parseInt(s.substr(6,2),10),n=parseInt(s.substr(8,2),10),i=parseInt(s.substr(10,2),10),o=parseInt(s.substr(12,2),10),l=0,u=0,c=!1;s.charAt(s.length-1)==="Z"&&(c=!0);var f=s.length-5,g=s.charAt(f);if(g==="+"||g==="-"){var v=parseInt(s.substr(f+1,2),10),p=parseInt(s.substr(f+4,2),10);u=v*60+p,u*=6e4,g==="+"&&(u*=-1),c=!0}return s.charAt(14)==="."&&(l=parseFloat(s.substr(14),10)*1e3),c?(e.setUTCFullYear(t,r,a),e.setUTCHours(n,i,o,l),e.setTime(+e+u)):(e.setFullYear(t,r,a),e.setHours(n,i,o,l)),e};ue.dateToUtcTime=function(s){if(typeof s=="string")return s;var e="",t=[];t.push((""+s.getUTCFullYear()).substr(2)),t.push(""+(s.getUTCMonth()+1)),t.push(""+s.getUTCDate()),t.push(""+s.getUTCHours()),t.push(""+s.getUTCMinutes()),t.push(""+s.getUTCSeconds());for(var r=0;r<t.length;++r)t[r].length<2&&(e+="0"),e+=t[r];return e+="Z",e};ue.dateToGeneralizedTime=function(s){if(typeof s=="string")return s;var e="",t=[];t.push(""+s.getUTCFullYear()),t.push(""+(s.getUTCMonth()+1)),t.push(""+s.getUTCDate()),t.push(""+s.getUTCHours()),t.push(""+s.getUTCMinutes()),t.push(""+s.getUTCSeconds());for(var r=0;r<t.length;++r)t[r].length<2&&(e+="0"),e+=t[r];return e+="Z",e};ue.integerToDer=function(s){var e=vt.util.createBuffer();if(s>=-128&&s<128)return e.putSignedInt(s,8);if(s>=-32768&&s<32768)return e.putSignedInt(s,16);if(s>=-8388608&&s<8388608)return e.putSignedInt(s,24);if(s>=-2147483648&&s<2147483648)return e.putSignedInt(s,32);var t=new Error("Integer too large; max is 32-bits.");throw t.integer=s,t};ue.derToInteger=function(s){typeof s=="string"&&(s=vt.util.createBuffer(s));var e=s.length()*8;if(e>32)throw new Error("Integer too large; max is 32-bits.");return s.getSignedInt(e)};ue.validate=function(s,e,t,r){var a=!1;if((s.tagClass===e.tagClass||typeof e.tagClass>"u")&&(s.type===e.type||typeof e.type>"u"))if(s.constructed===e.constructed||typeof e.constructed>"u"){if(a=!0,e.value&&vt.util.isArray(e.value))for(var n=0,i=0;a&&i<e.value.length;++i)a=e.value[i].optional||!1,s.value[n]&&(a=ue.validate(s.value[n],e.value[i],t,r),a?++n:e.value[i].optional&&(a=!0)),!a&&r&&r.push("["+e.name+'] Tag class "'+e.tagClass+'", type "'+e.type+'" expected value length "'+e.value.length+'", got "'+s.value.length+'"');if(a&&t&&(e.capture&&(t[e.capture]=s.value),e.captureAsn1&&(t[e.captureAsn1]=s),e.captureBitStringContents&&"bitStringContents"in s&&(t[e.captureBitStringContents]=s.bitStringContents),e.captureBitStringValue&&"bitStringContents"in s))if(s.bitStringContents.length<2)t[e.captureBitStringValue]="";else{var o=s.bitStringContents.charCodeAt(0);if(o!==0)throw new Error("captureBitStringValue only supported for zero unused bits");t[e.captureBitStringValue]=s.bitStringContents.slice(1)}}else r&&r.push("["+e.name+'] Expected constructed "'+e.constructed+'", got "'+s.constructed+'"');else r&&(s.tagClass!==e.tagClass&&r.push("["+e.name+'] Expected tag class "'+e.tagClass+'", got "'+s.tagClass+'"'),s.type!==e.type&&r.push("["+e.name+'] Expected type "'+e.type+'", got "'+s.type+'"'));return a};var Pm=/[^\\u0000-\\u00ff]/;ue.prettyPrint=function(s,e,t){var r="";e=e||0,t=t||2,e>0&&(r+=`
`);for(var a="",n=0;n<e*t;++n)a+=" ";switch(r+=a+"Tag: ",s.tagClass){case ue.Class.UNIVERSAL:r+="Universal:";break;case ue.Class.APPLICATION:r+="Application:";break;case ue.Class.CONTEXT_SPECIFIC:r+="Context-Specific:";break;case ue.Class.PRIVATE:r+="Private:";break}if(s.tagClass===ue.Class.UNIVERSAL)switch(r+=s.type,s.type){case ue.Type.NONE:r+=" (None)";break;case ue.Type.BOOLEAN:r+=" (Boolean)";break;case ue.Type.INTEGER:r+=" (Integer)";break;case ue.Type.BITSTRING:r+=" (Bit string)";break;case ue.Type.OCTETSTRING:r+=" (Octet string)";break;case ue.Type.NULL:r+=" (Null)";break;case ue.Type.OID:r+=" (Object Identifier)";break;case ue.Type.ODESC:r+=" (Object Descriptor)";break;case ue.Type.EXTERNAL:r+=" (External or Instance of)";break;case ue.Type.REAL:r+=" (Real)";break;case ue.Type.ENUMERATED:r+=" (Enumerated)";break;case ue.Type.EMBEDDED:r+=" (Embedded PDV)";break;case ue.Type.UTF8:r+=" (UTF8)";break;case ue.Type.ROID:r+=" (Relative Object Identifier)";break;case ue.Type.SEQUENCE:r+=" (Sequence)";break;case ue.Type.SET:r+=" (Set)";break;case ue.Type.PRINTABLESTRING:r+=" (Printable String)";break;case ue.Type.IA5String:r+=" (IA5String (ASCII))";break;case ue.Type.UTCTIME:r+=" (UTC time)";break;case ue.Type.GENERALIZEDTIME:r+=" (Generalized time)";break;case ue.Type.BMPSTRING:r+=" (BMP String)";break}else r+=s.type;if(r+=`
`,r+=a+"Constructed: "+s.constructed+`
`,s.composed){for(var i=0,o="",n=0;n<s.value.length;++n)s.value[n]!==void 0&&(i+=1,o+=ue.prettyPrint(s.value[n],e+1,t),n+1<s.value.length&&(o+=","));r+=a+"Sub values: "+i+o}else{if(r+=a+"Value: ",s.type===ue.Type.OID){var l=ue.derToOid(s.value);r+=l,vt.pki&&vt.pki.oids&&l in vt.pki.oids&&(r+=" ("+vt.pki.oids[l]+") ")}if(s.type===ue.Type.INTEGER)try{r+=ue.derToInteger(s.value)}catch{r+="0x"+vt.util.bytesToHex(s.value)}else if(s.type===ue.Type.BITSTRING){if(s.value.length>1?r+="0x"+vt.util.bytesToHex(s.value.slice(1)):r+="(none)",s.value.length>0){var u=s.value.charCodeAt(0);u==1?r+=" (1 unused bit shown)":u>1&&(r+=" ("+u+" unused bits shown)")}}else if(s.type===ue.Type.OCTETSTRING)Pm.test(s.value)||(r+="("+s.value+") "),r+="0x"+vt.util.bytesToHex(s.value);else if(s.type===ue.Type.UTF8)try{r+=vt.util.decodeUtf8(s.value)}catch(c){if(c.message==="URI malformed")r+="0x"+vt.util.bytesToHex(s.value)+" (malformed UTF8)";else throw c}else s.type===ue.Type.PRINTABLESTRING||s.type===ue.Type.IA5String?r+=s.value:Pm.test(s.value)?r+="0x"+vt.util.bytesToHex(s.value):s.value.length===0?r+="[null]":r+=s.value}return r};var C0=Fe,q1=C0.md=C0.md||{};C0.md.algorithms=C0.md.algorithms||{};var zs=Fe,J1=zs.hmac=zs.hmac||{};J1.create=function(){var s=null,e=null,t=null,r=null,a={};return a.start=function(n,i){if(n!==null)if(typeof n=="string")if(n=n.toLowerCase(),n in zs.md.algorithms)e=zs.md.algorithms[n].create();else throw new Error('Unknown hash algorithm "'+n+'"');else e=n;if(i===null)i=s;else{if(typeof i=="string")i=zs.util.createBuffer(i);else if(zs.util.isArray(i)){var o=i;i=zs.util.createBuffer();for(var l=0;l<o.length;++l)i.putByte(o[l])}var u=i.length();u>e.blockLength&&(e.start(),e.update(i.bytes()),i=e.digest()),t=zs.util.createBuffer(),r=zs.util.createBuffer(),u=i.length();for(var l=0;l<u;++l){var o=i.at(l);t.putByte(54^o),r.putByte(92^o)}if(u<e.blockLength)for(var o=e.blockLength-u,l=0;l<o;++l)t.putByte(54),r.putByte(92);s=i,t=t.bytes(),r=r.bytes()}e.start(),e.update(t)},a.update=function(n){e.update(n)},a.getMac=function(){var n=e.digest().bytes();return e.start(),e.update(r),e.update(n),e.digest()},a.digest=a.getMac,a};var Es=Fe,ty=Es.md5=Es.md5||{};Es.md.md5=Es.md.algorithms.md5=ty;ty.create=function(){ry||G1();var s=null,e=Es.util.createBuffer(),t=new Array(16),r={algorithm:"md5",blockLength:64,digestLength:16,messageLength:0,fullMessageLength:null,messageLengthSize:8};return r.start=function(){r.messageLength=0,r.fullMessageLength=r.messageLength64=[];for(var a=r.messageLengthSize/4,n=0;n<a;++n)r.fullMessageLength.push(0);return e=Es.util.createBuffer(),s={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878},r},r.start(),r.update=function(a,n){n==="utf8"&&(a=Es.util.encodeUtf8(a));var i=a.length;r.messageLength+=i,i=[i/4294967296>>>0,i>>>0];for(var o=r.fullMessageLength.length-1;o>=0;--o)r.fullMessageLength[o]+=i[1],i[1]=i[0]+(r.fullMessageLength[o]/4294967296>>>0),r.fullMessageLength[o]=r.fullMessageLength[o]>>>0,i[0]=i[1]/4294967296>>>0;return e.putBytes(a),Um(s,t,e),(e.read>2048||e.length()===0)&&e.compact(),r},r.digest=function(){var a=Es.util.createBuffer();a.putBytes(e.bytes());var n=r.fullMessageLength[r.fullMessageLength.length-1]+r.messageLengthSize,i=n&r.blockLength-1;a.putBytes(tg.substr(0,r.blockLength-i));for(var o,l=0,u=r.fullMessageLength.length-1;u>=0;--u)o=r.fullMessageLength[u]*8+l,l=o/4294967296>>>0,a.putInt32Le(o>>>0);var c={h0:s.h0,h1:s.h1,h2:s.h2,h3:s.h3};Um(c,t,a);var f=Es.util.createBuffer();return f.putInt32Le(c.h0),f.putInt32Le(c.h1),f.putInt32Le(c.h2),f.putInt32Le(c.h3),f},r};var tg=null,Hh=null,Pu=null,ql=null,ry=!1;function G1(){tg=String.fromCharCode(128),tg+=Es.util.fillString(String.fromCharCode(0),64),Hh=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1,6,11,0,5,10,15,4,9,14,3,8,13,2,7,12,5,8,11,14,1,4,7,10,13,0,3,6,9,12,15,2,0,7,14,5,12,3,10,1,8,15,6,13,4,11,2,9],Pu=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],ql=new Array(64);for(var s=0;s<64;++s)ql[s]=Math.floor(Math.abs(Math.sin(s+1))*4294967296);ry=!0}function Um(s,e,t){for(var r,a,n,i,o,l,u,c,f=t.length();f>=64;){for(a=s.h0,n=s.h1,i=s.h2,o=s.h3,c=0;c<16;++c)e[c]=t.getInt32Le(),l=o^n&(i^o),r=a+l+ql[c]+e[c],u=Pu[c],a=o,o=i,i=n,n+=r<<u|r>>>32-u;for(;c<32;++c)l=i^o&(n^i),r=a+l+ql[c]+e[Hh[c]],u=Pu[c],a=o,o=i,i=n,n+=r<<u|r>>>32-u;for(;c<48;++c)l=n^i^o,r=a+l+ql[c]+e[Hh[c]],u=Pu[c],a=o,o=i,i=n,n+=r<<u|r>>>32-u;for(;c<64;++c)l=i^(n|~o),r=a+l+ql[c]+e[Hh[c]],u=Pu[c],a=o,o=i,i=n,n+=r<<u|r>>>32-u;s.h0=s.h0+a|0,s.h1=s.h1+n|0,s.h2=s.h2+i|0,s.h3=s.h3+o|0,f-=64}}var A0=Fe,sy=A0.pem=A0.pem||{};sy.encode=function(s,e){e=e||{};var t="-----BEGIN "+s.type+`-----\r
`,r;if(s.procType&&(r={name:"Proc-Type",values:[String(s.procType.version),s.procType.type]},t+=ch(r)),s.contentDomain&&(r={name:"Content-Domain",values:[s.contentDomain]},t+=ch(r)),s.dekInfo&&(r={name:"DEK-Info",values:[s.dekInfo.algorithm]},s.dekInfo.parameters&&r.values.push(s.dekInfo.parameters),t+=ch(r)),s.headers)for(var a=0;a<s.headers.length;++a)t+=ch(s.headers[a]);return s.procType&&(t+=`\r
`),t+=A0.util.encode64(s.body,e.maxline||64)+`\r
`,t+="-----END "+s.type+`-----\r
`,t};sy.decode=function(s){for(var e=[],t=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,r=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,a=/\r?\n/,n;n=t.exec(s),!!n;){var i=n[1];i==="NEW CERTIFICATE REQUEST"&&(i="CERTIFICATE REQUEST");var o={type:i,procType:null,contentDomain:null,dekInfo:null,headers:[],body:A0.util.decode64(n[3])};if(e.push(o),!!n[2]){for(var l=n[2].split(a),u=0;n&&u<l.length;){for(var c=l[u].replace(/\s+$/,""),f=u+1;f<l.length;++f){var g=l[f];if(!/\s/.test(g[0]))break;c+=g,u=f}if(n=c.match(r),n){for(var v={name:n[1],values:[]},p=n[2].split(","),h=0;h<p.length;++h)v.values.push(j1(p[h]));if(o.procType)if(!o.contentDomain&&v.name==="Content-Domain")o.contentDomain=p[0]||"";else if(!o.dekInfo&&v.name==="DEK-Info"){if(v.values.length===0)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');o.dekInfo={algorithm:p[0],parameters:p[1]||null}}else o.headers.push(v);else{if(v.name!=="Proc-Type")throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(v.values.length!==2)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');o.procType={version:p[0],type:p[1]}}}++u}if(o.procType==="ENCRYPTED"&&!o.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(e.length===0)throw new Error("Invalid PEM formatted message.");return e};function ch(s){for(var e=s.name+": ",t=[],r=function(l,u){return" "+u},a=0;a<s.values.length;++a)t.push(s.values[a].replace(/^(\S+\r\n)/,r));e+=t.join(",")+`\r
`;for(var n=0,i=-1,a=0;a<e.length;++a,++n)if(n>65&&i!==-1){var o=e[i];o===","?(++i,e=e.substr(0,i)+`\r
 `+e.substr(i)):e=e.substr(0,i)+`\r
`+o+e.substr(i+1),n=a-i-1,i=-1,++a}else(e[a]===" "||e[a]==="	"||e[a]===",")&&(i=a);return e}function j1(s){return s.replace(/^\s+/,"")}var kt=Fe;kt.des=kt.des||{};kt.des.startEncrypting=function(s,e,t,r){var a=td({key:s,output:t,decrypt:!1,mode:r||(e===null?"ECB":"CBC")});return a.start(e),a};kt.des.createEncryptionCipher=function(s,e){return td({key:s,output:null,decrypt:!1,mode:e})};kt.des.startDecrypting=function(s,e,t,r){var a=td({key:s,output:t,decrypt:!0,mode:r||(e===null?"ECB":"CBC")});return a.start(e),a};kt.des.createDecryptionCipher=function(s,e){return td({key:s,output:null,decrypt:!0,mode:e})};kt.des.Algorithm=function(s,e){var t=this;t.name=s,t.mode=new e({blockSize:8,cipher:{encrypt:function(r,a){return Km(t._keys,r,a,!1)},decrypt:function(r,a){return Km(t._keys,r,a,!0)}}}),t._init=!1};kt.des.Algorithm.prototype.initialize=function(s){if(!this._init){var e=kt.util.createBuffer(s.key);if(this.name.indexOf("3DES")===0&&e.length()!==24)throw new Error("Invalid Triple-DES key size: "+e.length()*8);this._keys=rw(e),this._init=!0}};Ls("DES-ECB",kt.cipher.modes.ecb);Ls("DES-CBC",kt.cipher.modes.cbc);Ls("DES-CFB",kt.cipher.modes.cfb);Ls("DES-OFB",kt.cipher.modes.ofb);Ls("DES-CTR",kt.cipher.modes.ctr);Ls("3DES-ECB",kt.cipher.modes.ecb);Ls("3DES-CBC",kt.cipher.modes.cbc);Ls("3DES-CFB",kt.cipher.modes.cfb);Ls("3DES-OFB",kt.cipher.modes.ofb);Ls("3DES-CTR",kt.cipher.modes.ctr);function Ls(s,e){var t=function(){return new kt.des.Algorithm(s,e)};kt.cipher.registerAlgorithm(s,t)}var W1=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],Q1=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],Y1=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],z1=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],X1=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],Z1=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],ew=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],tw=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function rw(s){for(var e=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],t=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],r=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],a=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],n=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],i=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],o=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],l=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],u=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],c=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],f=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],g=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],v=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],p=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],h=s.length()>8?3:1,d=[],y=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],E=0,k,R=0;R<h;R++){var V=s.getInt32(),L=s.getInt32();k=(V>>>4^L)&252645135,L^=k,V^=k<<4,k=(L>>>-16^V)&65535,V^=k,L^=k<<-16,k=(V>>>2^L)&858993459,L^=k,V^=k<<2,k=(L>>>-16^V)&65535,V^=k,L^=k<<-16,k=(V>>>1^L)&1431655765,L^=k,V^=k<<1,k=(L>>>8^V)&16711935,V^=k,L^=k<<8,k=(V>>>1^L)&1431655765,L^=k,V^=k<<1,k=V<<8|L>>>20&240,V=L<<24|L<<8&16711680|L>>>8&65280|L>>>24&240,L=k;for(var ne=0;ne<y.length;++ne){y[ne]?(V=V<<2|V>>>26,L=L<<2|L>>>26):(V=V<<1|V>>>27,L=L<<1|L>>>27),V&=-15,L&=-15;var ae=e[V>>>28]|t[V>>>24&15]|r[V>>>20&15]|a[V>>>16&15]|n[V>>>12&15]|i[V>>>8&15]|o[V>>>4&15],ve=l[L>>>28]|u[L>>>24&15]|c[L>>>20&15]|f[L>>>16&15]|g[L>>>12&15]|v[L>>>8&15]|p[L>>>4&15];k=(ve>>>16^ae)&65535,d[E++]=ae^k,d[E++]=ve^k<<16}}return d}function Km(s,e,t,r){var a=s.length===32?3:9,n;a===3?n=r?[30,-2,-2]:[0,32,2]:n=r?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var i,o=e[0],l=e[1];i=(o>>>4^l)&252645135,l^=i,o^=i<<4,i=(o>>>16^l)&65535,l^=i,o^=i<<16,i=(l>>>2^o)&858993459,o^=i,l^=i<<2,i=(l>>>8^o)&16711935,o^=i,l^=i<<8,i=(o>>>1^l)&1431655765,l^=i,o^=i<<1,o=o<<1|o>>>31,l=l<<1|l>>>31;for(var u=0;u<a;u+=3){for(var c=n[u+1],f=n[u+2],g=n[u];g!=c;g+=f){var v=l^s[g],p=(l>>>4|l<<28)^s[g+1];i=o,o=l,l=i^(Q1[v>>>24&63]|z1[v>>>16&63]|Z1[v>>>8&63]|tw[v&63]|W1[p>>>24&63]|Y1[p>>>16&63]|X1[p>>>8&63]|ew[p&63])}i=o,o=l,l=i}o=o>>>1|o<<31,l=l>>>1|l<<31,i=(o>>>1^l)&1431655765,l^=i,o^=i<<1,i=(l>>>8^o)&16711935,o^=i,l^=i<<8,i=(l>>>2^o)&858993459,o^=i,l^=i<<2,i=(o>>>16^l)&65535,l^=i,o^=i<<16,i=(o>>>4^l)&252645135,l^=i,o^=i<<4,t[0]=o,t[1]=l}function td(s){s=s||{};var e=(s.mode||"CBC").toUpperCase(),t="DES-"+e,r;s.decrypt?r=kt.cipher.createDecipher(t,s.key):r=kt.cipher.createCipher(t,s.key);var a=r.start;return r.start=function(n,i){var o=null;i instanceof kt.util.ByteBuffer&&(o=i,i={}),i=i||{},i.output=o,i.iv=n,a.call(r,i)},r}const sw={},aw=Object.freeze(Object.defineProperty({__proto__:null,default:sw},Symbol.toStringTag,{value:"Module"})),Qg=$1(aw);var fr=Fe,nw=fr.pkcs5=fr.pkcs5||{},Ps;fr.util.isNodejs&&!fr.options.usePureJavaScript&&(Ps=Qg);fr.pbkdf2=nw.pbkdf2=function(s,e,t,r,a,n){if(typeof a=="function"&&(n=a,a=null),fr.util.isNodejs&&!fr.options.usePureJavaScript&&Ps.pbkdf2&&(a===null||typeof a!="object")&&(Ps.pbkdf2Sync.length>4||!a||a==="sha1"))return typeof a!="string"&&(a="sha1"),s=Buffer.from(s,"binary"),e=Buffer.from(e,"binary"),n?Ps.pbkdf2Sync.length===4?Ps.pbkdf2(s,e,t,r,function(k,R){if(k)return n(k);n(null,R.toString("binary"))}):Ps.pbkdf2(s,e,t,r,a,function(k,R){if(k)return n(k);n(null,R.toString("binary"))}):Ps.pbkdf2Sync.length===4?Ps.pbkdf2Sync(s,e,t,r).toString("binary"):Ps.pbkdf2Sync(s,e,t,r,a).toString("binary");if((typeof a>"u"||a===null)&&(a="sha1"),typeof a=="string"){if(!(a in fr.md.algorithms))throw new Error("Unknown hash algorithm: "+a);a=fr.md[a].create()}var i=a.digestLength;if(r>4294967295*i){var o=new Error("Derived key is too long.");if(n)return n(o);throw o}var l=Math.ceil(r/i),u=r-(l-1)*i,c=fr.hmac.create();c.start(a,s);var f="",g,v,p;if(!n){for(var h=1;h<=l;++h){c.start(null,null),c.update(e),c.update(fr.util.int32ToBytes(h)),g=p=c.digest().getBytes();for(var d=2;d<=t;++d)c.start(null,null),c.update(p),v=c.digest().getBytes(),g=fr.util.xorBytes(g,v,i),p=v;f+=h<l?g:g.substr(0,u)}return f}var h=1,d;function y(){if(h>l)return n(null,f);c.start(null,null),c.update(e),c.update(fr.util.int32ToBytes(h)),g=p=c.digest().getBytes(),d=2,E()}function E(){if(d<=t)return c.start(null,null),c.update(p),v=c.digest().getBytes(),g=fr.util.xorBytes(g,v,i),p=v,++d,fr.util.setImmediate(E);f+=h<l?g:g.substr(0,u),++h,y()}y()};var bs=Fe,ay=bs.sha256=bs.sha256||{};bs.md.sha256=bs.md.algorithms.sha256=ay;ay.create=function(){ny||iw();var s=null,e=bs.util.createBuffer(),t=new Array(64),r={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8};return r.start=function(){r.messageLength=0,r.fullMessageLength=r.messageLength64=[];for(var a=r.messageLengthSize/4,n=0;n<a;++n)r.fullMessageLength.push(0);return e=bs.util.createBuffer(),s={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},r},r.start(),r.update=function(a,n){n==="utf8"&&(a=bs.util.encodeUtf8(a));var i=a.length;r.messageLength+=i,i=[i/4294967296>>>0,i>>>0];for(var o=r.fullMessageLength.length-1;o>=0;--o)r.fullMessageLength[o]+=i[1],i[1]=i[0]+(r.fullMessageLength[o]/4294967296>>>0),r.fullMessageLength[o]=r.fullMessageLength[o]>>>0,i[0]=i[1]/4294967296>>>0;return e.putBytes(a),Mm(s,t,e),(e.read>2048||e.length()===0)&&e.compact(),r},r.digest=function(){var a=bs.util.createBuffer();a.putBytes(e.bytes());var n=r.fullMessageLength[r.fullMessageLength.length-1]+r.messageLengthSize,i=n&r.blockLength-1;a.putBytes(rg.substr(0,r.blockLength-i));for(var o,l,u=r.fullMessageLength[0]*8,c=0;c<r.fullMessageLength.length-1;++c)o=r.fullMessageLength[c+1]*8,l=o/4294967296>>>0,u+=l,a.putInt32(u>>>0),u=o>>>0;a.putInt32(u);var f={h0:s.h0,h1:s.h1,h2:s.h2,h3:s.h3,h4:s.h4,h5:s.h5,h6:s.h6,h7:s.h7};Mm(f,t,a);var g=bs.util.createBuffer();return g.putInt32(f.h0),g.putInt32(f.h1),g.putInt32(f.h2),g.putInt32(f.h3),g.putInt32(f.h4),g.putInt32(f.h5),g.putInt32(f.h6),g.putInt32(f.h7),g},r};var rg=null,ny=!1,iy=null;function iw(){rg=String.fromCharCode(128),rg+=bs.util.fillString(String.fromCharCode(0),64),iy=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],ny=!0}function Mm(s,e,t){for(var r,a,n,i,o,l,u,c,f,g,v,p,h,d,y,E=t.length();E>=64;){for(u=0;u<16;++u)e[u]=t.getInt32();for(;u<64;++u)r=e[u-2],r=(r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10,a=e[u-15],a=(a>>>7|a<<25)^(a>>>18|a<<14)^a>>>3,e[u]=r+e[u-7]+a+e[u-16]|0;for(c=s.h0,f=s.h1,g=s.h2,v=s.h3,p=s.h4,h=s.h5,d=s.h6,y=s.h7,u=0;u<64;++u)i=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7),o=d^p&(h^d),n=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),l=c&f|g&(c^f),r=y+i+o+iy[u]+e[u],a=n+l,y=d,d=h,h=p,p=v+r>>>0,v=g,g=f,f=c,c=r+a>>>0;s.h0=s.h0+c|0,s.h1=s.h1+f|0,s.h2=s.h2+g|0,s.h3=s.h3+v|0,s.h4=s.h4+p|0,s.h5=s.h5+h|0,s.h6=s.h6+d|0,s.h7=s.h7+y|0,E-=64}}var Cs=Fe,Fh=null;Cs.util.isNodejs&&!Cs.options.usePureJavaScript&&!process.versions["node-webkit"]&&(Fh=Qg);var ow=Cs.prng=Cs.prng||{};ow.create=function(s){for(var e={plugin:s,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},t=s.md,r=new Array(32),a=0;a<32;++a)r[a]=t.create();e.pools=r,e.pool=0,e.generate=function(u,c){if(!c)return e.generateSync(u);var f=e.plugin.cipher,g=e.plugin.increment,v=e.plugin.formatKey,p=e.plugin.formatSeed,h=Cs.util.createBuffer();e.key=null,d();function d(y){if(y)return c(y);if(h.length()>=u)return c(null,h.getBytes(u));if(e.generated>1048575&&(e.key=null),e.key===null)return Cs.util.nextTick(function(){n(d)});var E=f(e.key,e.seed);e.generated+=E.length,h.putBytes(E),e.key=v(f(e.key,g(e.seed))),e.seed=p(f(e.key,e.seed)),Cs.util.setImmediate(d)}},e.generateSync=function(u){var c=e.plugin.cipher,f=e.plugin.increment,g=e.plugin.formatKey,v=e.plugin.formatSeed;e.key=null;for(var p=Cs.util.createBuffer();p.length()<u;){e.generated>1048575&&(e.key=null),e.key===null&&i();var h=c(e.key,e.seed);e.generated+=h.length,p.putBytes(h),e.key=g(c(e.key,f(e.seed))),e.seed=v(c(e.key,e.seed))}return p.getBytes(u)};function n(u){if(e.pools[0].messageLength>=32)return o(),u();var c=32-e.pools[0].messageLength<<5;e.seedFile(c,function(f,g){if(f)return u(f);e.collect(g),o(),u()})}function i(){if(e.pools[0].messageLength>=32)return o();var u=32-e.pools[0].messageLength<<5;e.collect(e.seedFileSync(u)),o()}function o(){e.reseeds=e.reseeds===4294967295?0:e.reseeds+1;var u=e.plugin.md.create();u.update(e.keyBytes);for(var c=1,f=0;f<32;++f)e.reseeds%c===0&&(u.update(e.pools[f].digest().getBytes()),e.pools[f].start()),c=c<<1;e.keyBytes=u.digest().getBytes(),u.start(),u.update(e.keyBytes);var g=u.digest().getBytes();e.key=e.plugin.formatKey(e.keyBytes),e.seed=e.plugin.formatSeed(g),e.generated=0}function l(u){var c=null,f=Cs.util.globalScope,g=f.crypto||f.msCrypto;g&&g.getRandomValues&&(c=function(V){return g.getRandomValues(V)});var v=Cs.util.createBuffer();if(c)for(;v.length()<u;){var p=Math.max(1,Math.min(u-v.length(),65536)/4),h=new Uint32Array(Math.floor(p));try{c(h);for(var d=0;d<h.length;++d)v.putInt32(h[d])}catch(V){if(!(typeof QuotaExceededError<"u"&&V instanceof QuotaExceededError))throw V}}if(v.length()<u)for(var y,E,k,R=Math.floor(Math.random()*65536);v.length()<u;){E=16807*(R&65535),y=16807*(R>>16),E+=(y&32767)<<16,E+=y>>15,E=(E&2147483647)+(E>>31),R=E&4294967295;for(var d=0;d<3;++d)k=R>>>(d<<3),k^=Math.floor(Math.random()*256),v.putByte(k&255)}return v.getBytes(u)}return Fh?(e.seedFile=function(u,c){Fh.randomBytes(u,function(f,g){if(f)return c(f);c(null,g.toString())})},e.seedFileSync=function(u){return Fh.randomBytes(u).toString()}):(e.seedFile=function(u,c){try{c(null,l(u))}catch(f){c(f)}},e.seedFileSync=l),e.collect=function(u){for(var c=u.length,f=0;f<c;++f)e.pools[e.pool].update(u.substr(f,1)),e.pool=e.pool===31?0:e.pool+1},e.collectInt=function(u,c){for(var f="",g=0;g<c;g+=8)f+=String.fromCharCode(u>>g&255);e.collect(f)},e.registerWorker=function(u){if(u===self)e.seedFile=function(f,g){function v(p){var h=p.data;h.forge&&h.forge.prng&&(self.removeEventListener("message",v),g(h.forge.prng.err,h.forge.prng.bytes))}self.addEventListener("message",v),self.postMessage({forge:{prng:{needed:f}}})};else{var c=function(f){var g=f.data;g.forge&&g.forge.prng&&e.seedFile(g.forge.prng.needed,function(v,p){u.postMessage({forge:{prng:{err:v,bytes:p}}})})};u.addEventListener("message",c)}},e};var Wt=Fe;(function(){if(Wt.random&&Wt.random.getBytes){Wt.random;return}(function(s){var e={},t=new Array(4),r=Wt.util.createBuffer();e.formatKey=function(f){var g=Wt.util.createBuffer(f);return f=new Array(4),f[0]=g.getInt32(),f[1]=g.getInt32(),f[2]=g.getInt32(),f[3]=g.getInt32(),Wt.aes._expandKey(f,!1)},e.formatSeed=function(f){var g=Wt.util.createBuffer(f);return f=new Array(4),f[0]=g.getInt32(),f[1]=g.getInt32(),f[2]=g.getInt32(),f[3]=g.getInt32(),f},e.cipher=function(f,g){return Wt.aes._updateBlock(f,g,t,!1),r.putInt32(t[0]),r.putInt32(t[1]),r.putInt32(t[2]),r.putInt32(t[3]),r.getBytes()},e.increment=function(f){return++f[3],f},e.md=Wt.md.sha256;function a(){var f=Wt.prng.create(e);return f.getBytes=function(g,v){return f.generate(g,v)},f.getBytesSync=function(g){return f.generate(g)},f}var n=a(),i=null,o=Wt.util.globalScope,l=o.crypto||o.msCrypto;if(l&&l.getRandomValues&&(i=function(f){return l.getRandomValues(f)}),Wt.options.usePureJavaScript||!Wt.util.isNodejs&&!i){if(n.collectInt(+new Date,32),typeof navigator<"u"){var u="";for(var c in navigator)try{typeof navigator[c]=="string"&&(u+=navigator[c])}catch{}n.collect(u),u=null}s&&(s().mousemove(function(f){n.collectInt(f.clientX,16),n.collectInt(f.clientY,16)}),s().keypress(function(f){n.collectInt(f.charCode,8)}))}if(!Wt.random)Wt.random=n;else for(var c in n)Wt.random[c]=n[c];Wt.random.createInstance=a,Wt.random})(typeof jQuery<"u"?jQuery:null)})();var Ir=Fe,gd=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],Hm=[1,2,3,5],lw=function(s,e){return s<<e&65535|(s&65535)>>16-e},uw=function(s,e){return(s&65535)>>e|s<<16-e&65535};Ir.rc2=Ir.rc2||{};Ir.rc2.expandKey=function(s,e){typeof s=="string"&&(s=Ir.util.createBuffer(s)),e=e||128;var t=s,r=s.length(),a=e,n=Math.ceil(a/8),i=255>>(a&7),o;for(o=r;o<128;o++)t.putByte(gd[t.at(o-1)+t.at(o-r)&255]);for(t.setAt(128-n,gd[t.at(128-n)&i]),o=127-n;o>=0;o--)t.setAt(o,gd[t.at(o+1)^t.at(o+n)]);return t};var oy=function(s,e,t){var r=!1,a=null,n=null,i=null,o,l,u,c,f=[];for(s=Ir.rc2.expandKey(s,e),u=0;u<64;u++)f.push(s.getInt16Le());t?(o=function(p){for(u=0;u<4;u++)p[u]+=f[c]+(p[(u+3)%4]&p[(u+2)%4])+(~p[(u+3)%4]&p[(u+1)%4]),p[u]=lw(p[u],Hm[u]),c++},l=function(p){for(u=0;u<4;u++)p[u]+=f[p[(u+3)%4]&63]}):(o=function(p){for(u=3;u>=0;u--)p[u]=uw(p[u],Hm[u]),p[u]-=f[c]+(p[(u+3)%4]&p[(u+2)%4])+(~p[(u+3)%4]&p[(u+1)%4]),c--},l=function(p){for(u=3;u>=0;u--)p[u]-=f[p[(u+3)%4]&63]});var g=function(p){var h=[];for(u=0;u<4;u++){var d=a.getInt16Le();i!==null&&(t?d^=i.getInt16Le():i.putInt16Le(d)),h.push(d&65535)}c=t?0:63;for(var y=0;y<p.length;y++)for(var E=0;E<p[y][0];E++)p[y][1](h);for(u=0;u<4;u++)i!==null&&(t?i.putInt16Le(h[u]):h[u]^=i.getInt16Le()),n.putInt16Le(h[u])},v=null;return v={start:function(p,h){p&&typeof p=="string"&&(p=Ir.util.createBuffer(p)),r=!1,a=Ir.util.createBuffer(),n=h||new Ir.util.createBuffer,i=p,v.output=n},update:function(p){for(r||a.putBuffer(p);a.length()>=8;)g([[5,o],[1,l],[6,o],[1,l],[5,o]])},finish:function(p){var h=!0;if(t)if(p)h=p(8,a,!t);else{var d=a.length()===8?8:8-a.length();a.fillWithByte(d,d)}if(h&&(r=!0,v.update()),!t&&(h=a.length()===0,h))if(p)h=p(8,n,!t);else{var y=n.length(),E=n.at(y-1);E>y?h=!1:n.truncate(E)}return h}},v};Ir.rc2.startEncrypting=function(s,e,t){var r=Ir.rc2.createEncryptionCipher(s,128);return r.start(e,t),r};Ir.rc2.createEncryptionCipher=function(s,e){return oy(s,e,!0)};Ir.rc2.startDecrypting=function(s,e,t){var r=Ir.rc2.createDecryptionCipher(s,128);return r.start(e,t),r};Ir.rc2.createDecryptionCipher=function(s,e){return oy(s,e,!1)};var sg=Fe;sg.jsbn=sg.jsbn||{};var Zs;function Y(s,e,t){this.data=[],s!=null&&(typeof s=="number"?this.fromNumber(s,e,t):e==null&&typeof s!="string"?this.fromString(s,256):this.fromString(s,e))}sg.jsbn.BigInteger=Y;function et(){return new Y(null)}function cw(s,e,t,r,a,n){for(;--n>=0;){var i=e*this.data[s++]+t.data[r]+a;a=Math.floor(i/67108864),t.data[r++]=i&67108863}return a}function fw(s,e,t,r,a,n){for(var i=e&32767,o=e>>15;--n>=0;){var l=this.data[s]&32767,u=this.data[s++]>>15,c=o*l+u*i;l=i*l+((c&32767)<<15)+t.data[r]+(a&1073741823),a=(l>>>30)+(c>>>15)+o*u+(a>>>30),t.data[r++]=l&1073741823}return a}function Fm(s,e,t,r,a,n){for(var i=e&16383,o=e>>14;--n>=0;){var l=this.data[s]&16383,u=this.data[s++]>>14,c=o*l+u*i;l=i*l+((c&16383)<<14)+t.data[r]+a,a=(l>>28)+(c>>14)+o*u,t.data[r++]=l&268435455}return a}typeof navigator>"u"?(Y.prototype.am=Fm,Zs=28):navigator.appName=="Microsoft Internet Explorer"?(Y.prototype.am=fw,Zs=30):navigator.appName!="Netscape"?(Y.prototype.am=cw,Zs=26):(Y.prototype.am=Fm,Zs=28);Y.prototype.DB=Zs;Y.prototype.DM=(1<<Zs)-1;Y.prototype.DV=1<<Zs;var Yg=52;Y.prototype.FV=Math.pow(2,Yg);Y.prototype.F1=Yg-Zs;Y.prototype.F2=2*Zs-Yg;var hw="0123456789abcdefghijklmnopqrstuvwxyz",rd=new Array,mu,zr;mu="0".charCodeAt(0);for(zr=0;zr<=9;++zr)rd[mu++]=zr;mu="a".charCodeAt(0);for(zr=10;zr<36;++zr)rd[mu++]=zr;mu="A".charCodeAt(0);for(zr=10;zr<36;++zr)rd[mu++]=zr;function qm(s){return hw.charAt(s)}function ly(s,e){var t=rd[s.charCodeAt(e)];return t==null?-1:t}function dw(s){for(var e=this.t-1;e>=0;--e)s.data[e]=this.data[e];s.t=this.t,s.s=this.s}function gw(s){this.t=1,this.s=s<0?-1:0,s>0?this.data[0]=s:s<-1?this.data[0]=s+this.DV:this.t=0}function fn(s){var e=et();return e.fromInt(s),e}function mw(s,e){var t;if(e==16)t=4;else if(e==8)t=3;else if(e==256)t=8;else if(e==2)t=1;else if(e==32)t=5;else if(e==4)t=2;else{this.fromRadix(s,e);return}this.t=0,this.s=0;for(var r=s.length,a=!1,n=0;--r>=0;){var i=t==8?s[r]&255:ly(s,r);if(i<0){s.charAt(r)=="-"&&(a=!0);continue}a=!1,n==0?this.data[this.t++]=i:n+t>this.DB?(this.data[this.t-1]|=(i&(1<<this.DB-n)-1)<<n,this.data[this.t++]=i>>this.DB-n):this.data[this.t-1]|=i<<n,n+=t,n>=this.DB&&(n-=this.DB)}t==8&&(s[0]&128)!=0&&(this.s=-1,n>0&&(this.data[this.t-1]|=(1<<this.DB-n)-1<<n)),this.clamp(),a&&Y.ZERO.subTo(this,this)}function pw(){for(var s=this.s&this.DM;this.t>0&&this.data[this.t-1]==s;)--this.t}function yw(s){if(this.s<0)return"-"+this.negate().toString(s);var e;if(s==16)e=4;else if(s==8)e=3;else if(s==2)e=1;else if(s==32)e=5;else if(s==4)e=2;else return this.toRadix(s);var t=(1<<e)-1,r,a=!1,n="",i=this.t,o=this.DB-i*this.DB%e;if(i-- >0)for(o<this.DB&&(r=this.data[i]>>o)>0&&(a=!0,n=qm(r));i>=0;)o<e?(r=(this.data[i]&(1<<o)-1)<<e-o,r|=this.data[--i]>>(o+=this.DB-e)):(r=this.data[i]>>(o-=e)&t,o<=0&&(o+=this.DB,--i)),r>0&&(a=!0),a&&(n+=qm(r));return a?n:"0"}function vw(){var s=et();return Y.ZERO.subTo(this,s),s}function ww(){return this.s<0?this.negate():this}function Sw(s){var e=this.s-s.s;if(e!=0)return e;var t=this.t;if(e=t-s.t,e!=0)return this.s<0?-e:e;for(;--t>=0;)if((e=this.data[t]-s.data[t])!=0)return e;return 0}function sd(s){var e=1,t;return(t=s>>>16)!=0&&(s=t,e+=16),(t=s>>8)!=0&&(s=t,e+=8),(t=s>>4)!=0&&(s=t,e+=4),(t=s>>2)!=0&&(s=t,e+=2),(t=s>>1)!=0&&(s=t,e+=1),e}function Cw(){return this.t<=0?0:this.DB*(this.t-1)+sd(this.data[this.t-1]^this.s&this.DM)}function Aw(s,e){var t;for(t=this.t-1;t>=0;--t)e.data[t+s]=this.data[t];for(t=s-1;t>=0;--t)e.data[t]=0;e.t=this.t+s,e.s=this.s}function Ew(s,e){for(var t=s;t<this.t;++t)e.data[t-s]=this.data[t];e.t=Math.max(this.t-s,0),e.s=this.s}function bw(s,e){var t=s%this.DB,r=this.DB-t,a=(1<<r)-1,n=Math.floor(s/this.DB),i=this.s<<t&this.DM,o;for(o=this.t-1;o>=0;--o)e.data[o+n+1]=this.data[o]>>r|i,i=(this.data[o]&a)<<t;for(o=n-1;o>=0;--o)e.data[o]=0;e.data[n]=i,e.t=this.t+n+1,e.s=this.s,e.clamp()}function kw(s,e){e.s=this.s;var t=Math.floor(s/this.DB);if(t>=this.t){e.t=0;return}var r=s%this.DB,a=this.DB-r,n=(1<<r)-1;e.data[0]=this.data[t]>>r;for(var i=t+1;i<this.t;++i)e.data[i-t-1]|=(this.data[i]&n)<<a,e.data[i-t]=this.data[i]>>r;r>0&&(e.data[this.t-t-1]|=(this.s&n)<<a),e.t=this.t-t,e.clamp()}function Iw(s,e){for(var t=0,r=0,a=Math.min(s.t,this.t);t<a;)r+=this.data[t]-s.data[t],e.data[t++]=r&this.DM,r>>=this.DB;if(s.t<this.t){for(r-=s.s;t<this.t;)r+=this.data[t],e.data[t++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;t<s.t;)r-=s.data[t],e.data[t++]=r&this.DM,r>>=this.DB;r-=s.s}e.s=r<0?-1:0,r<-1?e.data[t++]=this.DV+r:r>0&&(e.data[t++]=r),e.t=t,e.clamp()}function Bw(s,e){var t=this.abs(),r=s.abs(),a=t.t;for(e.t=a+r.t;--a>=0;)e.data[a]=0;for(a=0;a<r.t;++a)e.data[a+t.t]=t.am(0,r.data[a],e,a,0,t.t);e.s=0,e.clamp(),this.s!=s.s&&Y.ZERO.subTo(e,e)}function xw(s){for(var e=this.abs(),t=s.t=2*e.t;--t>=0;)s.data[t]=0;for(t=0;t<e.t-1;++t){var r=e.am(t,e.data[t],s,2*t,0,1);(s.data[t+e.t]+=e.am(t+1,2*e.data[t],s,2*t+1,r,e.t-t-1))>=e.DV&&(s.data[t+e.t]-=e.DV,s.data[t+e.t+1]=1)}s.t>0&&(s.data[s.t-1]+=e.am(t,e.data[t],s,2*t,0,1)),s.s=0,s.clamp()}function Nw(s,e,t){var r=s.abs();if(!(r.t<=0)){var a=this.abs();if(a.t<r.t){e!=null&&e.fromInt(0),t!=null&&this.copyTo(t);return}t==null&&(t=et());var n=et(),i=this.s,o=s.s,l=this.DB-sd(r.data[r.t-1]);l>0?(r.lShiftTo(l,n),a.lShiftTo(l,t)):(r.copyTo(n),a.copyTo(t));var u=n.t,c=n.data[u-1];if(c!=0){var f=c*(1<<this.F1)+(u>1?n.data[u-2]>>this.F2:0),g=this.FV/f,v=(1<<this.F1)/f,p=1<<this.F2,h=t.t,d=h-u,y=e==null?et():e;for(n.dlShiftTo(d,y),t.compareTo(y)>=0&&(t.data[t.t++]=1,t.subTo(y,t)),Y.ONE.dlShiftTo(u,y),y.subTo(n,n);n.t<u;)n.data[n.t++]=0;for(;--d>=0;){var E=t.data[--h]==c?this.DM:Math.floor(t.data[h]*g+(t.data[h-1]+p)*v);if((t.data[h]+=n.am(0,E,t,d,0,u))<E)for(n.dlShiftTo(d,y),t.subTo(y,t);t.data[h]<--E;)t.subTo(y,t)}e!=null&&(t.drShiftTo(u,e),i!=o&&Y.ZERO.subTo(e,e)),t.t=u,t.clamp(),l>0&&t.rShiftTo(l,t),i<0&&Y.ZERO.subTo(t,t)}}}function Tw(s){var e=et();return this.abs().divRemTo(s,null,e),this.s<0&&e.compareTo(Y.ZERO)>0&&s.subTo(e,e),e}function oo(s){this.m=s}function Rw(s){return s.s<0||s.compareTo(this.m)>=0?s.mod(this.m):s}function Vw(s){return s}function _w(s){s.divRemTo(this.m,null,s)}function $w(s,e,t){s.multiplyTo(e,t),this.reduce(t)}function Dw(s,e){s.squareTo(e),this.reduce(e)}oo.prototype.convert=Rw;oo.prototype.revert=Vw;oo.prototype.reduce=_w;oo.prototype.mulTo=$w;oo.prototype.sqrTo=Dw;function Lw(){if(this.t<1)return 0;var s=this.data[0];if((s&1)==0)return 0;var e=s&3;return e=e*(2-(s&15)*e)&15,e=e*(2-(s&255)*e)&255,e=e*(2-((s&65535)*e&65535))&65535,e=e*(2-s*e%this.DV)%this.DV,e>0?this.DV-e:-e}function lo(s){this.m=s,this.mp=s.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<s.DB-15)-1,this.mt2=2*s.t}function Ow(s){var e=et();return s.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),s.s<0&&e.compareTo(Y.ZERO)>0&&this.m.subTo(e,e),e}function Pw(s){var e=et();return s.copyTo(e),this.reduce(e),e}function Uw(s){for(;s.t<=this.mt2;)s.data[s.t++]=0;for(var e=0;e<this.m.t;++e){var t=s.data[e]&32767,r=t*this.mpl+((t*this.mph+(s.data[e]>>15)*this.mpl&this.um)<<15)&s.DM;for(t=e+this.m.t,s.data[t]+=this.m.am(0,r,s,e,0,this.m.t);s.data[t]>=s.DV;)s.data[t]-=s.DV,s.data[++t]++}s.clamp(),s.drShiftTo(this.m.t,s),s.compareTo(this.m)>=0&&s.subTo(this.m,s)}function Kw(s,e){s.squareTo(e),this.reduce(e)}function Mw(s,e,t){s.multiplyTo(e,t),this.reduce(t)}lo.prototype.convert=Ow;lo.prototype.revert=Pw;lo.prototype.reduce=Uw;lo.prototype.mulTo=Mw;lo.prototype.sqrTo=Kw;function Hw(){return(this.t>0?this.data[0]&1:this.s)==0}function Fw(s,e){if(s>4294967295||s<1)return Y.ONE;var t=et(),r=et(),a=e.convert(this),n=sd(s)-1;for(a.copyTo(t);--n>=0;)if(e.sqrTo(t,r),(s&1<<n)>0)e.mulTo(r,a,t);else{var i=t;t=r,r=i}return e.revert(t)}function qw(s,e){var t;return s<256||e.isEven()?t=new oo(e):t=new lo(e),this.exp(s,t)}Y.prototype.copyTo=dw;Y.prototype.fromInt=gw;Y.prototype.fromString=mw;Y.prototype.clamp=pw;Y.prototype.dlShiftTo=Aw;Y.prototype.drShiftTo=Ew;Y.prototype.lShiftTo=bw;Y.prototype.rShiftTo=kw;Y.prototype.subTo=Iw;Y.prototype.multiplyTo=Bw;Y.prototype.squareTo=xw;Y.prototype.divRemTo=Nw;Y.prototype.invDigit=Lw;Y.prototype.isEven=Hw;Y.prototype.exp=Fw;Y.prototype.toString=yw;Y.prototype.negate=vw;Y.prototype.abs=ww;Y.prototype.compareTo=Sw;Y.prototype.bitLength=Cw;Y.prototype.mod=Tw;Y.prototype.modPowInt=qw;Y.ZERO=fn(0);Y.ONE=fn(1);function Jw(){var s=et();return this.copyTo(s),s}function Gw(){if(this.s<0){if(this.t==1)return this.data[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this.data[0];if(this.t==0)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function jw(){return this.t==0?this.s:this.data[0]<<24>>24}function Ww(){return this.t==0?this.s:this.data[0]<<16>>16}function Qw(s){return Math.floor(Math.LN2*this.DB/Math.log(s))}function Yw(){return this.s<0?-1:this.t<=0||this.t==1&&this.data[0]<=0?0:1}function zw(s){if(s==null&&(s=10),this.signum()==0||s<2||s>36)return"0";var e=this.chunkSize(s),t=Math.pow(s,e),r=fn(t),a=et(),n=et(),i="";for(this.divRemTo(r,a,n);a.signum()>0;)i=(t+n.intValue()).toString(s).substr(1)+i,a.divRemTo(r,a,n);return n.intValue().toString(s)+i}function Xw(s,e){this.fromInt(0),e==null&&(e=10);for(var t=this.chunkSize(e),r=Math.pow(e,t),a=!1,n=0,i=0,o=0;o<s.length;++o){var l=ly(s,o);if(l<0){s.charAt(o)=="-"&&this.signum()==0&&(a=!0);continue}i=e*i+l,++n>=t&&(this.dMultiply(r),this.dAddOffset(i,0),n=0,i=0)}n>0&&(this.dMultiply(Math.pow(e,n)),this.dAddOffset(i,0)),a&&Y.ZERO.subTo(this,this)}function Zw(s,e,t){if(typeof e=="number")if(s<2)this.fromInt(1);else for(this.fromNumber(s,t),this.testBit(s-1)||this.bitwiseTo(Y.ONE.shiftLeft(s-1),zg,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>s&&this.subTo(Y.ONE.shiftLeft(s-1),this);else{var r=new Array,a=s&7;r.length=(s>>3)+1,e.nextBytes(r),a>0?r[0]&=(1<<a)-1:r[0]=0,this.fromString(r,256)}}function eS(){var s=this.t,e=new Array;e[0]=this.s;var t=this.DB-s*this.DB%8,r,a=0;if(s-- >0)for(t<this.DB&&(r=this.data[s]>>t)!=(this.s&this.DM)>>t&&(e[a++]=r|this.s<<this.DB-t);s>=0;)t<8?(r=(this.data[s]&(1<<t)-1)<<8-t,r|=this.data[--s]>>(t+=this.DB-8)):(r=this.data[s]>>(t-=8)&255,t<=0&&(t+=this.DB,--s)),(r&128)!=0&&(r|=-256),a==0&&(this.s&128)!=(r&128)&&++a,(a>0||r!=this.s)&&(e[a++]=r);return e}function tS(s){return this.compareTo(s)==0}function rS(s){return this.compareTo(s)<0?this:s}function sS(s){return this.compareTo(s)>0?this:s}function aS(s,e,t){var r,a,n=Math.min(s.t,this.t);for(r=0;r<n;++r)t.data[r]=e(this.data[r],s.data[r]);if(s.t<this.t){for(a=s.s&this.DM,r=n;r<this.t;++r)t.data[r]=e(this.data[r],a);t.t=this.t}else{for(a=this.s&this.DM,r=n;r<s.t;++r)t.data[r]=e(a,s.data[r]);t.t=s.t}t.s=e(this.s,s.s),t.clamp()}function nS(s,e){return s&e}function iS(s){var e=et();return this.bitwiseTo(s,nS,e),e}function zg(s,e){return s|e}function oS(s){var e=et();return this.bitwiseTo(s,zg,e),e}function uy(s,e){return s^e}function lS(s){var e=et();return this.bitwiseTo(s,uy,e),e}function cy(s,e){return s&~e}function uS(s){var e=et();return this.bitwiseTo(s,cy,e),e}function cS(){for(var s=et(),e=0;e<this.t;++e)s.data[e]=this.DM&~this.data[e];return s.t=this.t,s.s=~this.s,s}function fS(s){var e=et();return s<0?this.rShiftTo(-s,e):this.lShiftTo(s,e),e}function hS(s){var e=et();return s<0?this.lShiftTo(-s,e):this.rShiftTo(s,e),e}function dS(s){if(s==0)return-1;var e=0;return(s&65535)==0&&(s>>=16,e+=16),(s&255)==0&&(s>>=8,e+=8),(s&15)==0&&(s>>=4,e+=4),(s&3)==0&&(s>>=2,e+=2),(s&1)==0&&++e,e}function gS(){for(var s=0;s<this.t;++s)if(this.data[s]!=0)return s*this.DB+dS(this.data[s]);return this.s<0?this.t*this.DB:-1}function mS(s){for(var e=0;s!=0;)s&=s-1,++e;return e}function pS(){for(var s=0,e=this.s&this.DM,t=0;t<this.t;++t)s+=mS(this.data[t]^e);return s}function yS(s){var e=Math.floor(s/this.DB);return e>=this.t?this.s!=0:(this.data[e]&1<<s%this.DB)!=0}function vS(s,e){var t=Y.ONE.shiftLeft(s);return this.bitwiseTo(t,e,t),t}function wS(s){return this.changeBit(s,zg)}function SS(s){return this.changeBit(s,cy)}function CS(s){return this.changeBit(s,uy)}function AS(s,e){for(var t=0,r=0,a=Math.min(s.t,this.t);t<a;)r+=this.data[t]+s.data[t],e.data[t++]=r&this.DM,r>>=this.DB;if(s.t<this.t){for(r+=s.s;t<this.t;)r+=this.data[t],e.data[t++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;t<s.t;)r+=s.data[t],e.data[t++]=r&this.DM,r>>=this.DB;r+=s.s}e.s=r<0?-1:0,r>0?e.data[t++]=r:r<-1&&(e.data[t++]=this.DV+r),e.t=t,e.clamp()}function ES(s){var e=et();return this.addTo(s,e),e}function bS(s){var e=et();return this.subTo(s,e),e}function kS(s){var e=et();return this.multiplyTo(s,e),e}function IS(s){var e=et();return this.divRemTo(s,e,null),e}function BS(s){var e=et();return this.divRemTo(s,null,e),e}function xS(s){var e=et(),t=et();return this.divRemTo(s,e,t),new Array(e,t)}function NS(s){this.data[this.t]=this.am(0,s-1,this,0,0,this.t),++this.t,this.clamp()}function TS(s,e){if(s!=0){for(;this.t<=e;)this.data[this.t++]=0;for(this.data[e]+=s;this.data[e]>=this.DV;)this.data[e]-=this.DV,++e>=this.t&&(this.data[this.t++]=0),++this.data[e]}}function nh(){}function fy(s){return s}function RS(s,e,t){s.multiplyTo(e,t)}function VS(s,e){s.squareTo(e)}nh.prototype.convert=fy;nh.prototype.revert=fy;nh.prototype.mulTo=RS;nh.prototype.sqrTo=VS;function _S(s){return this.exp(s,new nh)}function $S(s,e,t){var r=Math.min(this.t+s.t,e);for(t.s=0,t.t=r;r>0;)t.data[--r]=0;var a;for(a=t.t-this.t;r<a;++r)t.data[r+this.t]=this.am(0,s.data[r],t,r,0,this.t);for(a=Math.min(s.t,e);r<a;++r)this.am(0,s.data[r],t,r,0,e-r);t.clamp()}function DS(s,e,t){--e;var r=t.t=this.t+s.t-e;for(t.s=0;--r>=0;)t.data[r]=0;for(r=Math.max(e-this.t,0);r<s.t;++r)t.data[this.t+r-e]=this.am(e-r,s.data[r],t,0,0,this.t+r-e);t.clamp(),t.drShiftTo(1,t)}function pu(s){this.r2=et(),this.q3=et(),Y.ONE.dlShiftTo(2*s.t,this.r2),this.mu=this.r2.divide(s),this.m=s}function LS(s){if(s.s<0||s.t>2*this.m.t)return s.mod(this.m);if(s.compareTo(this.m)<0)return s;var e=et();return s.copyTo(e),this.reduce(e),e}function OS(s){return s}function PS(s){for(s.drShiftTo(this.m.t-1,this.r2),s.t>this.m.t+1&&(s.t=this.m.t+1,s.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);s.compareTo(this.r2)<0;)s.dAddOffset(1,this.m.t+1);for(s.subTo(this.r2,s);s.compareTo(this.m)>=0;)s.subTo(this.m,s)}function US(s,e){s.squareTo(e),this.reduce(e)}function KS(s,e,t){s.multiplyTo(e,t),this.reduce(t)}pu.prototype.convert=LS;pu.prototype.revert=OS;pu.prototype.reduce=PS;pu.prototype.mulTo=KS;pu.prototype.sqrTo=US;function MS(s,e){var t=s.bitLength(),r,a=fn(1),n;if(t<=0)return a;t<18?r=1:t<48?r=3:t<144?r=4:t<768?r=5:r=6,t<8?n=new oo(e):e.isEven()?n=new pu(e):n=new lo(e);var i=new Array,o=3,l=r-1,u=(1<<r)-1;if(i[1]=n.convert(this),r>1){var c=et();for(n.sqrTo(i[1],c);o<=u;)i[o]=et(),n.mulTo(c,i[o-2],i[o]),o+=2}var f=s.t-1,g,v=!0,p=et(),h;for(t=sd(s.data[f])-1;f>=0;){for(t>=l?g=s.data[f]>>t-l&u:(g=(s.data[f]&(1<<t+1)-1)<<l-t,f>0&&(g|=s.data[f-1]>>this.DB+t-l)),o=r;(g&1)==0;)g>>=1,--o;if((t-=o)<0&&(t+=this.DB,--f),v)i[g].copyTo(a),v=!1;else{for(;o>1;)n.sqrTo(a,p),n.sqrTo(p,a),o-=2;o>0?n.sqrTo(a,p):(h=a,a=p,p=h),n.mulTo(p,i[g],a)}for(;f>=0&&(s.data[f]&1<<t)==0;)n.sqrTo(a,p),h=a,a=p,p=h,--t<0&&(t=this.DB-1,--f)}return n.revert(a)}function HS(s){var e=this.s<0?this.negate():this.clone(),t=s.s<0?s.negate():s.clone();if(e.compareTo(t)<0){var r=e;e=t,t=r}var a=e.getLowestSetBit(),n=t.getLowestSetBit();if(n<0)return e;for(a<n&&(n=a),n>0&&(e.rShiftTo(n,e),t.rShiftTo(n,t));e.signum()>0;)(a=e.getLowestSetBit())>0&&e.rShiftTo(a,e),(a=t.getLowestSetBit())>0&&t.rShiftTo(a,t),e.compareTo(t)>=0?(e.subTo(t,e),e.rShiftTo(1,e)):(t.subTo(e,t),t.rShiftTo(1,t));return n>0&&t.lShiftTo(n,t),t}function FS(s){if(s<=0)return 0;var e=this.DV%s,t=this.s<0?s-1:0;if(this.t>0)if(e==0)t=this.data[0]%s;else for(var r=this.t-1;r>=0;--r)t=(e*t+this.data[r])%s;return t}function qS(s){var e=s.isEven();if(this.isEven()&&e||s.signum()==0)return Y.ZERO;for(var t=s.clone(),r=this.clone(),a=fn(1),n=fn(0),i=fn(0),o=fn(1);t.signum()!=0;){for(;t.isEven();)t.rShiftTo(1,t),e?((!a.isEven()||!n.isEven())&&(a.addTo(this,a),n.subTo(s,n)),a.rShiftTo(1,a)):n.isEven()||n.subTo(s,n),n.rShiftTo(1,n);for(;r.isEven();)r.rShiftTo(1,r),e?((!i.isEven()||!o.isEven())&&(i.addTo(this,i),o.subTo(s,o)),i.rShiftTo(1,i)):o.isEven()||o.subTo(s,o),o.rShiftTo(1,o);t.compareTo(r)>=0?(t.subTo(r,t),e&&a.subTo(i,a),n.subTo(o,n)):(r.subTo(t,r),e&&i.subTo(a,i),o.subTo(n,o))}if(r.compareTo(Y.ONE)!=0)return Y.ZERO;if(o.compareTo(s)>=0)return o.subtract(s);if(o.signum()<0)o.addTo(s,o);else return o;return o.signum()<0?o.add(s):o}var as=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],JS=(1<<26)/as[as.length-1];function GS(s){var e,t=this.abs();if(t.t==1&&t.data[0]<=as[as.length-1]){for(e=0;e<as.length;++e)if(t.data[0]==as[e])return!0;return!1}if(t.isEven())return!1;for(e=1;e<as.length;){for(var r=as[e],a=e+1;a<as.length&&r<JS;)r*=as[a++];for(r=t.modInt(r);e<a;)if(r%as[e++]==0)return!1}return t.millerRabin(s)}function jS(s){var e=this.subtract(Y.ONE),t=e.getLowestSetBit();if(t<=0)return!1;for(var r=e.shiftRight(t),a=WS(),n,i=0;i<s;++i){do n=new Y(this.bitLength(),a);while(n.compareTo(Y.ONE)<=0||n.compareTo(e)>=0);var o=n.modPow(r,this);if(o.compareTo(Y.ONE)!=0&&o.compareTo(e)!=0){for(var l=1;l++<t&&o.compareTo(e)!=0;)if(o=o.modPowInt(2,this),o.compareTo(Y.ONE)==0)return!1;if(o.compareTo(e)!=0)return!1}}return!0}function WS(){return{nextBytes:function(s){for(var e=0;e<s.length;++e)s[e]=Math.floor(Math.random()*256)}}}Y.prototype.chunkSize=Qw;Y.prototype.toRadix=zw;Y.prototype.fromRadix=Xw;Y.prototype.fromNumber=Zw;Y.prototype.bitwiseTo=aS;Y.prototype.changeBit=vS;Y.prototype.addTo=AS;Y.prototype.dMultiply=NS;Y.prototype.dAddOffset=TS;Y.prototype.multiplyLowerTo=$S;Y.prototype.multiplyUpperTo=DS;Y.prototype.modInt=FS;Y.prototype.millerRabin=jS;Y.prototype.clone=Jw;Y.prototype.intValue=Gw;Y.prototype.byteValue=jw;Y.prototype.shortValue=Ww;Y.prototype.signum=Yw;Y.prototype.toByteArray=eS;Y.prototype.equals=tS;Y.prototype.min=rS;Y.prototype.max=sS;Y.prototype.and=iS;Y.prototype.or=oS;Y.prototype.xor=lS;Y.prototype.andNot=uS;Y.prototype.not=cS;Y.prototype.shiftLeft=fS;Y.prototype.shiftRight=hS;Y.prototype.getLowestSetBit=gS;Y.prototype.bitCount=pS;Y.prototype.testBit=yS;Y.prototype.setBit=wS;Y.prototype.clearBit=SS;Y.prototype.flipBit=CS;Y.prototype.add=ES;Y.prototype.subtract=bS;Y.prototype.multiply=kS;Y.prototype.divide=IS;Y.prototype.remainder=BS;Y.prototype.divideAndRemainder=xS;Y.prototype.modPow=MS;Y.prototype.modInverse=qS;Y.prototype.pow=_S;Y.prototype.gcd=HS;Y.prototype.isProbablePrime=GS;var ks=Fe,hy=ks.sha1=ks.sha1||{};ks.md.sha1=ks.md.algorithms.sha1=hy;hy.create=function(){dy||QS();var s=null,e=ks.util.createBuffer(),t=new Array(80),r={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8};return r.start=function(){r.messageLength=0,r.fullMessageLength=r.messageLength64=[];for(var a=r.messageLengthSize/4,n=0;n<a;++n)r.fullMessageLength.push(0);return e=ks.util.createBuffer(),s={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},r},r.start(),r.update=function(a,n){n==="utf8"&&(a=ks.util.encodeUtf8(a));var i=a.length;r.messageLength+=i,i=[i/4294967296>>>0,i>>>0];for(var o=r.fullMessageLength.length-1;o>=0;--o)r.fullMessageLength[o]+=i[1],i[1]=i[0]+(r.fullMessageLength[o]/4294967296>>>0),r.fullMessageLength[o]=r.fullMessageLength[o]>>>0,i[0]=i[1]/4294967296>>>0;return e.putBytes(a),Jm(s,t,e),(e.read>2048||e.length()===0)&&e.compact(),r},r.digest=function(){var a=ks.util.createBuffer();a.putBytes(e.bytes());var n=r.fullMessageLength[r.fullMessageLength.length-1]+r.messageLengthSize,i=n&r.blockLength-1;a.putBytes(ag.substr(0,r.blockLength-i));for(var o,l,u=r.fullMessageLength[0]*8,c=0;c<r.fullMessageLength.length-1;++c)o=r.fullMessageLength[c+1]*8,l=o/4294967296>>>0,u+=l,a.putInt32(u>>>0),u=o>>>0;a.putInt32(u);var f={h0:s.h0,h1:s.h1,h2:s.h2,h3:s.h3,h4:s.h4};Jm(f,t,a);var g=ks.util.createBuffer();return g.putInt32(f.h0),g.putInt32(f.h1),g.putInt32(f.h2),g.putInt32(f.h3),g.putInt32(f.h4),g},r};var ag=null,dy=!1;function QS(){ag=String.fromCharCode(128),ag+=ks.util.fillString(String.fromCharCode(0),64),dy=!0}function Jm(s,e,t){for(var r,a,n,i,o,l,u,c,f=t.length();f>=64;){for(a=s.h0,n=s.h1,i=s.h2,o=s.h3,l=s.h4,c=0;c<16;++c)r=t.getInt32(),e[c]=r,u=o^n&(i^o),r=(a<<5|a>>>27)+u+l+1518500249+r,l=o,o=i,i=(n<<30|n>>>2)>>>0,n=a,a=r;for(;c<20;++c)r=e[c-3]^e[c-8]^e[c-14]^e[c-16],r=r<<1|r>>>31,e[c]=r,u=o^n&(i^o),r=(a<<5|a>>>27)+u+l+1518500249+r,l=o,o=i,i=(n<<30|n>>>2)>>>0,n=a,a=r;for(;c<32;++c)r=e[c-3]^e[c-8]^e[c-14]^e[c-16],r=r<<1|r>>>31,e[c]=r,u=n^i^o,r=(a<<5|a>>>27)+u+l+1859775393+r,l=o,o=i,i=(n<<30|n>>>2)>>>0,n=a,a=r;for(;c<40;++c)r=e[c-6]^e[c-16]^e[c-28]^e[c-32],r=r<<2|r>>>30,e[c]=r,u=n^i^o,r=(a<<5|a>>>27)+u+l+1859775393+r,l=o,o=i,i=(n<<30|n>>>2)>>>0,n=a,a=r;for(;c<60;++c)r=e[c-6]^e[c-16]^e[c-28]^e[c-32],r=r<<2|r>>>30,e[c]=r,u=n&i|o&(n^i),r=(a<<5|a>>>27)+u+l+2400959708+r,l=o,o=i,i=(n<<30|n>>>2)>>>0,n=a,a=r;for(;c<80;++c)r=e[c-6]^e[c-16]^e[c-28]^e[c-32],r=r<<2|r>>>30,e[c]=r,u=n^i^o,r=(a<<5|a>>>27)+u+l+3395469782+r,l=o,o=i,i=(n<<30|n>>>2)>>>0,n=a,a=r;s.h0=s.h0+a|0,s.h1=s.h1+n|0,s.h2=s.h2+i|0,s.h3=s.h3+o|0,s.h4=s.h4+l|0,f-=64}}var Bs=Fe,gy=Bs.pkcs1=Bs.pkcs1||{};gy.encode_rsa_oaep=function(s,e,t){var r,a,n,i;typeof t=="string"?(r=t,a=arguments[3]||void 0,n=arguments[4]||void 0):t&&(r=t.label||void 0,a=t.seed||void 0,n=t.md||void 0,t.mgf1&&t.mgf1.md&&(i=t.mgf1.md)),n?n.start():n=Bs.md.sha1.create(),i||(i=n);var o=Math.ceil(s.n.bitLength()/8),l=o-2*n.digestLength-2;if(e.length>l){var u=new Error("RSAES-OAEP input message length is too long.");throw u.length=e.length,u.maxLength=l,u}r||(r=""),n.update(r,"raw");for(var c=n.digest(),f="",g=l-e.length,v=0;v<g;v++)f+="\0";var p=c.getBytes()+f+""+e;if(!a)a=Bs.random.getBytes(n.digestLength);else if(a.length!==n.digestLength){var u=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw u.seedLength=a.length,u.digestLength=n.digestLength,u}var h=E0(a,o-n.digestLength-1,i),d=Bs.util.xorBytes(p,h,p.length),y=E0(d,n.digestLength,i),E=Bs.util.xorBytes(a,y,a.length);return"\0"+E+d};gy.decode_rsa_oaep=function(s,e,t){var r,a,n;typeof t=="string"?(r=t,a=arguments[3]||void 0):t&&(r=t.label||void 0,a=t.md||void 0,t.mgf1&&t.mgf1.md&&(n=t.mgf1.md));var i=Math.ceil(s.n.bitLength()/8);if(e.length!==i){var d=new Error("RSAES-OAEP encoded message length is invalid.");throw d.length=e.length,d.expectedLength=i,d}if(a===void 0?a=Bs.md.sha1.create():a.start(),n||(n=a),i<2*a.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");r||(r=""),a.update(r,"raw");for(var o=a.digest().getBytes(),l=e.charAt(0),u=e.substring(1,a.digestLength+1),c=e.substring(1+a.digestLength),f=E0(c,a.digestLength,n),g=Bs.util.xorBytes(u,f,u.length),v=E0(g,i-a.digestLength-1,n),p=Bs.util.xorBytes(c,v,c.length),h=p.substring(0,a.digestLength),d=l!=="\0",y=0;y<a.digestLength;++y)d|=o.charAt(y)!==h.charAt(y);for(var E=1,k=a.digestLength,R=a.digestLength;R<p.length;R++){var V=p.charCodeAt(R),L=V&1^1,ne=E?65534:0;d|=V&ne,E=E&L,k+=E}if(d||p.charCodeAt(k)!==1)throw new Error("Invalid RSAES-OAEP padding.");return p.substring(k+1)};function E0(s,e,t){t||(t=Bs.md.sha1.create());for(var r="",a=Math.ceil(e/t.digestLength),n=0;n<a;++n){var i=String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255);t.start(),t.update(s+i),r+=t.digest().getBytes()}return r.substring(0,e)}var pa=Fe;(function(){if(pa.prime){pa.prime;return}var s=pa.prime=pa.prime||{},e=pa.jsbn.BigInteger,t=[6,4,2,4,2,4,6,2],r=new e(null);r.fromInt(30);var a=function(f,g){return f|g};s.generateProbablePrime=function(f,g,v){typeof g=="function"&&(v=g,g={}),g=g||{};var p=g.algorithm||"PRIMEINC";typeof p=="string"&&(p={name:p}),p.options=p.options||{};var h=g.prng||pa.random,d={nextBytes:function(y){for(var E=h.getBytesSync(y.length),k=0;k<y.length;++k)y[k]=E.charCodeAt(k)}};if(p.name==="PRIMEINC")return n(f,d,p.options,v);throw new Error("Invalid prime generation algorithm: "+p.name)};function n(f,g,v,p){return"workers"in v?l(f,g,v,p):i(f,g,v,p)}function i(f,g,v,p){var h=u(f,g),d=0,y=c(h.bitLength());"millerRabinTests"in v&&(y=v.millerRabinTests);var E=10;"maxBlockTime"in v&&(E=v.maxBlockTime),o(h,f,g,d,y,E,p)}function o(f,g,v,p,h,d,y){var E=+new Date;do{if(f.bitLength()>g&&(f=u(g,v)),f.isProbablePrime(h))return y(null,f);f.dAddOffset(t[p++%8],0)}while(d<0||+new Date-E<d);pa.util.setImmediate(function(){o(f,g,v,p,h,d,y)})}function l(f,g,v,p){if(typeof Worker>"u")return i(f,g,v,p);var h=u(f,g),d=v.workers,y=v.workLoad||100,E=y*30/8,k=v.workerScript||"forge/prime.worker.js";if(d===-1)return pa.util.estimateCores(function(V,L){V&&(L=2),d=L-1,R()});R();function R(){d=Math.max(1,d);for(var V=[],L=0;L<d;++L)V[L]=new Worker(k);for(var L=0;L<d;++L)V[L].addEventListener("message",ae);var ne=!1;function ae(ve){if(!ne){var Te=ve.data;if(Te.found){for(var ye=0;ye<V.length;++ye)V[ye].terminate();return ne=!0,p(null,new e(Te.prime,16))}h.bitLength()>f&&(h=u(f,g));var Ce=h.toString(16);ve.target.postMessage({hex:Ce,workLoad:y}),h.dAddOffset(E,0)}}}}function u(f,g){var v=new e(f,g),p=f-1;return v.testBit(p)||v.bitwiseTo(e.ONE.shiftLeft(p),a,v),v.dAddOffset(31-v.mod(r).byteValue(),0),v}function c(f){return f<=100?27:f<=150?18:f<=200?15:f<=250?12:f<=300?9:f<=350?8:f<=400?7:f<=500?6:f<=600?5:f<=800?4:f<=1250?3:2}})();var we=Fe;if(typeof Ze>"u")var Ze=we.jsbn.BigInteger;var ng=we.util.isNodejs?Qg:null,T=we.asn1,Xr=we.util;we.pki=we.pki||{};we.pki.rsa=we.rsa=we.rsa||{};var De=we.pki,YS=[6,4,2,4,2,4,6,2],Xg={name:"PrivateKeyInfo",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:T.Class.UNIVERSAL,type:T.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},zS={name:"RSAPrivateKey",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},XS={name:"RSAPublicKey",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},ZS=we.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:T.Class.UNIVERSAL,type:T.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},eC={name:"DigestInfo",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:T.Class.UNIVERSAL,type:T.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:T.Class.UNIVERSAL,type:T.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},tC=function(s){var e;if(s.algorithm in De.oids)e=De.oids[s.algorithm];else{var t=new Error("Unknown message digest algorithm.");throw t.algorithm=s.algorithm,t}var r=T.oidToDer(e).getBytes(),a=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[]),n=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[]);n.value.push(T.create(T.Class.UNIVERSAL,T.Type.OID,!1,r)),n.value.push(T.create(T.Class.UNIVERSAL,T.Type.NULL,!1,""));var i=T.create(T.Class.UNIVERSAL,T.Type.OCTETSTRING,!1,s.digest().getBytes());return a.value.push(n),a.value.push(i),T.toDer(a).getBytes()},my=function(s,e,t){if(t)return s.modPow(e.e,e.n);if(!e.p||!e.q)return s.modPow(e.d,e.n);e.dP||(e.dP=e.d.mod(e.p.subtract(Ze.ONE))),e.dQ||(e.dQ=e.d.mod(e.q.subtract(Ze.ONE))),e.qInv||(e.qInv=e.q.modInverse(e.p));var r;do r=new Ze(we.util.bytesToHex(we.random.getBytes(e.n.bitLength()/8)),16);while(r.compareTo(e.n)>=0||!r.gcd(e.n).equals(Ze.ONE));s=s.multiply(r.modPow(e.e,e.n)).mod(e.n);for(var a=s.mod(e.p).modPow(e.dP,e.p),n=s.mod(e.q).modPow(e.dQ,e.q);a.compareTo(n)<0;)a=a.add(e.p);var i=a.subtract(n).multiply(e.qInv).mod(e.p).multiply(e.q).add(n);return i=i.multiply(r.modInverse(e.n)).mod(e.n),i};De.rsa.encrypt=function(s,e,t){var r=t,a,n=Math.ceil(e.n.bitLength()/8);t!==!1&&t!==!0?(r=t===2,a=py(s,e,t)):(a=we.util.createBuffer(),a.putBytes(s));for(var i=new Ze(a.toHex(),16),o=my(i,e,r),l=o.toString(16),u=we.util.createBuffer(),c=n-Math.ceil(l.length/2);c>0;)u.putByte(0),--c;return u.putBytes(we.util.hexToBytes(l)),u.getBytes()};De.rsa.decrypt=function(s,e,t,r){var a=Math.ceil(e.n.bitLength()/8);if(s.length!==a){var n=new Error("Encrypted message length is invalid.");throw n.length=s.length,n.expected=a,n}var i=new Ze(we.util.createBuffer(s).toHex(),16);if(i.compareTo(e.n)>=0)throw new Error("Encrypted message is invalid.");for(var o=my(i,e,t),l=o.toString(16),u=we.util.createBuffer(),c=a-Math.ceil(l.length/2);c>0;)u.putByte(0),--c;return u.putBytes(we.util.hexToBytes(l)),r!==!1?b0(u.getBytes(),e,t):u.getBytes()};De.rsa.createKeyPairGenerationState=function(s,e,t){typeof s=="string"&&(s=parseInt(s,10)),s=s||2048,t=t||{};var r=t.prng||we.random,a={nextBytes:function(o){for(var l=r.getBytesSync(o.length),u=0;u<o.length;++u)o[u]=l.charCodeAt(u)}},n=t.algorithm||"PRIMEINC",i;if(n==="PRIMEINC")i={algorithm:n,state:0,bits:s,rng:a,eInt:e||65537,e:new Ze(null),p:null,q:null,qBits:s>>1,pBits:s-(s>>1),pqState:0,num:null,keys:null},i.e.fromInt(i.eInt);else throw new Error("Invalid key generation algorithm: "+n);return i};De.rsa.stepKeyPairGenerationState=function(s,e){"algorithm"in s||(s.algorithm="PRIMEINC");var t=new Ze(null);t.fromInt(30);for(var r=0,a=function(f,g){return f|g},n=+new Date,i,o=0;s.keys===null&&(e<=0||o<e);){if(s.state===0){var l=s.p===null?s.pBits:s.qBits,u=l-1;s.pqState===0?(s.num=new Ze(l,s.rng),s.num.testBit(u)||s.num.bitwiseTo(Ze.ONE.shiftLeft(u),a,s.num),s.num.dAddOffset(31-s.num.mod(t).byteValue(),0),r=0,++s.pqState):s.pqState===1?s.num.bitLength()>l?s.pqState=0:s.num.isProbablePrime(sC(s.num.bitLength()))?++s.pqState:s.num.dAddOffset(YS[r++%8],0):s.pqState===2?s.pqState=s.num.subtract(Ze.ONE).gcd(s.e).compareTo(Ze.ONE)===0?3:0:s.pqState===3&&(s.pqState=0,s.p===null?s.p=s.num:s.q=s.num,s.p!==null&&s.q!==null&&++s.state,s.num=null)}else if(s.state===1)s.p.compareTo(s.q)<0&&(s.num=s.p,s.p=s.q,s.q=s.num),++s.state;else if(s.state===2)s.p1=s.p.subtract(Ze.ONE),s.q1=s.q.subtract(Ze.ONE),s.phi=s.p1.multiply(s.q1),++s.state;else if(s.state===3)s.phi.gcd(s.e).compareTo(Ze.ONE)===0?++s.state:(s.p=null,s.q=null,s.state=0);else if(s.state===4)s.n=s.p.multiply(s.q),s.n.bitLength()===s.bits?++s.state:(s.q=null,s.state=0);else if(s.state===5){var c=s.e.modInverse(s.phi);s.keys={privateKey:De.rsa.setPrivateKey(s.n,s.e,c,s.p,s.q,c.mod(s.p1),c.mod(s.q1),s.q.modInverse(s.p)),publicKey:De.rsa.setPublicKey(s.n,s.e)}}i=+new Date,o+=i-n,n=i}return s.keys!==null};De.rsa.generateKeyPair=function(s,e,t,r){if(arguments.length===1?typeof s=="object"?(t=s,s=void 0):typeof s=="function"&&(r=s,s=void 0):arguments.length===2?typeof s=="number"?typeof e=="function"?(r=e,e=void 0):typeof e!="number"&&(t=e,e=void 0):(t=s,r=e,s=void 0,e=void 0):arguments.length===3&&(typeof e=="number"?typeof t=="function"&&(r=t,t=void 0):(r=t,t=e,e=void 0)),t=t||{},s===void 0&&(s=t.bits||2048),e===void 0&&(e=t.e||65537),!we.options.usePureJavaScript&&!t.prng&&s>=256&&s<=16384&&(e===65537||e===3)){if(r){if(Gm("generateKeyPair"))return ng.generateKeyPair("rsa",{modulusLength:s,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},function(o,l,u){if(o)return r(o);r(null,{privateKey:De.privateKeyFromPem(u),publicKey:De.publicKeyFromPem(l)})});if(jm("generateKey")&&jm("exportKey"))return Xr.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:s,publicExponent:Qm(e),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(o){return Xr.globalScope.crypto.subtle.exportKey("pkcs8",o.privateKey)}).then(void 0,function(o){r(o)}).then(function(o){if(o){var l=De.privateKeyFromAsn1(T.fromDer(we.util.createBuffer(o)));r(null,{privateKey:l,publicKey:De.setRsaPublicKey(l.n,l.e)})}});if(Wm("generateKey")&&Wm("exportKey")){var a=Xr.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:s,publicExponent:Qm(e),hash:{name:"SHA-256"}},!0,["sign","verify"]);a.oncomplete=function(o){var l=o.target.result,u=Xr.globalScope.msCrypto.subtle.exportKey("pkcs8",l.privateKey);u.oncomplete=function(c){var f=c.target.result,g=De.privateKeyFromAsn1(T.fromDer(we.util.createBuffer(f)));r(null,{privateKey:g,publicKey:De.setRsaPublicKey(g.n,g.e)})},u.onerror=function(c){r(c)}},a.onerror=function(o){r(o)};return}}else if(Gm("generateKeyPairSync")){var n=ng.generateKeyPairSync("rsa",{modulusLength:s,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:De.privateKeyFromPem(n.privateKey),publicKey:De.publicKeyFromPem(n.publicKey)}}}var i=De.rsa.createKeyPairGenerationState(s,e,t);if(!r)return De.rsa.stepKeyPairGenerationState(i,0),i.keys;rC(i,t,r)};De.setRsaPublicKey=De.rsa.setPublicKey=function(s,e){var t={n:s,e};return t.encrypt=function(r,a,n){if(typeof a=="string"?a=a.toUpperCase():a===void 0&&(a="RSAES-PKCS1-V1_5"),a==="RSAES-PKCS1-V1_5")a={encode:function(o,l,u){return py(o,l,2).getBytes()}};else if(a==="RSA-OAEP"||a==="RSAES-OAEP")a={encode:function(o,l){return we.pkcs1.encode_rsa_oaep(l,o,n)}};else if(["RAW","NONE","NULL",null].indexOf(a)!==-1)a={encode:function(o){return o}};else if(typeof a=="string")throw new Error('Unsupported encryption scheme: "'+a+'".');var i=a.encode(r,t,!0);return De.rsa.encrypt(i,t,!0)},t.verify=function(r,a,n,i){typeof n=="string"?n=n.toUpperCase():n===void 0&&(n="RSASSA-PKCS1-V1_5"),i===void 0&&(i={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in i||(i._parseAllDigestBytes=!0),n==="RSASSA-PKCS1-V1_5"?n={verify:function(l,u){u=b0(u,t,!0);var c=T.fromDer(u,{parseAllBytes:i._parseAllDigestBytes}),f={},g=[];if(!T.validate(c,eC,f,g)){var v=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.");throw v.errors=g,v}var p=T.derToOid(f.algorithmIdentifier);if(!(p===we.oids.md2||p===we.oids.md5||p===we.oids.sha1||p===we.oids.sha224||p===we.oids.sha256||p===we.oids.sha384||p===we.oids.sha512||p===we.oids["sha512-224"]||p===we.oids["sha512-256"])){var v=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.");throw v.oid=p,v}if((p===we.oids.md2||p===we.oids.md5)&&!("parameters"in f))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return l===f.digest}}:(n==="NONE"||n==="NULL"||n===null)&&(n={verify:function(l,u){return u=b0(u,t,!0),l===u}});var o=De.rsa.decrypt(a,t,!0,!1);return n.verify(r,o,t.n.bitLength())},t};De.setRsaPrivateKey=De.rsa.setPrivateKey=function(s,e,t,r,a,n,i,o){var l={n:s,e,d:t,p:r,q:a,dP:n,dQ:i,qInv:o};return l.decrypt=function(u,c,f){typeof c=="string"?c=c.toUpperCase():c===void 0&&(c="RSAES-PKCS1-V1_5");var g=De.rsa.decrypt(u,l,!1,!1);if(c==="RSAES-PKCS1-V1_5")c={decode:b0};else if(c==="RSA-OAEP"||c==="RSAES-OAEP")c={decode:function(v,p){return we.pkcs1.decode_rsa_oaep(p,v,f)}};else if(["RAW","NONE","NULL",null].indexOf(c)!==-1)c={decode:function(v){return v}};else throw new Error('Unsupported encryption scheme: "'+c+'".');return c.decode(g,l,!1)},l.sign=function(u,c){var f=!1;typeof c=="string"&&(c=c.toUpperCase()),c===void 0||c==="RSASSA-PKCS1-V1_5"?(c={encode:tC},f=1):(c==="NONE"||c==="NULL"||c===null)&&(c={encode:function(){return u}},f=1);var g=c.encode(u,l.n.bitLength());return De.rsa.encrypt(g,l,f)},l};De.wrapRsaPrivateKey=function(s){return T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,T.integerToDer(0).getBytes()),T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(De.oids.rsaEncryption).getBytes()),T.create(T.Class.UNIVERSAL,T.Type.NULL,!1,"")]),T.create(T.Class.UNIVERSAL,T.Type.OCTETSTRING,!1,T.toDer(s).getBytes())])};De.getPrivateKeyOid=function(s){var e={},t=[];T.validate(s,Xg,e,t)&&(s=T.fromDer(we.util.createBuffer(e.privateKey)));var r=we.asn1.derToOid(e.privateKeyOid);return console.log(r),r};De.getPrivateKeyData=function(s){var e={},t=[],r="";return T.validate(s,Xg,e,t)&&(r=T.fromDer(we.util.createBuffer(e.privateKey))),r};De.privateKeyFromAsn1=function(s){var e={},t=[];if(T.validate(s,Xg,e,t)&&(s=T.fromDer(we.util.createBuffer(e.privateKey))),e={},t=[],!T.validate(s,zS,e,t)){var r=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey. ");throw r.errors=t,r}var a,n,i,o,l,u,c,f;return a=we.util.createBuffer(e.privateKeyModulus).toHex(),n=we.util.createBuffer(e.privateKeyPublicExponent).toHex(),i=we.util.createBuffer(e.privateKeyPrivateExponent).toHex(),o=we.util.createBuffer(e.privateKeyPrime1).toHex(),l=we.util.createBuffer(e.privateKeyPrime2).toHex(),u=we.util.createBuffer(e.privateKeyExponent1).toHex(),c=we.util.createBuffer(e.privateKeyExponent2).toHex(),f=we.util.createBuffer(e.privateKeyCoefficient).toHex(),De.setRsaPrivateKey(new Ze(a,16),new Ze(n,16),new Ze(i,16),new Ze(o,16),new Ze(l,16),new Ze(u,16),new Ze(c,16),new Ze(f,16))};De.privateKeyToAsn1=De.privateKeyToRSAPrivateKey=function(s){return T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,T.integerToDer(0).getBytes()),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,ws(s.n)),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,ws(s.e)),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,ws(s.d)),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,ws(s.p)),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,ws(s.q)),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,ws(s.dP)),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,ws(s.dQ)),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,ws(s.qInv))])};De.publicKeyFromAsn1=function(s){var e={},t=[];if(T.validate(s,ZS,e,t)){var r=T.derToOid(e.publicKeyOid);if(r!==De.oids.rsaEncryption){var a=new Error("Cannot read public key. Unknown OID.");throw a.oid=r,a}s=e.rsaPublicKey}if(t=[],!T.validate(s,XS,e,t)){var a=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw a.errors=t,a}var n=we.util.createBuffer(e.publicKeyModulus).toHex(),i=we.util.createBuffer(e.publicKeyExponent).toHex();return De.setRsaPublicKey(new Ze(n,16),new Ze(i,16))};De.publicKeyToAsn1=De.publicKeyToSubjectPublicKeyInfo=function(s){return T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(De.oids.rsaEncryption).getBytes()),T.create(T.Class.UNIVERSAL,T.Type.NULL,!1,"")]),T.create(T.Class.UNIVERSAL,T.Type.BITSTRING,!1,[De.publicKeyToRSAPublicKey(s)])])};De.publicKeyToRSAPublicKey=function(s){return T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,ws(s.n)),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,ws(s.e))])};function py(s,e,t){var r=we.util.createBuffer(),a=Math.ceil(e.n.bitLength()/8);if(s.length>a-11){var n=new Error("Message is too long for PKCS#1 v1.5 padding.");throw n.length=s.length,n.max=a-11,n}r.putByte(0),r.putByte(t);var i=a-3-s.length,o;if(t===0||t===1){o=t===0?0:255;for(var l=0;l<i;++l)r.putByte(o)}else for(;i>0;){for(var u=0,c=we.random.getBytes(i),l=0;l<i;++l)o=c.charCodeAt(l),o===0?++u:r.putByte(o);i=u}return r.putByte(0),r.putBytes(s),r}function b0(s,e,t,r){var a=Math.ceil(e.n.bitLength()/8),n=we.util.createBuffer(s),i=n.getByte(),o=n.getByte();if(i!==0||t&&o!==0&&o!==1||!t&&o!=2||t&&o===0&&typeof r>"u")throw new Error("Encryption block is invalid.");var l=0;if(o===0){l=a-3-r;for(var u=0;u<l;++u)if(n.getByte()!==0)throw new Error("Encryption block is invalid.")}else if(o===1)for(l=0;n.length()>1;){if(n.getByte()!==255){--n.read;break}++l}else if(o===2)for(l=0;n.length()>1;){if(n.getByte()===0){--n.read;break}++l}var c=n.getByte();if(c!==0||l!==a-3-n.length())throw new Error("Encryption block is invalid.");return n.getBytes()}function rC(s,e,t){typeof e=="function"&&(t=e,e={}),e=e||{};var r={algorithm:{name:e.algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(r.prng=e.prng),a();function a(){n(s.pBits,function(o,l){if(o)return t(o);if(s.p=l,s.q!==null)return i(o,s.q);n(s.qBits,i)})}function n(o,l){we.prime.generateProbablePrime(o,r,l)}function i(o,l){if(o)return t(o);if(s.q=l,s.p.compareTo(s.q)<0){var u=s.p;s.p=s.q,s.q=u}if(s.p.subtract(Ze.ONE).gcd(s.e).compareTo(Ze.ONE)!==0){s.p=null,a();return}if(s.q.subtract(Ze.ONE).gcd(s.e).compareTo(Ze.ONE)!==0){s.q=null,n(s.qBits,i);return}if(s.p1=s.p.subtract(Ze.ONE),s.q1=s.q.subtract(Ze.ONE),s.phi=s.p1.multiply(s.q1),s.phi.gcd(s.e).compareTo(Ze.ONE)!==0){s.p=s.q=null,a();return}if(s.n=s.p.multiply(s.q),s.n.bitLength()!==s.bits){s.q=null,n(s.qBits,i);return}var c=s.e.modInverse(s.phi);s.keys={privateKey:De.rsa.setPrivateKey(s.n,s.e,c,s.p,s.q,c.mod(s.p1),c.mod(s.q1),s.q.modInverse(s.p)),publicKey:De.rsa.setPublicKey(s.n,s.e)},t(null,s.keys)}}function ws(s){var e=s.toString(16);e[0]>="8"&&(e="00"+e);var t=we.util.hexToBytes(e);return t.length>1&&(t.charCodeAt(0)===0&&(t.charCodeAt(1)&128)===0||t.charCodeAt(0)===255&&(t.charCodeAt(1)&128)===128)?t.substr(1):t}function sC(s){return s<=100?27:s<=150?18:s<=200?15:s<=250?12:s<=300?9:s<=350?8:s<=400?7:s<=500?6:s<=600?5:s<=800?4:s<=1250?3:2}function Gm(s){return we.util.isNodejs&&typeof ng[s]=="function"}function jm(s){return typeof Xr.globalScope<"u"&&typeof Xr.globalScope.crypto=="object"&&typeof Xr.globalScope.crypto.subtle=="object"&&typeof Xr.globalScope.crypto.subtle[s]=="function"}function Wm(s){return typeof Xr.globalScope<"u"&&typeof Xr.globalScope.msCrypto=="object"&&typeof Xr.globalScope.msCrypto.subtle=="object"&&typeof Xr.globalScope.msCrypto.subtle[s]=="function"}function Qm(s){for(var e=we.util.hexToBytes(s.toString(16)),t=new Uint8Array(e.length),r=0;r<e.length;++r)t[r]=e.charCodeAt(r);return t}var de=Fe;if(typeof aC>"u")var aC=de.jsbn.BigInteger;var M=de.asn1,Ke=de.pki=de.pki||{};Ke.pbe=de.pbe=de.pbe||{};var Vn=Ke.oids,nC={name:"EncryptedPrivateKeyInfo",tagClass:M.Class.UNIVERSAL,type:M.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:M.Class.UNIVERSAL,type:M.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:M.Class.UNIVERSAL,type:M.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:M.Class.UNIVERSAL,type:M.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:M.Class.UNIVERSAL,type:M.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},iC={name:"PBES2Algorithms",tagClass:M.Class.UNIVERSAL,type:M.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:M.Class.UNIVERSAL,type:M.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:M.Class.UNIVERSAL,type:M.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:M.Class.UNIVERSAL,type:M.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:M.Class.UNIVERSAL,type:M.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:M.Class.UNIVERSAL,type:M.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:M.Class.UNIVERSAL,type:M.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:M.Class.UNIVERSAL,type:M.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:M.Class.UNIVERSAL,type:M.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:M.Class.UNIVERSAL,type:M.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:M.Class.UNIVERSAL,type:M.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:M.Class.UNIVERSAL,type:M.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},oC={name:"pkcs-12PbeParams",tagClass:M.Class.UNIVERSAL,type:M.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:M.Class.UNIVERSAL,type:M.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:M.Class.UNIVERSAL,type:M.Type.INTEGER,constructed:!1,capture:"iterations"}]};Ke.encryptPrivateKeyInfo=function(s,e,t){t=t||{},t.saltSize=t.saltSize||8,t.count=t.count||2048,t.algorithm=t.algorithm||"aes128",t.prfAlgorithm=t.prfAlgorithm||"sha1";var r=de.random.getBytesSync(t.saltSize),a=t.count,n=M.integerToDer(a),i,o,l;if(t.algorithm.indexOf("aes")===0||t.algorithm==="des"){var u,c,f;switch(t.algorithm){case"aes128":i=16,u=16,c=Vn["aes128-CBC"],f=de.aes.createEncryptionCipher;break;case"aes192":i=24,u=16,c=Vn["aes192-CBC"],f=de.aes.createEncryptionCipher;break;case"aes256":i=32,u=16,c=Vn["aes256-CBC"],f=de.aes.createEncryptionCipher;break;case"des":i=8,u=8,c=Vn.desCBC,f=de.des.createEncryptionCipher;break;default:var g=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw g.algorithm=t.algorithm,g}var v="hmacWith"+t.prfAlgorithm.toUpperCase(),p=vy(v),h=de.pkcs5.pbkdf2(e,r,a,i,p),d=de.random.getBytesSync(u),y=f(h);y.start(d),y.update(M.toDer(s)),y.finish(),l=y.output.getBytes();var E=lC(r,n,i,v);o=M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.OID,!1,M.oidToDer(Vn.pkcs5PBES2).getBytes()),M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.OID,!1,M.oidToDer(Vn.pkcs5PBKDF2).getBytes()),E]),M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.OID,!1,M.oidToDer(c).getBytes()),M.create(M.Class.UNIVERSAL,M.Type.OCTETSTRING,!1,d)])])])}else if(t.algorithm==="3des"){i=24;var k=new de.util.ByteBuffer(r),h=Ke.pbe.generatePkcs12Key(e,k,1,a,i),d=Ke.pbe.generatePkcs12Key(e,k,2,a,i),y=de.des.createEncryptionCipher(h);y.start(d),y.update(M.toDer(s)),y.finish(),l=y.output.getBytes(),o=M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.OID,!1,M.oidToDer(Vn["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.OCTETSTRING,!1,r),M.create(M.Class.UNIVERSAL,M.Type.INTEGER,!1,n.getBytes())])])}else{var g=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw g.algorithm=t.algorithm,g}var R=M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[o,M.create(M.Class.UNIVERSAL,M.Type.OCTETSTRING,!1,l)]);return R};Ke.decryptPrivateKeyInfo=function(s,e){var t=null,r={},a=[];if(!M.validate(s,nC,r,a)){var n=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw n.errors=a,n}var i=M.derToOid(r.encryptionOid),o=Ke.pbe.getCipher(i,r.encryptionParams,e),l=de.util.createBuffer(r.encryptedData);return o.update(l),o.finish()&&(t=M.fromDer(o.output)),t};Ke.encryptedPrivateKeyToPem=function(s,e){var t={type:"ENCRYPTED PRIVATE KEY",body:M.toDer(s).getBytes()};return de.pem.encode(t,{maxline:e})};Ke.encryptedPrivateKeyFromPem=function(s){var e=de.pem.decode(s)[0];if(e.type!=="ENCRYPTED PRIVATE KEY"){var t=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return M.fromDer(e.body)};Ke.encryptRsaPrivateKey=function(s,e,t){if(t=t||{},!t.legacy){var r=Ke.wrapRsaPrivateKey(Ke.privateKeyToAsn1(s));return r=Ke.encryptPrivateKeyInfo(r,e,t),Ke.encryptedPrivateKeyToPem(r)}var a,n,i,o;switch(t.algorithm){case"aes128":a="AES-128-CBC",i=16,n=de.random.getBytesSync(16),o=de.aes.createEncryptionCipher;break;case"aes192":a="AES-192-CBC",i=24,n=de.random.getBytesSync(16),o=de.aes.createEncryptionCipher;break;case"aes256":a="AES-256-CBC",i=32,n=de.random.getBytesSync(16),o=de.aes.createEncryptionCipher;break;case"3des":a="DES-EDE3-CBC",i=24,n=de.random.getBytesSync(8),o=de.des.createEncryptionCipher;break;case"des":a="DES-CBC",i=8,n=de.random.getBytesSync(8),o=de.des.createEncryptionCipher;break;default:var l=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+t.algorithm+'".');throw l.algorithm=t.algorithm,l}var u=de.pbe.opensslDeriveBytes(e,n.substr(0,8),i),c=o(u);c.start(n),c.update(M.toDer(Ke.privateKeyToAsn1(s))),c.finish();var f={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:a,parameters:de.util.bytesToHex(n).toUpperCase()},body:c.output.getBytes()};return de.pem.encode(f)};Ke.decryptRsaPrivateKey=function(s,e){var t=null,r=de.pem.decode(s)[0];if(r.type!=="ENCRYPTED PRIVATE KEY"&&r.type!=="PRIVATE KEY"&&r.type!=="RSA PRIVATE KEY"){var a=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw a.headerType=a,a}if(r.procType&&r.procType.type==="ENCRYPTED"){var n,i;switch(r.dekInfo.algorithm){case"DES-CBC":n=8,i=de.des.createDecryptionCipher;break;case"DES-EDE3-CBC":n=24,i=de.des.createDecryptionCipher;break;case"AES-128-CBC":n=16,i=de.aes.createDecryptionCipher;break;case"AES-192-CBC":n=24,i=de.aes.createDecryptionCipher;break;case"AES-256-CBC":n=32,i=de.aes.createDecryptionCipher;break;case"RC2-40-CBC":n=5,i=function(f){return de.rc2.createDecryptionCipher(f,40)};break;case"RC2-64-CBC":n=8,i=function(f){return de.rc2.createDecryptionCipher(f,64)};break;case"RC2-128-CBC":n=16,i=function(f){return de.rc2.createDecryptionCipher(f,128)};break;default:var a=new Error('Could not decrypt private key; unsupported encryption algorithm "'+r.dekInfo.algorithm+'".');throw a.algorithm=r.dekInfo.algorithm,a}var o=de.util.hexToBytes(r.dekInfo.parameters),l=de.pbe.opensslDeriveBytes(e,o.substr(0,8),n),u=i(l);if(u.start(o),u.update(de.util.createBuffer(r.body)),u.finish())t=u.output.getBytes();else return t}else t=r.body;return r.type==="ENCRYPTED PRIVATE KEY"?t=Ke.decryptPrivateKeyInfo(M.fromDer(t),e):t=M.fromDer(t),t!==null&&(t=Ke.privateKeyFromAsn1(t)),t};Ke.pbe.generatePkcs12Key=function(s,e,t,r,a,n){var i,o;if(typeof n>"u"||n===null){if(!("sha1"in de.md))throw new Error('"sha1" hash algorithm unavailable.');n=de.md.sha1.create()}var l=n.digestLength,u=n.blockLength,c=new de.util.ByteBuffer,f=new de.util.ByteBuffer;if(s!=null){for(o=0;o<s.length;o++)f.putInt16(s.charCodeAt(o));f.putInt16(0)}var g=f.length(),v=e.length(),p=new de.util.ByteBuffer;p.fillWithByte(t,u);var h=u*Math.ceil(v/u),d=new de.util.ByteBuffer;for(o=0;o<h;o++)d.putByte(e.at(o%v));var y=u*Math.ceil(g/u),E=new de.util.ByteBuffer;for(o=0;o<y;o++)E.putByte(f.at(o%g));var k=d;k.putBuffer(E);for(var R=Math.ceil(a/l),V=1;V<=R;V++){var L=new de.util.ByteBuffer;L.putBytes(p.bytes()),L.putBytes(k.bytes());for(var ne=0;ne<r;ne++)n.start(),n.update(L.getBytes()),L=n.digest();var ae=new de.util.ByteBuffer;for(o=0;o<u;o++)ae.putByte(L.at(o%l));var ve=Math.ceil(v/u)+Math.ceil(g/u),Te=new de.util.ByteBuffer;for(i=0;i<ve;i++){var ye=new de.util.ByteBuffer(k.getBytes(u)),Ce=511;for(o=ae.length()-1;o>=0;o--)Ce=Ce>>8,Ce+=ae.at(o)+ye.at(o),ye.setAt(o,Ce&255);Te.putBuffer(ye)}k=Te,c.putBuffer(L)}return c.truncate(c.length()-a),c};Ke.pbe.getCipher=function(s,e,t){switch(s){case Ke.oids.pkcs5PBES2:return Ke.pbe.getCipherForPBES2(s,e,t);case Ke.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case Ke.oids["pbewithSHAAnd40BitRC2-CBC"]:return Ke.pbe.getCipherForPKCS12PBE(s,e,t);default:var r=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw r.oid=s,r.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],r}};Ke.pbe.getCipherForPBES2=function(s,e,t){var r={},a=[];if(!M.validate(e,iC,r,a)){var n=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw n.errors=a,n}if(s=M.derToOid(r.kdfOid),s!==Ke.oids.pkcs5PBKDF2){var n=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw n.oid=s,n.supportedOids=["pkcs5PBKDF2"],n}if(s=M.derToOid(r.encOid),s!==Ke.oids["aes128-CBC"]&&s!==Ke.oids["aes192-CBC"]&&s!==Ke.oids["aes256-CBC"]&&s!==Ke.oids["des-EDE3-CBC"]&&s!==Ke.oids.desCBC){var n=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw n.oid=s,n.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],n}var i=r.kdfSalt,o=de.util.createBuffer(r.kdfIterationCount);o=o.getInt(o.length()<<3);var l,u;switch(Ke.oids[s]){case"aes128-CBC":l=16,u=de.aes.createDecryptionCipher;break;case"aes192-CBC":l=24,u=de.aes.createDecryptionCipher;break;case"aes256-CBC":l=32,u=de.aes.createDecryptionCipher;break;case"des-EDE3-CBC":l=24,u=de.des.createDecryptionCipher;break;case"desCBC":l=8,u=de.des.createDecryptionCipher;break}var c=yy(r.prfOid),f=de.pkcs5.pbkdf2(t,i,o,l,c),g=r.encIv,v=u(f);return v.start(g),v};Ke.pbe.getCipherForPKCS12PBE=function(s,e,t){var r={},a=[];if(!M.validate(e,oC,r,a)){var n=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw n.errors=a,n}var i=de.util.createBuffer(r.salt),o=de.util.createBuffer(r.iterations);o=o.getInt(o.length()<<3);var l,u,c;switch(s){case Ke.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:l=24,u=8,c=de.des.startDecrypting;break;case Ke.oids["pbewithSHAAnd40BitRC2-CBC"]:l=5,u=8,c=function(h,d){var y=de.rc2.createDecryptionCipher(h,40);return y.start(d,null),y};break;default:var n=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw n.oid=s,n}var f=yy(r.prfOid),g=Ke.pbe.generatePkcs12Key(t,i,1,o,l,f);f.start();var v=Ke.pbe.generatePkcs12Key(t,i,2,o,u,f);return c(g,v)};Ke.pbe.opensslDeriveBytes=function(s,e,t,r){if(typeof r>"u"||r===null){if(!("md5"in de.md))throw new Error('"md5" hash algorithm unavailable.');r=de.md.md5.create()}e===null&&(e="");for(var a=[Ym(r,s+e)],n=16,i=1;n<t;++i,n+=16)a.push(Ym(r,a[i-1]+s+e));return a.join("").substr(0,t)};function Ym(s,e){return s.start().update(e).digest().getBytes()}function yy(s){var e;if(!s)e="hmacWithSHA1";else if(e=Ke.oids[M.derToOid(s)],!e){var t=new Error("Unsupported PRF OID.");throw t.oid=s,t.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],t}return vy(e)}function vy(s){var e=de.md;switch(s){case"hmacWithSHA224":e=de.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":s=s.substr(8).toLowerCase();break;default:var t=new Error("Unsupported PRF algorithm.");throw t.algorithm=s,t.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],t}if(!e||!(s in e))throw new Error("Unknown hash algorithm: "+s);return e[s].create()}function lC(s,e,t,r){var a=M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.OCTETSTRING,!1,s),M.create(M.Class.UNIVERSAL,M.Type.INTEGER,!1,e.getBytes())]);return r!=="hmacWithSHA1"&&a.value.push(M.create(M.Class.UNIVERSAL,M.Type.INTEGER,!1,de.util.hexToBytes(t.toString(16))),M.create(M.Class.UNIVERSAL,M.Type.SEQUENCE,!0,[M.create(M.Class.UNIVERSAL,M.Type.OID,!1,M.oidToDer(Ke.oids[r]).getBytes()),M.create(M.Class.UNIVERSAL,M.Type.NULL,!1,"")])),a}var au=Fe,ce=au.asn1,yu=au.pkcs7asn1=au.pkcs7asn1||{};au.pkcs7=au.pkcs7||{};au.pkcs7.asn1=yu;var wy={name:"ContentInfo",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:ce.Class.UNIVERSAL,type:ce.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:ce.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};yu.contentInfoValidator=wy;var Sy={name:"EncryptedContentInfo",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:ce.Class.UNIVERSAL,type:ce.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:ce.Class.UNIVERSAL,type:ce.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:ce.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:ce.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};yu.envelopedDataValidator={name:"EnvelopedData",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:ce.Class.UNIVERSAL,type:ce.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(Sy)};yu.encryptedDataValidator={name:"EncryptedData",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:ce.Class.UNIVERSAL,type:ce.Type.INTEGER,constructed:!1,capture:"version"}].concat(Sy)};var uC={name:"SignerInfo",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:ce.Class.UNIVERSAL,type:ce.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:ce.Class.UNIVERSAL,type:ce.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:ce.Class.UNIVERSAL,type:ce.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:ce.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:ce.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:ce.Class.UNIVERSAL,type:ce.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:ce.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};yu.signedDataValidator={name:"SignedData",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:ce.Class.UNIVERSAL,type:ce.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},wy,{name:"SignedData.Certificates",tagClass:ce.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:ce.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SET,capture:"signerInfos",optional:!0,value:[uC]}]};yu.recipientInfoValidator={name:"RecipientInfo",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:ce.Class.UNIVERSAL,type:ce.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:ce.Class.UNIVERSAL,type:ce.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:ce.Class.UNIVERSAL,type:ce.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:ce.Class.UNIVERSAL,type:ce.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:ce.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter",optional:!0}]},{name:"RecipientInfo.encryptedKey",tagClass:ce.Class.UNIVERSAL,type:ce.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]};var ji=Fe;ji.mgf=ji.mgf||{};var cC=ji.mgf.mgf1=ji.mgf1=ji.mgf1||{};cC.create=function(s){var e={generate:function(t,r){for(var a=new ji.util.ByteBuffer,n=Math.ceil(r/s.digestLength),i=0;i<n;i++){var o=new ji.util.ByteBuffer;o.putInt32(i),s.start(),s.update(t+o.getBytes()),a.putBuffer(s.digest())}return a.truncate(a.length()-r),a.getBytes()}};return e};var k0=Fe;k0.mgf=k0.mgf||{};k0.mgf.mgf1=k0.mgf1;var Oi=Fe,fC=Oi.pss=Oi.pss||{};fC.create=function(s){arguments.length===3&&(s={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var e=s.md,t=s.mgf,r=e.digestLength,a=s.salt||null;typeof a=="string"&&(a=Oi.util.createBuffer(a));var n;if("saltLength"in s)n=s.saltLength;else if(a!==null)n=a.length();else throw new Error("Salt length not specified or specific salt not given.");if(a!==null&&a.length()!==n)throw new Error("Given salt length does not match length of given salt.");var i=s.prng||Oi.random,o={};return o.encode=function(l,u){var c,f=u-1,g=Math.ceil(f/8),v=l.digest().getBytes();if(g<r+n+2)throw new Error("Message is too long to encrypt.");var p;a===null?p=i.getBytesSync(n):p=a.bytes();var h=new Oi.util.ByteBuffer;h.fillWithByte(0,8),h.putBytes(v),h.putBytes(p),e.start(),e.update(h.getBytes());var d=e.digest().getBytes(),y=new Oi.util.ByteBuffer;y.fillWithByte(0,g-n-r-2),y.putByte(1),y.putBytes(p);var E=y.getBytes(),k=g-r-1,R=t.generate(d,k),V="";for(c=0;c<k;c++)V+=String.fromCharCode(E.charCodeAt(c)^R.charCodeAt(c));var L=65280>>8*g-f&255;return V=String.fromCharCode(V.charCodeAt(0)&~L)+V.substr(1),V+d+String.fromCharCode(188)},o.verify=function(l,u,c){var f,g=c-1,v=Math.ceil(g/8);if(u=u.substr(-v),v<r+n+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(u.charCodeAt(v-1)!==188)throw new Error("Encoded message does not end in 0xBC.");var p=v-r-1,h=u.substr(0,p),d=u.substr(p,r),y=65280>>8*v-g&255;if((h.charCodeAt(0)&y)!==0)throw new Error("Bits beyond keysize not zero as expected.");var E=t.generate(d,p),k="";for(f=0;f<p;f++)k+=String.fromCharCode(h.charCodeAt(f)^E.charCodeAt(f));k=String.fromCharCode(k.charCodeAt(0)&~y)+k.substr(1);var R=v-r-n-2;for(f=0;f<R;f++)if(k.charCodeAt(f)!==0)throw new Error("Leftmost octets not zero as expected");if(k.charCodeAt(R)!==1)throw new Error("Inconsistent PSS signature, 0x01 marker not found");var V=k.substr(-n),L=new Oi.util.ByteBuffer;L.fillWithByte(0,8),L.putBytes(l),L.putBytes(V),e.start(),e.update(L.getBytes());var ne=e.digest().getBytes();return d===ne},o};var Be=Fe,w=Be.asn1,re=Be.pki=Be.pki||{},Ye=re.oids,Tt={};Tt.CN=Ye.commonName;Tt.commonName="CN";Tt.C=Ye.countryName;Tt.countryName="C";Tt.L=Ye.localityName;Tt.localityName="L";Tt.ST=Ye.stateOrProvinceName;Tt.stateOrProvinceName="ST";Tt.O=Ye.organizationName;Tt.organizationName="O";Tt.OU=Ye.organizationalUnitName;Tt.organizationalUnitName="OU";Tt.E=Ye.emailAddress;Tt.emailAddress="E";var Cy=Be.pki.rsa.publicKeyValidator,hC={name:"Certificate",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:w.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:w.Class.UNIVERSAL,type:w.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:w.Class.UNIVERSAL,type:w.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:w.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:w.Class.UNIVERSAL,type:w.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:w.Class.UNIVERSAL,type:w.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:w.Class.UNIVERSAL,type:w.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:w.Class.UNIVERSAL,type:w.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},Cy,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:w.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:w.Class.UNIVERSAL,type:w.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:w.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:w.Class.UNIVERSAL,type:w.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:w.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:w.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:w.Class.UNIVERSAL,type:w.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},dC={name:"rsapss",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:w.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:w.Class.UNIVERSAL,type:w.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:w.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:w.Class.UNIVERSAL,type:w.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:w.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:w.Class.UNIVERSAL,type:w.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:w.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:w.Class.UNIVERSAL,type:w.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},gC={name:"CertificationRequestInfo",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:w.Class.UNIVERSAL,type:w.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},Cy,{name:"CertificationRequestInfo.attributes",tagClass:w.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:w.Class.UNIVERSAL,type:w.Type.SET,constructed:!0}]}]}]},mC={name:"CertificationRequest",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[gC,{name:"CertificationRequest.signatureAlgorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:w.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:w.Class.UNIVERSAL,type:w.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};re.RDNAttributesAsArray=function(s,e){for(var t=[],r,a,n,i=0;i<s.value.length;++i){r=s.value[i];for(var o=0;o<r.value.length;++o)n={},a=r.value[o],n.type=w.derToOid(a.value[0].value),n.value=a.value[1].value,n.valueTagClass=a.value[1].type,n.type in Ye&&(n.name=Ye[n.type],n.name in Tt&&(n.shortName=Tt[n.name])),e&&(e.update(n.type),e.update(n.value)),t.push(n)}return t};re.CRIAttributesAsArray=function(s){for(var e=[],t=0;t<s.length;++t)for(var r=s[t],a=w.derToOid(r.value[0].value),n=r.value[1].value,i=0;i<n.length;++i){var o={};if(o.type=a,o.value=n[i].value,o.valueTagClass=n[i].type,o.type in Ye&&(o.name=Ye[o.type],o.name in Tt&&(o.shortName=Tt[o.name])),o.type===Ye.extensionRequest){o.extensions=[];for(var l=0;l<o.value.length;++l)o.extensions.push(re.certificateExtensionFromAsn1(o.value[l]))}e.push(o)}return e};function In(s,e){typeof e=="string"&&(e={shortName:e});for(var t=null,r,a=0;t===null&&a<s.attributes.length;++a)r=s.attributes[a],(e.type&&e.type===r.type||e.name&&e.name===r.name||e.shortName&&e.shortName===r.shortName)&&(t=r);return t}var I0=function(s,e,t){var r={};if(s!==Ye["RSASSA-PSS"])return r;t&&(r={hash:{algorithmOid:Ye.sha1},mgf:{algorithmOid:Ye.mgf1,hash:{algorithmOid:Ye.sha1}},saltLength:20});var a={},n=[];if(!w.validate(e,dC,a,n)){var i=new Error("Cannot read RSASSA-PSS parameter block.");throw i.errors=n,i}return a.hashOid!==void 0&&(r.hash=r.hash||{},r.hash.algorithmOid=w.derToOid(a.hashOid)),a.maskGenOid!==void 0&&(r.mgf=r.mgf||{},r.mgf.algorithmOid=w.derToOid(a.maskGenOid),r.mgf.hash=r.mgf.hash||{},r.mgf.hash.algorithmOid=w.derToOid(a.maskGenHashOid)),a.saltLength!==void 0&&(r.saltLength=a.saltLength.charCodeAt(0)),r},ad=function(s){switch(Ye[s.signatureOid]){case"sha1WithRSAEncryption":case"sha1WithRSASignature":return Be.md.sha1.create();case"md5WithRSAEncryption":return Be.md.md5.create();case"sha256WithRSAEncryption":return Be.md.sha256.create();case"sha384WithRSAEncryption":return Be.md.sha384.create();case"sha512WithRSAEncryption":return Be.md.sha512.create();case"RSASSA-PSS":return Be.md.sha256.create();default:var e=new Error("Could not compute "+s.type+" digest. Unknown signature OID.");throw e.signatureOid=s.signatureOid,e}},Ay=function(s){var e=s.certificate,t;switch(e.signatureOid){case Ye.sha1WithRSAEncryption:case Ye.sha1WithRSASignature:break;case Ye["RSASSA-PSS"]:var r,a;if(r=Ye[e.signatureParameters.mgf.hash.algorithmOid],r===void 0||Be.md[r]===void 0){var n=new Error("Unsupported MGF hash function.");throw n.oid=e.signatureParameters.mgf.hash.algorithmOid,n.name=r,n}if(a=Ye[e.signatureParameters.mgf.algorithmOid],a===void 0||Be.mgf[a]===void 0){var n=new Error("Unsupported MGF function.");throw n.oid=e.signatureParameters.mgf.algorithmOid,n.name=a,n}if(a=Be.mgf[a].create(Be.md[r].create()),r=Ye[e.signatureParameters.hash.algorithmOid],r===void 0||Be.md[r]===void 0){var n=new Error("Unsupported RSASSA-PSS hash function.");throw n.oid=e.signatureParameters.hash.algorithmOid,n.name=r,n}t=Be.pss.create(Be.md[r].create(),a,e.signatureParameters.saltLength);break}return e.publicKey.verify(s.md.digest().getBytes(),s.signature,t)};re.certificateFromPem=function(s,e,t){var r=Be.pem.decode(s)[0];if(r.type!=="CERTIFICATE"&&r.type!=="X509 CERTIFICATE"&&r.type!=="TRUSTED CERTIFICATE"){var a=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw a.headerType=r.type,a}if(r.procType&&r.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var n=w.fromDer(r.body,t);return re.certificateFromAsn1(n,e)};re.certificateToPem=function(s,e){var t={type:"CERTIFICATE",body:w.toDer(re.certificateToAsn1(s)).getBytes()};return Be.pem.encode(t,{maxline:e})};re.publicKeyFromPem=function(s){var e=Be.pem.decode(s)[0];if(e.type!=="PUBLIC KEY"&&e.type!=="RSA PUBLIC KEY"){var t=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert public key from PEM; PEM is encrypted.");var r=w.fromDer(e.body);return re.publicKeyFromAsn1(r)};re.publicKeyToPem=function(s,e){var t={type:"PUBLIC KEY",body:w.toDer(re.publicKeyToAsn1(s)).getBytes()};return Be.pem.encode(t,{maxline:e})};re.publicKeyToRSAPublicKeyPem=function(s,e){var t={type:"RSA PUBLIC KEY",body:w.toDer(re.publicKeyToRSAPublicKey(s)).getBytes()};return Be.pem.encode(t,{maxline:e})};re.getPublicKeyFingerprint=function(s,e){e=e||{};var t=e.md||Be.md.sha1.create(),r=e.type||"RSAPublicKey",a;switch(r){case"RSAPublicKey":a=w.toDer(re.publicKeyToRSAPublicKey(s)).getBytes();break;case"SubjectPublicKeyInfo":a=w.toDer(re.publicKeyToAsn1(s)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+e.type+'".')}t.start(),t.update(a);var n=t.digest();if(e.encoding==="hex"){var i=n.toHex();return e.delimiter?i.match(/.{2}/g).join(e.delimiter):i}else{if(e.encoding==="binary")return n.getBytes();if(e.encoding)throw new Error('Unknown encoding "'+e.encoding+'".')}return n};re.certificationRequestFromPem=function(s,e,t){var r=Be.pem.decode(s)[0];if(r.type!=="CERTIFICATE REQUEST"){var a=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw a.headerType=r.type,a}if(r.procType&&r.procType.type==="ENCRYPTED")throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var n=w.fromDer(r.body,t);return re.certificationRequestFromAsn1(n,e)};re.certificationRequestToPem=function(s,e){var t={type:"CERTIFICATE REQUEST",body:w.toDer(re.certificationRequestToAsn1(s)).getBytes()};return Be.pem.encode(t,{maxline:e})};re.createCertificate=function(){var s={};return s.version=2,s.serialNumber="00",s.signatureOid=null,s.signature=null,s.siginfo={},s.siginfo.algorithmOid=null,s.validity={},s.validity.notBefore=new Date,s.validity.notAfter=new Date,s.issuer={},s.issuer.getField=function(e){return In(s.issuer,e)},s.issuer.addField=function(e){Zr([e]),s.issuer.attributes.push(e)},s.issuer.attributes=[],s.issuer.hash=null,s.subject={},s.subject.getField=function(e){return In(s.subject,e)},s.subject.addField=function(e){Zr([e]),s.subject.attributes.push(e)},s.subject.attributes=[],s.subject.hash=null,s.extensions=[],s.publicKey=null,s.md=null,s.setSubject=function(e,t){Zr(e),s.subject.attributes=e,delete s.subject.uniqueId,t&&(s.subject.uniqueId=t),s.subject.hash=null},s.setIssuer=function(e,t){Zr(e),s.issuer.attributes=e,delete s.issuer.uniqueId,t&&(s.issuer.uniqueId=t),s.issuer.hash=null},s.setExtensions=function(e){for(var t=0;t<e.length;++t)Ey(e[t],{cert:s});s.extensions=e},s.getExtension=function(e){typeof e=="string"&&(e={name:e});for(var t=null,r,a=0;t===null&&a<s.extensions.length;++a)r=s.extensions[a],(e.id&&r.id===e.id||e.name&&r.name===e.name)&&(t=r);return t},s.sign=function(e,t){s.md=t||Be.md.sha1.create();var r=Ye[s.md.algorithm+"WithRSAEncryption"];if(!r){var a=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw a.algorithm=s.md.algorithm,a}s.signatureOid=s.siginfo.algorithmOid=r,s.tbsCertificate=re.getTBSCertificate(s);var n=w.toDer(s.tbsCertificate);s.md.update(n.getBytes()),s.signature=e.sign(s.md)},s.verify=function(e){var t=!1;if(!s.issued(e)){var r=e.issuer,a=s.subject,n=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw n.expectedIssuer=a.attributes,n.actualIssuer=r.attributes,n}var i=e.md;if(i===null){i=ad({signatureOid:e.signatureOid,type:"certificate"});var o=e.tbsCertificate||re.getTBSCertificate(e),l=w.toDer(o);i.update(l.getBytes())}return i!==null&&(t=Ay({certificate:s,md:i,signature:e.signature})),t},s.isIssuer=function(e){var t=!1,r=s.issuer,a=e.subject;if(r.hash&&a.hash)t=r.hash===a.hash;else if(r.attributes.length===a.attributes.length){t=!0;for(var n,i,o=0;t&&o<r.attributes.length;++o)n=r.attributes[o],i=a.attributes[o],(n.type!==i.type||n.value!==i.value)&&(t=!1)}return t},s.issued=function(e){return e.isIssuer(s)},s.generateSubjectKeyIdentifier=function(){return re.getPublicKeyFingerprint(s.publicKey,{type:"RSAPublicKey"})},s.verifySubjectKeyIdentifier=function(){for(var e=Ye.subjectKeyIdentifier,t=0;t<s.extensions.length;++t){var r=s.extensions[t];if(r.id===e){var a=s.generateSubjectKeyIdentifier().getBytes();return Be.util.hexToBytes(r.subjectKeyIdentifier)===a}}return!1},s};re.certificateFromAsn1=function(s,e){var t={},r=[];if(!w.validate(s,hC,t,r)){var a=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw a.errors=r,a}var n=w.derToOid(t.publicKeyOid);if(n!==re.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var i=re.createCertificate();i.version=t.certVersion?t.certVersion.charCodeAt(0):0;var o=Be.util.createBuffer(t.certSerialNumber);i.serialNumber=o.toHex(),i.signatureOid=Be.asn1.derToOid(t.certSignatureOid),i.signatureParameters=I0(i.signatureOid,t.certSignatureParams,!0),i.siginfo.algorithmOid=Be.asn1.derToOid(t.certinfoSignatureOid),i.siginfo.parameters=I0(i.siginfo.algorithmOid,t.certinfoSignatureParams,!1),i.signature=t.certSignature;var l=[];if(t.certValidity1UTCTime!==void 0&&l.push(w.utcTimeToDate(t.certValidity1UTCTime)),t.certValidity2GeneralizedTime!==void 0&&l.push(w.generalizedTimeToDate(t.certValidity2GeneralizedTime)),t.certValidity3UTCTime!==void 0&&l.push(w.utcTimeToDate(t.certValidity3UTCTime)),t.certValidity4GeneralizedTime!==void 0&&l.push(w.generalizedTimeToDate(t.certValidity4GeneralizedTime)),l.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(l.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(i.validity.notBefore=l[0],i.validity.notAfter=l[1],i.tbsCertificate=t.tbsCertificate,e){i.md=ad({signatureOid:i.signatureOid,type:"certificate"});var u=w.toDer(i.tbsCertificate);i.md.update(u.getBytes())}var c=Be.md.sha1.create(),f=w.toDer(t.certIssuer);c.update(f.getBytes()),i.issuer.getField=function(p){return In(i.issuer,p)},i.issuer.addField=function(p){Zr([p]),i.issuer.attributes.push(p)},i.issuer.attributes=re.RDNAttributesAsArray(t.certIssuer),t.certIssuerUniqueId&&(i.issuer.uniqueId=t.certIssuerUniqueId),i.issuer.hash=c.digest().toHex();var g=Be.md.sha1.create(),v=w.toDer(t.certSubject);return g.update(v.getBytes()),i.subject.getField=function(p){return In(i.subject,p)},i.subject.addField=function(p){Zr([p]),i.subject.attributes.push(p)},i.subject.attributes=re.RDNAttributesAsArray(t.certSubject),t.certSubjectUniqueId&&(i.subject.uniqueId=t.certSubjectUniqueId),i.subject.hash=g.digest().toHex(),t.certExtensions?i.extensions=re.certificateExtensionsFromAsn1(t.certExtensions):i.extensions=[],i.publicKey=re.publicKeyFromAsn1(t.subjectPublicKeyInfo),i};re.certificateExtensionsFromAsn1=function(s){for(var e=[],t=0;t<s.value.length;++t)for(var r=s.value[t],a=0;a<r.value.length;++a)e.push(re.certificateExtensionFromAsn1(r.value[a]));return e};re.certificateExtensionFromAsn1=function(s){var e={};if(e.id=w.derToOid(s.value[0].value),e.critical=!1,s.value[1].type===w.Type.BOOLEAN?(e.critical=s.value[1].value.charCodeAt(0)!==0,e.value=s.value[2].value):e.value=s.value[1].value,e.id in Ye){if(e.name=Ye[e.id],e.name==="keyUsage"){var t=w.fromDer(e.value),r=0,a=0;t.value.length>1&&(r=t.value.charCodeAt(1),a=t.value.length>2?t.value.charCodeAt(2):0),e.digitalSignature=(r&128)===128,e.nonRepudiation=(r&64)===64,e.keyEncipherment=(r&32)===32,e.dataEncipherment=(r&16)===16,e.keyAgreement=(r&8)===8,e.keyCertSign=(r&4)===4,e.cRLSign=(r&2)===2,e.encipherOnly=(r&1)===1,e.decipherOnly=(a&128)===128}else if(e.name==="basicConstraints"){var t=w.fromDer(e.value);t.value.length>0&&t.value[0].type===w.Type.BOOLEAN?e.cA=t.value[0].value.charCodeAt(0)!==0:e.cA=!1;var n=null;t.value.length>0&&t.value[0].type===w.Type.INTEGER?n=t.value[0].value:t.value.length>1&&(n=t.value[1].value),n!==null&&(e.pathLenConstraint=w.derToInteger(n))}else if(e.name==="extKeyUsage")for(var t=w.fromDer(e.value),i=0;i<t.value.length;++i){var o=w.derToOid(t.value[i].value);o in Ye?e[Ye[o]]=!0:e[o]=!0}else if(e.name==="nsCertType"){var t=w.fromDer(e.value),r=0;t.value.length>1&&(r=t.value.charCodeAt(1)),e.client=(r&128)===128,e.server=(r&64)===64,e.email=(r&32)===32,e.objsign=(r&16)===16,e.reserved=(r&8)===8,e.sslCA=(r&4)===4,e.emailCA=(r&2)===2,e.objCA=(r&1)===1}else if(e.name==="subjectAltName"||e.name==="issuerAltName"){e.altNames=[];for(var l,t=w.fromDer(e.value),u=0;u<t.value.length;++u){l=t.value[u];var c={type:l.type,value:l.value};switch(e.altNames.push(c),l.type){case 1:case 2:case 6:break;case 7:c.ip=Be.util.bytesToIP(l.value);break;case 8:c.oid=w.derToOid(l.value);break}}}else if(e.name==="subjectKeyIdentifier"){var t=w.fromDer(e.value);e.subjectKeyIdentifier=Be.util.bytesToHex(t.value)}}return e};re.certificationRequestFromAsn1=function(s,e){var t={},r=[];if(!w.validate(s,mC,t,r)){var a=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw a.errors=r,a}var n=w.derToOid(t.publicKeyOid);if(n!==re.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var i=re.createCertificationRequest();if(i.version=t.csrVersion?t.csrVersion.charCodeAt(0):0,i.signatureOid=Be.asn1.derToOid(t.csrSignatureOid),i.signatureParameters=I0(i.signatureOid,t.csrSignatureParams,!0),i.siginfo.algorithmOid=Be.asn1.derToOid(t.csrSignatureOid),i.siginfo.parameters=I0(i.siginfo.algorithmOid,t.csrSignatureParams,!1),i.signature=t.csrSignature,i.certificationRequestInfo=t.certificationRequestInfo,e){i.md=ad({signatureOid:i.signatureOid,type:"certification request"});var o=w.toDer(i.certificationRequestInfo);i.md.update(o.getBytes())}var l=Be.md.sha1.create();return i.subject.getField=function(u){return In(i.subject,u)},i.subject.addField=function(u){Zr([u]),i.subject.attributes.push(u)},i.subject.attributes=re.RDNAttributesAsArray(t.certificationRequestInfoSubject,l),i.subject.hash=l.digest().toHex(),i.publicKey=re.publicKeyFromAsn1(t.subjectPublicKeyInfo),i.getAttribute=function(u){return In(i,u)},i.addAttribute=function(u){Zr([u]),i.attributes.push(u)},i.attributes=re.CRIAttributesAsArray(t.certificationRequestInfoAttributes||[]),i};re.createCertificationRequest=function(){var s={};return s.version=0,s.signatureOid=null,s.signature=null,s.siginfo={},s.siginfo.algorithmOid=null,s.subject={},s.subject.getField=function(e){return In(s.subject,e)},s.subject.addField=function(e){Zr([e]),s.subject.attributes.push(e)},s.subject.attributes=[],s.subject.hash=null,s.publicKey=null,s.attributes=[],s.getAttribute=function(e){return In(s,e)},s.addAttribute=function(e){Zr([e]),s.attributes.push(e)},s.md=null,s.setSubject=function(e){Zr(e),s.subject.attributes=e,s.subject.hash=null},s.setAttributes=function(e){Zr(e),s.attributes=e},s.sign=function(e,t){s.md=t||Be.md.sha1.create();var r=Ye[s.md.algorithm+"WithRSAEncryption"];if(!r){var a=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw a.algorithm=s.md.algorithm,a}s.signatureOid=s.siginfo.algorithmOid=r,s.certificationRequestInfo=re.getCertificationRequestInfo(s);var n=w.toDer(s.certificationRequestInfo);s.md.update(n.getBytes()),s.signature=e.sign(s.md)},s.verify=function(){var e=!1,t=s.md;if(t===null){t=ad({signatureOid:s.signatureOid,type:"certification request"});var r=s.certificationRequestInfo||re.getCertificationRequestInfo(s),a=w.toDer(r);t.update(a.getBytes())}return t!==null&&(e=Ay({certificate:s,md:t,signature:s.signature})),e},s};function nu(s){for(var e=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]),t,r,a=s.attributes,n=0;n<a.length;++n){t=a[n];var i=t.value,o=w.Type.PRINTABLESTRING;"valueTagClass"in t&&(o=t.valueTagClass,o===w.Type.UTF8&&(i=Be.util.encodeUtf8(i))),r=w.create(w.Class.UNIVERSAL,w.Type.SET,!0,[w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(t.type).getBytes()),w.create(w.Class.UNIVERSAL,o,!1,i)])]),e.value.push(r)}return e}function Zr(s){for(var e,t=0;t<s.length;++t){if(e=s[t],typeof e.name>"u"&&(e.type&&e.type in re.oids?e.name=re.oids[e.type]:e.shortName&&e.shortName in Tt&&(e.name=re.oids[Tt[e.shortName]])),typeof e.type>"u")if(e.name&&e.name in re.oids)e.type=re.oids[e.name];else{var r=new Error("Attribute type not specified.");throw r.attribute=e,r}if(typeof e.shortName>"u"&&e.name&&e.name in Tt&&(e.shortName=Tt[e.name]),e.type===Ye.extensionRequest&&(e.valueConstructed=!0,e.valueTagClass=w.Type.SEQUENCE,!e.value&&e.extensions)){e.value=[];for(var a=0;a<e.extensions.length;++a)e.value.push(re.certificateExtensionToAsn1(Ey(e.extensions[a])))}if(typeof e.value>"u"){var r=new Error("Attribute value not specified.");throw r.attribute=e,r}}}function Ey(s,e){if(e=e||{},typeof s.name>"u"&&s.id&&s.id in re.oids&&(s.name=re.oids[s.id]),typeof s.id>"u")if(s.name&&s.name in re.oids)s.id=re.oids[s.name];else{var t=new Error("Extension ID not specified.");throw t.extension=s,t}if(typeof s.value<"u")return s;if(s.name==="keyUsage"){var r=0,a=0,n=0;s.digitalSignature&&(a|=128,r=7),s.nonRepudiation&&(a|=64,r=6),s.keyEncipherment&&(a|=32,r=5),s.dataEncipherment&&(a|=16,r=4),s.keyAgreement&&(a|=8,r=3),s.keyCertSign&&(a|=4,r=2),s.cRLSign&&(a|=2,r=1),s.encipherOnly&&(a|=1,r=0),s.decipherOnly&&(n|=128,r=7);var i=String.fromCharCode(r);n!==0?i+=String.fromCharCode(a)+String.fromCharCode(n):a!==0&&(i+=String.fromCharCode(a)),s.value=w.create(w.Class.UNIVERSAL,w.Type.BITSTRING,!1,i)}else if(s.name==="basicConstraints")s.value=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]),s.cA&&s.value.value.push(w.create(w.Class.UNIVERSAL,w.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in s&&s.value.value.push(w.create(w.Class.UNIVERSAL,w.Type.INTEGER,!1,w.integerToDer(s.pathLenConstraint).getBytes()));else if(s.name==="extKeyUsage"){s.value=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]);var o=s.value.value;for(var l in s)s[l]===!0&&(l in Ye?o.push(w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(Ye[l]).getBytes())):l.indexOf(".")!==-1&&o.push(w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(l).getBytes())))}else if(s.name==="nsCertType"){var r=0,a=0;s.client&&(a|=128,r=7),s.server&&(a|=64,r=6),s.email&&(a|=32,r=5),s.objsign&&(a|=16,r=4),s.reserved&&(a|=8,r=3),s.sslCA&&(a|=4,r=2),s.emailCA&&(a|=2,r=1),s.objCA&&(a|=1,r=0);var i=String.fromCharCode(r);a!==0&&(i+=String.fromCharCode(a)),s.value=w.create(w.Class.UNIVERSAL,w.Type.BITSTRING,!1,i)}else if(s.name==="subjectAltName"||s.name==="issuerAltName"){s.value=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]);for(var u,c=0;c<s.altNames.length;++c){u=s.altNames[c];var i=u.value;if(u.type===7&&u.ip){if(i=Be.util.bytesFromIP(u.ip),i===null){var t=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw t.extension=s,t}}else u.type===8&&(u.oid?i=w.oidToDer(w.oidToDer(u.oid)):i=w.oidToDer(i));s.value.value.push(w.create(w.Class.CONTEXT_SPECIFIC,u.type,!1,i))}}else if(s.name==="nsComment"&&e.cert){if(!/^[\x00-\x7F]*$/.test(s.comment)||s.comment.length<1||s.comment.length>128)throw new Error('Invalid "nsComment" content.');s.value=w.create(w.Class.UNIVERSAL,w.Type.IA5STRING,!1,s.comment)}else if(s.name==="subjectKeyIdentifier"&&e.cert){var f=e.cert.generateSubjectKeyIdentifier();s.subjectKeyIdentifier=f.toHex(),s.value=w.create(w.Class.UNIVERSAL,w.Type.OCTETSTRING,!1,f.getBytes())}else if(s.name==="authorityKeyIdentifier"&&e.cert){s.value=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]);var o=s.value.value;if(s.keyIdentifier){var g=s.keyIdentifier===!0?e.cert.generateSubjectKeyIdentifier().getBytes():s.keyIdentifier;o.push(w.create(w.Class.CONTEXT_SPECIFIC,0,!1,g))}if(s.authorityCertIssuer){var v=[w.create(w.Class.CONTEXT_SPECIFIC,4,!0,[nu(s.authorityCertIssuer===!0?e.cert.issuer:s.authorityCertIssuer)])];o.push(w.create(w.Class.CONTEXT_SPECIFIC,1,!0,v))}if(s.serialNumber){var p=Be.util.hexToBytes(s.serialNumber===!0?e.cert.serialNumber:s.serialNumber);o.push(w.create(w.Class.CONTEXT_SPECIFIC,2,!1,p))}}else if(s.name==="cRLDistributionPoints"){s.value=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]);for(var o=s.value.value,h=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]),d=w.create(w.Class.CONTEXT_SPECIFIC,0,!0,[]),u,c=0;c<s.altNames.length;++c){u=s.altNames[c];var i=u.value;if(u.type===7&&u.ip){if(i=Be.util.bytesFromIP(u.ip),i===null){var t=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw t.extension=s,t}}else u.type===8&&(u.oid?i=w.oidToDer(w.oidToDer(u.oid)):i=w.oidToDer(i));d.value.push(w.create(w.Class.CONTEXT_SPECIFIC,u.type,!1,i))}h.value.push(w.create(w.Class.CONTEXT_SPECIFIC,0,!0,[d])),o.push(h)}if(typeof s.value>"u"){var t=new Error("Extension value not specified.");throw t.extension=s,t}return s}function Zg(s,e){switch(s){case Ye["RSASSA-PSS"]:var t=[];return e.hash.algorithmOid!==void 0&&t.push(w.create(w.Class.CONTEXT_SPECIFIC,0,!0,[w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(e.hash.algorithmOid).getBytes()),w.create(w.Class.UNIVERSAL,w.Type.NULL,!1,"")])])),e.mgf.algorithmOid!==void 0&&t.push(w.create(w.Class.CONTEXT_SPECIFIC,1,!0,[w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(e.mgf.algorithmOid).getBytes()),w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(e.mgf.hash.algorithmOid).getBytes()),w.create(w.Class.UNIVERSAL,w.Type.NULL,!1,"")])])])),e.saltLength!==void 0&&t.push(w.create(w.Class.CONTEXT_SPECIFIC,2,!0,[w.create(w.Class.UNIVERSAL,w.Type.INTEGER,!1,w.integerToDer(e.saltLength).getBytes())])),w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,t);default:return w.create(w.Class.UNIVERSAL,w.Type.NULL,!1,"")}}function pC(s){var e=w.create(w.Class.CONTEXT_SPECIFIC,0,!0,[]);if(s.attributes.length===0)return e;for(var t=s.attributes,r=0;r<t.length;++r){var a=t[r],n=a.value,i=w.Type.UTF8;"valueTagClass"in a&&(i=a.valueTagClass),i===w.Type.UTF8&&(n=Be.util.encodeUtf8(n));var o=!1;"valueConstructed"in a&&(o=a.valueConstructed);var l=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(a.type).getBytes()),w.create(w.Class.UNIVERSAL,w.Type.SET,!0,[w.create(w.Class.UNIVERSAL,i,o,n)])]);e.value.push(l)}return e}var yC=new Date("1950-01-01T00:00:00Z"),vC=new Date("2050-01-01T00:00:00Z");function zm(s){return s>=yC&&s<vC?w.create(w.Class.UNIVERSAL,w.Type.UTCTIME,!1,w.dateToUtcTime(s)):w.create(w.Class.UNIVERSAL,w.Type.GENERALIZEDTIME,!1,w.dateToGeneralizedTime(s))}re.getTBSCertificate=function(s){var e=zm(s.validity.notBefore),t=zm(s.validity.notAfter),r=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.CONTEXT_SPECIFIC,0,!0,[w.create(w.Class.UNIVERSAL,w.Type.INTEGER,!1,w.integerToDer(s.version).getBytes())]),w.create(w.Class.UNIVERSAL,w.Type.INTEGER,!1,Be.util.hexToBytes(s.serialNumber)),w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(s.siginfo.algorithmOid).getBytes()),Zg(s.siginfo.algorithmOid,s.siginfo.parameters)]),nu(s.issuer),w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[e,t]),nu(s.subject),re.publicKeyToAsn1(s.publicKey)]);return s.issuer.uniqueId&&r.value.push(w.create(w.Class.CONTEXT_SPECIFIC,1,!0,[w.create(w.Class.UNIVERSAL,w.Type.BITSTRING,!1,String.fromCharCode(0)+s.issuer.uniqueId)])),s.subject.uniqueId&&r.value.push(w.create(w.Class.CONTEXT_SPECIFIC,2,!0,[w.create(w.Class.UNIVERSAL,w.Type.BITSTRING,!1,String.fromCharCode(0)+s.subject.uniqueId)])),s.extensions.length>0&&r.value.push(re.certificateExtensionsToAsn1(s.extensions)),r};re.getCertificationRequestInfo=function(s){var e=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.INTEGER,!1,w.integerToDer(s.version).getBytes()),nu(s.subject),re.publicKeyToAsn1(s.publicKey),pC(s)]);return e};re.distinguishedNameToAsn1=function(s){return nu(s)};re.certificateToAsn1=function(s){var e=s.tbsCertificate||re.getTBSCertificate(s);return w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[e,w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(s.signatureOid).getBytes()),Zg(s.signatureOid,s.signatureParameters)]),w.create(w.Class.UNIVERSAL,w.Type.BITSTRING,!1,String.fromCharCode(0)+s.signature)])};re.certificateExtensionsToAsn1=function(s){var e=w.create(w.Class.CONTEXT_SPECIFIC,3,!0,[]),t=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]);e.value.push(t);for(var r=0;r<s.length;++r)t.value.push(re.certificateExtensionToAsn1(s[r]));return e};re.certificateExtensionToAsn1=function(s){var e=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]);e.value.push(w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(s.id).getBytes())),s.critical&&e.value.push(w.create(w.Class.UNIVERSAL,w.Type.BOOLEAN,!1,String.fromCharCode(255)));var t=s.value;return typeof s.value!="string"&&(t=w.toDer(t).getBytes()),e.value.push(w.create(w.Class.UNIVERSAL,w.Type.OCTETSTRING,!1,t)),e};re.certificationRequestToAsn1=function(s){var e=s.certificationRequestInfo||re.getCertificationRequestInfo(s);return w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[e,w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(s.signatureOid).getBytes()),Zg(s.signatureOid,s.signatureParameters)]),w.create(w.Class.UNIVERSAL,w.Type.BITSTRING,!1,String.fromCharCode(0)+s.signature)])};re.createCaStore=function(s){var e={certs:{}};e.getIssuer=function(i){var o=t(i.issuer);return o},e.addCertificate=function(i){if(typeof i=="string"&&(i=Be.pki.certificateFromPem(i)),r(i.subject),!e.hasCertificate(i))if(i.subject.hash in e.certs){var o=e.certs[i.subject.hash];Be.util.isArray(o)||(o=[o]),o.push(i),e.certs[i.subject.hash]=o}else e.certs[i.subject.hash]=i},e.hasCertificate=function(i){typeof i=="string"&&(i=Be.pki.certificateFromPem(i));var o=t(i.subject);if(!o)return!1;Be.util.isArray(o)||(o=[o]);for(var l=w.toDer(re.certificateToAsn1(i)).getBytes(),u=0;u<o.length;++u){var c=w.toDer(re.certificateToAsn1(o[u])).getBytes();if(l===c)return!0}return!1},e.listAllCertificates=function(){var i=[];for(var o in e.certs)if(e.certs.hasOwnProperty(o)){var l=e.certs[o];if(!Be.util.isArray(l))i.push(l);else for(var u=0;u<l.length;++u)i.push(l[u])}return i},e.removeCertificate=function(i){var o;if(typeof i=="string"&&(i=Be.pki.certificateFromPem(i)),r(i.subject),!e.hasCertificate(i))return null;var l=t(i.subject);if(!Be.util.isArray(l))return o=e.certs[i.subject.hash],delete e.certs[i.subject.hash],o;for(var u=w.toDer(re.certificateToAsn1(i)).getBytes(),c=0;c<l.length;++c){var f=w.toDer(re.certificateToAsn1(l[c])).getBytes();u===f&&(o=l[c],l.splice(c,1))}return l.length===0&&delete e.certs[i.subject.hash],o};function t(i){return r(i),e.certs[i.hash]||null}function r(i){if(!i.hash){var o=Be.md.sha1.create();i.attributes=re.RDNAttributesAsArray(nu(i),o),i.hash=o.digest().toHex()}}if(s)for(var a=0;a<s.length;++a){var n=s[a];e.addCertificate(n)}return e};re.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"};re.verifyCertificateChain=function(s,e,t){typeof t=="function"&&(t={verify:t}),t=t||{},e=e.slice(0);var r=e.slice(0),a=t.validityCheckDate;typeof a>"u"&&(a=new Date);var n=!0,i=null,o=0;do{var l=e.shift(),u=null,c=!1;if(a&&(a<l.validity.notBefore||a>l.validity.notAfter)&&(i={message:"Certificate is not valid yet or has expired.",error:re.certificateError.certificate_expired,notBefore:l.validity.notBefore,notAfter:l.validity.notAfter,now:a}),i===null){if(u=e[0]||s.getIssuer(l),u===null&&l.isIssuer(l)&&(c=!0,u=l),u){var f=u;Be.util.isArray(f)||(f=[f]);for(var g=!1;!g&&f.length>0;){u=f.shift();try{g=u.verify(l)}catch{}}g||(i={message:"Certificate signature is invalid.",error:re.certificateError.bad_certificate})}i===null&&(!u||c)&&!s.hasCertificate(l)&&(i={message:"Certificate is not trusted.",error:re.certificateError.unknown_ca})}if(i===null&&u&&!l.isIssuer(u)&&(i={message:"Certificate issuer is invalid.",error:re.certificateError.bad_certificate}),i===null)for(var v={keyUsage:!0,basicConstraints:!0},p=0;i===null&&p<l.extensions.length;++p){var h=l.extensions[p];h.critical&&!(h.name in v)&&(i={message:"Certificate has an unsupported critical extension.",error:re.certificateError.unsupported_certificate})}if(i===null&&(!n||e.length===0&&(!u||c))){var d=l.getExtension("basicConstraints"),y=l.getExtension("keyUsage");if(y!==null&&(!y.keyCertSign||d===null)&&(i={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:re.certificateError.bad_certificate}),i===null&&d!==null&&!d.cA&&(i={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:re.certificateError.bad_certificate}),i===null&&y!==null&&"pathLenConstraint"in d){var E=o-1;E>d.pathLenConstraint&&(i={message:"Certificate basicConstraints pathLenConstraint violated.",error:re.certificateError.bad_certificate})}}var k=i===null?!0:i.error,R=t.verify?t.verify(k,o,r):k;if(R===!0)i=null;else throw k===!0&&(i={message:"The application rejected the certificate.",error:re.certificateError.bad_certificate}),(R||R===0)&&(typeof R=="object"&&!Be.util.isArray(R)?(R.message&&(i.message=R.message),R.error&&(i.error=R.error)):typeof R=="string"&&(i.error=R)),i;n=!1,++o}while(e.length>0);return!0};var dt=Fe,I=dt.asn1,Je=dt.pki,Mf=dt.pkcs12=dt.pkcs12||{},by={name:"ContentInfo",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.contentType",tagClass:I.Class.UNIVERSAL,type:I.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:I.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"content"}]},wC={name:"PFX",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.version",tagClass:I.Class.UNIVERSAL,type:I.Type.INTEGER,constructed:!1,capture:"version"},by,{name:"PFX.macData",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"mac",value:[{name:"PFX.macData.mac",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm.algorithm",tagClass:I.Class.UNIVERSAL,type:I.Type.OID,constructed:!1,capture:"macAlgorithm"},{name:"PFX.macData.mac.digestAlgorithm.parameters",tagClass:I.Class.UNIVERSAL,captureAsn1:"macAlgorithmParameters"}]},{name:"PFX.macData.mac.digest",tagClass:I.Class.UNIVERSAL,type:I.Type.OCTETSTRING,constructed:!1,capture:"macDigest"}]},{name:"PFX.macData.macSalt",tagClass:I.Class.UNIVERSAL,type:I.Type.OCTETSTRING,constructed:!1,capture:"macSalt"},{name:"PFX.macData.iterations",tagClass:I.Class.UNIVERSAL,type:I.Type.INTEGER,constructed:!1,optional:!0,capture:"macIterations"}]}]},SC={name:"SafeBag",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,value:[{name:"SafeBag.bagId",tagClass:I.Class.UNIVERSAL,type:I.Type.OID,constructed:!1,capture:"bagId"},{name:"SafeBag.bagValue",tagClass:I.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"bagValue"},{name:"SafeBag.bagAttributes",tagClass:I.Class.UNIVERSAL,type:I.Type.SET,constructed:!0,optional:!0,capture:"bagAttributes"}]},CC={name:"Attribute",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:I.Class.UNIVERSAL,type:I.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:I.Class.UNIVERSAL,type:I.Type.SET,constructed:!0,capture:"values"}]},AC={name:"CertBag",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,value:[{name:"CertBag.certId",tagClass:I.Class.UNIVERSAL,type:I.Type.OID,constructed:!1,capture:"certId"},{name:"CertBag.certValue",tagClass:I.Class.CONTEXT_SPECIFIC,constructed:!0,value:[{name:"CertBag.certValue[0]",tagClass:I.Class.UNIVERSAL,type:I.Class.OCTETSTRING,constructed:!1,capture:"cert"}]}]};function Cu(s,e,t,r){for(var a=[],n=0;n<s.length;n++)for(var i=0;i<s[n].safeBags.length;i++){var o=s[n].safeBags[i];if(!(r!==void 0&&o.type!==r)){if(e===null){a.push(o);continue}o.attributes[e]!==void 0&&o.attributes[e].indexOf(t)>=0&&a.push(o)}}return a}Mf.pkcs12FromAsn1=function(s,e,t){typeof e=="string"?(t=e,e=!0):e===void 0&&(e=!0);var r={},a=[];if(!I.validate(s,wC,r,a)){var n=new Error("Cannot read PKCS#12 PFX. ASN.1 object is not an PKCS#12 PFX.");throw n.errors=n,n}var i={version:r.version.charCodeAt(0),safeContents:[],getBags:function(d){var y={},E;return"localKeyId"in d?E=d.localKeyId:"localKeyIdHex"in d&&(E=dt.util.hexToBytes(d.localKeyIdHex)),E===void 0&&!("friendlyName"in d)&&"bagType"in d&&(y[d.bagType]=Cu(i.safeContents,null,null,d.bagType)),E!==void 0&&(y.localKeyId=Cu(i.safeContents,"localKeyId",E,d.bagType)),"friendlyName"in d&&(y.friendlyName=Cu(i.safeContents,"friendlyName",d.friendlyName,d.bagType)),y},getBagsByFriendlyName:function(d,y){return Cu(i.safeContents,"friendlyName",d,y)},getBagsByLocalKeyId:function(d,y){return Cu(i.safeContents,"localKeyId",d,y)}};if(r.version.charCodeAt(0)!==3){var n=new Error("PKCS#12 PFX of version other than 3 not supported.");throw n.version=r.version.charCodeAt(0),n}if(I.derToOid(r.contentType)!==Je.oids.data){var n=new Error("Only PKCS#12 PFX in password integrity mode supported.");throw n.oid=I.derToOid(r.contentType),n}var o=r.content.value[0];if(o.tagClass!==I.Class.UNIVERSAL||o.type!==I.Type.OCTETSTRING)throw new Error("PKCS#12 authSafe content data is not an OCTET STRING.");if(o=em(o),r.mac){var l=null,u=0,c=I.derToOid(r.macAlgorithm);switch(c){case Je.oids.sha1:l=dt.md.sha1.create(),u=20;break;case Je.oids.sha256:l=dt.md.sha256.create(),u=32;break;case Je.oids.sha384:l=dt.md.sha384.create(),u=48;break;case Je.oids.sha512:l=dt.md.sha512.create(),u=64;break;case Je.oids.md5:l=dt.md.md5.create(),u=16;break}if(l===null)throw new Error("PKCS#12 uses unsupported MAC algorithm: "+c);var f=new dt.util.ByteBuffer(r.macSalt),g="macIterations"in r?parseInt(dt.util.bytesToHex(r.macIterations),16):1,v=Mf.generateKey(t,f,3,g,u,l),p=dt.hmac.create();p.start(l,v),p.update(o.value);var h=p.getMac();if(h.getBytes()!==r.macDigest)throw new Error("PKCS#12 MAC could not be verified. Invalid password?")}return EC(i,o.value,e,t),i};function em(s){if(s.composed||s.constructed){for(var e=dt.util.createBuffer(),t=0;t<s.value.length;++t)e.putBytes(s.value[t].value);s.composed=s.constructed=!1,s.value=e.getBytes()}return s}function EC(s,e,t,r){if(e=I.fromDer(e,t),e.tagClass!==I.Class.UNIVERSAL||e.type!==I.Type.SEQUENCE||e.constructed!==!0)throw new Error("PKCS#12 AuthenticatedSafe expected to be a SEQUENCE OF ContentInfo");for(var a=0;a<e.value.length;a++){var n=e.value[a],i={},o=[];if(!I.validate(n,by,i,o)){var l=new Error("Cannot read ContentInfo.");throw l.errors=o,l}var u={encrypted:!1},c=null,f=i.content.value[0];switch(I.derToOid(i.contentType)){case Je.oids.data:if(f.tagClass!==I.Class.UNIVERSAL||f.type!==I.Type.OCTETSTRING)throw new Error("PKCS#12 SafeContents Data is not an OCTET STRING.");c=em(f).value;break;case Je.oids.encryptedData:c=bC(f,r),u.encrypted=!0;break;default:var l=new Error("Unsupported PKCS#12 contentType.");throw l.contentType=I.derToOid(i.contentType),l}u.safeBags=kC(c,t,r),s.safeContents.push(u)}}function bC(s,e){var t={},r=[];if(!I.validate(s,dt.pkcs7.asn1.encryptedDataValidator,t,r)){var a=new Error("Cannot read EncryptedContentInfo.");throw a.errors=r,a}var n=I.derToOid(t.contentType);if(n!==Je.oids.data){var a=new Error("PKCS#12 EncryptedContentInfo ContentType is not Data.");throw a.oid=n,a}n=I.derToOid(t.encAlgorithm);var i=Je.pbe.getCipher(n,t.encParameter,e),o=em(t.encryptedContentAsn1),l=dt.util.createBuffer(o.value);if(i.update(l),!i.finish())throw new Error("Failed to decrypt PKCS#12 SafeContents.");return i.output.getBytes()}function kC(s,e,t){if(!e&&s.length===0)return[];if(s=I.fromDer(s,e),s.tagClass!==I.Class.UNIVERSAL||s.type!==I.Type.SEQUENCE||s.constructed!==!0)throw new Error("PKCS#12 SafeContents expected to be a SEQUENCE OF SafeBag.");for(var r=[],a=0;a<s.value.length;a++){var n=s.value[a],i={},o=[];if(!I.validate(n,SC,i,o)){var l=new Error("Cannot read SafeBag.");throw l.errors=o,l}var u={type:I.derToOid(i.bagId),attributes:IC(i.bagAttributes)};r.push(u);var c,f,g=i.bagValue.value[0];switch(u.type){case Je.oids.pkcs8ShroudedKeyBag:if(g=Je.decryptPrivateKeyInfo(g,t),g===null)throw new Error("Unable to decrypt PKCS#8 ShroudedKeyBag, wrong password?");case Je.oids.keyBag:try{u.key=Je.privateKeyFromAsn1(g)}catch{u.key=null,u.asn1=g}continue;case Je.oids.certBag:c=AC,f=function(){if(I.derToOid(i.certId)!==Je.oids.x509Certificate){var p=new Error("Unsupported certificate type, only X.509 supported.");throw p.oid=I.derToOid(i.certId),p}var h=I.fromDer(i.cert,e);try{u.cert=Je.certificateFromAsn1(h,!0)}catch{u.cert=null,u.asn1=h}};break;default:var l=new Error("Unsupported PKCS#12 SafeBag type.");throw l.oid=u.type,l}if(c!==void 0&&!I.validate(g,c,i,o)){var l=new Error("Cannot read PKCS#12 "+c.name);throw l.errors=o,l}f()}return r}function IC(s){var e={};if(s!==void 0)for(var t=0;t<s.length;++t){var r={},a=[];if(!I.validate(s[t],CC,r,a)){var n=new Error("Cannot read PKCS#12 BagAttribute.");throw n.errors=a,n}var i=I.derToOid(r.oid);if(Je.oids[i]!==void 0){e[Je.oids[i]]=[];for(var o=0;o<r.values.length;++o)e[Je.oids[i]].push(r.values[o].value)}}return e}Mf.toPkcs12Asn1=function(s,e,t,r){r=r||{},r.saltSize=r.saltSize||8,r.count=r.count||2048,r.algorithm=r.algorithm||r.encAlgorithm||"aes128","useMac"in r||(r.useMac=!0),"localKeyId"in r||(r.localKeyId=null),"generateLocalKeyId"in r||(r.generateLocalKeyId=!0);var a=r.localKeyId,n;if(a!==null)a=dt.util.hexToBytes(a);else if(r.generateLocalKeyId)if(e){var i=dt.util.isArray(e)?e[0]:e;typeof i=="string"&&(i=Je.certificateFromPem(i));var o=dt.md.sha1.create();o.update(I.toDer(Je.certificateToAsn1(i)).getBytes()),a=o.digest().getBytes()}else a=dt.random.getBytes(20);var l=[];a!==null&&l.push(I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(Je.oids.localKeyId).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.SET,!0,[I.create(I.Class.UNIVERSAL,I.Type.OCTETSTRING,!1,a)])])),"friendlyName"in r&&l.push(I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(Je.oids.friendlyName).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.SET,!0,[I.create(I.Class.UNIVERSAL,I.Type.BMPSTRING,!1,r.friendlyName)])])),l.length>0&&(n=I.create(I.Class.UNIVERSAL,I.Type.SET,!0,l));var u=[],c=[];e!==null&&(dt.util.isArray(e)?c=e:c=[e]);for(var f=[],g=0;g<c.length;++g){e=c[g],typeof e=="string"&&(e=Je.certificateFromPem(e));var v=g===0?n:void 0,p=Je.certificateToAsn1(e),h=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(Je.oids.certBag).getBytes()),I.create(I.Class.CONTEXT_SPECIFIC,0,!0,[I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(Je.oids.x509Certificate).getBytes()),I.create(I.Class.CONTEXT_SPECIFIC,0,!0,[I.create(I.Class.UNIVERSAL,I.Type.OCTETSTRING,!1,I.toDer(p).getBytes())])])]),v]);f.push(h)}if(f.length>0){var d=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,f),y=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(Je.oids.data).getBytes()),I.create(I.Class.CONTEXT_SPECIFIC,0,!0,[I.create(I.Class.UNIVERSAL,I.Type.OCTETSTRING,!1,I.toDer(d).getBytes())])]);u.push(y)}var E=null;if(s!==null){var k=Je.wrapRsaPrivateKey(Je.privateKeyToAsn1(s));t===null?E=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(Je.oids.keyBag).getBytes()),I.create(I.Class.CONTEXT_SPECIFIC,0,!0,[k]),n]):E=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(Je.oids.pkcs8ShroudedKeyBag).getBytes()),I.create(I.Class.CONTEXT_SPECIFIC,0,!0,[Je.encryptPrivateKeyInfo(k,t,r)]),n]);var R=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[E]),V=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(Je.oids.data).getBytes()),I.create(I.Class.CONTEXT_SPECIFIC,0,!0,[I.create(I.Class.UNIVERSAL,I.Type.OCTETSTRING,!1,I.toDer(R).getBytes())])]);u.push(V)}var L=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,u),ne;if(r.useMac){var o=dt.md.sha1.create(),ae=new dt.util.ByteBuffer(dt.random.getBytes(r.saltSize)),ve=r.count,s=Mf.generateKey(t,ae,3,ve,20),Te=dt.hmac.create();Te.start(o,s),Te.update(I.toDer(L).getBytes());var ye=Te.getMac();ne=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(Je.oids.sha1).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.NULL,!1,"")]),I.create(I.Class.UNIVERSAL,I.Type.OCTETSTRING,!1,ye.getBytes())]),I.create(I.Class.UNIVERSAL,I.Type.OCTETSTRING,!1,ae.getBytes()),I.create(I.Class.UNIVERSAL,I.Type.INTEGER,!1,I.integerToDer(ve).getBytes())])}return I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.INTEGER,!1,I.integerToDer(3).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(Je.oids.data).getBytes()),I.create(I.Class.CONTEXT_SPECIFIC,0,!0,[I.create(I.Class.UNIVERSAL,I.Type.OCTETSTRING,!1,I.toDer(L).getBytes())])]),ne])};Mf.generateKey=dt.pbe.generatePkcs12Key;var Bn=Fe,tm=Bn.asn1,iu=Bn.pki=Bn.pki||{};iu.pemToDer=function(s){var e=Bn.pem.decode(s)[0];if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert PEM to DER; PEM is encrypted.");return Bn.util.createBuffer(e.body)};iu.privateKeyFromPem=function(s){var e=Bn.pem.decode(s)[0];if(e.type!=="PRIVATE KEY"&&e.type!=="RSA PRIVATE KEY"){var t=new Error('Could not convert private key from PEM; PEM header type is not "PRIVATE KEY" or "RSA PRIVATE KEY".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert private key from PEM; PEM is encrypted.");var r=tm.fromDer(e.body);return iu.privateKeyFromAsn1(r)};iu.privateKeyToPem=function(s,e){var t={type:"RSA PRIVATE KEY",body:tm.toDer(iu.privateKeyToAsn1(s)).getBytes()};return Bn.pem.encode(t,{maxline:e})};iu.privateKeyInfoToPem=function(s,e){var t={type:"PRIVATE KEY",body:tm.toDer(s).getBytes()};return Bn.pem.encode(t,{maxline:e})};var Q=Fe,nd=function(s,e,t,r){var a=Q.util.createBuffer(),n=s.length>>1,i=n+(s.length&1),o=s.substr(0,i),l=s.substr(n,i),u=Q.util.createBuffer(),c=Q.hmac.create();t=e+t;var f=Math.ceil(r/16),g=Math.ceil(r/20);c.start("MD5",o);var v=Q.util.createBuffer();u.putBytes(t);for(var p=0;p<f;++p)c.start(null,null),c.update(u.getBytes()),u.putBuffer(c.digest()),c.start(null,null),c.update(u.bytes()+t),v.putBuffer(c.digest());c.start("SHA1",l);var h=Q.util.createBuffer();u.clear(),u.putBytes(t);for(var p=0;p<g;++p)c.start(null,null),c.update(u.getBytes()),u.putBuffer(c.digest()),c.start(null,null),c.update(u.bytes()+t),h.putBuffer(c.digest());return a.putBytes(Q.util.xorBytes(v.getBytes(),h.getBytes(),r)),a},BC=function(s,e,t){var r=Q.hmac.create();r.start("SHA1",s);var a=Q.util.createBuffer();return a.putInt32(e[0]),a.putInt32(e[1]),a.putByte(t.type),a.putByte(t.version.major),a.putByte(t.version.minor),a.putInt16(t.length),a.putBytes(t.fragment.bytes()),r.update(a.getBytes()),r.digest().getBytes()},xC=function(s,e,t){var r=!1;try{var a=s.deflate(e.fragment.getBytes());e.fragment=Q.util.createBuffer(a),e.length=a.length,r=!0}catch{}return r},NC=function(s,e,t){var r=!1;try{var a=s.inflate(e.fragment.getBytes());e.fragment=Q.util.createBuffer(a),e.length=a.length,r=!0}catch{}return r},_r=function(s,e){var t=0;switch(e){case 1:t=s.getByte();break;case 2:t=s.getInt16();break;case 3:t=s.getInt24();break;case 4:t=s.getInt32();break}return Q.util.createBuffer(s.getBytes(t))},qr=function(s,e,t){s.putInt(t.length(),e<<3),s.putBuffer(t)},A={};A.Versions={TLS_1_0:{major:3,minor:1},TLS_1_1:{major:3,minor:2},TLS_1_2:{major:3,minor:3}};A.SupportedVersions=[A.Versions.TLS_1_1,A.Versions.TLS_1_0];A.Version=A.SupportedVersions[0];A.MaxFragment=16384-1024;A.ConnectionEnd={server:0,client:1};A.PRFAlgorithm={tls_prf_sha256:0};A.BulkCipherAlgorithm={none:null,rc4:0,des3:1,aes:2};A.CipherType={stream:0,block:1,aead:2};A.MACAlgorithm={none:null,hmac_md5:0,hmac_sha1:1,hmac_sha256:2,hmac_sha384:3,hmac_sha512:4};A.CompressionMethod={none:0,deflate:1};A.ContentType={change_cipher_spec:20,alert:21,handshake:22,application_data:23,heartbeat:24};A.HandshakeType={hello_request:0,client_hello:1,server_hello:2,certificate:11,server_key_exchange:12,certificate_request:13,server_hello_done:14,certificate_verify:15,client_key_exchange:16,finished:20};A.Alert={};A.Alert.Level={warning:1,fatal:2};A.Alert.Description={close_notify:0,unexpected_message:10,bad_record_mac:20,decryption_failed:21,record_overflow:22,decompression_failure:30,handshake_failure:40,bad_certificate:42,unsupported_certificate:43,certificate_revoked:44,certificate_expired:45,certificate_unknown:46,illegal_parameter:47,unknown_ca:48,access_denied:49,decode_error:50,decrypt_error:51,export_restriction:60,protocol_version:70,insufficient_security:71,internal_error:80,user_canceled:90,no_renegotiation:100};A.HeartbeatMessageType={heartbeat_request:1,heartbeat_response:2};A.CipherSuites={};A.getCipherSuite=function(s){var e=null;for(var t in A.CipherSuites){var r=A.CipherSuites[t];if(r.id[0]===s.charCodeAt(0)&&r.id[1]===s.charCodeAt(1)){e=r;break}}return e};A.handleUnexpected=function(s,e){var t=!s.open&&s.entity===A.ConnectionEnd.client;t||s.error(s,{message:"Unexpected message. Received TLS record out of order.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.unexpected_message}})};A.handleHelloRequest=function(s,e,t){!s.handshaking&&s.handshakes>0&&(A.queue(s,A.createAlert(s,{level:A.Alert.Level.warning,description:A.Alert.Description.no_renegotiation})),A.flush(s)),s.process()};A.parseHelloMessage=function(s,e,t){var r=null,a=s.entity===A.ConnectionEnd.client;if(t<38)s.error(s,{message:a?"Invalid ServerHello message. Message too short.":"Invalid ClientHello message. Message too short.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.illegal_parameter}});else{var n=e.fragment,i=n.length();if(r={version:{major:n.getByte(),minor:n.getByte()},random:Q.util.createBuffer(n.getBytes(32)),session_id:_r(n,1),extensions:[]},a?(r.cipher_suite=n.getBytes(2),r.compression_method=n.getByte()):(r.cipher_suites=_r(n,2),r.compression_methods=_r(n,1)),i=t-(i-n.length()),i>0){for(var o=_r(n,2);o.length()>0;)r.extensions.push({type:[o.getByte(),o.getByte()],data:_r(o,2)});if(!a)for(var l=0;l<r.extensions.length;++l){var u=r.extensions[l];if(u.type[0]===0&&u.type[1]===0)for(var c=_r(u.data,2);c.length()>0;){var f=c.getByte();if(f!==0)break;s.session.extensions.server_name.serverNameList.push(_r(c,2).getBytes())}}}if(s.session.version&&(r.version.major!==s.session.version.major||r.version.minor!==s.session.version.minor))return s.error(s,{message:"TLS version change is disallowed during renegotiation.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.protocol_version}});if(a)s.session.cipherSuite=A.getCipherSuite(r.cipher_suite);else for(var g=Q.util.createBuffer(r.cipher_suites.bytes());g.length()>0&&(s.session.cipherSuite=A.getCipherSuite(g.getBytes(2)),s.session.cipherSuite===null););if(s.session.cipherSuite===null)return s.error(s,{message:"No cipher suites in common.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.handshake_failure},cipherSuite:Q.util.bytesToHex(r.cipher_suite)});a?s.session.compressionMethod=r.compression_method:s.session.compressionMethod=A.CompressionMethod.none}return r};A.createSecurityParameters=function(s,e){var t=s.entity===A.ConnectionEnd.client,r=e.random.bytes(),a=t?s.session.sp.client_random:r,n=t?r:A.createRandom().getBytes();s.session.sp={entity:s.entity,prf_algorithm:A.PRFAlgorithm.tls_prf_sha256,bulk_cipher_algorithm:null,cipher_type:null,enc_key_length:null,block_length:null,fixed_iv_length:null,record_iv_length:null,mac_algorithm:null,mac_length:null,mac_key_length:null,compression_algorithm:s.session.compressionMethod,pre_master_secret:null,master_secret:null,client_random:a,server_random:n}};A.handleServerHello=function(s,e,t){var r=A.parseHelloMessage(s,e,t);if(!s.fail){if(r.version.minor<=s.version.minor)s.version.minor=r.version.minor;else return s.error(s,{message:"Incompatible TLS version.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.protocol_version}});s.session.version=s.version;var a=r.session_id.bytes();a.length>0&&a===s.session.id?(s.expect=ky,s.session.resuming=!0,s.session.sp.server_random=r.random.bytes()):(s.expect=RC,s.session.resuming=!1,A.createSecurityParameters(s,r)),s.session.id=a,s.process()}};A.handleClientHello=function(s,e,t){var r=A.parseHelloMessage(s,e,t);if(!s.fail){var a=r.session_id.bytes(),n=null;if(s.sessionCache&&(n=s.sessionCache.getSession(a),n===null?a="":(n.version.major!==r.version.major||n.version.minor>r.version.minor)&&(n=null,a="")),a.length===0&&(a=Q.random.getBytes(32)),s.session.id=a,s.session.clientHelloVersion=r.version,s.session.sp={},n)s.version=s.session.version=n.version,s.session.sp=n.sp;else{for(var i,o=1;o<A.SupportedVersions.length&&(i=A.SupportedVersions[o],!(i.minor<=r.version.minor));++o);s.version={major:i.major,minor:i.minor},s.session.version=s.version}n!==null?(s.expect=rm,s.session.resuming=!0,s.session.sp.client_random=r.random.bytes()):(s.expect=s.verifyClient!==!1?PC:ig,s.session.resuming=!1,A.createSecurityParameters(s,r)),s.open=!0,A.queue(s,A.createRecord(s,{type:A.ContentType.handshake,data:A.createServerHello(s)})),s.session.resuming?(A.queue(s,A.createRecord(s,{type:A.ContentType.change_cipher_spec,data:A.createChangeCipherSpec()})),s.state.pending=A.createConnectionState(s),s.state.current.write=s.state.pending.write,A.queue(s,A.createRecord(s,{type:A.ContentType.handshake,data:A.createFinished(s)}))):(A.queue(s,A.createRecord(s,{type:A.ContentType.handshake,data:A.createCertificate(s)})),s.fail||(A.queue(s,A.createRecord(s,{type:A.ContentType.handshake,data:A.createServerKeyExchange(s)})),s.verifyClient!==!1&&A.queue(s,A.createRecord(s,{type:A.ContentType.handshake,data:A.createCertificateRequest(s)})),A.queue(s,A.createRecord(s,{type:A.ContentType.handshake,data:A.createServerHelloDone(s)})))),A.flush(s),s.process()}};A.handleCertificate=function(s,e,t){if(t<3)return s.error(s,{message:"Invalid Certificate message. Message too short.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.illegal_parameter}});var r=e.fragment,a={certificate_list:_r(r,3)},n,i,o=[];try{for(;a.certificate_list.length()>0;)n=_r(a.certificate_list,3),i=Q.asn1.fromDer(n),n=Q.pki.certificateFromAsn1(i,!0),o.push(n)}catch(u){return s.error(s,{message:"Could not parse certificate list.",cause:u,send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.bad_certificate}})}var l=s.entity===A.ConnectionEnd.client;(l||s.verifyClient===!0)&&o.length===0?s.error(s,{message:l?"No server certificate provided.":"No client certificate provided.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.illegal_parameter}}):o.length===0?s.expect=l?Xm:ig:(l?s.session.serverCertificate=o[0]:s.session.clientCertificate=o[0],A.verifyCertificateChain(s,o)&&(s.expect=l?Xm:ig)),s.process()};A.handleServerKeyExchange=function(s,e,t){if(t>0)return s.error(s,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.unsupported_certificate}});s.expect=VC,s.process()};A.handleClientKeyExchange=function(s,e,t){if(t<48)return s.error(s,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.unsupported_certificate}});var r=e.fragment,a={enc_pre_master_secret:_r(r,2).getBytes()},n=null;if(s.getPrivateKey)try{n=s.getPrivateKey(s,s.session.serverCertificate),n=Q.pki.privateKeyFromPem(n)}catch(l){s.error(s,{message:"Could not get private key.",cause:l,send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.internal_error}})}if(n===null)return s.error(s,{message:"No private key set.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.internal_error}});try{var i=s.session.sp;i.pre_master_secret=n.decrypt(a.enc_pre_master_secret);var o=s.session.clientHelloVersion;if(o.major!==i.pre_master_secret.charCodeAt(0)||o.minor!==i.pre_master_secret.charCodeAt(1))throw new Error("TLS version rollback attack detected.")}catch{i.pre_master_secret=Q.random.getBytes(48)}s.expect=rm,s.session.clientCertificate!==null&&(s.expect=UC),s.process()};A.handleCertificateRequest=function(s,e,t){if(t<3)return s.error(s,{message:"Invalid CertificateRequest. Message too short.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.illegal_parameter}});var r=e.fragment,a={certificate_types:_r(r,1),certificate_authorities:_r(r,2)};s.session.certificateRequest=a,s.expect=_C,s.process()};A.handleCertificateVerify=function(s,e,t){if(t<2)return s.error(s,{message:"Invalid CertificateVerify. Message too short.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.illegal_parameter}});var r=e.fragment;r.read-=4;var a=r.bytes();r.read+=4;var n={signature:_r(r,2).getBytes()},i=Q.util.createBuffer();i.putBuffer(s.session.md5.digest()),i.putBuffer(s.session.sha1.digest()),i=i.getBytes();try{var o=s.session.clientCertificate;if(!o.publicKey.verify(i,n.signature,"NONE"))throw new Error("CertificateVerify signature does not match.");s.session.md5.update(a),s.session.sha1.update(a)}catch{return s.error(s,{message:"Bad signature in CertificateVerify.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.handshake_failure}})}s.expect=rm,s.process()};A.handleServerHelloDone=function(s,e,t){if(t>0)return s.error(s,{message:"Invalid ServerHelloDone message. Invalid length.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.record_overflow}});if(s.serverCertificate===null){var r={message:"No server certificate provided. Not enough security.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.insufficient_security}},a=0,n=s.verify(s,r.alert.description,a,[]);if(n!==!0)return(n||n===0)&&(typeof n=="object"&&!Q.util.isArray(n)?(n.message&&(r.message=n.message),n.alert&&(r.alert.description=n.alert)):typeof n=="number"&&(r.alert.description=n)),s.error(s,r)}s.session.certificateRequest!==null&&(e=A.createRecord(s,{type:A.ContentType.handshake,data:A.createCertificate(s)}),A.queue(s,e)),e=A.createRecord(s,{type:A.ContentType.handshake,data:A.createClientKeyExchange(s)}),A.queue(s,e),s.expect=LC;var i=function(o,l){o.session.certificateRequest!==null&&o.session.clientCertificate!==null&&A.queue(o,A.createRecord(o,{type:A.ContentType.handshake,data:A.createCertificateVerify(o,l)})),A.queue(o,A.createRecord(o,{type:A.ContentType.change_cipher_spec,data:A.createChangeCipherSpec()})),o.state.pending=A.createConnectionState(o),o.state.current.write=o.state.pending.write,A.queue(o,A.createRecord(o,{type:A.ContentType.handshake,data:A.createFinished(o)})),o.expect=ky,A.flush(o),o.process()};if(s.session.certificateRequest===null||s.session.clientCertificate===null)return i(s,null);A.getClientSignature(s,i)};A.handleChangeCipherSpec=function(s,e){if(e.fragment.getByte()!==1)return s.error(s,{message:"Invalid ChangeCipherSpec message received.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.illegal_parameter}});var t=s.entity===A.ConnectionEnd.client;(s.session.resuming&&t||!s.session.resuming&&!t)&&(s.state.pending=A.createConnectionState(s)),s.state.current.read=s.state.pending.read,(!s.session.resuming&&t||s.session.resuming&&!t)&&(s.state.pending=null),s.expect=t?$C:KC,s.process()};A.handleFinished=function(s,e,t){var r=e.fragment;r.read-=4;var a=r.bytes();r.read+=4;var n=e.fragment.getBytes();r=Q.util.createBuffer(),r.putBuffer(s.session.md5.digest()),r.putBuffer(s.session.sha1.digest());var i=s.entity===A.ConnectionEnd.client,o=i?"server finished":"client finished",l=s.session.sp,u=12,c=nd;if(r=c(l.master_secret,o,r.getBytes(),u),r.getBytes()!==n)return s.error(s,{message:"Invalid verify_data in Finished message.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.decrypt_error}});s.session.md5.update(a),s.session.sha1.update(a),(s.session.resuming&&i||!s.session.resuming&&!i)&&(A.queue(s,A.createRecord(s,{type:A.ContentType.change_cipher_spec,data:A.createChangeCipherSpec()})),s.state.current.write=s.state.pending.write,s.state.pending=null,A.queue(s,A.createRecord(s,{type:A.ContentType.handshake,data:A.createFinished(s)}))),s.expect=i?DC:MC,s.handshaking=!1,++s.handshakes,s.peerCertificate=i?s.session.serverCertificate:s.session.clientCertificate,A.flush(s),s.isConnected=!0,s.connected(s),s.process()};A.handleAlert=function(s,e){var t=e.fragment,r={level:t.getByte(),description:t.getByte()},a;switch(r.description){case A.Alert.Description.close_notify:a="Connection closed.";break;case A.Alert.Description.unexpected_message:a="Unexpected message.";break;case A.Alert.Description.bad_record_mac:a="Bad record MAC.";break;case A.Alert.Description.decryption_failed:a="Decryption failed.";break;case A.Alert.Description.record_overflow:a="Record overflow.";break;case A.Alert.Description.decompression_failure:a="Decompression failed.";break;case A.Alert.Description.handshake_failure:a="Handshake failure.";break;case A.Alert.Description.bad_certificate:a="Bad certificate.";break;case A.Alert.Description.unsupported_certificate:a="Unsupported certificate.";break;case A.Alert.Description.certificate_revoked:a="Certificate revoked.";break;case A.Alert.Description.certificate_expired:a="Certificate expired.";break;case A.Alert.Description.certificate_unknown:a="Certificate unknown.";break;case A.Alert.Description.illegal_parameter:a="Illegal parameter.";break;case A.Alert.Description.unknown_ca:a="Unknown certificate authority.";break;case A.Alert.Description.access_denied:a="Access denied.";break;case A.Alert.Description.decode_error:a="Decode error.";break;case A.Alert.Description.decrypt_error:a="Decrypt error.";break;case A.Alert.Description.export_restriction:a="Export restriction.";break;case A.Alert.Description.protocol_version:a="Unsupported protocol version.";break;case A.Alert.Description.insufficient_security:a="Insufficient security.";break;case A.Alert.Description.internal_error:a="Internal error.";break;case A.Alert.Description.user_canceled:a="User canceled.";break;case A.Alert.Description.no_renegotiation:a="Renegotiation not supported.";break;default:a="Unknown error.";break}if(r.description===A.Alert.Description.close_notify)return s.close();s.error(s,{message:a,send:!1,origin:s.entity===A.ConnectionEnd.client?"server":"client",alert:r}),s.process()};A.handleHandshake=function(s,e){var t=e.fragment,r=t.getByte(),a=t.getInt24();if(a>t.length())return s.fragmented=e,e.fragment=Q.util.createBuffer(),t.read-=4,s.process();s.fragmented=null,t.read-=4;var n=t.bytes(a+4);t.read+=4,r in B0[s.entity][s.expect]?(s.entity===A.ConnectionEnd.server&&!s.open&&!s.fail&&(s.handshaking=!0,s.session={version:null,extensions:{server_name:{serverNameList:[]}},cipherSuite:null,compressionMethod:null,serverCertificate:null,clientCertificate:null,md5:Q.md.md5.create(),sha1:Q.md.sha1.create()}),r!==A.HandshakeType.hello_request&&r!==A.HandshakeType.certificate_verify&&r!==A.HandshakeType.finished&&(s.session.md5.update(n),s.session.sha1.update(n)),B0[s.entity][s.expect][r](s,e,a)):A.handleUnexpected(s,e)};A.handleApplicationData=function(s,e){s.data.putBuffer(e.fragment),s.dataReady(s),s.process()};A.handleHeartbeat=function(s,e){var t=e.fragment,r=t.getByte(),a=t.getInt16(),n=t.getBytes(a);if(r===A.HeartbeatMessageType.heartbeat_request){if(s.handshaking||a>n.length)return s.process();A.queue(s,A.createRecord(s,{type:A.ContentType.heartbeat,data:A.createHeartbeat(A.HeartbeatMessageType.heartbeat_response,n)})),A.flush(s)}else if(r===A.HeartbeatMessageType.heartbeat_response){if(n!==s.expectedHeartbeatPayload)return s.process();s.heartbeatReceived&&s.heartbeatReceived(s,Q.util.createBuffer(n))}s.process()};var TC=0,RC=1,Xm=2,VC=3,_C=4,ky=5,$C=6,DC=7,LC=8,OC=0,PC=1,ig=2,UC=3,rm=4,KC=5,MC=6,C=A.handleUnexpected,Iy=A.handleChangeCipherSpec,rr=A.handleAlert,mr=A.handleHandshake,By=A.handleApplicationData,sr=A.handleHeartbeat,sm=[];sm[A.ConnectionEnd.client]=[[C,rr,mr,C,sr],[C,rr,mr,C,sr],[C,rr,mr,C,sr],[C,rr,mr,C,sr],[C,rr,mr,C,sr],[Iy,rr,C,C,sr],[C,rr,mr,C,sr],[C,rr,mr,By,sr],[C,rr,mr,C,sr]];sm[A.ConnectionEnd.server]=[[C,rr,mr,C,sr],[C,rr,mr,C,sr],[C,rr,mr,C,sr],[C,rr,mr,C,sr],[Iy,rr,C,C,sr],[C,rr,mr,C,sr],[C,rr,mr,By,sr],[C,rr,mr,C,sr]];var ya=A.handleHelloRequest,HC=A.handleServerHello,xy=A.handleCertificate,Zm=A.handleServerKeyExchange,md=A.handleCertificateRequest,fh=A.handleServerHelloDone,Ny=A.handleFinished,B0=[];B0[A.ConnectionEnd.client]=[[C,C,HC,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[ya,C,C,C,C,C,C,C,C,C,C,xy,Zm,md,fh,C,C,C,C,C,C],[ya,C,C,C,C,C,C,C,C,C,C,C,Zm,md,fh,C,C,C,C,C,C],[ya,C,C,C,C,C,C,C,C,C,C,C,C,md,fh,C,C,C,C,C,C],[ya,C,C,C,C,C,C,C,C,C,C,C,C,C,fh,C,C,C,C,C,C],[ya,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[ya,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,Ny],[ya,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[ya,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C]];var FC=A.handleClientHello,qC=A.handleClientKeyExchange,JC=A.handleCertificateVerify;B0[A.ConnectionEnd.server]=[[C,FC,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,xy,C,C,C,C,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,qC,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,JC,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,Ny],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C]];A.generateKeys=function(s,e){var t=nd,r=e.client_random+e.server_random;s.session.resuming||(e.master_secret=t(e.pre_master_secret,"master secret",r,48).bytes(),e.pre_master_secret=null),r=e.server_random+e.client_random;var a=2*e.mac_key_length+2*e.enc_key_length,n=s.version.major===A.Versions.TLS_1_0.major&&s.version.minor===A.Versions.TLS_1_0.minor;n&&(a+=2*e.fixed_iv_length);var i=t(e.master_secret,"key expansion",r,a),o={client_write_MAC_key:i.getBytes(e.mac_key_length),server_write_MAC_key:i.getBytes(e.mac_key_length),client_write_key:i.getBytes(e.enc_key_length),server_write_key:i.getBytes(e.enc_key_length)};return n&&(o.client_write_IV=i.getBytes(e.fixed_iv_length),o.server_write_IV=i.getBytes(e.fixed_iv_length)),o};A.createConnectionState=function(s){var e=s.entity===A.ConnectionEnd.client,t=function(){var n={sequenceNumber:[0,0],macKey:null,macLength:0,macFunction:null,cipherState:null,cipherFunction:function(i){return!0},compressionState:null,compressFunction:function(i){return!0},updateSequenceNumber:function(){n.sequenceNumber[1]===4294967295?(n.sequenceNumber[1]=0,++n.sequenceNumber[0]):++n.sequenceNumber[1]}};return n},r={read:t(),write:t()};if(r.read.update=function(n,i){return r.read.cipherFunction(i,r.read)?r.read.compressFunction(n,i,r.read)||n.error(n,{message:"Could not decompress record.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.decompression_failure}}):n.error(n,{message:"Could not decrypt record or bad MAC.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.bad_record_mac}}),!n.fail},r.write.update=function(n,i){return r.write.compressFunction(n,i,r.write)?r.write.cipherFunction(i,r.write)||n.error(n,{message:"Could not encrypt record.",send:!1,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.internal_error}}):n.error(n,{message:"Could not compress record.",send:!1,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.internal_error}}),!n.fail},s.session){var a=s.session.sp;switch(s.session.cipherSuite.initSecurityParameters(a),a.keys=A.generateKeys(s,a),r.read.macKey=e?a.keys.server_write_MAC_key:a.keys.client_write_MAC_key,r.write.macKey=e?a.keys.client_write_MAC_key:a.keys.server_write_MAC_key,s.session.cipherSuite.initConnectionState(r,s,a),a.compression_algorithm){case A.CompressionMethod.none:break;case A.CompressionMethod.deflate:r.read.compressFunction=NC,r.write.compressFunction=xC;break;default:throw new Error("Unsupported compression algorithm.")}}return r};A.createRandom=function(){var s=new Date,e=+s+s.getTimezoneOffset()*6e4,t=Q.util.createBuffer();return t.putInt32(e),t.putBytes(Q.random.getBytes(28)),t};A.createRecord=function(s,e){if(!e.data)return null;var t={type:e.type,version:{major:s.version.major,minor:s.version.minor},length:e.data.length(),fragment:e.data};return t};A.createAlert=function(s,e){var t=Q.util.createBuffer();return t.putByte(e.level),t.putByte(e.description),A.createRecord(s,{type:A.ContentType.alert,data:t})};A.createClientHello=function(s){s.session.clientHelloVersion={major:s.version.major,minor:s.version.minor};for(var e=Q.util.createBuffer(),t=0;t<s.cipherSuites.length;++t){var r=s.cipherSuites[t];e.putByte(r.id[0]),e.putByte(r.id[1])}var a=e.length(),n=Q.util.createBuffer();n.putByte(A.CompressionMethod.none);var i=n.length(),o=Q.util.createBuffer();if(s.virtualHost){var l=Q.util.createBuffer();l.putByte(0),l.putByte(0);var u=Q.util.createBuffer();u.putByte(0),qr(u,2,Q.util.createBuffer(s.virtualHost));var c=Q.util.createBuffer();qr(c,2,u),qr(l,2,c),o.putBuffer(l)}var f=o.length();f>0&&(f+=2);var g=s.session.id,v=g.length+1+2+4+28+2+a+1+i+f,p=Q.util.createBuffer();return p.putByte(A.HandshakeType.client_hello),p.putInt24(v),p.putByte(s.version.major),p.putByte(s.version.minor),p.putBytes(s.session.sp.client_random),qr(p,1,Q.util.createBuffer(g)),qr(p,2,e),qr(p,1,n),f>0&&qr(p,2,o),p};A.createServerHello=function(s){var e=s.session.id,t=e.length+1+2+4+28+2+1,r=Q.util.createBuffer();return r.putByte(A.HandshakeType.server_hello),r.putInt24(t),r.putByte(s.version.major),r.putByte(s.version.minor),r.putBytes(s.session.sp.server_random),qr(r,1,Q.util.createBuffer(e)),r.putByte(s.session.cipherSuite.id[0]),r.putByte(s.session.cipherSuite.id[1]),r.putByte(s.session.compressionMethod),r};A.createCertificate=function(s){var e=s.entity===A.ConnectionEnd.client,t=null;if(s.getCertificate){var r;e?r=s.session.certificateRequest:r=s.session.extensions.server_name.serverNameList,t=s.getCertificate(s,r)}var a=Q.util.createBuffer();if(t!==null)try{Q.util.isArray(t)||(t=[t]);for(var n=null,i=0;i<t.length;++i){var o=Q.pem.decode(t[i])[0];if(o.type!=="CERTIFICATE"&&o.type!=="X509 CERTIFICATE"&&o.type!=="TRUSTED CERTIFICATE"){var l=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw l.headerType=o.type,l}if(o.procType&&o.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var u=Q.util.createBuffer(o.body);n===null&&(n=Q.asn1.fromDer(u.bytes(),!1));var c=Q.util.createBuffer();qr(c,3,u),a.putBuffer(c)}t=Q.pki.certificateFromAsn1(n),e?s.session.clientCertificate=t:s.session.serverCertificate=t}catch(v){return s.error(s,{message:"Could not send certificate list.",cause:v,send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.bad_certificate}})}var f=3+a.length(),g=Q.util.createBuffer();return g.putByte(A.HandshakeType.certificate),g.putInt24(f),qr(g,3,a),g};A.createClientKeyExchange=function(s){var e=Q.util.createBuffer();e.putByte(s.session.clientHelloVersion.major),e.putByte(s.session.clientHelloVersion.minor),e.putBytes(Q.random.getBytes(46));var t=s.session.sp;t.pre_master_secret=e.getBytes();var r=s.session.serverCertificate.publicKey;e=r.encrypt(t.pre_master_secret);var a=e.length+2,n=Q.util.createBuffer();return n.putByte(A.HandshakeType.client_key_exchange),n.putInt24(a),n.putInt16(e.length),n.putBytes(e),n};A.createServerKeyExchange=function(s){var e=Q.util.createBuffer();return e};A.getClientSignature=function(s,e){var t=Q.util.createBuffer();t.putBuffer(s.session.md5.digest()),t.putBuffer(s.session.sha1.digest()),t=t.getBytes(),s.getSignature=s.getSignature||function(r,a,n){var i=null;if(r.getPrivateKey)try{i=r.getPrivateKey(r,r.session.clientCertificate),i=Q.pki.privateKeyFromPem(i)}catch(o){r.error(r,{message:"Could not get private key.",cause:o,send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.internal_error}})}i===null?r.error(r,{message:"No private key set.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.internal_error}}):a=i.sign(a,null),n(r,a)},s.getSignature(s,t,e)};A.createCertificateVerify=function(s,e){var t=e.length+2,r=Q.util.createBuffer();return r.putByte(A.HandshakeType.certificate_verify),r.putInt24(t),r.putInt16(e.length),r.putBytes(e),r};A.createCertificateRequest=function(s){var e=Q.util.createBuffer();e.putByte(1);var t=Q.util.createBuffer();for(var r in s.caStore.certs){var a=s.caStore.certs[r],n=Q.pki.distinguishedNameToAsn1(a.subject),i=Q.asn1.toDer(n);t.putInt16(i.length()),t.putBuffer(i)}var o=1+e.length()+2+t.length(),l=Q.util.createBuffer();return l.putByte(A.HandshakeType.certificate_request),l.putInt24(o),qr(l,1,e),qr(l,2,t),l};A.createServerHelloDone=function(s){var e=Q.util.createBuffer();return e.putByte(A.HandshakeType.server_hello_done),e.putInt24(0),e};A.createChangeCipherSpec=function(){var s=Q.util.createBuffer();return s.putByte(1),s};A.createFinished=function(s){var e=Q.util.createBuffer();e.putBuffer(s.session.md5.digest()),e.putBuffer(s.session.sha1.digest());var t=s.entity===A.ConnectionEnd.client,r=s.session.sp,a=12,n=nd,i=t?"client finished":"server finished";e=n(r.master_secret,i,e.getBytes(),a);var o=Q.util.createBuffer();return o.putByte(A.HandshakeType.finished),o.putInt24(e.length()),o.putBuffer(e),o};A.createHeartbeat=function(s,e,t){typeof t>"u"&&(t=e.length);var r=Q.util.createBuffer();r.putByte(s),r.putInt16(t),r.putBytes(e);var a=r.length(),n=Math.max(16,a-t-3);return r.putBytes(Q.random.getBytes(n)),r};A.queue=function(s,e){if(!!e&&!(e.fragment.length()===0&&(e.type===A.ContentType.handshake||e.type===A.ContentType.alert||e.type===A.ContentType.change_cipher_spec))){if(e.type===A.ContentType.handshake){var t=e.fragment.bytes();s.session.md5.update(t),s.session.sha1.update(t),t=null}var r;if(e.fragment.length()<=A.MaxFragment)r=[e];else{r=[];for(var a=e.fragment.bytes();a.length>A.MaxFragment;)r.push(A.createRecord(s,{type:e.type,data:Q.util.createBuffer(a.slice(0,A.MaxFragment))})),a=a.slice(A.MaxFragment);a.length>0&&r.push(A.createRecord(s,{type:e.type,data:Q.util.createBuffer(a)}))}for(var n=0;n<r.length&&!s.fail;++n){var i=r[n],o=s.state.current.write;o.update(s,i)&&s.records.push(i)}}};A.flush=function(s){for(var e=0;e<s.records.length;++e){var t=s.records[e];s.tlsData.putByte(t.type),s.tlsData.putByte(t.version.major),s.tlsData.putByte(t.version.minor),s.tlsData.putInt16(t.fragment.length()),s.tlsData.putBuffer(s.records[e].fragment)}return s.records=[],s.tlsDataReady(s)};var pd=function(s){switch(s){case!0:return!0;case Q.pki.certificateError.bad_certificate:return A.Alert.Description.bad_certificate;case Q.pki.certificateError.unsupported_certificate:return A.Alert.Description.unsupported_certificate;case Q.pki.certificateError.certificate_revoked:return A.Alert.Description.certificate_revoked;case Q.pki.certificateError.certificate_expired:return A.Alert.Description.certificate_expired;case Q.pki.certificateError.certificate_unknown:return A.Alert.Description.certificate_unknown;case Q.pki.certificateError.unknown_ca:return A.Alert.Description.unknown_ca;default:return A.Alert.Description.bad_certificate}},GC=function(s){switch(s){case!0:return!0;case A.Alert.Description.bad_certificate:return Q.pki.certificateError.bad_certificate;case A.Alert.Description.unsupported_certificate:return Q.pki.certificateError.unsupported_certificate;case A.Alert.Description.certificate_revoked:return Q.pki.certificateError.certificate_revoked;case A.Alert.Description.certificate_expired:return Q.pki.certificateError.certificate_expired;case A.Alert.Description.certificate_unknown:return Q.pki.certificateError.certificate_unknown;case A.Alert.Description.unknown_ca:return Q.pki.certificateError.unknown_ca;default:return Q.pki.certificateError.bad_certificate}};A.verifyCertificateChain=function(s,e){try{var t={};for(var r in s.verifyOptions)t[r]=s.verifyOptions[r];t.verify=function(n,i,o){var l=pd(n),u=s.verify(s,n,i,o);if(u!==!0){if(typeof u=="object"&&!Q.util.isArray(u)){var c=new Error("The application rejected the certificate.");throw c.send=!0,c.alert={level:A.Alert.Level.fatal,description:A.Alert.Description.bad_certificate},u.message&&(c.message=u.message),u.alert&&(c.alert.description=u.alert),c}u!==n&&(u=GC(u))}return u},Q.pki.verifyCertificateChain(s.caStore,e,t)}catch(n){var a=n;(typeof a!="object"||Q.util.isArray(a))&&(a={send:!0,alert:{level:A.Alert.Level.fatal,description:pd(n)}}),"send"in a||(a.send=!0),"alert"in a||(a.alert={level:A.Alert.Level.fatal,description:pd(a.error)}),s.error(s,a)}return!s.fail};A.createSessionCache=function(s,e){var t=null;if(s&&s.getSession&&s.setSession&&s.order)t=s;else{t={},t.cache=s||{},t.capacity=Math.max(e||100,1),t.order=[];for(var r in s)t.order.length<=e?t.order.push(r):delete s[r];t.getSession=function(a){var n=null,i=null;if(a?i=Q.util.bytesToHex(a):t.order.length>0&&(i=t.order[0]),i!==null&&i in t.cache){n=t.cache[i],delete t.cache[i];for(var o in t.order)if(t.order[o]===i){t.order.splice(o,1);break}}return n},t.setSession=function(a,n){if(t.order.length===t.capacity){var i=t.order.shift();delete t.cache[i]}var i=Q.util.bytesToHex(a);t.order.push(i),t.cache[i]=n}}return t};A.createConnection=function(s){var e=null;s.caStore?Q.util.isArray(s.caStore)?e=Q.pki.createCaStore(s.caStore):e=s.caStore:e=Q.pki.createCaStore();var t=s.cipherSuites||null;if(t===null){t=[];for(var r in A.CipherSuites)t.push(A.CipherSuites[r])}var a=s.server?A.ConnectionEnd.server:A.ConnectionEnd.client,n=s.sessionCache?A.createSessionCache(s.sessionCache):null,i={version:{major:A.Version.major,minor:A.Version.minor},entity:a,sessionId:s.sessionId,caStore:e,sessionCache:n,cipherSuites:t,connected:s.connected,virtualHost:s.virtualHost||null,verifyClient:s.verifyClient||!1,verify:s.verify||function(c,f,g,v){return f},verifyOptions:s.verifyOptions||{},getCertificate:s.getCertificate||null,getPrivateKey:s.getPrivateKey||null,getSignature:s.getSignature||null,input:Q.util.createBuffer(),tlsData:Q.util.createBuffer(),data:Q.util.createBuffer(),tlsDataReady:s.tlsDataReady,dataReady:s.dataReady,heartbeatReceived:s.heartbeatReceived,closed:s.closed,error:function(c,f){f.origin=f.origin||(c.entity===A.ConnectionEnd.client?"client":"server"),f.send&&(A.queue(c,A.createAlert(c,f.alert)),A.flush(c));var g=f.fatal!==!1;g&&(c.fail=!0),s.error(c,f),g&&c.close(!1)},deflate:s.deflate||null,inflate:s.inflate||null};i.reset=function(c){i.version={major:A.Version.major,minor:A.Version.minor},i.record=null,i.session=null,i.peerCertificate=null,i.state={pending:null,current:null},i.expect=i.entity===A.ConnectionEnd.client?TC:OC,i.fragmented=null,i.records=[],i.open=!1,i.handshakes=0,i.handshaking=!1,i.isConnected=!1,i.fail=!(c||typeof c>"u"),i.input.clear(),i.tlsData.clear(),i.data.clear(),i.state.current=A.createConnectionState(i)},i.reset();var o=function(c,f){var g=f.type-A.ContentType.change_cipher_spec,v=sm[c.entity][c.expect];g in v?v[g](c,f):A.handleUnexpected(c,f)},l=function(c){var f=0,g=c.input,v=g.length();if(v<5)f=5-v;else{c.record={type:g.getByte(),version:{major:g.getByte(),minor:g.getByte()},length:g.getInt16(),fragment:Q.util.createBuffer(),ready:!1};var p=c.record.version.major===c.version.major;p&&c.session&&c.session.version&&(p=c.record.version.minor===c.version.minor),p||c.error(c,{message:"Incompatible TLS version.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.protocol_version}})}return f},u=function(c){var f=0,g=c.input,v=g.length();if(v<c.record.length)f=c.record.length-v;else{c.record.fragment.putBytes(g.getBytes(c.record.length)),g.compact();var p=c.state.current.read;p.update(c,c.record)&&(c.fragmented!==null&&(c.fragmented.type===c.record.type?(c.fragmented.fragment.putBuffer(c.record.fragment),c.record=c.fragmented):c.error(c,{message:"Invalid fragmented record.",send:!0,alert:{level:A.Alert.Level.fatal,description:A.Alert.Description.unexpected_message}})),c.record.ready=!0)}return f};return i.handshake=function(c){if(i.entity!==A.ConnectionEnd.client)i.error(i,{message:"Cannot initiate handshake as a server.",fatal:!1});else if(i.handshaking)i.error(i,{message:"Handshake already in progress.",fatal:!1});else{i.fail&&!i.open&&i.handshakes===0&&(i.fail=!1),i.handshaking=!0,c=c||"";var f=null;c.length>0&&(i.sessionCache&&(f=i.sessionCache.getSession(c)),f===null&&(c="")),c.length===0&&i.sessionCache&&(f=i.sessionCache.getSession(),f!==null&&(c=f.id)),i.session={id:c,version:null,cipherSuite:null,compressionMethod:null,serverCertificate:null,certificateRequest:null,clientCertificate:null,sp:{},md5:Q.md.md5.create(),sha1:Q.md.sha1.create()},f&&(i.version=f.version,i.session.sp=f.sp),i.session.sp.client_random=A.createRandom().getBytes(),i.open=!0,A.queue(i,A.createRecord(i,{type:A.ContentType.handshake,data:A.createClientHello(i)})),A.flush(i)}},i.process=function(c){var f=0;return c&&i.input.putBytes(c),i.fail||(i.record!==null&&i.record.ready&&i.record.fragment.isEmpty()&&(i.record=null),i.record===null&&(f=l(i)),!i.fail&&i.record!==null&&!i.record.ready&&(f=u(i)),!i.fail&&i.record!==null&&i.record.ready&&o(i,i.record)),f},i.prepare=function(c){return A.queue(i,A.createRecord(i,{type:A.ContentType.application_data,data:Q.util.createBuffer(c)})),A.flush(i)},i.prepareHeartbeatRequest=function(c,f){return c instanceof Q.util.ByteBuffer&&(c=c.bytes()),typeof f>"u"&&(f=c.length),i.expectedHeartbeatPayload=c,A.queue(i,A.createRecord(i,{type:A.ContentType.heartbeat,data:A.createHeartbeat(A.HeartbeatMessageType.heartbeat_request,c,f)})),A.flush(i)},i.close=function(c){if(!i.fail&&i.sessionCache&&i.session){var f={id:i.session.id,version:i.session.version,sp:i.session.sp};f.sp.keys=null,i.sessionCache.setSession(f.id,f)}i.open&&(i.open=!1,i.input.clear(),(i.isConnected||i.handshaking)&&(i.isConnected=i.handshaking=!1,A.queue(i,A.createAlert(i,{level:A.Alert.Level.warning,description:A.Alert.Description.close_notify})),A.flush(i)),i.closed(i)),i.reset(c)},i};Q.tls=Q.tls||{};for(var yd in A)typeof A[yd]!="function"&&(Q.tls[yd]=A[yd]);Q.tls.prf_tls1=nd;Q.tls.hmac_sha1=BC;Q.tls.createSessionCache=A.createSessionCache;Q.tls.createConnection=A.createConnection;var Sn=Fe,es=Sn.tls;es.CipherSuites.TLS_RSA_WITH_AES_128_CBC_SHA={id:[0,47],name:"TLS_RSA_WITH_AES_128_CBC_SHA",initSecurityParameters:function(s){s.bulk_cipher_algorithm=es.BulkCipherAlgorithm.aes,s.cipher_type=es.CipherType.block,s.enc_key_length=16,s.block_length=16,s.fixed_iv_length=16,s.record_iv_length=16,s.mac_algorithm=es.MACAlgorithm.hmac_sha1,s.mac_length=20,s.mac_key_length=20},initConnectionState:Ty};es.CipherSuites.TLS_RSA_WITH_AES_256_CBC_SHA={id:[0,53],name:"TLS_RSA_WITH_AES_256_CBC_SHA",initSecurityParameters:function(s){s.bulk_cipher_algorithm=es.BulkCipherAlgorithm.aes,s.cipher_type=es.CipherType.block,s.enc_key_length=32,s.block_length=16,s.fixed_iv_length=16,s.record_iv_length=16,s.mac_algorithm=es.MACAlgorithm.hmac_sha1,s.mac_length=20,s.mac_key_length=20},initConnectionState:Ty};function Ty(s,e,t){var r=e.entity===Sn.tls.ConnectionEnd.client;s.read.cipherState={init:!1,cipher:Sn.cipher.createDecipher("AES-CBC",r?t.keys.server_write_key:t.keys.client_write_key),iv:r?t.keys.server_write_IV:t.keys.client_write_IV},s.write.cipherState={init:!1,cipher:Sn.cipher.createCipher("AES-CBC",r?t.keys.client_write_key:t.keys.server_write_key),iv:r?t.keys.client_write_IV:t.keys.server_write_IV},s.read.cipherFunction=YC,s.write.cipherFunction=jC,s.read.macLength=s.write.macLength=t.mac_length,s.read.macFunction=s.write.macFunction=es.hmac_sha1}function jC(s,e){var t=!1,r=e.macFunction(e.macKey,e.sequenceNumber,s);s.fragment.putBytes(r),e.updateSequenceNumber();var a;s.version.minor===es.Versions.TLS_1_0.minor?a=e.cipherState.init?null:e.cipherState.iv:a=Sn.random.getBytesSync(16),e.cipherState.init=!0;var n=e.cipherState.cipher;return n.start({iv:a}),s.version.minor>=es.Versions.TLS_1_1.minor&&n.output.putBytes(a),n.update(s.fragment),n.finish(WC)&&(s.fragment=n.output,s.length=s.fragment.length(),t=!0),t}function WC(s,e,t){if(!t){var r=s-e.length()%s;e.fillWithByte(r-1,r)}return!0}function QC(s,e,t){var r=!0;if(t){for(var a=e.length(),n=e.last(),i=a-1-n;i<a-1;++i)r=r&&e.at(i)==n;r&&e.truncate(n+1)}return r}function YC(s,e){var t=!1,r;s.version.minor===es.Versions.TLS_1_0.minor?r=e.cipherState.init?null:e.cipherState.iv:r=s.fragment.getBytes(16),e.cipherState.init=!0;var a=e.cipherState.cipher;a.start({iv:r}),a.update(s.fragment),t=a.finish(QC);var n=e.macLength,i=Sn.random.getBytesSync(n),o=a.output.length();o>=n?(s.fragment=a.output.getBytes(o-n),i=a.output.getBytes(n)):s.fragment=a.output.getBytes(),s.fragment=Sn.util.createBuffer(s.fragment),s.length=s.fragment.length();var l=e.macFunction(e.macKey,e.sequenceNumber,s);return e.updateSequenceNumber(),t=zC(e.macKey,i,l)&&t,t}function zC(s,e,t){var r=Sn.hmac.create();return r.start("SHA1",s),r.update(e),e=r.digest().getBytes(),r.start(null,null),r.update(t),t=r.digest().getBytes(),e===t}var wt=Fe,ih=wt.sha512=wt.sha512||{};wt.md.sha512=wt.md.algorithms.sha512=ih;var Ry=wt.sha384=wt.sha512.sha384=wt.sha512.sha384||{};Ry.create=function(){return ih.create("SHA-384")};wt.md.sha384=wt.md.algorithms.sha384=Ry;wt.sha512.sha256=wt.sha512.sha256||{create:function(){return ih.create("SHA-512/256")}};wt.md["sha512/256"]=wt.md.algorithms["sha512/256"]=wt.sha512.sha256;wt.sha512.sha224=wt.sha512.sha224||{create:function(){return ih.create("SHA-512/224")}};wt.md["sha512/224"]=wt.md.algorithms["sha512/224"]=wt.sha512.sha224;ih.create=function(s){if(Vy||XC(),typeof s>"u"&&(s="SHA-512"),!(s in Pi))throw new Error("Invalid SHA-512 algorithm: "+s);for(var e=Pi[s],t=null,r=wt.util.createBuffer(),a=new Array(80),n=0;n<80;++n)a[n]=new Array(2);var i=64;switch(s){case"SHA-384":i=48;break;case"SHA-512/256":i=32;break;case"SHA-512/224":i=28;break}var o={algorithm:s.replace("-","").toLowerCase(),blockLength:128,digestLength:i,messageLength:0,fullMessageLength:null,messageLengthSize:16};return o.start=function(){o.messageLength=0,o.fullMessageLength=o.messageLength128=[];for(var l=o.messageLengthSize/4,u=0;u<l;++u)o.fullMessageLength.push(0);r=wt.util.createBuffer(),t=new Array(e.length);for(var u=0;u<e.length;++u)t[u]=e[u].slice(0);return o},o.start(),o.update=function(l,u){u==="utf8"&&(l=wt.util.encodeUtf8(l));var c=l.length;o.messageLength+=c,c=[c/4294967296>>>0,c>>>0];for(var f=o.fullMessageLength.length-1;f>=0;--f)o.fullMessageLength[f]+=c[1],c[1]=c[0]+(o.fullMessageLength[f]/4294967296>>>0),o.fullMessageLength[f]=o.fullMessageLength[f]>>>0,c[0]=c[1]/4294967296>>>0;return r.putBytes(l),ep(t,a,r),(r.read>2048||r.length()===0)&&r.compact(),o},o.digest=function(){var l=wt.util.createBuffer();l.putBytes(r.bytes());var u=o.fullMessageLength[o.fullMessageLength.length-1]+o.messageLengthSize,c=u&o.blockLength-1;l.putBytes(og.substr(0,o.blockLength-c));for(var f,g,v=o.fullMessageLength[0]*8,p=0;p<o.fullMessageLength.length-1;++p)f=o.fullMessageLength[p+1]*8,g=f/4294967296>>>0,v+=g,l.putInt32(v>>>0),v=f>>>0;l.putInt32(v);for(var h=new Array(t.length),p=0;p<t.length;++p)h[p]=t[p].slice(0);ep(h,a,l);var d=wt.util.createBuffer(),y;s==="SHA-512"?y=h.length:s==="SHA-384"?y=h.length-2:y=h.length-4;for(var p=0;p<y;++p)d.putInt32(h[p][0]),(p!==y-1||s!=="SHA-512/224")&&d.putInt32(h[p][1]);return d},o};var og=null,Vy=!1,lg=null,Pi=null;function XC(){og=String.fromCharCode(128),og+=wt.util.fillString(String.fromCharCode(0),128),lg=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],Pi={},Pi["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],Pi["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],Pi["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],Pi["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],Vy=!0}function ep(s,e,t){for(var r,a,n,i,o,l,u,c,f,g,v,p,h,d,y,E,k,R,V,L,ne,ae,ve,Te,ye,Ce,Ve,Pe,pe,$e,ie,ot,Me,te,oe,se=t.length();se>=128;){for(pe=0;pe<16;++pe)e[pe][0]=t.getInt32()>>>0,e[pe][1]=t.getInt32()>>>0;for(;pe<80;++pe)ot=e[pe-2],$e=ot[0],ie=ot[1],r=(($e>>>19|ie<<13)^(ie>>>29|$e<<3)^$e>>>6)>>>0,a=(($e<<13|ie>>>19)^(ie<<3|$e>>>29)^($e<<26|ie>>>6))>>>0,te=e[pe-15],$e=te[0],ie=te[1],n=(($e>>>1|ie<<31)^($e>>>8|ie<<24)^$e>>>7)>>>0,i=(($e<<31|ie>>>1)^($e<<24|ie>>>8)^($e<<25|ie>>>7))>>>0,Me=e[pe-7],oe=e[pe-16],ie=a+Me[1]+i+oe[1],e[pe][0]=r+Me[0]+n+oe[0]+(ie/4294967296>>>0)>>>0,e[pe][1]=ie>>>0;for(h=s[0][0],d=s[0][1],y=s[1][0],E=s[1][1],k=s[2][0],R=s[2][1],V=s[3][0],L=s[3][1],ne=s[4][0],ae=s[4][1],ve=s[5][0],Te=s[5][1],ye=s[6][0],Ce=s[6][1],Ve=s[7][0],Pe=s[7][1],pe=0;pe<80;++pe)u=((ne>>>14|ae<<18)^(ne>>>18|ae<<14)^(ae>>>9|ne<<23))>>>0,c=((ne<<18|ae>>>14)^(ne<<14|ae>>>18)^(ae<<23|ne>>>9))>>>0,f=(ye^ne&(ve^ye))>>>0,g=(Ce^ae&(Te^Ce))>>>0,o=((h>>>28|d<<4)^(d>>>2|h<<30)^(d>>>7|h<<25))>>>0,l=((h<<4|d>>>28)^(d<<30|h>>>2)^(d<<25|h>>>7))>>>0,v=(h&y|k&(h^y))>>>0,p=(d&E|R&(d^E))>>>0,ie=Pe+c+g+lg[pe][1]+e[pe][1],r=Ve+u+f+lg[pe][0]+e[pe][0]+(ie/4294967296>>>0)>>>0,a=ie>>>0,ie=l+p,n=o+v+(ie/4294967296>>>0)>>>0,i=ie>>>0,Ve=ye,Pe=Ce,ye=ve,Ce=Te,ve=ne,Te=ae,ie=L+a,ne=V+r+(ie/4294967296>>>0)>>>0,ae=ie>>>0,V=k,L=R,k=y,R=E,y=h,E=d,ie=a+i,h=r+n+(ie/4294967296>>>0)>>>0,d=ie>>>0;ie=s[0][1]+d,s[0][0]=s[0][0]+h+(ie/4294967296>>>0)>>>0,s[0][1]=ie>>>0,ie=s[1][1]+E,s[1][0]=s[1][0]+y+(ie/4294967296>>>0)>>>0,s[1][1]=ie>>>0,ie=s[2][1]+R,s[2][0]=s[2][0]+k+(ie/4294967296>>>0)>>>0,s[2][1]=ie>>>0,ie=s[3][1]+L,s[3][0]=s[3][0]+V+(ie/4294967296>>>0)>>>0,s[3][1]=ie>>>0,ie=s[4][1]+ae,s[4][0]=s[4][0]+ne+(ie/4294967296>>>0)>>>0,s[4][1]=ie>>>0,ie=s[5][1]+Te,s[5][0]=s[5][0]+ve+(ie/4294967296>>>0)>>>0,s[5][1]=ie>>>0,ie=s[6][1]+Ce,s[6][0]=s[6][0]+ye+(ie/4294967296>>>0)>>>0,s[6][1]=ie>>>0,ie=s[7][1]+Pe,s[7][0]=s[7][0]+Ve+(ie/4294967296>>>0)>>>0,s[7][1]=ie>>>0,se-=128}}var am={},ZC=Fe,zt=ZC.asn1;am.privateKeyValidator={name:"PrivateKeyInfo",tagClass:zt.Class.UNIVERSAL,type:zt.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:zt.Class.UNIVERSAL,type:zt.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:zt.Class.UNIVERSAL,type:zt.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:zt.Class.UNIVERSAL,type:zt.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:zt.Class.UNIVERSAL,type:zt.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]};am.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:zt.Class.UNIVERSAL,type:zt.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:zt.Class.UNIVERSAL,type:zt.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:zt.Class.UNIVERSAL,type:zt.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{tagClass:zt.Class.UNIVERSAL,type:zt.Type.BITSTRING,constructed:!1,composed:!0,captureBitStringValue:"ed25519PublicKey"}]};var nr=Fe,_y=am,eA=_y.publicKeyValidator,tA=_y.privateKeyValidator;if(typeof rA>"u")var rA=nr.jsbn.BigInteger;var ug=nr.util.ByteBuffer,Br=typeof Buffer>"u"?Uint8Array:Buffer;nr.pki=nr.pki||{};nr.pki.ed25519=nr.ed25519=nr.ed25519||{};var je=nr.ed25519;je.constants={};je.constants.PUBLIC_KEY_BYTE_LENGTH=32;je.constants.PRIVATE_KEY_BYTE_LENGTH=64;je.constants.SEED_BYTE_LENGTH=32;je.constants.SIGN_BYTE_LENGTH=64;je.constants.HASH_BYTE_LENGTH=64;je.generateKeyPair=function(s){s=s||{};var e=s.seed;if(e===void 0)e=nr.random.getBytesSync(je.constants.SEED_BYTE_LENGTH);else if(typeof e=="string"){if(e.length!==je.constants.SEED_BYTE_LENGTH)throw new TypeError('"seed" must be '+je.constants.SEED_BYTE_LENGTH+" bytes in length.")}else if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, Uint8Array, or a binary string.');e=oa({message:e,encoding:"binary"});for(var t=new Br(je.constants.PUBLIC_KEY_BYTE_LENGTH),r=new Br(je.constants.PRIVATE_KEY_BYTE_LENGTH),a=0;a<32;++a)r[a]=e[a];return iA(t,r),{publicKey:t,privateKey:r}};je.privateKeyFromAsn1=function(s){var e={},t=[],r=nr.asn1.validate(s,tA,e,t);if(!r){var a=new Error("Invalid Key.");throw a.errors=t,a}var n=nr.asn1.derToOid(e.privateKeyOid),i=nr.oids.EdDSA25519;if(n!==i)throw new Error('Invalid OID "'+n+'"; OID must be "'+i+'".');var o=e.privateKey,l=oa({message:nr.asn1.fromDer(o).value,encoding:"binary"});return{privateKeyBytes:l}};je.publicKeyFromAsn1=function(s){var e={},t=[],r=nr.asn1.validate(s,eA,e,t);if(!r){var a=new Error("Invalid Key.");throw a.errors=t,a}var n=nr.asn1.derToOid(e.publicKeyOid),i=nr.oids.EdDSA25519;if(n!==i)throw new Error('Invalid OID "'+n+'"; OID must be "'+i+'".');var o=e.ed25519PublicKey;if(o.length!==je.constants.PUBLIC_KEY_BYTE_LENGTH)throw new Error("Key length is invalid.");return oa({message:o,encoding:"binary"})};je.publicKeyFromPrivateKey=function(s){s=s||{};var e=oa({message:s.privateKey,encoding:"binary"});if(e.length!==je.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+je.constants.PRIVATE_KEY_BYTE_LENGTH);for(var t=new Br(je.constants.PUBLIC_KEY_BYTE_LENGTH),r=0;r<t.length;++r)t[r]=e[32+r];return t};je.sign=function(s){s=s||{};var e=oa(s),t=oa({message:s.privateKey,encoding:"binary"});if(t.length===je.constants.SEED_BYTE_LENGTH){var r=je.generateKeyPair({seed:t});t=r.privateKey}else if(t.length!==je.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+je.constants.SEED_BYTE_LENGTH+" or "+je.constants.PRIVATE_KEY_BYTE_LENGTH);var a=new Br(je.constants.SIGN_BYTE_LENGTH+e.length);oA(a,e,e.length,t);for(var n=new Br(je.constants.SIGN_BYTE_LENGTH),i=0;i<n.length;++i)n[i]=a[i];return n};je.verify=function(s){s=s||{};var e=oa(s);if(s.signature===void 0)throw new TypeError('"options.signature" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a binary string.');var t=oa({message:s.signature,encoding:"binary"});if(t.length!==je.constants.SIGN_BYTE_LENGTH)throw new TypeError('"options.signature" must have a byte length of '+je.constants.SIGN_BYTE_LENGTH);var r=oa({message:s.publicKey,encoding:"binary"});if(r.length!==je.constants.PUBLIC_KEY_BYTE_LENGTH)throw new TypeError('"options.publicKey" must have a byte length of '+je.constants.PUBLIC_KEY_BYTE_LENGTH);var a=new Br(je.constants.SIGN_BYTE_LENGTH+e.length),n=new Br(je.constants.SIGN_BYTE_LENGTH+e.length),i;for(i=0;i<je.constants.SIGN_BYTE_LENGTH;++i)a[i]=t[i];for(i=0;i<e.length;++i)a[i+je.constants.SIGN_BYTE_LENGTH]=e[i];return lA(n,a,a.length,r)>=0};function oa(s){var e=s.message;if(e instanceof Uint8Array||e instanceof Br)return e;var t=s.encoding;if(e===void 0)if(s.md)e=s.md.digest().getBytes(),t="binary";else throw new TypeError('"options.message" or "options.md" not specified.');if(typeof e=="string"&&!t)throw new TypeError('"options.encoding" must be "binary" or "utf8".');if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.from(e,t);e=new ug(e,t)}else if(!(e instanceof ug))throw new TypeError('"options.message" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a string with "options.encoding" specifying its encoding.');for(var r=new Br(e.length()),a=0;a<r.length;++a)r[a]=e.at(a);return r}var cg=Re(),x0=Re([1]),sA=Re([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),aA=Re([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),tp=Re([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),rp=Re([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),vd=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]),nA=Re([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function Lf(s,e){var t=nr.md.sha512.create(),r=new ug(s);t.update(r.getBytes(e),"binary");var a=t.digest().getBytes();if(typeof Buffer<"u")return Buffer.from(a,"binary");for(var n=new Br(je.constants.HASH_BYTE_LENGTH),i=0;i<64;++i)n[i]=a.charCodeAt(i);return n}function iA(s,e){var t=[Re(),Re(),Re(),Re()],r,a=Lf(e,32);for(a[0]&=248,a[31]&=127,a[31]|=64,im(t,a),nm(s,t),r=0;r<32;++r)e[r+32]=s[r];return 0}function oA(s,e,t,r){var a,n,i=new Float64Array(64),o=[Re(),Re(),Re(),Re()],l=Lf(r,32);l[0]&=248,l[31]&=127,l[31]|=64;var u=t+64;for(a=0;a<t;++a)s[64+a]=e[a];for(a=0;a<32;++a)s[32+a]=l[32+a];var c=Lf(s.subarray(32),t+32);for(fg(c),im(o,c),nm(s,o),a=32;a<64;++a)s[a]=r[a];var f=Lf(s,t+64);for(fg(f),a=32;a<64;++a)i[a]=0;for(a=0;a<32;++a)i[a]=c[a];for(a=0;a<32;++a)for(n=0;n<32;n++)i[a+n]+=f[a]*l[n];return $y(s.subarray(32),i),u}function lA(s,e,t,r){var a,n,i=new Br(32),o=[Re(),Re(),Re(),Re()],l=[Re(),Re(),Re(),Re()];if(n=-1,t<64||uA(l,r))return-1;for(a=0;a<t;++a)s[a]=e[a];for(a=0;a<32;++a)s[a+32]=r[a];var u=Lf(s,t);if(fg(u),Oy(o,l,u),im(l,e.subarray(32)),hg(o,l),nm(i,o),t-=64,Dy(e,0,i,0)){for(a=0;a<t;++a)s[a]=0;return-1}for(a=0;a<t;++a)s[a]=e[a+64];return n=t,n}function $y(s,e){var t,r,a,n;for(r=63;r>=32;--r){for(t=0,a=r-32,n=r-12;a<n;++a)e[a]+=t-16*e[r]*vd[a-(r-32)],t=e[a]+128>>8,e[a]-=t*256;e[a]+=t,e[r]=0}for(t=0,a=0;a<32;++a)e[a]+=t-(e[31]>>4)*vd[a],t=e[a]>>8,e[a]&=255;for(a=0;a<32;++a)e[a]-=t*vd[a];for(r=0;r<32;++r)e[r+1]+=e[r]>>8,s[r]=e[r]&255}function fg(s){for(var e=new Float64Array(64),t=0;t<64;++t)e[t]=s[t],s[t]=0;$y(s,e)}function hg(s,e){var t=Re(),r=Re(),a=Re(),n=Re(),i=Re(),o=Re(),l=Re(),u=Re(),c=Re();Jl(t,s[1],s[0]),Jl(c,e[1],e[0]),ct(t,t,c),Eo(r,s[0],s[1]),Eo(c,e[0],e[1]),ct(r,r,c),ct(a,s[3],e[3]),ct(a,a,aA),ct(n,s[2],e[2]),Eo(n,n,n),Jl(i,r,t),Jl(o,n,a),Eo(l,n,a),Eo(u,r,t),ct(s[0],i,o),ct(s[1],u,l),ct(s[2],l,o),ct(s[3],i,u)}function sp(s,e,t){for(var r=0;r<4;++r)Py(s[r],e[r],t)}function nm(s,e){var t=Re(),r=Re(),a=Re();dA(a,e[2]),ct(t,e[0],a),ct(r,e[1],a),N0(s,r),s[31]^=Ly(t)<<7}function N0(s,e){var t,r,a,n=Re(),i=Re();for(t=0;t<16;++t)i[t]=e[t];for(wd(i),wd(i),wd(i),r=0;r<2;++r){for(n[0]=i[0]-65517,t=1;t<15;++t)n[t]=i[t]-65535-(n[t-1]>>16&1),n[t-1]&=65535;n[15]=i[15]-32767-(n[14]>>16&1),a=n[15]>>16&1,n[14]&=65535,Py(i,n,1-a)}for(t=0;t<16;t++)s[2*t]=i[t]&255,s[2*t+1]=i[t]>>8}function uA(s,e){var t=Re(),r=Re(),a=Re(),n=Re(),i=Re(),o=Re(),l=Re();return hn(s[2],x0),cA(s[1],e),Ui(a,s[1]),ct(n,a,sA),Jl(a,a,s[2]),Eo(n,s[2],n),Ui(i,n),Ui(o,i),ct(l,o,i),ct(t,l,a),ct(t,t,n),fA(t,t),ct(t,t,a),ct(t,t,n),ct(t,t,n),ct(s[0],t,n),Ui(r,s[0]),ct(r,r,n),ap(r,a)&&ct(s[0],s[0],nA),Ui(r,s[0]),ct(r,r,n),ap(r,a)?-1:(Ly(s[0])===e[31]>>7&&Jl(s[0],cg,s[0]),ct(s[3],s[0],s[1]),0)}function cA(s,e){var t;for(t=0;t<16;++t)s[t]=e[2*t]+(e[2*t+1]<<8);s[15]&=32767}function fA(s,e){var t=Re(),r;for(r=0;r<16;++r)t[r]=e[r];for(r=250;r>=0;--r)Ui(t,t),r!==1&&ct(t,t,e);for(r=0;r<16;++r)s[r]=t[r]}function ap(s,e){var t=new Br(32),r=new Br(32);return N0(t,s),N0(r,e),Dy(t,0,r,0)}function Dy(s,e,t,r){return hA(s,e,t,r,32)}function hA(s,e,t,r,a){var n,i=0;for(n=0;n<a;++n)i|=s[e+n]^t[r+n];return(1&i-1>>>8)-1}function Ly(s){var e=new Br(32);return N0(e,s),e[0]&1}function Oy(s,e,t){var r,a;for(hn(s[0],cg),hn(s[1],x0),hn(s[2],x0),hn(s[3],cg),a=255;a>=0;--a)r=t[a/8|0]>>(a&7)&1,sp(s,e,r),hg(e,s),hg(s,s),sp(s,e,r)}function im(s,e){var t=[Re(),Re(),Re(),Re()];hn(t[0],tp),hn(t[1],rp),hn(t[2],x0),ct(t[3],tp,rp),Oy(s,t,e)}function hn(s,e){var t;for(t=0;t<16;t++)s[t]=e[t]|0}function dA(s,e){var t=Re(),r;for(r=0;r<16;++r)t[r]=e[r];for(r=253;r>=0;--r)Ui(t,t),r!==2&&r!==4&&ct(t,t,e);for(r=0;r<16;++r)s[r]=t[r]}function wd(s){var e,t,r=1;for(e=0;e<16;++e)t=s[e]+r+65535,r=Math.floor(t/65536),s[e]=t-r*65536;s[0]+=r-1+37*(r-1)}function Py(s,e,t){for(var r,a=~(t-1),n=0;n<16;++n)r=a&(s[n]^e[n]),s[n]^=r,e[n]^=r}function Re(s){var e,t=new Float64Array(16);if(s)for(e=0;e<s.length;++e)t[e]=s[e];return t}function Eo(s,e,t){for(var r=0;r<16;++r)s[r]=e[r]+t[r]}function Jl(s,e,t){for(var r=0;r<16;++r)s[r]=e[r]-t[r]}function Ui(s,e){ct(s,e,e)}function ct(s,e,t){var r,a,n=0,i=0,o=0,l=0,u=0,c=0,f=0,g=0,v=0,p=0,h=0,d=0,y=0,E=0,k=0,R=0,V=0,L=0,ne=0,ae=0,ve=0,Te=0,ye=0,Ce=0,Ve=0,Pe=0,pe=0,$e=0,ie=0,ot=0,Me=0,te=t[0],oe=t[1],se=t[2],me=t[3],Ae=t[4],qe=t[5],it=t[6],Ue=t[7],Ne=t[8],fe=t[9],ht=t[10],lt=t[11],ut=t[12],Oe=t[13],Jt=t[14],Gt=t[15];r=e[0],n+=r*te,i+=r*oe,o+=r*se,l+=r*me,u+=r*Ae,c+=r*qe,f+=r*it,g+=r*Ue,v+=r*Ne,p+=r*fe,h+=r*ht,d+=r*lt,y+=r*ut,E+=r*Oe,k+=r*Jt,R+=r*Gt,r=e[1],i+=r*te,o+=r*oe,l+=r*se,u+=r*me,c+=r*Ae,f+=r*qe,g+=r*it,v+=r*Ue,p+=r*Ne,h+=r*fe,d+=r*ht,y+=r*lt,E+=r*ut,k+=r*Oe,R+=r*Jt,V+=r*Gt,r=e[2],o+=r*te,l+=r*oe,u+=r*se,c+=r*me,f+=r*Ae,g+=r*qe,v+=r*it,p+=r*Ue,h+=r*Ne,d+=r*fe,y+=r*ht,E+=r*lt,k+=r*ut,R+=r*Oe,V+=r*Jt,L+=r*Gt,r=e[3],l+=r*te,u+=r*oe,c+=r*se,f+=r*me,g+=r*Ae,v+=r*qe,p+=r*it,h+=r*Ue,d+=r*Ne,y+=r*fe,E+=r*ht,k+=r*lt,R+=r*ut,V+=r*Oe,L+=r*Jt,ne+=r*Gt,r=e[4],u+=r*te,c+=r*oe,f+=r*se,g+=r*me,v+=r*Ae,p+=r*qe,h+=r*it,d+=r*Ue,y+=r*Ne,E+=r*fe,k+=r*ht,R+=r*lt,V+=r*ut,L+=r*Oe,ne+=r*Jt,ae+=r*Gt,r=e[5],c+=r*te,f+=r*oe,g+=r*se,v+=r*me,p+=r*Ae,h+=r*qe,d+=r*it,y+=r*Ue,E+=r*Ne,k+=r*fe,R+=r*ht,V+=r*lt,L+=r*ut,ne+=r*Oe,ae+=r*Jt,ve+=r*Gt,r=e[6],f+=r*te,g+=r*oe,v+=r*se,p+=r*me,h+=r*Ae,d+=r*qe,y+=r*it,E+=r*Ue,k+=r*Ne,R+=r*fe,V+=r*ht,L+=r*lt,ne+=r*ut,ae+=r*Oe,ve+=r*Jt,Te+=r*Gt,r=e[7],g+=r*te,v+=r*oe,p+=r*se,h+=r*me,d+=r*Ae,y+=r*qe,E+=r*it,k+=r*Ue,R+=r*Ne,V+=r*fe,L+=r*ht,ne+=r*lt,ae+=r*ut,ve+=r*Oe,Te+=r*Jt,ye+=r*Gt,r=e[8],v+=r*te,p+=r*oe,h+=r*se,d+=r*me,y+=r*Ae,E+=r*qe,k+=r*it,R+=r*Ue,V+=r*Ne,L+=r*fe,ne+=r*ht,ae+=r*lt,ve+=r*ut,Te+=r*Oe,ye+=r*Jt,Ce+=r*Gt,r=e[9],p+=r*te,h+=r*oe,d+=r*se,y+=r*me,E+=r*Ae,k+=r*qe,R+=r*it,V+=r*Ue,L+=r*Ne,ne+=r*fe,ae+=r*ht,ve+=r*lt,Te+=r*ut,ye+=r*Oe,Ce+=r*Jt,Ve+=r*Gt,r=e[10],h+=r*te,d+=r*oe,y+=r*se,E+=r*me,k+=r*Ae,R+=r*qe,V+=r*it,L+=r*Ue,ne+=r*Ne,ae+=r*fe,ve+=r*ht,Te+=r*lt,ye+=r*ut,Ce+=r*Oe,Ve+=r*Jt,Pe+=r*Gt,r=e[11],d+=r*te,y+=r*oe,E+=r*se,k+=r*me,R+=r*Ae,V+=r*qe,L+=r*it,ne+=r*Ue,ae+=r*Ne,ve+=r*fe,Te+=r*ht,ye+=r*lt,Ce+=r*ut,Ve+=r*Oe,Pe+=r*Jt,pe+=r*Gt,r=e[12],y+=r*te,E+=r*oe,k+=r*se,R+=r*me,V+=r*Ae,L+=r*qe,ne+=r*it,ae+=r*Ue,ve+=r*Ne,Te+=r*fe,ye+=r*ht,Ce+=r*lt,Ve+=r*ut,Pe+=r*Oe,pe+=r*Jt,$e+=r*Gt,r=e[13],E+=r*te,k+=r*oe,R+=r*se,V+=r*me,L+=r*Ae,ne+=r*qe,ae+=r*it,ve+=r*Ue,Te+=r*Ne,ye+=r*fe,Ce+=r*ht,Ve+=r*lt,Pe+=r*ut,pe+=r*Oe,$e+=r*Jt,ie+=r*Gt,r=e[14],k+=r*te,R+=r*oe,V+=r*se,L+=r*me,ne+=r*Ae,ae+=r*qe,ve+=r*it,Te+=r*Ue,ye+=r*Ne,Ce+=r*fe,Ve+=r*ht,Pe+=r*lt,pe+=r*ut,$e+=r*Oe,ie+=r*Jt,ot+=r*Gt,r=e[15],R+=r*te,V+=r*oe,L+=r*se,ne+=r*me,ae+=r*Ae,ve+=r*qe,Te+=r*it,ye+=r*Ue,Ce+=r*Ne,Ve+=r*fe,Pe+=r*ht,pe+=r*lt,$e+=r*ut,ie+=r*Oe,ot+=r*Jt,Me+=r*Gt,n+=38*V,i+=38*L,o+=38*ne,l+=38*ae,u+=38*ve,c+=38*Te,f+=38*ye,g+=38*Ce,v+=38*Ve,p+=38*Pe,h+=38*pe,d+=38*$e,y+=38*ie,E+=38*ot,k+=38*Me,a=1,r=n+a+65535,a=Math.floor(r/65536),n=r-a*65536,r=i+a+65535,a=Math.floor(r/65536),i=r-a*65536,r=o+a+65535,a=Math.floor(r/65536),o=r-a*65536,r=l+a+65535,a=Math.floor(r/65536),l=r-a*65536,r=u+a+65535,a=Math.floor(r/65536),u=r-a*65536,r=c+a+65535,a=Math.floor(r/65536),c=r-a*65536,r=f+a+65535,a=Math.floor(r/65536),f=r-a*65536,r=g+a+65535,a=Math.floor(r/65536),g=r-a*65536,r=v+a+65535,a=Math.floor(r/65536),v=r-a*65536,r=p+a+65535,a=Math.floor(r/65536),p=r-a*65536,r=h+a+65535,a=Math.floor(r/65536),h=r-a*65536,r=d+a+65535,a=Math.floor(r/65536),d=r-a*65536,r=y+a+65535,a=Math.floor(r/65536),y=r-a*65536,r=E+a+65535,a=Math.floor(r/65536),E=r-a*65536,r=k+a+65535,a=Math.floor(r/65536),k=r-a*65536,r=R+a+65535,a=Math.floor(r/65536),R=r-a*65536,n+=a-1+37*(a-1),a=1,r=n+a+65535,a=Math.floor(r/65536),n=r-a*65536,r=i+a+65535,a=Math.floor(r/65536),i=r-a*65536,r=o+a+65535,a=Math.floor(r/65536),o=r-a*65536,r=l+a+65535,a=Math.floor(r/65536),l=r-a*65536,r=u+a+65535,a=Math.floor(r/65536),u=r-a*65536,r=c+a+65535,a=Math.floor(r/65536),c=r-a*65536,r=f+a+65535,a=Math.floor(r/65536),f=r-a*65536,r=g+a+65535,a=Math.floor(r/65536),g=r-a*65536,r=v+a+65535,a=Math.floor(r/65536),v=r-a*65536,r=p+a+65535,a=Math.floor(r/65536),p=r-a*65536,r=h+a+65535,a=Math.floor(r/65536),h=r-a*65536,r=d+a+65535,a=Math.floor(r/65536),d=r-a*65536,r=y+a+65535,a=Math.floor(r/65536),y=r-a*65536,r=E+a+65535,a=Math.floor(r/65536),E=r-a*65536,r=k+a+65535,a=Math.floor(r/65536),k=r-a*65536,r=R+a+65535,a=Math.floor(r/65536),R=r-a*65536,n+=a-1+37*(a-1),s[0]=n,s[1]=i,s[2]=o,s[3]=l,s[4]=u,s[5]=c,s[6]=f,s[7]=g,s[8]=v,s[9]=p,s[10]=h,s[11]=d,s[12]=y,s[13]=E,s[14]=k,s[15]=R}var Or=Fe;Or.kem=Or.kem||{};var np=Or.jsbn.BigInteger;Or.kem.rsa={};Or.kem.rsa.create=function(s,e){e=e||{};var t=e.prng||Or.random,r={};return r.encrypt=function(a,n){var i=Math.ceil(a.n.bitLength()/8),o;do o=new np(Or.util.bytesToHex(t.getBytesSync(i)),16).mod(a.n);while(o.compareTo(np.ONE)<=0);o=Or.util.hexToBytes(o.toString(16));var l=i-o.length;l>0&&(o=Or.util.fillString(String.fromCharCode(0),l)+o);var u=a.encrypt(o,"NONE"),c=s.generate(o,n);return{encapsulation:u,key:c}},r.decrypt=function(a,n,i){var o=a.decrypt(n,"NONE");return s.generate(o,i)},r};Or.kem.kdf1=function(s,e){Uy(this,s,0,e||s.digestLength)};Or.kem.kdf2=function(s,e){Uy(this,s,1,e||s.digestLength)};function Uy(s,e,t,r){s.generate=function(a,n){for(var i=new Or.util.ByteBuffer,o=Math.ceil(n/r)+t,l=new Or.util.ByteBuffer,u=t;u<o;++u){l.putInt32(u),e.start(),e.update(a+l.getBytes());var c=e.digest();i.putBytes(c.getBytes(r))}return i.truncate(i.length()-n),i.getBytes()}}var Qe=Fe;Qe.log=Qe.log||{};Qe.log.levels=["none","error","warning","info","debug","verbose","max"];var T0={},dg=[],Of=null;Qe.log.LEVEL_LOCKED=1<<1;Qe.log.NO_LEVEL_CHECK=1<<2;Qe.log.INTERPOLATE=1<<3;for(var dn=0;dn<Qe.log.levels.length;++dn){var ip=Qe.log.levels[dn];T0[ip]={index:dn,name:ip.toUpperCase()}}Qe.log.logMessage=function(s){for(var e=T0[s.level].index,t=0;t<dg.length;++t){var r=dg[t];if(r.flags&Qe.log.NO_LEVEL_CHECK)r.f(s);else{var a=T0[r.level].index;e<=a&&r.f(r,s)}}};Qe.log.prepareStandard=function(s){"standard"in s||(s.standard=T0[s.level].name+" ["+s.category+"] "+s.message)};Qe.log.prepareFull=function(s){if(!("full"in s)){var e=[s.message];e=e.concat([]),s.full=Qe.util.format.apply(this,e)}};Qe.log.prepareStandardFull=function(s){"standardFull"in s||(Qe.log.prepareStandard(s),s.standardFull=s.standard)};for(var op=["error","warning","info","debug","verbose"],dn=0;dn<op.length;++dn)(function(e){Qe.log[e]=function(t,r){var a=Array.prototype.slice.call(arguments).slice(2),n={timestamp:new Date,level:e,category:t,message:r,arguments:a};Qe.log.logMessage(n)}})(op[dn]);Qe.log.makeLogger=function(s){var e={flags:0,f:s};return Qe.log.setLevel(e,"none"),e};Qe.log.setLevel=function(s,e){var t=!1;if(s&&!(s.flags&Qe.log.LEVEL_LOCKED))for(var r=0;r<Qe.log.levels.length;++r){var a=Qe.log.levels[r];if(e==a){s.level=e,t=!0;break}}return t};Qe.log.lock=function(s,e){typeof e>"u"||e?s.flags|=Qe.log.LEVEL_LOCKED:s.flags&=~Qe.log.LEVEL_LOCKED};Qe.log.addLogger=function(s){dg.push(s)};if(typeof console<"u"&&"log"in console){var Au;if(console.error&&console.warn&&console.info&&console.debug){var gA={error:console.error,warning:console.warn,info:console.info,debug:console.debug,verbose:console.debug},om=function(s,e){Qe.log.prepareStandard(e);var t=gA[e.level],r=[e.standard];r=r.concat(e.arguments.slice()),t.apply(console,r)};Au=Qe.log.makeLogger(om)}else{var om=function(e,t){Qe.log.prepareStandardFull(t),console.log(t.standardFull)};Au=Qe.log.makeLogger(om)}Qe.log.setLevel(Au,"debug"),Qe.log.addLogger(Au),Of=Au}else console={log:function(){}};if(Of!==null&&typeof window<"u"&&window.location){var hh=new URL(window.location.href).searchParams;if(hh.has("console.level")&&Qe.log.setLevel(Of,hh.get("console.level").slice(-1)[0]),hh.has("console.lock")){var mA=hh.get("console.lock").slice(-1)[0];mA=="true"&&Qe.log.lock(Of)}}Qe.log.consoleLogger=Of;var pA={exports:{}};(function(s){s.exports=q1})(pA);var le=Fe,B=le.asn1,vr=le.pkcs7=le.pkcs7||{};vr.messageFromPem=function(s){var e=le.pem.decode(s)[0];if(e.type!=="PKCS7"){var t=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var r=B.fromDer(e.body);return vr.messageFromAsn1(r)};vr.messageToPem=function(s,e){var t={type:"PKCS7",body:B.toDer(s.toAsn1()).getBytes()};return le.pem.encode(t,{maxline:e})};vr.messageFromAsn1=function(s){var e={},t=[];if(!B.validate(s,vr.asn1.contentInfoValidator,e,t)){var r=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw r.errors=t,r}var a=B.derToOid(e.contentType),n;switch(a){case le.pki.oids.envelopedData:n=vr.createEnvelopedData();break;case le.pki.oids.encryptedData:n=vr.createEncryptedData();break;case le.pki.oids.signedData:n=vr.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+a+" is not (yet) supported.")}return n.fromAsn1(e.content.value[0]),n};vr.createSignedData=function(){var s=null;return s={type:le.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(r){if(lm(s,r,vr.asn1.signedDataValidator),s.certificates=[],s.crls=[],s.digestAlgorithmIdentifiers=[],s.contentInfo=null,s.signerInfos=[],s.rawCapture.certificates)for(var a=s.rawCapture.certificates.value,n=0;n<a.length;++n)s.certificates.push(le.pki.certificateFromAsn1(a[n]))},toAsn1:function(){s.contentInfo||s.sign();for(var r=[],a=0;a<s.certificates.length;++a)r.push(le.pki.certificateToAsn1(s.certificates[a]));var n=[],i=B.create(B.Class.CONTEXT_SPECIFIC,0,!0,[B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.INTEGER,!1,B.integerToDer(s.version).getBytes()),B.create(B.Class.UNIVERSAL,B.Type.SET,!0,s.digestAlgorithmIdentifiers),s.contentInfo])]);return r.length>0&&i.value[0].value.push(B.create(B.Class.CONTEXT_SPECIFIC,0,!0,r)),n.length>0&&i.value[0].value.push(B.create(B.Class.CONTEXT_SPECIFIC,1,!0,n)),i.value[0].value.push(B.create(B.Class.UNIVERSAL,B.Type.SET,!0,s.signerInfos)),B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(s.type).getBytes()),i])},addSigner:function(r){var a=r.issuer,n=r.serialNumber;if(r.certificate){var i=r.certificate;typeof i=="string"&&(i=le.pki.certificateFromPem(i)),a=i.issuer.attributes,n=i.serialNumber}var o=r.key;if(!o)throw new Error("Could not add PKCS#7 signer; no private key specified.");typeof o=="string"&&(o=le.pki.privateKeyFromPem(o));var l=r.digestAlgorithm||le.pki.oids.sha1;switch(l){case le.pki.oids.sha1:case le.pki.oids.sha256:case le.pki.oids.sha384:case le.pki.oids.sha512:case le.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+l)}var u=r.authenticatedAttributes||[];if(u.length>0){for(var c=!1,f=!1,g=0;g<u.length;++g){var v=u[g];if(!c&&v.type===le.pki.oids.contentType){if(c=!0,f)break;continue}if(!f&&v.type===le.pki.oids.messageDigest){if(f=!0,c)break;continue}}if(!c||!f)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}s.signers.push({key:o,version:1,issuer:a,serialNumber:n,digestAlgorithm:l,signatureAlgorithm:le.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:u,unauthenticatedAttributes:[]})},sign:function(r){if(r=r||{},(typeof s.content!="object"||s.contentInfo===null)&&(s.contentInfo=B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(le.pki.oids.data).getBytes())]),"content"in s)){var a;s.content instanceof le.util.ByteBuffer?a=s.content.bytes():typeof s.content=="string"&&(a=le.util.encodeUtf8(s.content)),r.detached?s.detachedContent=B.create(B.Class.UNIVERSAL,B.Type.OCTETSTRING,!1,a):s.contentInfo.value.push(B.create(B.Class.CONTEXT_SPECIFIC,0,!0,[B.create(B.Class.UNIVERSAL,B.Type.OCTETSTRING,!1,a)]))}if(s.signers.length!==0){var n=e();t(n)}},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(r){typeof r=="string"&&(r=le.pki.certificateFromPem(r)),s.certificates.push(r)},addCertificateRevokationList:function(r){throw new Error("PKCS#7 CRL support not yet implemented.")}},s;function e(){for(var r={},a=0;a<s.signers.length;++a){var n=s.signers[a],i=n.digestAlgorithm;i in r||(r[i]=le.md[le.pki.oids[i]].create()),n.authenticatedAttributes.length===0?n.md=r[i]:n.md=le.md[le.pki.oids[i]].create()}s.digestAlgorithmIdentifiers=[];for(var i in r)s.digestAlgorithmIdentifiers.push(B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(i).getBytes()),B.create(B.Class.UNIVERSAL,B.Type.NULL,!1,"")]));return r}function t(r){var a;if(s.detachedContent?a=s.detachedContent:(a=s.contentInfo.value[1],a=a.value[0]),!a)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var n=B.derToOid(s.contentInfo.value[0].value),i=B.toDer(a);i.getByte(),B.getBerValueLength(i),i=i.getBytes();for(var o in r)r[o].start().update(i);for(var l=new Date,u=0;u<s.signers.length;++u){var c=s.signers[u];if(c.authenticatedAttributes.length===0){if(n!==le.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{c.authenticatedAttributesAsn1=B.create(B.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var f=B.create(B.Class.UNIVERSAL,B.Type.SET,!0,[]),g=0;g<c.authenticatedAttributes.length;++g){var v=c.authenticatedAttributes[g];v.type===le.pki.oids.messageDigest?v.value=r[c.digestAlgorithm].digest():v.type===le.pki.oids.signingTime&&(v.value||(v.value=l)),f.value.push(gg(v)),c.authenticatedAttributesAsn1.value.push(gg(v))}i=B.toDer(f).getBytes(),c.md.start().update(i)}c.signature=c.key.sign(c.md,"RSASSA-PKCS1-V1_5")}s.signerInfos=AA(s.signers)}};vr.createEncryptedData=function(){var s=null;return s={type:le.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:le.pki.oids["aes256-CBC"]},fromAsn1:function(e){lm(s,e,vr.asn1.encryptedDataValidator)},decrypt:function(e){e!==void 0&&(s.encryptedContent.key=e),Ky(s)}},s};vr.createEnvelopedData=function(){var s=null;return s={type:le.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:le.pki.oids["aes256-CBC"]},fromAsn1:function(e){var t=lm(s,e,vr.asn1.envelopedDataValidator);s.recipients=wA(t.recipientInfos.value)},toAsn1:function(){return B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(s.type).getBytes()),B.create(B.Class.CONTEXT_SPECIFIC,0,!0,[B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.INTEGER,!1,B.integerToDer(s.version).getBytes()),B.create(B.Class.UNIVERSAL,B.Type.SET,!0,SA(s.recipients)),B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,EA(s.encryptedContent))])])])},findRecipient:function(e){for(var t=e.issuer.attributes,r=0;r<s.recipients.length;++r){var a=s.recipients[r],n=a.issuer;if(a.serialNumber===e.serialNumber&&n.length===t.length){for(var i=!0,o=0;o<t.length;++o)if(n[o].type!==t[o].type||n[o].value!==t[o].value){i=!1;break}if(i)return a}}return null},decrypt:function(e,t){if(s.encryptedContent.key===void 0&&e!==void 0&&t!==void 0)switch(e.encryptedContent.algorithm){case le.pki.oids.rsaEncryption:case le.pki.oids.desCBC:var r=t.decrypt(e.encryptedContent.content);s.encryptedContent.key=le.util.createBuffer(r);break;default:throw new Error("Unsupported asymmetric cipher, OID "+e.encryptedContent.algorithm)}Ky(s)},addRecipient:function(e){s.recipients.push({version:0,issuer:e.issuer.attributes,serialNumber:e.serialNumber,encryptedContent:{algorithm:le.pki.oids.rsaEncryption,key:e.publicKey}})},encrypt:function(e,t){if(s.encryptedContent.content===void 0){t=t||s.encryptedContent.algorithm,e=e||s.encryptedContent.key;var r,a,n;switch(t){case le.pki.oids["aes128-CBC"]:r=16,a=16,n=le.aes.createEncryptionCipher;break;case le.pki.oids["aes192-CBC"]:r=24,a=16,n=le.aes.createEncryptionCipher;break;case le.pki.oids["aes256-CBC"]:r=32,a=16,n=le.aes.createEncryptionCipher;break;case le.pki.oids["des-EDE3-CBC"]:r=24,a=8,n=le.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+t)}if(e===void 0)e=le.util.createBuffer(le.random.getBytes(r));else if(e.length()!=r)throw new Error("Symmetric key has wrong length; got "+e.length()+" bytes, expected "+r+".");s.encryptedContent.algorithm=t,s.encryptedContent.key=e,s.encryptedContent.parameter=le.util.createBuffer(le.random.getBytes(a));var i=n(e);if(i.start(s.encryptedContent.parameter.copy()),i.update(s.content),!i.finish())throw new Error("Symmetric encryption failed.");s.encryptedContent.content=i.output}for(var o=0;o<s.recipients.length;++o){var l=s.recipients[o];if(l.encryptedContent.content===void 0)switch(l.encryptedContent.algorithm){case le.pki.oids.rsaEncryption:l.encryptedContent.content=l.encryptedContent.key.encrypt(s.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+l.encryptedContent.algorithm)}}}},s};function yA(s){var e={},t=[];if(!B.validate(s,vr.asn1.recipientInfoValidator,e,t)){var r=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw r.errors=t,r}return{version:e.version.charCodeAt(0),issuer:le.pki.RDNAttributesAsArray(e.issuer),serialNumber:le.util.createBuffer(e.serial).toHex(),encryptedContent:{algorithm:B.derToOid(e.encAlgorithm),parameter:e.encParameter?e.encParameter.value:void 0,content:e.encKey}}}function vA(s){return B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.INTEGER,!1,B.integerToDer(s.version).getBytes()),B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[le.pki.distinguishedNameToAsn1({attributes:s.issuer}),B.create(B.Class.UNIVERSAL,B.Type.INTEGER,!1,le.util.hexToBytes(s.serialNumber))]),B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(s.encryptedContent.algorithm).getBytes()),B.create(B.Class.UNIVERSAL,B.Type.NULL,!1,"")]),B.create(B.Class.UNIVERSAL,B.Type.OCTETSTRING,!1,s.encryptedContent.content)])}function wA(s){for(var e=[],t=0;t<s.length;++t)e.push(yA(s[t]));return e}function SA(s){for(var e=[],t=0;t<s.length;++t)e.push(vA(s[t]));return e}function CA(s){var e=B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.INTEGER,!1,B.integerToDer(s.version).getBytes()),B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[le.pki.distinguishedNameToAsn1({attributes:s.issuer}),B.create(B.Class.UNIVERSAL,B.Type.INTEGER,!1,le.util.hexToBytes(s.serialNumber))]),B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(s.digestAlgorithm).getBytes()),B.create(B.Class.UNIVERSAL,B.Type.NULL,!1,"")])]);if(s.authenticatedAttributesAsn1&&e.value.push(s.authenticatedAttributesAsn1),e.value.push(B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(s.signatureAlgorithm).getBytes()),B.create(B.Class.UNIVERSAL,B.Type.NULL,!1,"")])),e.value.push(B.create(B.Class.UNIVERSAL,B.Type.OCTETSTRING,!1,s.signature)),s.unauthenticatedAttributes.length>0){for(var t=B.create(B.Class.CONTEXT_SPECIFIC,1,!0,[]),r=0;r<s.unauthenticatedAttributes.length;++r){var a=s.unauthenticatedAttributes[r];t.values.push(gg(a))}e.value.push(t)}return e}function AA(s){for(var e=[],t=0;t<s.length;++t)e.push(CA(s[t]));return e}function gg(s){var e;if(s.type===le.pki.oids.contentType)e=B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(s.value).getBytes());else if(s.type===le.pki.oids.messageDigest)e=B.create(B.Class.UNIVERSAL,B.Type.OCTETSTRING,!1,s.value.bytes());else if(s.type===le.pki.oids.signingTime){var t=new Date("1950-01-01T00:00:00Z"),r=new Date("2050-01-01T00:00:00Z"),a=s.value;if(typeof a=="string"){var n=Date.parse(a);isNaN(n)?a.length===13?a=B.utcTimeToDate(a):a=B.generalizedTimeToDate(a):a=new Date(n)}a>=t&&a<r?e=B.create(B.Class.UNIVERSAL,B.Type.UTCTIME,!1,B.dateToUtcTime(a)):e=B.create(B.Class.UNIVERSAL,B.Type.GENERALIZEDTIME,!1,B.dateToGeneralizedTime(a))}return B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(s.type).getBytes()),B.create(B.Class.UNIVERSAL,B.Type.SET,!0,[e])])}function EA(s){return[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(le.pki.oids.data).getBytes()),B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(s.algorithm).getBytes()),s.parameter?B.create(B.Class.UNIVERSAL,B.Type.OCTETSTRING,!1,s.parameter.getBytes()):void 0]),B.create(B.Class.CONTEXT_SPECIFIC,0,!0,[B.create(B.Class.UNIVERSAL,B.Type.OCTETSTRING,!1,s.content.getBytes())])]}function lm(s,e,t){var r={},a=[];if(!B.validate(e,t,r,a)){var n=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw n.errors=n,n}var i=B.derToOid(r.contentType);if(i!==le.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(r.encryptedContent){var o="";if(le.util.isArray(r.encryptedContent))for(var l=0;l<r.encryptedContent.length;++l){if(r.encryptedContent[l].type!==B.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");o+=r.encryptedContent[l].value}else o=r.encryptedContent;s.encryptedContent={algorithm:B.derToOid(r.encAlgorithm),parameter:le.util.createBuffer(r.encParameter.value),content:le.util.createBuffer(o)}}if(r.content){var o="";if(le.util.isArray(r.content))for(var l=0;l<r.content.length;++l){if(r.content[l].type!==B.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");o+=r.content[l].value}else o=r.content;s.content=le.util.createBuffer(o)}return s.version=r.version.charCodeAt(0),s.rawCapture=r,r}function Ky(s){if(s.encryptedContent.key===void 0)throw new Error("Symmetric key not available.");if(s.content===void 0){var e;switch(s.encryptedContent.algorithm){case le.pki.oids["aes128-CBC"]:case le.pki.oids["aes192-CBC"]:case le.pki.oids["aes256-CBC"]:e=le.aes.createDecryptionCipher(s.encryptedContent.key);break;case le.pki.oids.desCBC:case le.pki.oids["des-EDE3-CBC"]:e=le.des.createDecryptionCipher(s.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+s.encryptedContent.algorithm)}if(e.start(s.encryptedContent.parameter),e.update(s.encryptedContent.content),!e.finish())throw new Error("Symmetric decryption failed.");s.content=e.output}}var Mt=Fe,id=Mt.ssh=Mt.ssh||{};id.privateKeyToPutty=function(s,e,t){t=t||"",e=e||"";var r="ssh-rsa",a=e===""?"none":"aes256-cbc",n="PuTTY-User-Key-File-2: "+r+`\r
`;n+="Encryption: "+a+`\r
`,n+="Comment: "+t+`\r
`;var i=Mt.util.createBuffer();Gl(i,r),As(i,s.e),As(i,s.n);var o=Mt.util.encode64(i.bytes(),64),l=Math.floor(o.length/66)+1;n+="Public-Lines: "+l+`\r
`,n+=o;var u=Mt.util.createBuffer();As(u,s.d),As(u,s.p),As(u,s.q),As(u,s.qInv);var c;if(!e)c=Mt.util.encode64(u.bytes(),64);else{var f=u.length()+16-1;f-=f%16;var g=dh(u.bytes());g.truncate(g.length()-f+u.length()),u.putBuffer(g);var v=Mt.util.createBuffer();v.putBuffer(dh("\0\0\0\0",e)),v.putBuffer(dh("\0\0\0",e));var p=Mt.aes.createEncryptionCipher(v.truncate(8),"CBC");p.start(Mt.util.createBuffer().fillWithByte(0,16)),p.update(u.copy()),p.finish();var h=p.output;h.truncate(16),c=Mt.util.encode64(h.bytes(),64)}l=Math.floor(c.length/66)+1,n+=`\r
Private-Lines: `+l+`\r
`,n+=c;var d=dh("putty-private-key-file-mac-key",e),y=Mt.util.createBuffer();Gl(y,r),Gl(y,a),Gl(y,t),y.putInt32(i.length()),y.putBuffer(i),y.putInt32(u.length()),y.putBuffer(u);var E=Mt.hmac.create();return E.start("sha1",d),E.update(y.bytes()),n+=`\r
Private-MAC: `+E.digest().toHex()+`\r
`,n};id.publicKeyToOpenSSH=function(s,e){var t="ssh-rsa";e=e||"";var r=Mt.util.createBuffer();return Gl(r,t),As(r,s.e),As(r,s.n),t+" "+Mt.util.encode64(r.bytes())+" "+e};id.privateKeyToOpenSSH=function(s,e){return e?Mt.pki.encryptRsaPrivateKey(s,e,{legacy:!0,algorithm:"aes128"}):Mt.pki.privateKeyToPem(s)};id.getPublicKeyFingerprint=function(s,e){e=e||{};var t=e.md||Mt.md.md5.create(),r="ssh-rsa",a=Mt.util.createBuffer();Gl(a,r),As(a,s.e),As(a,s.n),t.start(),t.update(a.getBytes());var n=t.digest();if(e.encoding==="hex"){var i=n.toHex();return e.delimiter?i.match(/.{2}/g).join(e.delimiter):i}else{if(e.encoding==="binary")return n.getBytes();if(e.encoding)throw new Error('Unknown encoding "'+e.encoding+'".')}return n};function As(s,e){var t=e.toString(16);t[0]>="8"&&(t="00"+t);var r=Mt.util.hexToBytes(t);s.putInt32(r.length),s.putBytes(r)}function Gl(s,e){s.putInt32(e.length),s.putString(e)}function dh(){for(var s=Mt.md.sha1.create(),e=arguments.length,t=0;t<e;++t)s.update(arguments[t]);return s.digest()}(function(s){s.exports=Fe})(Yp);const Ar=_1(Yp.exports);/*!
 * MIT License
 * 
 * Copyright (c) 2017-2022 Peculiar Ventures, LLC
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const bA="[object ArrayBuffer]";class Ee{static isArrayBuffer(e){return Object.prototype.toString.call(e)===bA}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const r=Ee.toUint8Array(e),a=Ee.toUint8Array(t);if(r.length!==a.byteLength)return!1;for(let n=0;n<r.length;n++)if(r[n]!==a[n])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let r=0;for(const i of t)r+=i.byteLength;const a=new Uint8Array(r);let n=0;for(const i of t){const o=this.toUint8Array(i);a.set(o,n),n+=o.length}return e[e.length-1]instanceof Function?this.toView(a,e[e.length-1]):a.buffer}}const Sd="string",kA=/^[0-9a-f]+$/i,IA=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,BA=/^[a-zA-Z0-9-_]+$/;class lp{static fromString(e){const t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length);for(let a=0;a<t.length;a++)r[a]=t.charCodeAt(a);return r.buffer}static toString(e){const t=Ee.toUint8Array(e);let r="";for(let n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return decodeURIComponent(escape(r))}}class ys{static toString(e,t=!1){const r=Ee.toArrayBuffer(e),a=new DataView(r);let n="";for(let i=0;i<r.byteLength;i+=2){const o=a.getUint16(i,t);n+=String.fromCharCode(o)}return n}static fromString(e,t=!1){const r=new ArrayBuffer(e.length*2),a=new DataView(r);for(let n=0;n<e.length;n++)a.setUint16(n*2,e.charCodeAt(n),t);return r}}class ke{static isHex(e){return typeof e===Sd&&kA.test(e)}static isBase64(e){return typeof e===Sd&&IA.test(e)}static isBase64Url(e){return typeof e===Sd&&BA.test(e)}static ToString(e,t="utf8"){const r=Ee.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return ys.toString(r,!0);case"utf16":case"utf16be":return ys.toString(r);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return ys.fromString(e,!0);case"utf16":case"utf16be":return ys.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=Ee.toUint8Array(e);if(typeof btoa<"u"){const r=this.ToString(t,"binary");return btoa(r)}else return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!ke.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!ke.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=ke.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return lp.fromString(e);case"utf16":case"utf16be":return ys.fromString(e);case"utf16le":case"usc2":return ys.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=ke.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return lp.toString(e);case"utf16":case"utf16be":return ys.toString(e);case"utf16le":case"usc2":return ys.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,r=new Uint8Array(t);for(let a=0;a<t;a++)r[a]=e.charCodeAt(a);return r.buffer}static ToBinary(e){const t=Ee.toUint8Array(e);let r="";for(let a=0;a<t.length;a++)r+=String.fromCharCode(t[a]);return r}static ToHex(e){const t=Ee.toUint8Array(e);let r="";const a=t.length;for(let n=0;n<a;n++){const i=t[n];i<16&&(r+="0"),r+=i.toString(16)}return r}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!ke.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const r=new Uint8Array(t.length/2);for(let a=0;a<t.length;a=a+2){const n=t.slice(a,a+2);r[a/2]=parseInt(n,16)}return r.buffer}static ToUtf16String(e,t=!1){return ys.toString(e,t)}static FromUtf16String(e,t=!1){return ys.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let r=0;r<t;r++)e+="=";return e}static formatString(e){return(e==null?void 0:e.replace(/[\n\r\t ]/g,""))||""}}ke.DEFAULT_UTF8_ENCODING="utf8";/*!
 Copyright (c) Peculiar Ventures, LLC
*/function m(s,e,t){var r;return s instanceof Object&&(r=s[e])!==null&&r!==void 0?r:t}function up(s,e=0,t=s.byteLength-e,r=!1){let a="";for(const n of new Uint8Array(s,e,t)){const i=n.toString(16).toUpperCase();i.length===1&&(a+="0"),a+=i,r&&(a+=" ")}return a.trim()}function ao(s,e){let t=0;if(s.length===1)return s[0];for(let r=s.length-1;r>=0;r--)t+=s[s.length-1-r]*Math.pow(2,e*r);return t}function fa(s,e,t=-1){const r=t;let a=s,n=0,i=Math.pow(2,e);for(let o=1;o<8;o++){if(s<i){let l;if(r<0)l=new ArrayBuffer(o),n=o;else{if(r<o)return new ArrayBuffer(0);l=new ArrayBuffer(r),n=r}const u=new Uint8Array(l);for(let c=o-1;c>=0;c--){const f=Math.pow(2,c*e);u[n-c-1]=Math.floor(a/f),a-=u[n-c-1]*f}return l}i*=Math.pow(2,e)}return new ArrayBuffer(0)}function Ql(...s){let e=0,t=0;for(const n of s)e+=n.byteLength;const r=new ArrayBuffer(e),a=new Uint8Array(r);for(const n of s)a.set(new Uint8Array(n),t),t+=n.byteLength;return r}function mg(...s){let e=0,t=0;for(const n of s)e+=n.length;const r=new ArrayBuffer(e),a=new Uint8Array(r);for(const n of s)a.set(n,t),t+=n.length;return a}function My(){const s=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const o=s[0]===255&&s[1]&128,l=s[0]===0&&(s[1]&128)===0;(o||l)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let o=0;o<this.valueHex.byteLength;o++)t[o]=0;t[0]=s[0]&128;const r=ao(t,8),a=new ArrayBuffer(this.valueHex.byteLength),n=new Uint8Array(a);for(let o=0;o<this.valueHex.byteLength;o++)n[o]=s[o];return n[0]&=127,ao(n,8)-r}function xA(s){const e=s<0?s*-1:s;let t=128;for(let r=1;r<8;r++){if(e<=t){if(s<0){const i=t-e,o=fa(i,8,r),l=new Uint8Array(o);return l[0]|=128,o}let a=fa(e,8,r),n=new Uint8Array(a);if(n[0]&128){const i=a.slice(0),o=new Uint8Array(i);a=new ArrayBuffer(a.byteLength+1),n=new Uint8Array(a);for(let l=0;l<i.byteLength;l++)n[l+1]=o[l];n[0]=0}return a}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function ou(s,e){if(s.byteLength!==e.byteLength)return!1;const t=new Uint8Array(s),r=new Uint8Array(e);for(let a=0;a<t.length;a++)if(t[a]!==r[a])return!1;return!0}function $r(s,e){const t=s.toString(10);if(e<t.length)return"";const r=e-t.length,a=new Array(r);for(let i=0;i<r;i++)a[i]="0";return a.join("").concat(t)}const Hy="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Fy="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function pg(s,e=!1,t=!1,r=!1){let a=0,n=0,i=0,o="";const l=e?Fy:Hy;if(r){let u=0;for(let c=0;c<s.length;c++)if(s.charCodeAt(c)!==0){u=c;break}s=s.slice(u)}for(;a<s.length;){const u=s.charCodeAt(a++);a>=s.length&&(n=1);const c=s.charCodeAt(a++);a>=s.length&&(i=1);const f=s.charCodeAt(a++),g=u>>2,v=(u&3)<<4|c>>4;let p=(c&15)<<2|f>>6,h=f&63;n===1?p=h=64:i===1&&(h=64),t?p===64?o+=`${l.charAt(g)}${l.charAt(v)}`:h===64?o+=`${l.charAt(g)}${l.charAt(v)}${l.charAt(p)}`:o+=`${l.charAt(g)}${l.charAt(v)}${l.charAt(p)}${l.charAt(h)}`:o+=`${l.charAt(g)}${l.charAt(v)}${l.charAt(p)}${l.charAt(h)}`}return o}function Hf(s,e=!1,t=!1){const r=e?Fy:Hy;function a(l){for(let u=0;u<64;u++)if(r.charAt(u)===l)return u;return 64}function n(l){return l===64?0:l}let i=0,o="";for(;i<s.length;){const l=a(s.charAt(i++)),u=i>=s.length?0:a(s.charAt(i++)),c=i>=s.length?0:a(s.charAt(i++)),f=i>=s.length?0:a(s.charAt(i++)),g=n(l)<<2|n(u)>>4,v=(n(u)&15)<<4|n(c)>>2,p=(n(c)&3)<<6|n(f);o+=String.fromCharCode(g),c!==64&&(o+=String.fromCharCode(v)),f!==64&&(o+=String.fromCharCode(p))}if(t){const l=o.length;let u=-1;for(let c=l-1;c>=0;c--)if(o.charCodeAt(c)!==0){u=c;break}u!==-1?o=o.slice(0,u+1):o=""}return o}function R0(s){let e="";const t=new Uint8Array(s);for(const r of t)e+=String.fromCharCode(r);return e}function lu(s){const e=s.length,t=new ArrayBuffer(e),r=new Uint8Array(t);for(let a=0;a<e;a++)r[a]=s.charCodeAt(a);return t}const NA=Math.log(2);function TA(s){const e=Math.log(s)/NA,t=Math.floor(e),r=Math.round(e);return t===r?t:r}function W(s,e){for(const t of e)delete s[t]}/*!
 * Copyright (c) 2014, GMO GlobalSign
 * Copyright (c) 2015-2022, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */function V0(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function um(s){let e=0,t=0;for(let a=0;a<s.length;a++){const n=s[a];e+=n.byteLength}const r=new Uint8Array(e);for(let a=0;a<s.length;a++){const n=s[a];r.set(new Uint8Array(n),t),t+=n.byteLength}return r.buffer}function ha(s,e,t,r){return e instanceof Uint8Array?e.byteLength?t<0?(s.error="Wrong parameter: inputOffset less than zero",!1):r<0?(s.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-r<0?(s.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(s.error="Wrong parameter: inputBuffer has zero length",!1):(s.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class cm{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return um(this.items)}}const Eu=[new Uint8Array([1])],cp="0123456789",Cd="name",fp="valueHexView",RA="isHexOnly",VA="idBlock",_A="tagClass",$A="tagNumber",DA="isConstructed",LA="fromBER",OA="toBER",PA="local",br="",ms=new ArrayBuffer(0),od=new Uint8Array(0),Ff="EndOfContent",qy="OCTET STRING",Jy="BIT STRING";function da(s){var e;return e=class extends s{constructor(...r){var a;super(...r);const n=r[0]||{};this.isHexOnly=(a=n.isHexOnly)!==null&&a!==void 0?a:!1,this.valueHexView=n.valueHex?Ee.toUint8Array(n.valueHex):od}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(r){this.valueHexView=new Uint8Array(r)}fromBER(r,a,n){const i=r instanceof ArrayBuffer?new Uint8Array(r):r;if(!ha(this,i,a,n))return-1;const o=a+n;return this.valueHexView=i.subarray(a,o),this.valueHexView.length?(this.blockLength=n,o):(this.warnings.push("Zero buffer length"),a)}toBER(r=!1){return this.isHexOnly?r?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",ms)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:ke.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}class uo{constructor({blockLength:e=0,error:t=br,warnings:r=[],valueBeforeDecode:a=od}={}){this.blockLength=e,this.error=t,this.warnings=r,this.valueBeforeDecodeView=Ee.toUint8Array(a)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:ke.ToHex(this.valueBeforeDecodeView)}}}uo.NAME="baseBlock";class xr extends uo{fromBER(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}xr.NAME="valueBlock";class Gy extends da(uo){constructor({idBlock:e={}}={}){var t,r,a,n;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?Ee.toUint8Array(e.valueHex):od,this.tagClass=(r=e.tagClass)!==null&&r!==void 0?r:-1,this.tagNumber=(a=e.tagNumber)!==null&&a!==void 0?a:-1,this.isConstructed=(n=e.isConstructed)!==null&&n!==void 0?n:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",ms}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const a=new Uint8Array(1);if(!e){let n=this.tagNumber;n&=31,t|=n,a[0]=t}return a.buffer}if(!this.isHexOnly){const a=fa(this.tagNumber,7),n=new Uint8Array(a),i=a.byteLength,o=new Uint8Array(i+1);if(o[0]=t|31,!e){for(let l=0;l<i-1;l++)o[l+1]=n[l]|128;o[i]=n[i-1]}return o.buffer}const r=new Uint8Array(this.valueHexView.byteLength+1);if(r[0]=t|31,!e){const a=this.valueHexView;for(let n=0;n<a.length-1;n++)r[n+1]=a[n]|128;r[this.valueHexView.byteLength]=a[a.length-1]}return r.buffer}fromBER(e,t,r){const a=Ee.toUint8Array(e);if(!ha(this,a,t,r))return-1;const n=a.subarray(t,t+r);if(n.length===0)return this.error="Zero buffer length",-1;switch(n[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(n[0]&32)===32,this.isHexOnly=!1;const o=n[0]&31;if(o!==31)this.tagNumber=o,this.blockLength=1;else{let l=1,u=this.valueHexView=new Uint8Array(255),c=255;for(;n[l]&128;){if(u[l-1]=n[l]&127,l++,l>=n.length)return this.error="End of input reached before message was fully decoded",-1;if(l===c){c+=255;const g=new Uint8Array(c);for(let v=0;v<u.length;v++)g[v]=u[v];u=this.valueHexView=new Uint8Array(c)}}this.blockLength=l+1,u[l-1]=n[l]&127;const f=new Uint8Array(l);for(let g=0;g<l;g++)f[g]=u[g];u=this.valueHexView=new Uint8Array(l),u.set(f),this.blockLength<=9?this.tagNumber=ao(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}Gy.NAME="identificationBlock";class jy extends uo{constructor({lenBlock:e={}}={}){var t,r,a;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(r=e.longFormUsed)!==null&&r!==void 0?r:!1,this.length=(a=e.length)!==null&&a!==void 0?a:0}fromBER(e,t,r){const a=Ee.toUint8Array(e);if(!ha(this,a,t,r))return-1;const n=a.subarray(t,t+r);if(n.length===0)return this.error="Zero buffer length",-1;if(n[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=n[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(n[0]&128),this.longFormUsed===!1)return this.length=n[0],this.blockLength=1,t+this.blockLength;const i=n[0]&127;if(i>8)return this.error="Too big integer",-1;if(i+1>n.length)return this.error="End of input reached before message was fully decoded",-1;const o=t+1,l=a.subarray(o,o+i);return l[i-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=ao(l,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=i+1,t+this.blockLength}toBER(e=!1){let t,r;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(r=new Uint8Array(t),r[0]=128),t;if(this.longFormUsed){const a=fa(this.length,8);if(a.byteLength>127)return this.error="Too big length",ms;if(t=new ArrayBuffer(a.byteLength+1),e)return t;const n=new Uint8Array(a);r=new Uint8Array(t),r[0]=a.byteLength|128;for(let i=0;i<a.byteLength;i++)r[i+1]=n[i];return t}return t=new ArrayBuffer(1),e===!1&&(r=new Uint8Array(t),r[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}jy.NAME="lengthBlock";const ge={};class Cr extends uo{constructor({name:e=br,optional:t=!1,primitiveSchema:r,...a}={},n){super(a),this.name=e,this.optional=t,r&&(this.primitiveSchema=r),this.idBlock=new Gy(a),this.lenBlock=new jy(a),this.valueBlock=n?new n(a):new xr(a)}fromBER(e,t,r){const a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return a===-1?(this.error=this.valueBlock.error,a):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}toBER(e,t){const r=t||new cm;t||Wy(this);const a=this.idBlock.toBER(e);if(r.write(a),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{const n=this.valueBlock.toBER(e);this.lenBlock.length=n.byteLength;const i=this.lenBlock.toBER(e);r.write(i),r.write(n)}return t?ms:r.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():ke.ToHex(this.toBER())}onAsciiEncoding(){return`${this.constructor.NAME} : ${ke.ToHex(this.valueBlock.valueBeforeDecodeView)}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;const t=this.toBER(),r=e.toBER();return ou(t,r)}}Cr.NAME="BaseBlock";function Wy(s){if(s instanceof ge.Constructed)for(const e of s.valueBlock.value)Wy(e)&&(s.lenBlock.isIndefiniteForm=!0);return!!s.lenBlock.isIndefiniteForm}class Qy extends Cr{constructor({value:e=br,...t}={},r){super(t,r),e&&this.fromString(e)}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}fromBER(e,t,r){const a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return a===-1?(this.error=this.valueBlock.error,a):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}Qy.NAME="BaseStringBlock";class Yy extends da(xr){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}Yy.NAME="PrimitiveValueBlock";var zy;class Ie extends Cr{constructor(e={}){super(e,Yy),this.idBlock.isConstructed=!1}}zy=Ie;ge.Primitive=zy;Ie.NAME="PRIMITIVE";function UA(s,e){if(s instanceof e)return s;const t=new e;return t.idBlock=s.idBlock,t.lenBlock=s.lenBlock,t.warnings=s.warnings,t.valueBeforeDecodeView=s.valueBeforeDecodeView,t}function oh(s,e=0,t=s.length){const r=e;let a=new Cr({},xr);const n=new uo;if(!ha(n,s,e,t))return a.error=n.error,{offset:-1,result:a};if(!s.subarray(e,e+t).length)return a.error="Zero buffer length",{offset:-1,result:a};let o=a.idBlock.fromBER(s,e,t);if(a.idBlock.warnings.length&&a.warnings.concat(a.idBlock.warnings),o===-1)return a.error=a.idBlock.error,{offset:-1,result:a};if(e=o,t-=a.idBlock.blockLength,o=a.lenBlock.fromBER(s,e,t),a.lenBlock.warnings.length&&a.warnings.concat(a.lenBlock.warnings),o===-1)return a.error=a.lenBlock.error,{offset:-1,result:a};if(e=o,t-=a.lenBlock.blockLength,!a.idBlock.isConstructed&&a.lenBlock.isIndefiniteForm)return a.error="Indefinite length form used for primitive encoding form",{offset:-1,result:a};let l=Cr;switch(a.idBlock.tagClass){case 1:if(a.idBlock.tagNumber>=37&&a.idBlock.isHexOnly===!1)return a.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:a};switch(a.idBlock.tagNumber){case 0:if(a.idBlock.isConstructed&&a.lenBlock.length>0)return a.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:a};l=ge.EndOfContent;break;case 1:l=ge.Boolean;break;case 2:l=ge.Integer;break;case 3:l=ge.BitString;break;case 4:l=ge.OctetString;break;case 5:l=ge.Null;break;case 6:l=ge.ObjectIdentifier;break;case 10:l=ge.Enumerated;break;case 12:l=ge.Utf8String;break;case 13:l=ge.RelativeObjectIdentifier;break;case 14:l=ge.TIME;break;case 15:return a.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:a};case 16:l=ge.Sequence;break;case 17:l=ge.Set;break;case 18:l=ge.NumericString;break;case 19:l=ge.PrintableString;break;case 20:l=ge.TeletexString;break;case 21:l=ge.VideotexString;break;case 22:l=ge.IA5String;break;case 23:l=ge.UTCTime;break;case 24:l=ge.GeneralizedTime;break;case 25:l=ge.GraphicString;break;case 26:l=ge.VisibleString;break;case 27:l=ge.GeneralString;break;case 28:l=ge.UniversalString;break;case 29:l=ge.CharacterString;break;case 30:l=ge.BmpString;break;case 31:l=ge.DATE;break;case 32:l=ge.TimeOfDay;break;case 33:l=ge.DateTime;break;case 34:l=ge.Duration;break;default:{const u=a.idBlock.isConstructed?new ge.Constructed:new ge.Primitive;u.idBlock=a.idBlock,u.lenBlock=a.lenBlock,u.warnings=a.warnings,a=u}}break;case 2:case 3:case 4:default:l=a.idBlock.isConstructed?ge.Constructed:ge.Primitive}return a=UA(a,l),o=a.fromBER(s,e,a.lenBlock.isIndefiniteForm?t:a.lenBlock.length),a.valueBeforeDecodeView=s.subarray(r,r+a.blockLength),{offset:o,result:a}}function Lt(s){if(!s.byteLength){const e=new Cr({},xr);return e.error="Input buffer has zero length",{offset:-1,result:e}}return oh(Ee.toUint8Array(s).slice(),0,s.byteLength)}function KA(s,e){return s?1:e}class Cn extends xr{constructor({value:e=[],isIndefiniteForm:t=!1,...r}={}){super(r),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,r){const a=Ee.toUint8Array(e);if(!ha(this,a,t,r))return-1;if(this.valueBeforeDecodeView=a.subarray(t,t+r),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let n=t;for(;KA(this.isIndefiniteForm,r)>0;){const i=oh(a,n,r);if(i.offset===-1)return this.error=i.result.error,this.warnings.concat(i.result.warnings),-1;if(n=i.offset,this.blockLength+=i.result.blockLength,r-=i.result.blockLength,this.value.push(i.result),this.isIndefiniteForm&&i.result.constructor.NAME===Ff)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===Ff?this.value.pop():this.warnings.push("No EndOfContent block encoded")),n}toBER(e,t){const r=t||new cm;for(let a=0;a<this.value.length;a++)this.value[a].toBER(e,r);return t?ms:r.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}Cn.NAME="ConstructedValueBlock";var Xy;class N extends Cr{constructor(e={}){super(e,Cn),this.idBlock.isConstructed=!0}fromBER(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return a===-1?(this.error=this.valueBlock.error,a):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}onAsciiEncoding(){const e=[];for(const r of this.valueBlock.value)e.push(r.toString("ascii").split(`
`).map(a=>`  ${a}`).join(`
`));const t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}}Xy=N;ge.Constructed=Xy;N.NAME="CONSTRUCTED";class Zy extends xr{fromBER(e,t,r){return t}toBER(e){return ms}}Zy.override="EndOfContentValueBlock";var ev;class tv extends Cr{constructor(e={}){super(e,Zy),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}ev=tv;ge.EndOfContent=ev;tv.NAME=Ff;var rv;class xt extends Cr{constructor(e={}){super(e,xr),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}toBER(e,t){const r=new ArrayBuffer(2);if(!e){const a=new Uint8Array(r);a[0]=5,a[1]=0}return t&&t.write(r),r}onAsciiEncoding(){return`${this.constructor.NAME}`}}rv=xt;ge.Null=rv;xt.NAME="NULL";class sv extends da(xr){constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=Ee.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}fromBER(e,t,r){const a=Ee.toUint8Array(e);return ha(this,a,t,r)?(this.valueHexView=a.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,My.call(this),this.blockLength=r,t+r):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}sv.NAME="BooleanValueBlock";var av;class Ds extends Cr{constructor(e={}){super(e,sv),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}}av=Ds;ge.Boolean=av;Ds.NAME="BOOLEAN";class nv extends da(Cn){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,r){let a=0;if(this.isConstructed){if(this.isHexOnly=!1,a=Cn.prototype.fromBER.call(this,e,t,r),a===-1)return a;for(let n=0;n<this.value.length;n++){const i=this.value[n].constructor.NAME;if(i===Ff){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(i!==qy)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,a=super.fromBER(e,t,r),this.blockLength=r;return a}toBER(e,t){return this.isConstructed?Cn.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}nv.NAME="OctetStringValueBlock";var iv;class z extends Cr{constructor({idBlock:e={},lenBlock:t={},...r}={}){var a,n;(a=r.isConstructed)!==null&&a!==void 0||(r.isConstructed=!!(!((n=r.value)===null||n===void 0)&&n.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},nv),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,r===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const n=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+r);try{if(n.byteLength){const i=oh(n,0,n.byteLength);i.offset!==-1&&i.offset===r&&(this.valueBlock.value=[i.result])}}catch{}}return super.fromBER(e,t,r)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?N.prototype.onAsciiEncoding.call(this):`${this.constructor.NAME} : ${ke.ToHex(this.valueBlock.valueHexView)}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof z&&e.push(t.valueBlock.valueHexView);return Ee.concat(e)}}iv=z;ge.OctetString=iv;z.NAME=qy;class ov extends da(Cn){constructor({unusedBits:e=0,isConstructed:t=!1,...r}={}){super(r),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,r){if(!r)return t;let a=-1;if(this.isConstructed){if(a=Cn.prototype.fromBER.call(this,e,t,r),a===-1)return a;for(const o of this.value){const l=o.constructor.NAME;if(l===Ff){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(l!==Jy)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const u=o.valueBlock;if(this.unusedBits>0&&u.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=u.unusedBits}return a}const n=Ee.toUint8Array(e);if(!ha(this,n,t,r))return-1;const i=n.subarray(t,t+r);if(this.unusedBits=i[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const o=i.subarray(1);try{if(o.byteLength){const l=oh(o,0,o.byteLength);l.offset!==-1&&l.offset===r-1&&(this.value=[l.result])}}catch{}}return this.valueHexView=i.subarray(1),this.blockLength=i.length,t+r}toBER(e,t){if(this.isConstructed)return Cn.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return ms;const r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}ov.NAME="BitStringValueBlock";var lv;class He extends Cr{constructor({idBlock:e={},lenBlock:t={},...r}={}){var a,n;(a=r.isConstructed)!==null&&a!==void 0||(r.isConstructed=!!(!((n=r.value)===null||n===void 0)&&n.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},ov),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return N.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const a of t)e.push(a.toString(2).padStart(8,"0"));const r=e.join("");return`${this.constructor.NAME} : ${r.substring(0,r.length-this.valueBlock.unusedBits)}`}}}lv=He;ge.BitString=lv;He.NAME=Jy;var uv;function MA(s,e){const t=new Uint8Array([0]),r=new Uint8Array(s),a=new Uint8Array(e);let n=r.slice(0);const i=n.length-1,o=a.slice(0),l=o.length-1;let u=0;const c=l<i?i:l;let f=0;for(let g=c;g>=0;g--,f++){switch(!0){case f<o.length:u=n[i-f]+o[l-f]+t[0];break;default:u=n[i-f]+t[0]}switch(t[0]=u/10,!0){case f>=n.length:n=mg(new Uint8Array([u%10]),n);break;default:n[i-f]=u%10}}return t[0]>0&&(n=mg(t,n)),n}function hp(s){if(s>=Eu.length)for(let e=Eu.length;e<=s;e++){const t=new Uint8Array([0]);let r=Eu[e-1].slice(0);for(let a=r.length-1;a>=0;a--){const n=new Uint8Array([(r[a]<<1)+t[0]]);t[0]=n[0]/10,r[a]=n[0]%10}t[0]>0&&(r=mg(t,r)),Eu.push(r)}return Eu[s]}function HA(s,e){let t=0;const r=new Uint8Array(s),a=new Uint8Array(e),n=r.slice(0),i=n.length-1,o=a.slice(0),l=o.length-1;let u,c=0;for(let f=l;f>=0;f--,c++)switch(u=n[i-c]-o[l-c]-t,!0){case u<0:t=1,n[i-c]=u+10;break;default:t=0,n[i-c]=u}if(t>0)for(let f=i-l+1;f>=0;f--,c++)if(u=n[i-c]-t,u<0)t=1,n[i-c]=u+10;else{t=0,n[i-c]=u;break}return n.slice()}class fm extends da(xr){constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=My.call(this)))}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(xA(e))}get valueDec(){return this._valueDec}fromDER(e,t,r,a=0){const n=this.fromBER(e,t,r);if(n===-1)return n;const i=this.valueHexView;return i[0]===0&&(i[1]&128)!==0?this.valueHexView=i.subarray(1):a!==0&&i.length<a&&(a-i.length>1&&(a=i.length+1),this.valueHexView=i.subarray(a-i.length)),n}toDER(e=!1){const t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{const r=new Uint8Array(this.valueHexView.length+1);r[0]=0,r.set(t,1),this.valueHexView=r}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,r){const a=super.fromBER(e,t,r);return a===-1||this.setValueHex(),a}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=this.valueHexView.length*8-1;let t=new Uint8Array(this.valueHexView.length*8/3),r=0,a;const n=this.valueHexView;let i="",o=!1;for(let l=n.byteLength-1;l>=0;l--){a=n[l];for(let u=0;u<8;u++){if((a&1)===1)switch(r){case e:t=HA(hp(r),t),i="-";break;default:t=MA(t,hp(r))}r++,a>>=1}}for(let l=0;l<t.length;l++)t[l]&&(o=!0),o&&(i+=cp.charAt(t[l]));return o===!1&&(i+=cp.charAt(0)),i}}uv=fm;fm.NAME="IntegerValueBlock";Object.defineProperty(uv.prototype,"valueHex",{set:function(s){this.valueHexView=new Uint8Array(s),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var cv;class _ extends Cr{constructor(e={}){super(e,fm),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return V0(),BigInt(this.valueBlock.toString())}static fromBigInt(e){V0();const t=BigInt(e),r=new cm,a=t.toString(16).replace(/^-/,""),n=new Uint8Array(ke.FromHex(a));if(t<0){const o=new Uint8Array(n.length+(n[0]&128?1:0));o[0]|=128;const u=BigInt(`0x${ke.ToHex(o)}`)+t,c=Ee.toUint8Array(ke.FromHex(u.toString(16)));c[0]|=128,r.write(c)}else n[0]&128&&r.write(new Uint8Array([0])),r.write(n);return new _({valueHex:r.final()})}convertToDER(){const e=new _({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new _({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}cv=_;ge.Integer=cv;_.NAME="INTEGER";var fv;class no extends _{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}fv=no;ge.Enumerated=fv;no.NAME="ENUMERATED";class yg extends da(xr){constructor({valueDec:e=-1,isFirstSid:t=!1,...r}={}){super(r),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,r){if(!r)return t;const a=Ee.toUint8Array(e);if(!ha(this,a,t,r))return-1;const n=a.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let o=0;o<r&&(this.valueHexView[o]=n[o]&127,this.blockLength++,(n[o]&128)!==0);o++);const i=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength;o++)i[o]=this.valueHexView[o];return this.valueHexView=i,(n[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=ao(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){V0();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const r=new Uint8Array(t.length/7);for(let a=0;a<r.length;a++)r[a]=parseInt(t.slice(a*7,a*7+7),2)+(a+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const a=this.valueHexView,n=new Uint8Array(this.blockLength);for(let i=0;i<this.blockLength-1;i++)n[i]=a[i]|128;return n[this.blockLength-1]=a[this.blockLength-1],n.buffer}const t=fa(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",ms;const r=new Uint8Array(t.byteLength);if(!e){const a=new Uint8Array(t),n=t.byteLength-1;for(let i=0;i<n;i++)r[i]=a[i]|128;r[n]=a[n]}return r}toString(){let e="";if(this.isHexOnly)e=ke.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}yg.NAME="sidBlock";class hv extends xr{constructor({value:e=br,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let a=t;for(;r>0;){const n=new yg;if(a=n.fromBER(e,a,r),a===-1)return this.blockLength=0,this.error=n.error,a;this.value.length===0&&(n.isFirstSid=!0),this.blockLength+=n.blockLength,r-=n.blockLength,this.value.push(n)}return a}toBER(e){const t=[];for(let r=0;r<this.value.length;r++){const a=this.value[r].toBER(e);if(a.byteLength===0)return this.error=this.value[r].error,ms;t.push(a)}return um(t)}fromString(e){this.value=[];let t=0,r=0,a="",n=!1;do if(r=e.indexOf(".",t),r===-1?a=e.substring(t):a=e.substring(t,r),t=r+1,n){const i=this.value[0];let o=0;switch(i.valueDec){case 0:break;case 1:o=40;break;case 2:o=80;break;default:this.value=[];return}const l=parseInt(a,10);if(isNaN(l))return;i.valueDec=l+o,n=!1}else{const i=new yg;if(a>Number.MAX_SAFE_INTEGER){V0();const o=BigInt(a);i.valueBigInt=o}else if(i.valueDec=parseInt(a,10),isNaN(i.valueDec))return;this.value.length||(i.isFirstSid=!0,n=!0),this.value.push(i)}while(r!==-1)}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let a=this.value[r].toString();r!==0&&(e=`${e}.`),t?(a=`{${a}}`,this.value[r].isFirstSid?e=`2.{${a} - 80}`:e+=a):e+=a}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}hv.NAME="ObjectIdentifierValueBlock";var dv;class he extends Cr{constructor(e={}){super(e,hv),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}dv=he;ge.ObjectIdentifier=dv;he.NAME="OBJECT IDENTIFIER";class vg extends da(uo){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,r){if(r===0)return t;const a=Ee.toUint8Array(e);if(!ha(this,a,t,r))return-1;const n=a.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let o=0;o<r&&(this.valueHexView[o]=n[o]&127,this.blockLength++,(n[o]&128)!==0);o++);const i=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength;o++)i[o]=this.valueHexView[o];return this.valueHexView=i,(n[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=ao(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const a=this.valueHexView,n=new Uint8Array(this.blockLength);for(let i=0;i<this.blockLength-1;i++)n[i]=a[i]|128;return n[this.blockLength-1]=a[this.blockLength-1],n.buffer}const t=fa(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",ms;const r=new Uint8Array(t.byteLength);if(!e){const a=new Uint8Array(t),n=t.byteLength-1;for(let i=0;i<n;i++)r[i]=a[i]|128;r[n]=a[n]}return r.buffer}toString(){let e="";return this.isHexOnly?e=ke.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}vg.NAME="relativeSidBlock";class gv extends xr{constructor({value:e=br,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let a=t;for(;r>0;){const n=new vg;if(a=n.fromBER(e,a,r),a===-1)return this.blockLength=0,this.error=n.error,a;this.blockLength+=n.blockLength,r-=n.blockLength,this.value.push(n)}return a}toBER(e,t){const r=[];for(let a=0;a<this.value.length;a++){const n=this.value[a].toBER(e);if(n.byteLength===0)return this.error=this.value[a].error,ms;r.push(n)}return um(r)}fromString(e){this.value=[];let t=0,r=0,a="";do{r=e.indexOf(".",t),r===-1?a=e.substring(t):a=e.substring(t,r),t=r+1;const n=new vg;if(n.valueDec=parseInt(a,10),isNaN(n.valueDec))return!0;this.value.push(n)}while(r!==-1);return!0}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let a=this.value[r].toString();r!==0&&(e=`${e}.`),t&&(a=`{${a}}`),e+=a}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}gv.NAME="RelativeObjectIdentifierValueBlock";var mv;class pv extends Cr{constructor(e={}){super(e,gv),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}mv=pv;ge.RelativeObjectIdentifier=mv;pv.NAME="RelativeObjectIdentifier";var yv;class b extends N{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}yv=b;ge.Sequence=yv;b.NAME="SEQUENCE";var vv;class Nt extends N{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}vv=Nt;ge.Set=vv;Nt.NAME="SET";class wv extends da(xr){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=br}toJSON(){return{...super.toJSON(),value:this.value}}}wv.NAME="StringValueBlock";class Sv extends wv{}Sv.NAME="SimpleStringValueBlock";class Kr extends Qy{constructor({...e}={}){super(e,Sv)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,Ee.toUint8Array(e))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t);for(let a=0;a<t;a++)r[a]=e.charCodeAt(a);this.valueBlock.value=e}}Kr.NAME="SIMPLE STRING";class Cv extends Kr{fromBuffer(e){this.valueBlock.valueHexView=Ee.toUint8Array(e);try{this.valueBlock.value=ke.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=ke.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(ke.FromUtf8String(e)),this.valueBlock.value=e}}Cv.NAME="Utf8StringValueBlock";var Av;class gs extends Cv{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}Av=gs;ge.Utf8String=Av;gs.NAME="UTF8String";class Ev extends Kr{fromBuffer(e){this.valueBlock.value=ke.ToUtf16String(e),this.valueBlock.valueHexView=Ee.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(ke.FromUtf16String(e))}}Ev.NAME="BmpStringValueBlock";var bv;class qf extends Ev{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}bv=qf;ge.BmpString=bv;qf.NAME="BMPString";class kv extends Kr{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t);for(let a=0;a<r.length;a+=4)r[a]=r[a+3],r[a+1]=r[a+2],r[a+2]=0,r[a+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let a=0;a<t;a++){const n=fa(e.charCodeAt(a),8),i=new Uint8Array(n);if(i.length>4)continue;const o=4-i.length;for(let l=i.length-1;l>=0;l--)r[a*4+l+o]=i[l]}this.valueBlock.value=e}}kv.NAME="UniversalStringValueBlock";var Iv;class Jf extends kv{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}Iv=Jf;ge.UniversalString=Iv;Jf.NAME="UniversalString";var Bv;class Yl extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}Bv=Yl;ge.NumericString=Bv;Yl.NAME="NumericString";var xv;class fs extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}xv=fs;ge.PrintableString=xv;fs.NAME="PrintableString";var Nv;class Gf extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}Nv=Gf;ge.TeletexString=Nv;Gf.NAME="TeletexString";var Tv;class hm extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}Tv=hm;ge.VideotexString=Tv;hm.NAME="VideotexString";var Rv;class ld extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}Rv=ld;ge.IA5String=Rv;ld.NAME="IA5String";var Vv;class dm extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}Vv=dm;ge.GraphicString=Vv;dm.NAME="GraphicString";var _v;class ud extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}_v=ud;ge.VisibleString=_v;ud.NAME="VisibleString";var $v;class gm extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}$v=gm;ge.GeneralString=$v;gm.NAME="GeneralString";var Dv;class mm extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}Dv=mm;ge.CharacterString=Dv;mm.NAME="CharacterString";var Lv;class uu extends ud{constructor({value:e,valueDate:t,...r}={}){if(super(r),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let a=0;a<e.length;a++)this.valueBlock.valueHexView[a]=e.charCodeAt(a)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,Ee.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let a=0;a<e.length;a++)r[a]=e.charCodeAt(a);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const r=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(r===null){this.error="Wrong input string for conversion";return}const a=parseInt(r[1],10);a>=50?this.year=1900+a:this.year=2e3+a,this.month=parseInt(r[2],10),this.day=parseInt(r[3],10),this.hour=parseInt(r[4],10),this.minute=parseInt(r[5],10),this.second=parseInt(r[6],10)}toString(e="iso"){if(e==="iso"){const t=new Array(7);return t[0]=$r(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=$r(this.month,2),t[2]=$r(this.day,2),t[3]=$r(this.hour,2),t[4]=$r(this.minute,2),t[5]=$r(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}Lv=uu;ge.UTCTime=Lv;uu.NAME="UTCTime";var Ov;class St extends uu{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let t=!1,r="",a="",n=0,i,o=0,l=0;if(e[e.length-1]==="Z")r=e.substring(0,e.length-1),t=!0;else{const f=new Number(e[e.length-1]);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");r=e}if(t){if(r.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(r.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let f=1,g=r.indexOf("+"),v="";if(g===-1&&(g=r.indexOf("-"),f=-1),g!==-1){if(v=r.substring(g+1),r=r.substring(0,g),v.length!==2&&v.length!==4)throw new Error("Wrong input string for conversion");let p=parseInt(v.substring(0,2),10);if(isNaN(p.valueOf()))throw new Error("Wrong input string for conversion");if(o=f*p,v.length===4){if(p=parseInt(v.substring(2,4),10),isNaN(p.valueOf()))throw new Error("Wrong input string for conversion");l=f*p}}}let u=r.indexOf(".");if(u===-1&&(u=r.indexOf(",")),u!==-1){const f=new Number(`0${r.substring(u)}`);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");n=f.valueOf(),a=r.substring(0,u)}else a=r;switch(!0){case a.length===8:if(i=/(\d{4})(\d{2})(\d{2})/ig,u!==-1)throw new Error("Wrong input string for conversion");break;case a.length===10:if(i=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,u!==-1){let f=60*n;this.minute=Math.floor(f),f=60*(f-this.minute),this.second=Math.floor(f),f=1e3*(f-this.second),this.millisecond=Math.floor(f)}break;case a.length===12:if(i=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,u!==-1){let f=60*n;this.second=Math.floor(f),f=1e3*(f-this.second),this.millisecond=Math.floor(f)}break;case a.length===14:if(i=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,u!==-1){const f=1e3*n;this.millisecond=Math.floor(f)}break;default:throw new Error("Wrong input string for conversion")}const c=i.exec(a);if(c===null)throw new Error("Wrong input string for conversion");for(let f=1;f<c.length;f++)switch(f){case 1:this.year=parseInt(c[f],10);break;case 2:this.month=parseInt(c[f],10);break;case 3:this.day=parseInt(c[f],10);break;case 4:this.hour=parseInt(c[f],10)+o;break;case 5:this.minute=parseInt(c[f],10)+l;break;case 6:this.second=parseInt(c[f],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){const f=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=f.getUTCFullYear(),this.month=f.getUTCMonth(),this.day=f.getUTCDay(),this.hour=f.getUTCHours(),this.minute=f.getUTCMinutes(),this.second=f.getUTCSeconds(),this.millisecond=f.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){const t=[];return t.push($r(this.year,4)),t.push($r(this.month,2)),t.push($r(this.day,2)),t.push($r(this.hour,2)),t.push($r(this.minute,2)),t.push($r(this.second,2)),this.millisecond!==0&&(t.push("."),t.push($r(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}Ov=St;ge.GeneralizedTime=Ov;St.NAME="GeneralizedTime";var Pv;class Uv extends gs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}Pv=Uv;ge.DATE=Pv;Uv.NAME="DATE";var Kv;class Mv extends gs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}Kv=Mv;ge.TimeOfDay=Kv;Mv.NAME="TimeOfDay";var Hv;class Fv extends gs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}Hv=Fv;ge.DateTime=Hv;Fv.NAME="DateTime";var qv;class Jv extends gs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}qv=Jv;ge.Duration=qv;Jv.NAME="Duration";var Gv;class jv extends gs{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}Gv=jv;ge.TIME=Gv;jv.NAME="TIME";class xe{constructor({name:e=br,optional:t=!1}={}){this.name=e,this.optional=t}}class Ct extends xe{constructor({value:e=[],...t}={}){super(t),this.value=e}}class _e extends xe{constructor({value:e=new xe,local:t=!1,...r}={}){super(r),this.value=e,this.local=t}}class _0{constructor({data:e=od}={}){this.dataView=Ee.toUint8Array(e)}get data(){return this.dataView.slice().buffer}set data(e){this.dataView=Ee.toUint8Array(e)}fromBER(e,t,r){const a=t+r;return this.dataView=Ee.toUint8Array(e).subarray(t,a),a}toBER(e){return this.dataView.slice().buffer}}function j(s,e,t){if(t instanceof Ct){for(let n=0;n<t.value.length;n++)if(j(s,e,t.value[n]).verified)return{verified:!0,result:s};{const n={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(Cd)&&(n.name=t.name),n}}if(t instanceof xe)return t.hasOwnProperty(Cd)&&(s[t.name]=e),{verified:!0,result:s};if(!(s instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(VA in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(LA in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(OA in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const r=t.idBlock.toBER(!1);if(r.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(r,0,r.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(_A)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:s};if(t.idBlock.hasOwnProperty($A)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:s};if(t.idBlock.hasOwnProperty(DA)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:s};if(!(RA in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:s};if(t.idBlock.isHexOnly){if(!(fp in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const n=t.idBlock.valueHexView,i=e.idBlock.valueHexView;if(n.length!==i.length)return{verified:!1,result:s};for(let o=0;o<n.length;o++)if(n[o]!==i[1])return{verified:!1,result:s}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,br),t.name&&(s[t.name]=e)),t instanceof ge.Constructed){let n=0,i={verified:!1,result:{error:"Unknown error"}},o=t.valueBlock.value.length;if(o>0&&t.valueBlock.value[0]instanceof _e&&(o=e.valueBlock.value.length),o===0)return{verified:!0,result:s};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let l=!0;for(let u=0;u<t.valueBlock.value.length;u++)l=l&&(t.valueBlock.value[u].optional||!1);return l?{verified:!0,result:s}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,br),t.name&&delete s[t.name]),s.error="Inconsistent object length",{verified:!1,result:s})}for(let l=0;l<o;l++)if(l-n>=e.valueBlock.value.length){if(t.valueBlock.value[l].optional===!1){const u={verified:!1,result:s};return s.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,br),t.name&&(delete s[t.name],u.name=t.name)),u}}else if(t.valueBlock.value[0]instanceof _e){if(i=j(s,e.valueBlock.value[l],t.valueBlock.value[0].value),i.verified===!1)if(t.valueBlock.value[0].optional)n++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,br),t.name&&delete s[t.name]),i;if(Cd in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let u={};PA in t.valueBlock.value[0]&&t.valueBlock.value[0].local?u=e:u=s,typeof u[t.valueBlock.value[0].name]>"u"&&(u[t.valueBlock.value[0].name]=[]),u[t.valueBlock.value[0].name].push(e.valueBlock.value[l])}}else if(i=j(s,e.valueBlock.value[l-n],t.valueBlock.value[l]),i.verified===!1)if(t.valueBlock.value[l].optional)n++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,br),t.name&&delete s[t.name]),i;if(i.verified===!1){const l={verified:!1,result:s};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,br),t.name&&(delete s[t.name],l.name=t.name)),l}return{verified:!0,result:s}}if(t.primitiveSchema&&fp in e.valueBlock){const n=oh(e.valueBlock.valueHexView);if(n.offset===-1){const i={verified:!1,result:n.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,br),t.name&&(delete s[t.name],i.name=t.name)),i}return j(s,n.result,t.primitiveSchema)}return{verified:!0,result:s}}class bt{constructor(e={}){if("view"in e)this.fromUint8Array(e.view);else if("buffer"in e)this.fromArrayBuffer(e.buffer);else if("string"in e)this.fromString(e.string);else if("hexstring"in e)this.fromHexString(e.hexstring);else if("length"in e&&e.length>0){if(this.length=e.length,e.stub)for(let t=0;t<this._view.length;t++)this._view[t]=e.stub}else this.length=0}set buffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}get buffer(){return this._buffer}set view(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}get view(){return this._view}get length(){return this.view.byteLength}set length(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}clear(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}fromArrayBuffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}fromUint8Array(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}fromString(e){const t=e.length;this.length=t;for(let r=0;r<t;r++)this.view[r]=e.charCodeAt(r)}toString(e=0,t=this.view.length-e){let r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++)r+=String.fromCharCode(this.view[a]);return r}fromHexString(e){const t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);const r=new Map;r.set("0",0),r.set("1",1),r.set("2",2),r.set("3",3),r.set("4",4),r.set("5",5),r.set("6",6),r.set("7",7),r.set("8",8),r.set("9",9),r.set("A",10),r.set("a",10),r.set("B",11),r.set("b",11),r.set("C",12),r.set("c",12),r.set("D",13),r.set("d",13),r.set("E",14),r.set("e",14),r.set("F",15),r.set("f",15);let a=0,n=0;for(let i=0;i<t;i++)i%2?(n|=r.get(e.charAt(i)),this.view[a]=n,a++):n=r.get(e.charAt(i))<<4}toHexString(e=0,t=this.view.length-e){let r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++){const n=this.view[a].toString(16).toUpperCase();r=r+(n.length==1?"0":"")+n}return r}copy(e=0,t=this.length-e){if(!e&&!this.length)return new bt;if(e<0||e>this.length-1)throw new Error(`Wrong start position: ${e}`);return new bt({buffer:this._buffer.slice(e,e+t)})}slice(e=0,t=this.length){if(!e&&!this.length)return new bt;if(e<0||e>this.length-1)throw new Error(`Wrong start position: ${e}`);return new bt({buffer:this._buffer.slice(e,t)})}realloc(e){const t=new ArrayBuffer(e),r=new Uint8Array(t);e>this._view.length?r.set(this._view):r.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}append(e){const t=this.length,r=e.length,a=e._view.subarray();this.realloc(t+r),this._view.set(a,t)}insert(e,t=0,r=this.length-t){return t>this.length-1?!1:(r>this.length-t&&(r=this.length-t),r>e.length&&(r=e.length),r==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,r),t),!0)}isEqual(e){if(this.length!=e.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}isEqualView(e){if(e.length!=this.view.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}findPattern(e,t,r,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a),l=e.length;if(l>i)return-1;const u=[];for(let c=0;c<l;c++)u.push(e.view[c]);for(let c=0;c<=i-l;c++){let f=!0;const g=o?n-l-c:n+c;for(let v=0;v<l;v++)if(this.view[v+g]!=u[v]){f=!1;break}if(f)return o?n-l-c:n+l+c}return-1}findFirstIn(e,t,r,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a),l={id:-1,position:o?0:n+i,length:0};for(let u=0;u<e.length;u++){const c=this.findPattern(e[u],n,i,o);if(c!=-1){let f=!1;const g=e[u].length;o?c-g>=l.position-l.length&&(f=!0):c-g<=l.position-l.length&&(f=!0),f&&(l.position=c,l.id=u,l.length=g)}}return l}findAllIn(e,t,r){let{start:a,length:n}=this.prepareFindParameters(t,r);const i=[];let o={id:-1,position:a};do{const l=o.position;if(o=this.findFirstIn(e,o.position,n),o.id==-1)break;n-=o.position-l,i.push({id:o.id,position:o.position})}while(!0);return i}findAllPatternIn(e,t,r){const{start:a,length:n}=this.prepareFindParameters(t,r),i=[],o=e.length;if(o>n)return-1;const l=Array.from(e.view);for(let u=0;u<=n-o;u++){let c=!0;const f=a+u;for(let g=0;g<o;g++)if(this.view[g+f]!=l[g]){c=!1;break}c&&(i.push(a+o+u),u+=o-1)}return i}findFirstNotIn(e,t,r,a){let{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a);const l={left:{id:-1,position:n},right:{id:-1,position:0},value:new bt};let u=i;for(;u>0;){if(l.right=this.findFirstIn(e,o?n-i+u:n+i-u,u,o),l.right.id==-1){i=u,o?n-=i:n=l.left.position,l.value=new bt({buffer:this._buffer.slice(n,n+i)});break}if(l.right.position!=(o?l.left.position-e[l.right.id].length:l.left.position+e[l.right.id].length)){o?(n=l.right.position+e[l.right.id].length,i=l.left.position-l.right.position-e[l.right.id].length):(n=l.left.position,i=l.right.position-l.left.position-e[l.right.id].length),l.value=new bt({buffer:this._buffer.slice(n,n+i)});break}l.left=l.right,u-=e[l.right.id].length}if(o){const c=l.right;l.right=l.left,l.left=c}return l}findAllNotIn(e,t,r){let{start:a,length:n}=this.prepareFindParameters(t,r);const i=[];let o={left:{id:-1,position:a},right:{id:-1,position:a},value:new bt};do{const l=o.right.position;o=this.findFirstNotIn(e,o.right.position,n),n-=o.right.position-l,i.push({left:{id:o.left.id,position:o.left.position},right:{id:o.right.id,position:o.right.position},value:o.value})}while(o.right.id!=-1);return i}findFirstSequence(e,t,r,a){let{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a);const l=this.skipNotPatterns(e,n,i,o);if(l==-1)return{position:-1,value:new bt};const u=this.skipPatterns(e,l,i-(o?n-l:l-n),o);o?(n=u,i=l-u):(n=l,i=u-l);const c=new bt({buffer:this._buffer.slice(n,n+i)});return{position:u,value:c}}findAllSequences(e,t,r){let{start:a,length:n}=this.prepareFindParameters(t,r);const i=[];let o={position:a,value:new bt};do{const l=o.position;o=this.findFirstSequence(e,o.position,n),o.position!=-1&&(n-=o.position-l,i.push({position:o.position,value:o.value}))}while(o.position!=-1);return i}findPairedPatterns(e,t,r,a){const n=[];if(e.isEqual(t))return n;const{start:i,length:o}=this.prepareFindParameters(r,a);let l=0;const u=this.findAllPatternIn(e,i,o);if(!Array.isArray(u)||u.length==0)return n;const c=this.findAllPatternIn(t,i,o);if(!Array.isArray(c)||c.length==0)return n;for(;l<u.length&&c.length!=0;){if(u[0]==c[0]){n.push({left:u[0],right:c[0]}),u.splice(0,1),c.splice(0,1);continue}if(u[l]>c[0])break;for(;u[l]<c[0]&&(l++,!(l>=u.length)););n.push({left:u[l-1],right:c[0]}),u.splice(l-1,1),c.splice(0,1),l=0}return n.sort((f,g)=>f.left-g.left),n}findPairedArrays(e,t,r,a){const{start:n,length:i}=this.prepareFindParameters(r,a),o=[];let l=0;const u=this.findAllIn(e,n,i);if(u.length==0)return o;const c=this.findAllIn(t,n,i);if(c.length==0)return o;for(;l<u.length&&c.length!=0;){if(u[0].position==c[0].position){o.push({left:u[0],right:c[0]}),u.splice(0,1),c.splice(0,1);continue}if(u[l].position>c[0].position)break;for(;u[l].position<c[0].position&&(l++,!(l>=u.length)););o.push({left:u[l-1],right:c[0]}),u.splice(l-1,1),c.splice(0,1),l=0}return o.sort((f,g)=>f.left.position-g.left.position),o}replacePattern(e,t,r,a,n=null){let i=[],o;const l={status:-1,searchPatternPositions:[],replacePatternPositions:[]},{start:u,length:c}=this.prepareFindParameters(r,a);if(n==null){if(i=this.findAllIn([e],u,c),i.length==0)return l}else i=n;l.searchPatternPositions.push(...Array.from(i,p=>p.position));const f=e.length-t.length,g=new ArrayBuffer(this.view.length-i.length*f),v=new Uint8Array(g);for(v.set(new Uint8Array(this.buffer,0,u)),o=0;o<i.length;o++){const p=o==0?u:i[o-1].position;v.set(new Uint8Array(this.buffer,p,i[o].position-e.length-p),p-o*f),v.set(t.view,i[o].position-e.length-o*f),l.replacePatternPositions.push(i[o].position-e.length-o*f)}return o--,v.set(new Uint8Array(this.buffer,i[o].position,this.length-i[o].position),i[o].position-e.length+t.length-o*f),this.buffer=g,this.view=new Uint8Array(this.buffer),l.status=1,l}skipPatterns(e,t,r,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a);let l=n;for(let u=0;u<e.length;u++){const c=e[u].length,f=o?l-c:l;let g=!0;for(let v=0;v<c;v++)if(this.view[v+f]!=e[u].view[v]){g=!1;break}if(g){if(u=-1,o){if(l-=c,l<=0)return l}else if(l+=c,l>=n+i)return l}}return l}skipNotPatterns(e,t,r,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a);let l=-1;for(let u=0;u<i;u++){for(let c=0;c<e.length;c++){const f=e[c].length,g=o?n-u-f:n+u;let v=!0;for(let p=0;p<f;p++)if(this.view[p+g]!=e[c].view[p]){v=!1;break}if(v){l=o?n-u:n+u;break}}if(l!=-1)break}return l}prepareFindParameters(e=null,t=null,r=!1){return e===null&&(e=r?this.length:0),e>this.length&&(e=this.length),r?(t===null&&(t=e),t>e&&(t=e)):(t===null&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:r}}}const FA=16777216;class An{constructor(e={}){this._stream=new bt,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,"view"in e?this.stream=new bt({view:e.view}):"buffer"in e?this.stream=new bt({buffer:e.buffer}):"string"in e?this.stream=new bt({string:e.string}):"hexstring"in e?this.stream=new bt({hexstring:e.hexstring}):"stream"in e?this.stream=e.stream.slice():this.stream=new bt,"backward"in e&&e.backward&&(this.backward=e.backward,this._start=this.stream.length),"length"in e&&e.length>0&&(this._length=e.length),"start"in e&&e.start&&e.start>0&&(this._start=e.start),"appendBlock"in e&&e.appendBlock&&e.appendBlock>0&&(this.appendBlock=e.appendBlock)}set stream(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}get stream(){return this._stream}set length(e){this.prevLength=this._length,this._length=e}get length(){return this.appendBlock?this.start:this._length}set start(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}get start(){return this._start}get buffer(){return this._stream.buffer.slice(0,this._length)}resetPosition(){this._start=this.prevStart,this._length=this.prevLength}findPattern(e,t=null){(t==null||t>this.length)&&(t=this.length);const r=this.stream.findPattern(e,this.start,this.length,this.backward);if(r==-1)return r;if(this.backward){if(r<this.start-e.length-t)return-1}else if(r>this.start+e.length+t)return-1;return this.start=r,r}findFirstIn(e,t=null){(t==null||t>this.length)&&(t=this.length);const r=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(r.id==-1)return r;if(this.backward){if(r.position<this.start-e[r.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(r.position>this.start+e[r.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=r.position,r}findAllIn(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}findFirstNotIn(e,t=null){(t==null||t>this._length)&&(t=this._length);const r=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(r.left.id==-1&&r.right.id==-1)return r;if(this.backward){if(r.right.id!=-1&&r.right.position<this._start-e[r.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new bt}}else if(r.left.id!=-1&&r.left.position>this._start+e[r.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new bt};return this.backward?r.left.id==-1?this.start=0:this.start=r.left.position:r.right.id==-1?this.start=this._start+this._length:this.start=r.right.position,r}findAllNotIn(e){const t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}findFirstSequence(e,t=null,r=null){(t==null||t>this._length)&&(t=this._length),(r==null||r>t)&&(r=t);const a=this._stream.findFirstSequence(e,this._start,t,this.backward);if(a.value.length==0)return a;if(this.backward){if(a.position<this._start-a.value.length-r)return{position:-1,value:new bt}}else if(a.position>this._start+a.value.length+r)return{position:-1,value:new bt};return this.start=a.position,a}findAllSequences(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}findPairedPatterns(e,t,r=null){(r==null||r>this.length)&&(r=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedPatterns(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right<this.start-t.length-r)return[]}else if(n[0].left>this.start+e.length+r)return[]}return n}findPairedArrays(e,t,r=null){(r==null||r>this.length)&&(r=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedArrays(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right.position<this.start-t[n[0].right.id].length-r)return[]}else if(n[0].left.position>this.start+e[n[0].left.id].length+r)return[]}return n}replacePattern(e,t){const r=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,r,this.length)}skipPatterns(e){const t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}skipNotPatterns(e){const t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return t==-1?-1:(this.start=t,t)}append(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendView(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendChar(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}appendUint16(e){this.beforeAppend(2);const t=new Uint16Array([e]),r=new Uint8Array(t.buffer);this.stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendUint24(e){this.beforeAppend(3);const t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[2],this._stream.view[this._start+1]=r[1],this._stream.view[this._start+2]=r[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}appendUint32(e){this.beforeAppend(4);const t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}appendInt16(e){this.beforeAppend(2);const t=new Int16Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendInt32(e){this.beforeAppend(4);const t=new Int32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}getBlock(e,t=!0){if(this._length<=0)return new Uint8Array(0);this._length<e&&(e=this._length);let r;if(this.backward){const a=this._stream.view.subarray(this._length-e,this._length);r=new Uint8Array(e);for(let n=0;n<e;n++)r[e-1-n]=a[n]}else r=this._stream.view.subarray(this._start,this._start+e);return t&&(this.start+=this.backward?-1*e:e),r}getUint16(e=!0){const t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}getInt16(e=!0){const t=this.getUint16(e),r=32768;return t&r?-(r-(t^r)):t}getUint24(e=!0){const t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}getUint32(e=!0){const t=this.getBlock(4,e);return t.length<4?0:t[0]*FA+(t[1]<<16)+(t[2]<<8)+t[3]}getInt32(e=!0){const t=this.getUint32(e),r=2147483648;return t&r?-(r-(t^r)):t}beforeAppend(e){this._start+e>this._stream.length&&(e>this.appendBlock&&(this.appendBlock=e+An.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}An.APPEND_BLOCK=1e3;/*!
 * Copyright (c) 2014, GlobalSign
 * Copyright (c) 2015-2019, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the {organization} nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */const Ot=new ArrayBuffer(0),S="";class rt extends TypeError{constructor(){super(...arguments),this.name=rt.NAME}static isType(e,t){if(typeof t=="string"){if(t==="Array"&&Array.isArray(e))return!0;if(t==="ArrayBuffer"&&e instanceof ArrayBuffer)return!0;if(t==="ArrayBufferView"&&ArrayBuffer.isView(e))return!0;if(typeof e===t)return!0}else if(e instanceof t)return!0;return!1}static assert(e,t,...r){for(const n of r)if(this.isType(e,n))return;const a=r.map(n=>n instanceof Function&&"name"in n?n.name:`${n}`);throw new rt(`Parameter '${t}' is not of type ${a.length>1?`(${a.join(" or ")})`:a[0]}`)}}rt.NAME="ArgumentError";class Ge extends TypeError{constructor(e,t=null,r){super(),this.name=Ge.NAME,this.field=e,t&&(this.target=t),r?this.message=r:this.message=`Absent mandatory parameter '${e}' ${t?` in '${t}'`:S}`}static assert(...e){let t=null,r,a;typeof e[0]=="string"?(t=e[0],r=e[1],a=e.slice(2)):(r=e[0],a=e.slice(1)),rt.assert(r,"parameters","object");for(const n of a){const i=r[n];if(i==null)throw new Ge(n,t)}}static assertEmpty(e,t,r){if(e==null)throw new Ge(t,r)}}Ge.NAME="ParameterError";class K extends Error{static assertSchema(e,t){if(!e.verified)throw new Error(`Object's schema was not verified against input data for ${t}`)}static assert(e,t){if(e.offset===-1)throw new K(`Error during parsing of ASN.1 data. Data is not correct for '${t}'.`)}constructor(e){super(e),this.name="AsnError"}}class G{static blockName(){return this.CLASS_NAME}static fromBER(e){const t=Lt(e);K.assert(t,this.name);try{return new this({schema:t.result})}catch{throw new K(`Cannot create '${this.CLASS_NAME}' from ASN.1 object`)}}static defaultValues(e){throw new Error(`Invalid member name for ${this.CLASS_NAME} class: ${e}`)}static schema(e={}){throw new Error(`Method '${this.CLASS_NAME}.schema' should be overridden`)}get className(){return this.constructor.CLASS_NAME}toString(e="hex"){let t;try{t=this.toSchema()}catch{t=this.toSchema(!0)}return ke.ToString(t.toBER(),e)}}G.CLASS_NAME="PkiObject";function sn(s){let e=!1,t=S;const r=s.trim();for(let a=0;a<r.length;a++)r.charCodeAt(a)===32?e===!1&&(e=!0):(e&&(t+=" ",e=!1),t+=r[a]);return t.toLowerCase()}const bu="type",Ad="value";class gn extends G{constructor(e={}){super(),this.type=m(e,bu,gn.defaultValues(bu)),this.value=m(e,Ad,gn.defaultValues(Ad)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bu:return S;case Ad:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.type||S}),new xe({name:t.value||S})]})}fromSchema(e){W(e,[bu,"typeValue"]);const t=j(e,e,gn.schema({names:{type:bu,value:"typeValue"}}));K.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}toSchema(){return new b({value:[new he({value:this.type}),this.value]})}toJSON(){const e={type:this.type};return Object.keys(this.value).length!==0?e.value=this.value.toJSON():e.value=this.value,e}isEqual(e){const t=[gs.blockName(),qf.blockName(),Jf.blockName(),Yl.blockName(),fs.blockName(),Gf.blockName(),hm.blockName(),ld.blockName(),dm.blockName(),ud.blockName(),gm.blockName(),mm.blockName()];if(e instanceof ArrayBuffer)return Ee.isEqual(this.value.valueBeforeDecodeView,e);if(e.constructor.blockName()===gn.blockName()){if(this.type!==e.type)return!1;const r=[!1,!1],a=this.value.constructor.blockName();for(const i of t)a===i&&(r[0]=!0),e.value.constructor.blockName()===i&&(r[1]=!0);if(r[0]!==r[1])return!1;if(r[0]&&r[1]){const i=sn(this.value.valueBlock.value),o=sn(e.value.valueBlock.value);if(i.localeCompare(o)!==0)return!1}else if(!Ee.isEqual(this.value.valueBeforeDecodeView,e.value.valueBeforeDecodeView))return!1;return!0}return!1}}gn.CLASS_NAME="AttributeTypeAndValue";const _n="typesAndValues",gh="valueBeforeDecode",dp="RDN";class st extends G{constructor(e={}){super(),this.typesAndValues=m(e,_n,st.defaultValues(_n)),this.valueBeforeDecode=m(e,gh,st.defaultValues(gh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _n:return[];case gh:return Ot;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case _n:return t.length===0;case gh:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _e({name:t.repeatedSequence||S,value:new Nt({value:[new _e({name:t.repeatedSet||S,value:gn.schema(t.typeAndValue||{})})]})})]})}fromSchema(e){W(e,[dp,_n]);const t=j(e,e,st.schema({names:{blockName:dp,repeatedSet:_n}}));K.assertSchema(t,this.className),_n in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,r=>new gn({schema:r}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecodeView.slice().buffer}toSchema(){if(this.valueBeforeDecode.byteLength===0)return new b({value:[new Nt({value:Array.from(this.typesAndValues,t=>t.toSchema())})]});const e=Lt(this.valueBeforeDecode);if(K.assert(e,"RelativeDistinguishedNames"),!(e.result instanceof b))throw new Error("ASN.1 result should be SEQUENCE");return e.result}toJSON(){return{typesAndValues:Array.from(this.typesAndValues,e=>e.toJSON())}}isEqual(e){if(e instanceof st){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;for(const[t,r]of this.typesAndValues.entries())if(r.isEqual(e.typesAndValues[t])===!1)return!1;return!0}return e instanceof ArrayBuffer?ou(this.valueBeforeDecode,e):!1}}st.CLASS_NAME="RelativeDistinguishedNames";const Uu="type",Ku="value";function qA(s={},e=!1){const t=m(s,"names",{});return new b({optional:e,value:[new N({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:t.country_name||S,value:[new Ct({value:[new Yl,new fs]})]}),new N({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:t.administration_domain_name||S,value:[new Ct({value:[new Yl,new fs]})]}),new Ie({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:t.network_address||S,isHexOnly:!0}),new Ie({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:t.terminal_identifier||S,isHexOnly:!0}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:t.private_domain_name||S,value:[new Ct({value:[new Yl,new fs]})]}),new Ie({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:t.organization_name||S,isHexOnly:!0}),new Ie({optional:!0,name:t.numeric_user_identifier||S,idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new N({optional:!0,name:t.personal_name||S,idBlock:{tagClass:3,tagNumber:5},value:[new Ie({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new Ie({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new Ie({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new Ie({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new N({optional:!0,name:t.organizational_unit_names||S,idBlock:{tagClass:3,tagNumber:6},value:[new _e({value:new fs})]})]})}function JA(s=!1){return new b({optional:s,value:[new fs,new fs]})}function GA(s=!1){return new Nt({optional:s,value:[new Ie({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new xe]})]})}class ze extends G{constructor(e={}){super(),this.type=m(e,Uu,ze.defaultValues(Uu)),this.value=m(e,Ku,ze.defaultValues(Ku)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Uu:return 9;case Ku:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Uu:return t===ze.defaultValues(e);case Ku:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new Ct({value:[new N({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||S,value:[new he,new N({idBlock:{tagClass:3,tagNumber:0},value:[new xe]})]}),new Ie({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:1}}),new Ie({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:2}}),new N({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||S,value:[qA(t.builtInStandardAttributes||{},!1),JA(!0),GA(!0)]}),new N({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||S,value:[st.schema(t.directoryName||{})]}),new N({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||S,value:[new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ct({value:[new Gf,new fs,new Jf,new gs,new qf]})]}),new N({idBlock:{tagClass:3,tagNumber:1},value:[new Ct({value:[new Gf,new fs,new Jf,new gs,new qf]})]})]}),new Ie({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:6}}),new Ie({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:7}}),new Ie({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:8}})]})}fromSchema(e){W(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);const t=j(e,e,ze.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));switch(K.assertSchema(t,this.className),this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:this.value=t.result.blockName;break;case 1:case 2:case 6:{const r=t.result.blockName;r.idBlock.tagClass=1,r.idBlock.tagNumber=22;const a=r.toBER(!1),n=Lt(a);K.assert(n,"GeneralName value"),this.value=n.result.valueBlock.value}break;case 3:this.value=t.result.blockName;break;case 4:this.value=new st({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new z({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:{const r=t.result.blockName;r.idBlock.tagClass=1,r.idBlock.tagNumber=6;const a=r.toBER(!1),n=Lt(a);K.assert(n,"GeneralName registeredID"),this.value=n.result.valueBlock.toString()}break}}toSchema(){switch(this.type){case 0:case 3:case 5:return new N({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{const e=new ld({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 4:return new N({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{const e=this.value;return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 8:{const e=new he({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}default:return ze.schema()}}toJSON(){const e={type:this.type,value:S};if(typeof this.value=="string")e.value=this.value;else try{e.value=this.value.toJSON()}catch{}return e}}ze.CLASS_NAME="GeneralName";const Mu="accessMethod",Hu="accessLocation",jA=[Mu,Hu];class Wi extends G{constructor(e={}){super(),this.accessMethod=m(e,Mu,Wi.defaultValues(Mu)),this.accessLocation=m(e,Hu,Wi.defaultValues(Hu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mu:return S;case Hu:return new ze;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.accessMethod||S}),ze.schema(t.accessLocation||{})]})}fromSchema(e){W(e,jA);const t=j(e,e,Wi.schema({names:{accessMethod:Mu,accessLocation:{names:{blockName:Hu}}}}));K.assertSchema(t,this.className),this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new ze({schema:t.result.accessLocation})}toSchema(){return new b({value:[new he({value:this.accessMethod}),this.accessLocation.toSchema()]})}toJSON(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}Wi.CLASS_NAME="AccessDescription";const wa="seconds",Sa="millis",Ca="micros";class Dr extends G{constructor(e={}){super(),wa in e&&(this.seconds=m(e,wa,Dr.defaultValues(wa))),Sa in e&&(this.millis=m(e,Sa,Dr.defaultValues(Sa))),Ca in e&&(this.micros=m(e,Ca,Dr.defaultValues(Ca))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wa:case Sa:case Ca:return 0;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case wa:case Sa:case Ca:return t===Dr.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,optional:!0,value:[new _({optional:!0,name:t.seconds||S}),new Ie({name:t.millis||S,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Ie({name:t.micros||S,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){W(e,[wa,Sa,Ca]);const t=j(e,e,Dr.schema({names:{seconds:wa,millis:Sa,micros:Ca}}));if(K.assertSchema(t,this.className),"seconds"in t.result&&(this.seconds=t.result.seconds.valueBlock.valueDec),"millis"in t.result){const r=new _({valueHex:t.result.millis.valueBlock.valueHex});this.millis=r.valueBlock.valueDec}if("micros"in t.result){const r=new _({valueHex:t.result.micros.valueBlock.valueHex});this.micros=r.valueBlock.valueDec}}toSchema(){const e=[];if(this.seconds!==void 0&&e.push(new _({value:this.seconds})),this.millis!==void 0){const t=new _({value:this.millis});e.push(new Ie({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHexView}))}if(this.micros!==void 0){const t=new _({value:this.micros});e.push(new Ie({idBlock:{tagClass:3,tagNumber:1},valueHex:t.valueBlock.valueHexView}))}return new b({value:e})}toJSON(){const e={};return this.seconds!==void 0&&(e.seconds=this.seconds),this.millis!==void 0&&(e.millis=this.millis),this.micros!==void 0&&(e.micros=this.micros),e}}Dr.CLASS_NAME="Accuracy";const mh="algorithmId",ku="algorithmParams",Wv="algorithm",wg="params",WA=[Wv,wg];class $ extends G{constructor(e={}){super(),this.algorithmId=m(e,mh,$.defaultValues(mh)),ku in e&&(this.algorithmParams=m(e,ku,$.defaultValues(ku))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mh:return S;case ku:return new xe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case mh:return t===S;case ku:return t instanceof xe;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,optional:t.optional||!1,value:[new he({name:t.algorithmIdentifier||S}),new xe({name:t.algorithmParams||S,optional:!0})]})}fromSchema(e){W(e,WA);const t=j(e,e,$.schema({names:{algorithmIdentifier:Wv,algorithmParams:wg}}));K.assertSchema(t,this.className),this.algorithmId=t.result.algorithm.valueBlock.toString(),wg in t.result&&(this.algorithmParams=t.result.params)}toSchema(){const e=[];return e.push(new he({value:this.algorithmId})),this.algorithmParams&&!(this.algorithmParams instanceof xe)&&e.push(this.algorithmParams),new b({value:e})}toJSON(){const e={algorithmId:this.algorithmId};return this.algorithmParams&&!(this.algorithmParams instanceof xe)&&(e.algorithmParams=this.algorithmParams.toJSON()),e}isEqual(e){return!(e instanceof $)||this.algorithmId!==e.algorithmId?!1:this.algorithmParams?e.algorithmParams?JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!1:!e.algorithmParams}}$.CLASS_NAME="AlgorithmIdentifier";const bo="altNames",QA=[bo];class cu extends G{constructor(e={}){super(),this.altNames=m(e,bo,cu.defaultValues(bo)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bo:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _e({name:t.altNames||S,value:ze.schema()})]})}fromSchema(e){W(e,QA);const t=j(e,e,cu.schema({names:{altNames:bo}}));K.assertSchema(t,this.className),bo in t.result&&(this.altNames=Array.from(t.result.altNames,r=>new ze({schema:r})))}toSchema(){return new b({value:Array.from(this.altNames,e=>e.toSchema())})}toJSON(){return{altNames:Array.from(this.altNames,e=>e.toJSON())}}}cu.CLASS_NAME="AltName";const ko="type",Io="values",YA=[ko,Io];class mt extends G{constructor(e={}){super(),this.type=m(e,ko,mt.defaultValues(ko)),this.values=m(e,Io,mt.defaultValues(Io)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ko:return S;case Io:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ko:return t===S;case Io:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.type||S}),new Nt({name:t.setName||S,value:[new _e({name:t.values||S,value:new xe})]})]})}fromSchema(e){W(e,YA);const t=j(e,e,mt.schema({names:{type:ko,values:Io}}));K.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}toSchema(){return new b({value:[new he({value:this.type}),new Nt({value:this.values})]})}toJSON(){return{type:this.type,values:Array.from(this.values,e=>e.toJSON())}}}mt.CLASS_NAME="Attribute";const Fu="notBeforeTime",qu="notAfterTime",zA=[Fu,qu];class hs extends G{constructor(e={}){super(),this.notBeforeTime=m(e,Fu,hs.defaultValues(Fu)),this.notAfterTime=m(e,qu,hs.defaultValues(qu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fu:case qu:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new St({name:t.notBeforeTime||S}),new St({name:t.notAfterTime||S})]})}fromSchema(e){W(e,zA);const t=j(e,e,hs.schema({names:{notBeforeTime:Fu,notAfterTime:qu}}));K.assertSchema(t,this.className),this.notBeforeTime=t.result.notBeforeTime.toDate(),this.notAfterTime=t.result.notAfterTime.toDate()}toSchema(){return new b({value:[new St({valueDate:this.notBeforeTime}),new St({valueDate:this.notAfterTime})]})}toJSON(){return{notBeforeTime:this.notBeforeTime,notAfterTime:this.notAfterTime}}}hs.CLASS_NAME="AttCertValidityPeriod";const Iu="names",gp="generalNames";class Ht extends G{constructor(e={}){super(),this.names=m(e,Iu,Ht.defaultValues(Iu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"names":return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const r=m(e,Iu,{});return new b({optional:t,name:r.blockName||S,value:[new _e({name:r.generalNames||S,value:ze.schema()})]})}fromSchema(e){W(e,[Iu,gp]);const t=j(e,e,Ht.schema({names:{blockName:Iu,generalNames:gp}}));K.assertSchema(t,this.className),this.names=Array.from(t.result.generalNames,r=>new ze({schema:r}))}toSchema(){return new b({value:Array.from(this.names,e=>e.toSchema())})}toJSON(){return{names:Array.from(this.names,e=>e.toJSON())}}}Ht.CLASS_NAME="GeneralNames";const XA="2.5.29.9",ZA="2.5.29.14",eE="2.5.29.15",tE="2.5.29.16",Qv="2.5.29.17",Yv="2.5.29.18",pm="2.5.29.19",rE="2.5.29.20",sE="2.5.29.27",aE="2.5.29.21",nE="2.5.29.24",zv="2.5.29.28",Xv="2.5.29.29",Zv="2.5.29.30",e1="2.5.29.31",ym="2.5.29.46",t1="2.5.29.32",Hr="2.5.29.32.0",iE="1.3.6.1.4.1.311.21.10",r1="2.5.29.33",vm="2.5.29.35",s1="2.5.29.36",oE="2.5.29.37",lE="2.5.29.54",wm="1.3.6.1.5.5.7.1.1",uE="1.3.6.1.5.5.7.1.11",cE="1.3.6.1.4.1.11129.2.4.2",fE="1.3.6.1.4.1.311.21.7",hE="1.3.6.1.4.1.311.21.1",dE="1.3.6.1.5.5.7.1.3",Sm="1.2.840.113549.1.7.1",a1="1.2.840.113549.1.7.2",n1="1.2.840.113549.1.7.3",i1="1.2.840.113549.1.7.6",gE="1.2.840.113549.1.9.16.1.4",mp="1.2.840.113549.1.9.22.1",mE="1.2.840.113549.1.9.22.2",pp="1.2.840.113549.1.9.22.3",yp="1.2.840.113549.1.9.23.1",pE="1.3.6.1.5.5.7",yE=`${pE}.48`,qh=`${yE}.1.1`,On="keyIdentifier",Pn="authorityCertIssuer",Un="authorityCertSerialNumber",vE=[On,Pn,Un];class mn extends G{constructor(e={}){super(),On in e&&(this.keyIdentifier=m(e,On,mn.defaultValues(On))),Pn in e&&(this.authorityCertIssuer=m(e,Pn,mn.defaultValues(Pn))),Un in e&&(this.authorityCertSerialNumber=m(e,Un,mn.defaultValues(Un))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case On:return new z;case Pn:return[];case Un:return new _;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new Ie({name:t.keyIdentifier||S,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new _e({name:t.authorityCertIssuer||S,value:ze.schema()})]}),new Ie({name:t.authorityCertSerialNumber||S,optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}fromSchema(e){W(e,vE);const t=j(e,e,mn.schema({names:{keyIdentifier:On,authorityCertIssuer:Pn,authorityCertSerialNumber:Un}}));K.assertSchema(t,this.className),On in t.result&&(this.keyIdentifier=new z({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),Pn in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,r=>new ze({schema:r}))),Un in t.result&&(this.authorityCertSerialNumber=new _({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}toSchema(){const e=[];return this.keyIdentifier&&e.push(new Ie({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHexView})),this.authorityCertIssuer&&e.push(new N({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,t=>t.toSchema())})),this.authorityCertSerialNumber&&e.push(new Ie({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHexView})),new b({value:e})}toJSON(){const e={};return this.keyIdentifier&&(e.keyIdentifier=this.keyIdentifier.toJSON()),this.authorityCertIssuer&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,t=>t.toJSON())),this.authorityCertSerialNumber&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}mn.CLASS_NAME="AuthorityKeyIdentifier";const $n="pathLenConstraint",Dn="cA";class Qi extends G{constructor(e={}){super(),this.cA=m(e,Dn,!1),$n in e&&(this.pathLenConstraint=m(e,$n,0)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Dn:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new Ds({optional:!0,name:t.cA||S}),new _({optional:!0,name:t.pathLenConstraint||S})]})}fromSchema(e){W(e,[Dn,$n]);const t=j(e,e,Qi.schema({names:{cA:Dn,pathLenConstraint:$n}}));K.assertSchema(t,this.className),Dn in t.result&&(this.cA=t.result.cA.valueBlock.value),$n in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}toSchema(){const e=[];return this.cA!==Qi.defaultValues(Dn)&&e.push(new Ds({value:this.cA})),$n in this&&(this.pathLenConstraint instanceof _?e.push(this.pathLenConstraint):e.push(new _({value:this.pathLenConstraint}))),new b({value:e})}toJSON(){const e={};return this.cA!==Qi.defaultValues(Dn)&&(e.cA=this.cA),$n in this&&(this.pathLenConstraint instanceof _?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}Qi.CLASS_NAME="BasicConstraints";const Ed="certificateIndex",bd="keyIndex";class jf extends G{constructor(e={}){super(),this.certificateIndex=m(e,Ed,jf.defaultValues(Ed)),this.keyIndex=m(e,bd,jf.defaultValues(bd)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ed:case bd:return 0;default:return super.defaultValues(e)}}static schema(){return new _}fromSchema(e){if(e.constructor.blockName()!==_.blockName())throw new Error("Object's schema was not verified against input data for CAVersion");let t=e.valueBlock.valueHex.slice(0);const r=new Uint8Array(t);switch(!0){case t.byteLength<4:{const f=new ArrayBuffer(4);new Uint8Array(f).set(r,4-t.byteLength),t=f.slice(0)}break;case t.byteLength>4:{const f=new ArrayBuffer(4);new Uint8Array(f).set(r.slice(0,4)),t=f.slice(0)}break}const a=t.slice(0,2),n=new Uint8Array(a);let i=n[0];n[0]=n[1],n[1]=i;const o=new Uint16Array(a);this.keyIndex=o[0];const l=t.slice(2),u=new Uint8Array(l);i=u[0],u[0]=u[1],u[1]=i;const c=new Uint16Array(l);this.certificateIndex=c[0]}toSchema(){const e=new ArrayBuffer(2),t=new Uint16Array(e);t[0]=this.certificateIndex;const r=new Uint8Array(e);let a=r[0];r[0]=r[1],r[1]=a;const n=new ArrayBuffer(2),i=new Uint16Array(n);i[0]=this.keyIndex;const o=new Uint8Array(n);return a=o[0],o[0]=o[1],o[1]=a,new _({valueHex:Ql(n,e)})}toJSON(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}jf.CLASS_NAME="CAVersion";const Ju="policyQualifierId",Gu="qualifier",wE=[Ju,Gu];class Yi extends G{constructor(e={}){super(),this.policyQualifierId=m(e,Ju,Yi.defaultValues(Ju)),this.qualifier=m(e,Gu,Yi.defaultValues(Gu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ju:return S;case Gu:return new xe;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.policyQualifierId||S}),new xe({name:t.qualifier||S})]})}fromSchema(e){W(e,wE);const t=j(e,e,Yi.schema({names:{policyQualifierId:Ju,qualifier:Gu}}));K.assertSchema(t,this.className),this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}toSchema(){return new b({value:[new he({value:this.policyQualifierId}),this.qualifier]})}toJSON(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}Yi.CLASS_NAME="PolicyQualifierInfo";const ju="policyIdentifier",Kn="policyQualifiers",SE=[ju,Kn];class zi extends G{constructor(e={}){super(),this.policyIdentifier=m(e,ju,zi.defaultValues(ju)),Kn in e&&(this.policyQualifiers=m(e,Kn,zi.defaultValues(Kn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ju:return S;case Kn:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.policyIdentifier||S}),new b({optional:!0,value:[new _e({name:t.policyQualifiers||S,value:Yi.schema()})]})]})}fromSchema(e){W(e,SE);const t=j(e,e,zi.schema({names:{policyIdentifier:ju,policyQualifiers:Kn}}));K.assertSchema(t,this.className),this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),Kn in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,r=>new Yi({schema:r})))}toSchema(){const e=[];return e.push(new he({value:this.policyIdentifier})),this.policyQualifiers&&e.push(new b({value:Array.from(this.policyQualifiers,t=>t.toSchema())})),new b({value:e})}toJSON(){const e={policyIdentifier:this.policyIdentifier};return this.policyQualifiers&&(e.policyQualifiers=Array.from(this.policyQualifiers,t=>t.toJSON())),e}}zi.CLASS_NAME="PolicyInformation";const Wu="certificatePolicies",CE=[Wu];class fu extends G{constructor(e={}){super(),this.certificatePolicies=m(e,Wu,fu.defaultValues(Wu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Wu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _e({name:t.certificatePolicies||S,value:zi.schema()})]})}fromSchema(e){W(e,CE);const t=j(e,e,fu.schema({names:{certificatePolicies:Wu}}));K.assertSchema(t,this.className),this.certificatePolicies=Array.from(t.result.certificatePolicies,r=>new zi({schema:r}))}toSchema(){return new b({value:Array.from(this.certificatePolicies,e=>e.toSchema())})}toJSON(){return{certificatePolicies:Array.from(this.certificatePolicies,e=>e.toJSON())}}}fu.CLASS_NAME="CertificatePolicies";const Qu="templateID",Us="templateMajorVersion",Ks="templateMinorVersion",AE=[Qu,Us,Ks];class jl extends G{constructor(e={}){super(),this.templateID=m(e,Qu,jl.defaultValues(Qu)),Us in e&&(this.templateMajorVersion=m(e,Us,jl.defaultValues(Us))),Ks in e&&(this.templateMinorVersion=m(e,Ks,jl.defaultValues(Ks))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qu:return S;case Us:case Ks:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.templateID||S}),new _({name:t.templateMajorVersion||S,optional:!0}),new _({name:t.templateMinorVersion||S,optional:!0})]})}fromSchema(e){W(e,AE);const t=j(e,e,jl.schema({names:{templateID:Qu,templateMajorVersion:Us,templateMinorVersion:Ks}}));K.assertSchema(t,this.className),this.templateID=t.result.templateID.valueBlock.toString(),Us in t.result&&(this.templateMajorVersion=t.result.templateMajorVersion.valueBlock.valueDec),Ks in t.result&&(this.templateMinorVersion=t.result.templateMinorVersion.valueBlock.valueDec)}toSchema(){const e=[];return e.push(new he({value:this.templateID})),Us in this&&e.push(new _({value:this.templateMajorVersion})),Ks in this&&e.push(new _({value:this.templateMinorVersion})),new b({value:e})}toJSON(){const e={templateID:this.templateID};return Us in this&&(e.templateMajorVersion=this.templateMajorVersion),Ks in this&&(e.templateMinorVersion=this.templateMinorVersion),e}}const Mn="distributionPoint",o1="distributionPointNames",Hn="reasons",Fn="cRLIssuer",l1="cRLIssuerNames",EE=[Mn,o1,Hn,Fn,l1];class pn extends G{constructor(e={}){super(),Mn in e&&(this.distributionPoint=m(e,Mn,pn.defaultValues(Mn))),Hn in e&&(this.reasons=m(e,Hn,pn.defaultValues(Hn))),Fn in e&&(this.cRLIssuer=m(e,Fn,pn.defaultValues(Fn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mn:return[];case Hn:return new He;case Fn:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ct({value:[new N({name:t.distributionPoint||S,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new _e({name:t.distributionPointNames||S,value:ze.schema()})]}),new N({name:t.distributionPoint||S,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:st.schema().valueBlock.value})]})]}),new Ie({name:t.reasons||S,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new N({name:t.cRLIssuer||S,optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new _e({name:t.cRLIssuerNames||S,value:ze.schema()})]})]})}fromSchema(e){W(e,EE);const t=j(e,e,pn.schema({names:{distributionPoint:Mn,distributionPointNames:o1,reasons:Hn,cRLIssuer:Fn,cRLIssuerNames:l1}}));K.assertSchema(t,this.className),Mn in t.result&&(t.result.distributionPoint.idBlock.tagNumber===0&&(this.distributionPoint=Array.from(t.result.distributionPointNames,r=>new ze({schema:r}))),t.result.distributionPoint.idBlock.tagNumber===1&&(this.distributionPoint=new st({schema:new b({value:t.result.distributionPoint.valueBlock.value})}))),Hn in t.result&&(this.reasons=new He({valueHex:t.result.reasons.valueBlock.valueHex})),Fn in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,r=>new ze({schema:r})))}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new N({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,r=>r.toSchema())}):t=new N({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new N({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return this.reasons&&e.push(new Ie({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHexView})),this.cRLIssuer&&e.push(new N({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,t=>t.toSchema())})),new b({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.reasons&&(e.reasons=this.reasons.toJSON()),this.cRLIssuer&&(e.cRLIssuer=Array.from(this.cRLIssuer,t=>t.toJSON())),e}}pn.CLASS_NAME="DistributionPoint";const Yu="distributionPoints",bE=[Yu];class hu extends G{constructor(e={}){super(),this.distributionPoints=m(e,Yu,hu.defaultValues(Yu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _e({name:t.distributionPoints||S,value:pn.schema()})]})}fromSchema(e){W(e,bE);const t=j(e,e,hu.schema({names:{distributionPoints:Yu}}));K.assertSchema(t,this.className),this.distributionPoints=Array.from(t.result.distributionPoints,r=>new pn({schema:r}))}toSchema(){return new b({value:Array.from(this.distributionPoints,e=>e.toSchema())})}toJSON(){return{distributionPoints:Array.from(this.distributionPoints,e=>e.toJSON())}}}hu.CLASS_NAME="CRLDistributionPoints";const zu="keyPurposes",kE=[zu];class Wf extends G{constructor(e={}){super(),this.keyPurposes=m(e,zu,Wf.defaultValues(zu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _e({name:t.keyPurposes||S,value:new he})]})}fromSchema(e){W(e,kE);const t=j(e,e,Wf.schema({names:{keyPurposes:zu}}));K.assertSchema(t,this.className),this.keyPurposes=Array.from(t.result.keyPurposes,r=>r.valueBlock.toString())}toSchema(){return new b({value:Array.from(this.keyPurposes,e=>new he({value:e}))})}toJSON(){return{keyPurposes:Array.from(this.keyPurposes)}}}Wf.CLASS_NAME="ExtKeyUsage";const Bu="accessDescriptions";class du extends G{constructor(e={}){super(),this.accessDescriptions=m(e,Bu,du.defaultValues(Bu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _e({name:t.accessDescriptions||S,value:Wi.schema()})]})}fromSchema(e){W(e,[Bu]);const t=j(e,e,du.schema({names:{accessDescriptions:Bu}}));K.assertSchema(t,this.className),this.accessDescriptions=Array.from(t.result.accessDescriptions,r=>new Wi({schema:r}))}toSchema(){return new b({value:Array.from(this.accessDescriptions,e=>e.toSchema())})}toJSON(){return{accessDescriptions:Array.from(this.accessDescriptions,e=>e.toJSON())}}}du.CLASS_NAME="InfoAccess";const qn="distributionPoint",u1="distributionPointNames",Aa="onlyContainsUserCerts",Ea="onlyContainsCACerts",ba="onlySomeReasons",ka="indirectCRL",Ia="onlyContainsAttributeCerts",IE=[qn,u1,Aa,Ea,ba,ka,Ia];class Qt extends G{constructor(e={}){super(),qn in e&&(this.distributionPoint=m(e,qn,Qt.defaultValues(qn))),this.onlyContainsUserCerts=m(e,Aa,Qt.defaultValues(Aa)),this.onlyContainsCACerts=m(e,Ea,Qt.defaultValues(Ea)),ba in e&&(this.onlySomeReasons=m(e,ba,Qt.defaultValues(ba))),this.indirectCRL=m(e,ka,Qt.defaultValues(ka)),this.onlyContainsAttributeCerts=m(e,Ia,Qt.defaultValues(Ia)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case qn:return[];case Aa:return!1;case Ea:return!1;case ba:return 0;case ka:return!1;case Ia:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ct({value:[new N({name:t.distributionPoint||S,idBlock:{tagClass:3,tagNumber:0},value:[new _e({name:t.distributionPointNames||S,value:ze.schema()})]}),new N({name:t.distributionPoint||S,idBlock:{tagClass:3,tagNumber:1},value:st.schema().valueBlock.value})]})]}),new Ie({name:t.onlyContainsUserCerts||S,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Ie({name:t.onlyContainsCACerts||S,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new Ie({name:t.onlySomeReasons||S,optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new Ie({name:t.indirectCRL||S,optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new Ie({name:t.onlyContainsAttributeCerts||S,optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}fromSchema(e){W(e,IE);const t=j(e,e,Qt.schema({names:{distributionPoint:qn,distributionPointNames:u1,onlyContainsUserCerts:Aa,onlyContainsCACerts:Ea,onlySomeReasons:ba,indirectCRL:ka,onlyContainsAttributeCerts:Ia}}));if(K.assertSchema(t,this.className),qn in t.result)switch(!0){case t.result.distributionPoint.idBlock.tagNumber===0:this.distributionPoint=Array.from(t.result.distributionPointNames,r=>new ze({schema:r}));break;case t.result.distributionPoint.idBlock.tagNumber===1:this.distributionPoint=new st({schema:new b({value:t.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if(Aa in t.result){const r=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=r[0]!==0}if(Ea in t.result){const r=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=r[0]!==0}if(ba in t.result){const r=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=r[0]}if(ka in t.result){const r=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=r[0]!==0}if(Ia in t.result){const r=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=r[0]!==0}}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new N({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,r=>r.toSchema())}):(t=this.distributionPoint.toSchema(),t.idBlock.tagClass=3,t.idBlock.tagNumber=1),e.push(new N({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(this.onlyContainsUserCerts!==Qt.defaultValues(Aa)&&e.push(new Ie({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==Qt.defaultValues(Ea)&&e.push(new Ie({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),this.onlySomeReasons!==void 0){const t=new ArrayBuffer(1),r=new Uint8Array(t);r[0]=this.onlySomeReasons,e.push(new Ie({idBlock:{tagClass:3,tagNumber:3},valueHex:t}))}return this.indirectCRL!==Qt.defaultValues(ka)&&e.push(new Ie({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==Qt.defaultValues(Ia)&&e.push(new Ie({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new b({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==Qt.defaultValues(Aa)&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==Qt.defaultValues(Ea)&&(e.onlyContainsCACerts=this.onlyContainsCACerts),ba in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==Qt.defaultValues(ka)&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==Qt.defaultValues(Ia)&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}Qt.CLASS_NAME="IssuingDistributionPoint";const Xu="base",Bo="minimum",Ba="maximum",BE=[Xu,Bo,Ba];class xs extends G{constructor(e={}){super(),this.base=m(e,Xu,xs.defaultValues(Xu)),this.minimum=m(e,Bo,xs.defaultValues(Bo)),Ba in e&&(this.maximum=m(e,Ba,xs.defaultValues(Ba))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xu:return new ze;case Bo:return 0;case Ba:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[ze.schema(t.base||{}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new _({name:t.minimum||S})]}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new _({name:t.maximum||S})]})]})}fromSchema(e){W(e,BE);const t=j(e,e,xs.schema({names:{base:{names:{blockName:Xu}},minimum:Bo,maximum:Ba}}));K.assertSchema(t,this.className),this.base=new ze({schema:t.result.base}),Bo in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),Ba in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}toSchema(){const e=[];if(e.push(this.base.toSchema()),this.minimum!==0){let t=0;this.minimum instanceof _?t=this.minimum:t=new _({value:this.minimum}),e.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(Ba in this){let t=0;this.maximum instanceof _?t=this.maximum:t=new _({value:this.maximum}),e.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[t]}))}return new b({value:e})}toJSON(){const e={base:this.base.toJSON()};return this.minimum!==0&&(typeof this.minimum=="number"?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),this.maximum!==void 0&&(typeof this.maximum=="number"?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}xs.CLASS_NAME="GeneralSubtree";const Jn="permittedSubtrees",Gn="excludedSubtrees",xE=[Jn,Gn];class zl extends G{constructor(e={}){super(),Jn in e&&(this.permittedSubtrees=m(e,Jn,zl.defaultValues(Jn))),Gn in e&&(this.excludedSubtrees=m(e,Gn,zl.defaultValues(Gn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Jn:case Gn:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new _e({name:t.permittedSubtrees||S,value:xs.schema()})]}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new _e({name:t.excludedSubtrees||S,value:xs.schema()})]})]})}fromSchema(e){W(e,xE);const t=j(e,e,zl.schema({names:{permittedSubtrees:Jn,excludedSubtrees:Gn}}));K.assertSchema(t,this.className),Jn in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,r=>new xs({schema:r}))),Gn in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,r=>new xs({schema:r})))}toSchema(){const e=[];return this.permittedSubtrees&&e.push(new N({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,t=>t.toSchema())})),this.excludedSubtrees&&e.push(new N({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,t=>t.toSchema())})),new b({value:e})}toJSON(){const e={};return this.permittedSubtrees&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,t=>t.toJSON())),this.excludedSubtrees&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,t=>t.toJSON())),e}}zl.CLASS_NAME="NameConstraints";const Ms="requireExplicitPolicy",Hs="inhibitPolicyMapping",NE=[Ms,Hs];class Xl extends G{constructor(e={}){super(),Ms in e&&(this.requireExplicitPolicy=m(e,Ms,Xl.defaultValues(Ms))),Hs in e&&(this.inhibitPolicyMapping=m(e,Hs,Xl.defaultValues(Hs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ms:return 0;case Hs:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new Ie({name:t.requireExplicitPolicy||S,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Ie({name:t.inhibitPolicyMapping||S,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){W(e,NE);const t=j(e,e,Xl.schema({names:{requireExplicitPolicy:Ms,inhibitPolicyMapping:Hs}}));if(K.assertSchema(t,this.className),Ms in t.result){const r=t.result.requireExplicitPolicy;r.idBlock.tagClass=1,r.idBlock.tagNumber=2;const a=r.toBER(!1),n=Lt(a);K.assert(n,"Integer"),this.requireExplicitPolicy=n.result.valueBlock.valueDec}if(Hs in t.result){const r=t.result.inhibitPolicyMapping;r.idBlock.tagClass=1,r.idBlock.tagNumber=2;const a=r.toBER(!1),n=Lt(a);K.assert(n,"Integer"),this.inhibitPolicyMapping=n.result.valueBlock.valueDec}}toSchema(){const e=[];if(Ms in this){const t=new _({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if(Hs in this){const t=new _({value:this.inhibitPolicyMapping});t.idBlock.tagClass=3,t.idBlock.tagNumber=1,e.push(t)}return new b({value:e})}toJSON(){const e={};return Ms in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),Hs in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}Xl.CLASS_NAME="PolicyConstraints";const Zu="issuerDomainPolicy",ec="subjectDomainPolicy",TE=[Zu,ec];class Xi extends G{constructor(e={}){super(),this.issuerDomainPolicy=m(e,Zu,Xi.defaultValues(Zu)),this.subjectDomainPolicy=m(e,ec,Xi.defaultValues(ec)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Zu:return S;case ec:return S;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.issuerDomainPolicy||S}),new he({name:t.subjectDomainPolicy||S})]})}fromSchema(e){W(e,TE);const t=j(e,e,Xi.schema({names:{issuerDomainPolicy:Zu,subjectDomainPolicy:ec}}));K.assertSchema(t,this.className),this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}toSchema(){return new b({value:[new he({value:this.issuerDomainPolicy}),new he({value:this.subjectDomainPolicy})]})}toJSON(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}Xi.CLASS_NAME="PolicyMapping";const tc="mappings",RE=[tc];class Qf extends G{constructor(e={}){super(),this.mappings=m(e,tc,Qf.defaultValues(tc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tc:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _e({name:t.mappings||S,value:Xi.schema()})]})}fromSchema(e){W(e,RE);const t=j(e,e,Qf.schema({names:{mappings:tc}}));K.assertSchema(t,this.className),this.mappings=Array.from(t.result.mappings,r=>new Xi({schema:r}))}toSchema(){return new b({value:Array.from(this.mappings,e=>e.toSchema())})}toJSON(){return{mappings:Array.from(this.mappings,e=>e.toJSON())}}}Qf.CLASS_NAME="PolicyMappings";const xa="notBefore",Na="notAfter",VE=[xa,Na];class Zl extends G{constructor(e={}){super(),xa in e&&(this.notBefore=m(e,xa,Zl.defaultValues(xa))),Na in e&&(this.notAfter=m(e,Na,Zl.defaultValues(Na))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xa:return new Date;case Na:return new Date;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new Ie({name:t.notBefore||S,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Ie({name:t.notAfter||S,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){W(e,VE);const t=j(e,e,Zl.schema({names:{notBefore:xa,notAfter:Na}}));if(K.assertSchema(t,this.className),xa in t.result){const r=new St;r.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=r.toDate()}if(Na in t.result){const r=new St({valueHex:t.result.notAfter.valueBlock.valueHex});r.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=r.toDate()}}toSchema(){const e=[];return xa in this&&e.push(new Ie({idBlock:{tagClass:3,tagNumber:0},valueHex:new St({valueDate:this.notBefore}).valueBlock.valueHexView})),Na in this&&e.push(new Ie({idBlock:{tagClass:3,tagNumber:1},valueHex:new St({valueDate:this.notAfter}).valueBlock.valueHexView})),new b({value:e})}toJSON(){const e={};return this.notBefore&&(e.notBefore=this.notBefore),this.notAfter&&(e.notAfter=this.notAfter),e}}Zl.CLASS_NAME="PrivateKeyUsagePeriod";const xo="id",Fs="type",No="values",_E=[xo,Fs],$E=[No];class Zi extends G{constructor(e={}){super(),this.id=m(e,xo,Zi.defaultValues(xo)),Fs in e&&(this.type=m(e,Fs,Zi.defaultValues(Fs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xo:return S;case Fs:return new xt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case xo:return t===S;case Fs:return t instanceof xt;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.id||S}),new xe({name:t.type||S,optional:!0})]})}fromSchema(e){W(e,_E);const t=j(e,e,Zi.schema({names:{id:xo,type:Fs}}));K.assertSchema(t,this.className),this.id=t.result.id.valueBlock.toString(),Fs in t.result&&(this.type=t.result.type)}toSchema(){const e=[new he({value:this.id})];return Fs in this&&e.push(this.type),new b({value:e})}toJSON(){const e={id:this.id};return this.type&&(e.type=this.type.toJSON()),e}}Zi.CLASS_NAME="QCStatement";class Yf extends G{constructor(e={}){super(),this.values=m(e,No,Yf.defaultValues(No)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case No:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case No:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _e({name:t.values||S,value:Zi.schema(t.value||{})})]})}fromSchema(e){W(e,$E);const t=j(e,e,Yf.schema({names:{values:No}}));K.assertSchema(t,this.className),this.values=Array.from(t.result.values,r=>new Zi({schema:r}))}toSchema(){return new b({value:Array.from(this.values,e=>e.toSchema())})}toJSON(){return{values:Array.from(this.values,e=>e.toJSON())}}}Yf.CLASS_NAME="QCStatements";var jn;class En{static register(e,t,r){this.namedCurves[e.toLowerCase()]=this.namedCurves[t]={name:e,id:t,size:r}}static find(e){return this.namedCurves[e.toLowerCase()]||null}}jn=En;En.namedCurves={};jn.register("P-256","1.2.840.10045.3.1.7",32),jn.register("P-384","1.3.132.0.34",48),jn.register("P-521","1.3.132.0.35",66),jn.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),jn.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),jn.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);const ph="x",yh="y",vh="namedCurve";class yr extends G{constructor(e={}){super(),this.x=m(e,ph,yr.defaultValues(ph)),this.y=m(e,yh,yr.defaultValues(yh)),this.namedCurve=m(e,vh,yr.defaultValues(vh)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ph:case yh:return Ot;case vh:return S;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ph:case yh:return t instanceof ArrayBuffer&&ou(t,yr.defaultValues(e));case vh:return typeof t=="string"&&t===yr.defaultValues(e);default:return super.defaultValues(e)}}static schema(){return new _0}fromSchema(e){const t=Ee.toUint8Array(e);if(t[0]!==4)throw new Error("Object's schema was not verified against input data for ECPublicKey");const r=En.find(this.namedCurve);if(!r)throw new Error(`Incorrect curve OID: ${this.namedCurve}`);const a=r.size;if(t.byteLength!==a*2+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.namedCurve=r.name,this.x=t.slice(1,a+1).buffer,this.y=t.slice(1+a,a*2+1).buffer}toSchema(){return new _0({data:Ql(new Uint8Array([4]).buffer,this.x,this.y)})}toJSON(){const e=En.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:pg(R0(this.x),!0,!0,!1),y:pg(R0(this.y),!0,!0,!1)}}fromJSON(e){Ge.assert("json",e,"crv","x","y");let t=0;const r=En.find(e.crv);r&&(this.namedCurve=r.id,t=r.size);const a=lu(Hf(e.x,!0));if(a.byteLength<t){this.x=new ArrayBuffer(t);const i=new Uint8Array(this.x),o=new Uint8Array(a);i.set(o,1)}else this.x=a.slice(0,t);const n=lu(Hf(e.y,!0));if(n.byteLength<t){this.y=new ArrayBuffer(t);const i=new Uint8Array(this.y),o=new Uint8Array(n);i.set(o,1)}else this.y=n.slice(0,t)}}yr.CLASS_NAME="ECPublicKey";const rc="modulus",sc="publicExponent",DE=[rc,sc];class eo extends G{constructor(e={}){super(),this.modulus=m(e,rc,eo.defaultValues(rc)),this.publicExponent=m(e,sc,eo.defaultValues(sc)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rc:return new _;case sc:return new _;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _({name:t.modulus||S}),new _({name:t.publicExponent||S})]})}fromSchema(e){W(e,DE);const t=j(e,e,eo.schema({names:{modulus:rc,publicExponent:sc}}));K.assertSchema(t,this.className),this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}toSchema(){return new b({value:[this.modulus.convertToDER(),this.publicExponent]})}toJSON(){return{n:ke.ToBase64Url(this.modulus.valueBlock.valueHexView),e:ke.ToBase64Url(this.publicExponent.valueBlock.valueHexView)}}fromJSON(e){Ge.assert("json",e,"n","e");const t=lu(Hf(e.n,!0));this.modulus=new _({valueHex:t.slice(0,Math.pow(2,TA(t.byteLength)))}),this.publicExponent=new _({valueHex:lu(Hf(e.e,!0)).slice(0,3)})}}eo.CLASS_NAME="RSAPublicKey";const ac="algorithm",nc="subjectPublicKey",LE=[ac,nc];class Sr extends G{constructor(e={}){super(),this.algorithm=m(e,ac,Sr.defaultValues(ac)),this.subjectPublicKey=m(e,nc,Sr.defaultValues(nc));const t=m(e,"parsedKey",null);t&&(this.parsedKey=t),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}get parsedKey(){if(this._parsedKey===void 0){switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===he.blockName())try{this._parsedKey=new yr({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHexView})}catch{}break;case"1.2.840.113549.1.1.1":{const e=Lt(this.subjectPublicKey.valueBlock.valueHexView);if(e.offset!==-1)try{this._parsedKey=new eo({schema:e.result})}catch{}}break}this._parsedKey||(this._parsedKey=null)}return this._parsedKey||void 0}set parsedKey(e){this._parsedKey=e}static defaultValues(e){switch(e){case ac:return new $;case nc:return new He;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[$.schema(t.algorithm||{}),new He({name:t.subjectPublicKey||S})]})}fromSchema(e){W(e,LE);const t=j(e,e,Sr.schema({names:{algorithm:{names:{blockName:ac}},subjectPublicKey:nc}}));K.assertSchema(t,this.className),this.algorithm=new $({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey}toSchema(){return new b({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}toJSON(){if(!this.parsedKey)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};const e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new yr({json:e}),this.algorithm=new $({algorithmId:"1.2.840.10045.2.1",algorithmParams:new he({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new eo({json:e}),this.algorithm=new $({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new xt});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.subjectPublicKey=new He({valueHex:this.parsedKey.toSchema().toBER(!1)})}}async importKey(e,t=Le(!0)){try{if(!e)throw new Error("Need to provide publicKey input parameter");const r=await t.exportKey("spki",e),a=Lt(r);try{this.fromSchema(a.result)}catch{throw new Error("Error during initializing object from schema")}}catch(r){const a=r instanceof Error?r.message:`${r}`;throw new Error(`Error during exporting public key: ${a}`)}}}Sr.CLASS_NAME="PublicKeyInfo";const To="version",Ro="privateKey",ts="namedCurve",Ta="publicKey",OE=[To,Ro,ts,Ta];class Fr extends G{constructor(e={}){super(),this.version=m(e,To,Fr.defaultValues(To)),this.privateKey=m(e,Ro,Fr.defaultValues(Ro)),ts in e&&(this.namedCurve=m(e,ts,Fr.defaultValues(ts))),Ta in e&&(this.publicKey=m(e,Ta,Fr.defaultValues(Ta))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case To:return 1;case Ro:return new z;case ts:return S;case Ta:return new yr;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case To:return t===Fr.defaultValues(e);case Ro:return t.isEqual(Fr.defaultValues(e));case ts:return t===S;case Ta:return yr.compareWithDefault(ts,t.namedCurve)&&yr.compareWithDefault("x",t.x)&&yr.compareWithDefault("y",t.y);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _({name:t.version||S}),new z({name:t.privateKey||S}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new he({name:t.namedCurve||S})]}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new He({name:t.publicKey||S})]})]})}fromSchema(e){W(e,OE);const t=j(e,e,Fr.schema({names:{version:To,privateKey:Ro,namedCurve:ts,publicKey:Ta}}));if(K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,ts in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),Ta in t.result){const r={schema:t.result.publicKey.valueBlock.valueHex};ts in this&&(r.namedCurve=this.namedCurve),this.publicKey=new yr(r)}}toSchema(){const e=[new _({value:this.version}),this.privateKey];return this.namedCurve&&e.push(new N({idBlock:{tagClass:3,tagNumber:0},value:[new he({value:this.namedCurve})]})),this.publicKey&&e.push(new N({idBlock:{tagClass:3,tagNumber:1},value:[new He({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new b({value:e})}toJSON(){if(!this.namedCurve||Fr.compareWithDefault(ts,this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');const e=En.find(this.namedCurve),t={crv:e?e.name:this.namedCurve,d:ke.ToBase64Url(this.privateKey.valueBlock.valueHexView)};if(this.publicKey){const r=this.publicKey.toJSON();t.x=r.x,t.y=r.y}return t}fromJSON(e){Ge.assert("json",e,"crv","d");let t=0;const r=En.find(e.crv);r&&(this.namedCurve=r.id,t=r.size);const a=ke.FromBase64Url(e.d);if(a.byteLength<t){const n=new ArrayBuffer(t),i=new Uint8Array(n),o=new Uint8Array(a);i.set(o,1),this.privateKey=new z({valueHex:n})}else this.privateKey=new z({valueHex:a.slice(0,t)});e.x&&e.y&&(this.publicKey=new yr({json:e}))}}Fr.CLASS_NAME="ECPrivateKey";const ic="prime",oc="exponent",lc="coefficient",PE=[ic,oc,lc];class ea extends G{constructor(e={}){super(),this.prime=m(e,ic,ea.defaultValues(ic)),this.exponent=m(e,oc,ea.defaultValues(oc)),this.coefficient=m(e,lc,ea.defaultValues(lc)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ic:return new _;case oc:return new _;case lc:return new _;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _({name:t.prime||S}),new _({name:t.exponent||S}),new _({name:t.coefficient||S})]})}fromSchema(e){W(e,PE);const t=j(e,e,ea.schema({names:{prime:ic,exponent:oc,coefficient:lc}}));K.assertSchema(t,this.className),this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}toSchema(){return new b({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}toJSON(){return{r:ke.ToBase64Url(this.prime.valueBlock.valueHexView),d:ke.ToBase64Url(this.exponent.valueBlock.valueHexView),t:ke.ToBase64Url(this.coefficient.valueBlock.valueHexView)}}fromJSON(e){Ge.assert("json",e,"r","d","r"),this.prime=new _({valueHex:ke.FromBase64Url(e.r)}),this.exponent=new _({valueHex:ke.FromBase64Url(e.d)}),this.coefficient=new _({valueHex:ke.FromBase64Url(e.t)})}}ea.CLASS_NAME="OtherPrimeInfo";const uc="version",cc="modulus",fc="publicExponent",hc="privateExponent",dc="prime1",gc="prime2",mc="exponent1",pc="exponent2",yc="coefficient",Wn="otherPrimeInfos",UE=[uc,cc,fc,hc,dc,gc,mc,pc,yc,Wn];class hr extends G{constructor(e={}){super(),this.version=m(e,uc,hr.defaultValues(uc)),this.modulus=m(e,cc,hr.defaultValues(cc)),this.publicExponent=m(e,fc,hr.defaultValues(fc)),this.privateExponent=m(e,hc,hr.defaultValues(hc)),this.prime1=m(e,dc,hr.defaultValues(dc)),this.prime2=m(e,gc,hr.defaultValues(gc)),this.exponent1=m(e,mc,hr.defaultValues(mc)),this.exponent2=m(e,pc,hr.defaultValues(pc)),this.coefficient=m(e,yc,hr.defaultValues(yc)),Wn in e&&(this.otherPrimeInfos=m(e,Wn,hr.defaultValues(Wn))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uc:return 0;case cc:return new _;case fc:return new _;case hc:return new _;case dc:return new _;case gc:return new _;case mc:return new _;case pc:return new _;case yc:return new _;case Wn:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _({name:t.version||S}),new _({name:t.modulus||S}),new _({name:t.publicExponent||S}),new _({name:t.privateExponent||S}),new _({name:t.prime1||S}),new _({name:t.prime2||S}),new _({name:t.exponent1||S}),new _({name:t.exponent2||S}),new _({name:t.coefficient||S}),new b({optional:!0,value:[new _e({name:t.otherPrimeInfosName||S,value:ea.schema(t.otherPrimeInfo||{})})]})]})}fromSchema(e){W(e,UE);const t=j(e,e,hr.schema({names:{version:uc,modulus:cc,publicExponent:fc,privateExponent:hc,prime1:dc,prime2:gc,exponent1:mc,exponent2:pc,coefficient:yc,otherPrimeInfo:{names:{blockName:Wn}}}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),Wn in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,r=>new ea({schema:r})))}toSchema(){const e=[];return e.push(new _({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),this.otherPrimeInfos&&e.push(new b({value:Array.from(this.otherPrimeInfos,t=>t.toSchema())})),new b({value:e})}toJSON(){const e={n:ke.ToBase64Url(this.modulus.valueBlock.valueHexView),e:ke.ToBase64Url(this.publicExponent.valueBlock.valueHexView),d:ke.ToBase64Url(this.privateExponent.valueBlock.valueHexView),p:ke.ToBase64Url(this.prime1.valueBlock.valueHexView),q:ke.ToBase64Url(this.prime2.valueBlock.valueHexView),dp:ke.ToBase64Url(this.exponent1.valueBlock.valueHexView),dq:ke.ToBase64Url(this.exponent2.valueBlock.valueHexView),qi:ke.ToBase64Url(this.coefficient.valueBlock.valueHexView)};return this.otherPrimeInfos&&(e.oth=Array.from(this.otherPrimeInfos,t=>t.toJSON())),e}fromJSON(e){Ge.assert("json",e,"n","e","d","p","q","dp","dq","qi"),this.modulus=new _({valueHex:ke.FromBase64Url(e.n)}),this.publicExponent=new _({valueHex:ke.FromBase64Url(e.e)}),this.privateExponent=new _({valueHex:ke.FromBase64Url(e.d)}),this.prime1=new _({valueHex:ke.FromBase64Url(e.p)}),this.prime2=new _({valueHex:ke.FromBase64Url(e.q)}),this.exponent1=new _({valueHex:ke.FromBase64Url(e.dp)}),this.exponent2=new _({valueHex:ke.FromBase64Url(e.dq)}),this.coefficient=new _({valueHex:ke.FromBase64Url(e.qi)}),e.oth&&(this.otherPrimeInfos=Array.from(e.oth,t=>new ea({json:t})))}}hr.CLASS_NAME="RSAPrivateKey";const vc="version",wc="privateKeyAlgorithm",Sc="privateKey",Qn="attributes",wh="parsedKey",KE=[vc,wc,Sc,Qn];class Gr extends G{constructor(e={}){super(),this.version=m(e,vc,Gr.defaultValues(vc)),this.privateKeyAlgorithm=m(e,wc,Gr.defaultValues(wc)),this.privateKey=m(e,Sc,Gr.defaultValues(Sc)),Qn in e&&(this.attributes=m(e,Qn,Gr.defaultValues(Qn))),wh in e&&(this.parsedKey=m(e,wh,Gr.defaultValues(wh))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vc:return 0;case wc:return new $;case Sc:return new z;case Qn:return[];case wh:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _({name:t.version||S}),$.schema(t.privateKeyAlgorithm||{}),new z({name:t.privateKey||S}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new _e({name:t.attributes||S,value:mt.schema()})]})]})}fromSchema(e){W(e,KE);const t=j(e,e,Gr.schema({names:{version:vc,privateKeyAlgorithm:{names:{blockName:wc}},privateKey:Sc,attributes:Qn}}));switch(K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new $({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,Qn in t.result&&(this.attributes=Array.from(t.result.attributes,r=>new mt({schema:r}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{const r=Lt(this.privateKey.valueBlock.valueHexView);r.offset!==-1&&(this.parsedKey=new hr({schema:r.result}))}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof he){const r=Lt(this.privateKey.valueBlock.valueHexView);r.offset!==-1&&(this.parsedKey=new Fr({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:r.result}))}break}}toSchema(){const e=[new _({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return this.attributes&&e.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,t=>t.toSchema())})),new b({value:e})}toJSON(){if(!this.parsedKey){const r={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return this.attributes&&(r.attributes=Array.from(this.attributes,a=>a.toJSON())),r}const e={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Fr({json:e}),this.privateKeyAlgorithm=new $({algorithmId:"1.2.840.10045.2.1",algorithmParams:new he({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new hr({json:e}),this.privateKeyAlgorithm=new $({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new xt});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.privateKey=new z({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}Gr.CLASS_NAME="PrivateKeyInfo";const Vo="contentType",_o="contentEncryptionAlgorithm",Yn="encryptedContent",ME=[Vo,_o,Yn],vp=1024;class Rt extends G{constructor(e={}){if(super(),this.contentType=m(e,Vo,Rt.defaultValues(Vo)),this.contentEncryptionAlgorithm=m(e,_o,Rt.defaultValues(_o)),Yn in e&&e.encryptedContent&&(this.encryptedContent=e.encryptedContent,this.encryptedContent.idBlock.tagClass===1&&this.encryptedContent.idBlock.tagNumber===4&&this.encryptedContent.idBlock.isConstructed===!1&&!e.disableSplit)){const t=new z({idBlock:{isConstructed:!0},isConstructed:!0});let r=0;const a=this.encryptedContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const i=new Uint8Array(a,r,r+vp>a.byteLength?a.byteLength-r:vp),o=new ArrayBuffer(i.length),l=new Uint8Array(o);for(let u=0;u<l.length;u++)l[u]=i[u];t.valueBlock.value.push(new z({valueHex:o})),n-=i.length,r+=i.length}this.encryptedContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vo:return S;case _o:return new $;case Yn:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Vo:return t===S;case _o:return t.algorithmId===S&&!("algorithmParams"in t);case Yn:return t.isEqual(Rt.defaultValues(Yn));default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.contentType||S}),$.schema(t.contentEncryptionAlgorithm||{}),new Ct({value:[new N({name:t.encryptedContent||S,idBlock:{tagClass:3,tagNumber:0},value:[new _e({value:new z})]}),new Ie({name:t.encryptedContent||S,idBlock:{tagClass:3,tagNumber:0}})]})]})}fromSchema(e){W(e,ME);const t=j(e,e,Rt.schema({names:{contentType:Vo,contentEncryptionAlgorithm:{names:{blockName:_o}},encryptedContent:Yn}}));K.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new $({schema:t.result.contentEncryptionAlgorithm}),Yn in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}toSchema(){const e={isIndefiniteForm:!1},t=[];if(t.push(new he({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),this.encryptedContent){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;const r=this.encryptedContent;r.idBlock.tagClass=3,r.idBlock.tagNumber=0,r.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(r)}return new b({lenBlock:e,value:t})}toJSON(){const e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return this.encryptedContent&&(e.encryptedContent=this.encryptedContent.toJSON()),e}getEncryptedContent(){if(!this.encryptedContent)throw new Error("Parameter 'encryptedContent' is undefined");return z.prototype.getValue.call(this.encryptedContent)}}Rt.CLASS_NAME="EncryptedContentInfo";const Ra="hashAlgorithm",Va="maskGenAlgorithm",_a="saltLength",$a="trailerField",HE=[Ra,Va,_a,$a];class Yt extends G{constructor(e={}){super(),this.hashAlgorithm=m(e,Ra,Yt.defaultValues(Ra)),this.maskGenAlgorithm=m(e,Va,Yt.defaultValues(Va)),this.saltLength=m(e,_a,Yt.defaultValues(_a)),this.trailerField=m(e,$a,Yt.defaultValues($a)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ra:return new $({algorithmId:"1.3.14.3.2.26",algorithmParams:new xt});case Va:return new $({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new $({algorithmId:"1.3.14.3.2.26",algorithmParams:new xt}).toSchema()});case _a:return 20;case $a:return 1;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new N({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[$.schema(t.hashAlgorithm||{})]}),new N({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[$.schema(t.maskGenAlgorithm||{})]}),new N({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new _({name:t.saltLength||S})]}),new N({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new _({name:t.trailerField||S})]})]})}fromSchema(e){W(e,HE);const t=j(e,e,Yt.schema({names:{hashAlgorithm:{names:{blockName:Ra}},maskGenAlgorithm:{names:{blockName:Va}},saltLength:_a,trailerField:$a}}));K.assertSchema(t,this.className),Ra in t.result&&(this.hashAlgorithm=new $({schema:t.result.hashAlgorithm})),Va in t.result&&(this.maskGenAlgorithm=new $({schema:t.result.maskGenAlgorithm})),_a in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),$a in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}toSchema(){const e=[];return this.hashAlgorithm.isEqual(Yt.defaultValues(Ra))||e.push(new N({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(Yt.defaultValues(Va))||e.push(new N({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==Yt.defaultValues(_a)&&e.push(new N({idBlock:{tagClass:3,tagNumber:2},value:[new _({value:this.saltLength})]})),this.trailerField!==Yt.defaultValues($a)&&e.push(new N({idBlock:{tagClass:3,tagNumber:3},value:[new _({value:this.trailerField})]})),new b({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(Yt.defaultValues(Ra))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(Yt.defaultValues(Va))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==Yt.defaultValues(_a)&&(e.saltLength=this.saltLength),this.trailerField!==Yt.defaultValues($a)&&(e.trailerField=this.trailerField),e}}Yt.CLASS_NAME="RSASSAPSSParams";const $o="salt",Cc="iterationCount",rs="keyLength",qs="prf",FE=[$o,Cc,rs,qs];class ur extends G{constructor(e={}){super(),this.salt=m(e,$o,ur.defaultValues($o)),this.iterationCount=m(e,Cc,ur.defaultValues(Cc)),rs in e&&(this.keyLength=m(e,rs,ur.defaultValues(rs))),qs in e&&(this.prf=m(e,qs,ur.defaultValues(qs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $o:return{};case Cc:return-1;case rs:return 0;case qs:return new $({algorithmId:"1.3.14.3.2.26",algorithmParams:new xt});default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new Ct({value:[new z({name:t.saltPrimitive||S}),$.schema(t.saltConstructed||{})]}),new _({name:t.iterationCount||S}),new _({name:t.keyLength||S,optional:!0}),$.schema(t.prf||{names:{optional:!0}})]})}fromSchema(e){W(e,FE);const t=j(e,e,ur.schema({names:{saltPrimitive:$o,saltConstructed:{names:{blockName:$o}},iterationCount:Cc,keyLength:rs,prf:{names:{blockName:qs,optional:!0}}}}));K.assertSchema(t,this.className),this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,rs in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),qs in t.result&&(this.prf=new $({schema:t.result.prf}))}toSchema(){const e=[];return e.push(this.salt),e.push(new _({value:this.iterationCount})),rs in this&&ur.defaultValues(rs)!==this.keyLength&&e.push(new _({value:this.keyLength})),this.prf&&ur.defaultValues(qs).isEqual(this.prf)===!1&&e.push(this.prf.toSchema()),new b({value:e})}toJSON(){const e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return rs in this&&ur.defaultValues(rs)!==this.keyLength&&(e.keyLength=this.keyLength),this.prf&&ur.defaultValues(qs).isEqual(this.prf)===!1&&(e.prf=this.prf.toJSON()),e}}ur.CLASS_NAME="PBKDF2Params";const Ac="keyDerivationFunc",Ec="encryptionScheme",qE=[Ac,Ec];class to extends G{constructor(e={}){super(),this.keyDerivationFunc=m(e,Ac,to.defaultValues(Ac)),this.encryptionScheme=m(e,Ec,to.defaultValues(Ec)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ac:return new $;case Ec:return new $;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[$.schema(t.keyDerivationFunc||{}),$.schema(t.encryptionScheme||{})]})}fromSchema(e){W(e,qE);const t=j(e,e,to.schema({names:{keyDerivationFunc:{names:{blockName:Ac}},encryptionScheme:{names:{blockName:Ec}}}}));K.assertSchema(t,this.className),this.keyDerivationFunc=new $({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new $({schema:t.result.encryptionScheme})}toSchema(){return new b({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}toJSON(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}to.CLASS_NAME="PBES2Params";class JE{constructor(e){this.crypto=e.crypto,this.subtle="webkitSubtle"in e.crypto?e.crypto.webkitSubtle:e.crypto.subtle,this.name=m(e,"name",S)}async encrypt(...e){return this.subtle.encrypt(...e)}async decrypt(...e){return this.subtle.decrypt(...e)}sign(...e){return this.subtle.sign(...e)}async verify(...e){return this.subtle.verify(...e)}async digest(...e){return this.subtle.digest(...e)}async generateKey(...e){return this.subtle.generateKey(...e)}async deriveKey(...e){return this.subtle.deriveKey(...e)}async deriveBits(...e){return this.subtle.deriveBits(...e)}async wrapKey(...e){return this.subtle.wrapKey(...e)}async unwrapKey(...e){return this.subtle.unwrapKey(...e)}exportKey(...e){return this.subtle.exportKey(...e)}importKey(...e){return this.subtle.importKey(...e)}getRandomValues(e){return this.crypto.getRandomValues(e)}}async function wp(s,e,t,r,a,n){let i,o;const l=[];switch(e.toUpperCase()){case"SHA-1":i=20,o=64;break;case"SHA-256":i=32,o=64;break;case"SHA-384":i=48,o=128;break;case"SHA-512":i=64,o=128;break;default:throw new Error("Unsupported hashing algorithm")}const u=new Uint8Array(r),c=new ArrayBuffer(r.byteLength*2+2),f=new Uint8Array(c);for(let Ve=0;Ve<u.length;Ve++)f[Ve*2]=0,f[Ve*2+1]=u[Ve];f[f.length-2]=0,f[f.length-1]=0,r=c.slice(0);const g=new ArrayBuffer(o),v=new Uint8Array(g);for(let Ve=0;Ve<g.byteLength;Ve++)v[Ve]=3;const p=a.byteLength,h=o*Math.ceil(p/o),d=new ArrayBuffer(h),y=new Uint8Array(d),E=new Uint8Array(a);for(let Ve=0;Ve<h;Ve++)y[Ve]=E[Ve%p];const k=r.byteLength,R=o*Math.ceil(k/o),V=new ArrayBuffer(R),L=new Uint8Array(V),ne=new Uint8Array(r);for(let Ve=0;Ve<R;Ve++)L[Ve]=ne[Ve%k];const ae=d.byteLength+V.byteLength;let ve=new ArrayBuffer(ae),Te=new Uint8Array(ve);Te.set(y),Te.set(L,y.length);const ye=Math.ceil((t>>3)/i);let Ce=Promise.resolve(ve);for(let Ve=0;Ve<=ye;Ve++){Ce=Ce.then(Pe=>{const pe=new ArrayBuffer(g.byteLength+Pe.byteLength),$e=new Uint8Array(pe);return $e.set(v),$e.set(Te,v.length),pe});for(let Pe=0;Pe<n;Pe++)Ce=Ce.then(pe=>s.digest({name:e},new Uint8Array(pe)));Ce=Ce.then(Pe=>{const pe=new ArrayBuffer(o),$e=new Uint8Array(pe);for(let oe=0;oe<pe.byteLength;oe++)$e[oe]=Pe[oe%Pe.byteLength];const ie=Math.ceil(p/o)+Math.ceil(k/o),ot=[];let Me=0,te=o;for(let oe=0;oe<ie;oe++){const se=Array.from(new Uint8Array(ve.slice(Me,Me+te)));Me+=o,Me+o>ve.byteLength&&(te=ve.byteLength-Me);let me=511;for(let Ae=pe.byteLength-1;Ae>=0;Ae--)me>>=8,me+=$e[Ae]+se[Ae],se[Ae]=me&255;ot.push(...se)}return ve=new ArrayBuffer(ot.length),Te=new Uint8Array(ve),Te.set(ot),l.push(...new Uint8Array(Pe)),ve})}return Ce=Ce.then(()=>{const Ve=new ArrayBuffer(t>>3);return new Uint8Array(Ve).set(new Uint8Array(l).slice(0,t>>3)),Ve}),Ce}function c1(s){const e=typeof s=="string"?{name:s}:s;return"hash"in e?{...e,hash:c1(e.hash)}:e}class $0 extends JE{async importKey(e,t,r,a,n){var i,o,l,u,c,f;let g={};const v=c1(r);switch(e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,r,a,n);case"spki":{const p=Lt(Ee.toArrayBuffer(t));K.assert(p,"keyData");const h=new Sr;try{h.fromSchema(p.result)}catch{throw new rt("Incorrect keyData")}switch(v.name.toUpperCase()){case"RSA-PSS":{if(!v.hash)throw new Ge("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(v.hash.name.toUpperCase()){case"SHA-1":g.alg="PS1";break;case"SHA-256":g.alg="PS256";break;case"SHA-384":g.alg="PS384";break;case"SHA-512":g.alg="PS512";break;default:throw new Error(`Incorrect hash algorithm: ${v.hash.name.toUpperCase()}`)}}case"RSASSA-PKCS1-V1_5":{if(n=["verify"],g.kty="RSA",g.ext=a,g.key_ops=n,h.algorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error(`Incorrect public key algorithm: ${h.algorithm.algorithmId}`);if(!g.alg){if(!v.hash)throw new Ge("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(v.hash.name.toUpperCase()){case"SHA-1":g.alg="RS1";break;case"SHA-256":g.alg="RS256";break;case"SHA-384":g.alg="RS384";break;case"SHA-512":g.alg="RS512";break;default:throw new Error(`Incorrect hash algorithm: ${v.hash.name.toUpperCase()}`)}}const d=h.toJSON();Object.assign(g,d)}break;case"ECDSA":n=["verify"];case"ECDH":{if(g={kty:"EC",ext:a,key_ops:n},h.algorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error(`Incorrect public key algorithm: ${h.algorithm.algorithmId}`);const d=h.toJSON();Object.assign(g,d)}break;case"RSA-OAEP":{if(g.kty="RSA",g.ext=a,g.key_ops=n,this.name.toLowerCase()==="safari")g.alg="RSA-OAEP";else{if(!v.hash)throw new Ge("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(v.hash.name.toUpperCase()){case"SHA-1":g.alg="RSA-OAEP";break;case"SHA-256":g.alg="RSA-OAEP-256";break;case"SHA-384":g.alg="RSA-OAEP-384";break;case"SHA-512":g.alg="RSA-OAEP-512";break;default:throw new Error(`Incorrect hash algorithm: ${v.hash.name.toUpperCase()}`)}}const d=h.toJSON();Object.assign(g,d)}break;case"RSAES-PKCS1-V1_5":{g.kty="RSA",g.ext=a,g.key_ops=n,g.alg="PS1";const d=h.toJSON();Object.assign(g,d)}break;default:throw new Error(`Incorrect algorithm name: ${v.name.toUpperCase()}`)}}break;case"pkcs8":{const p=new Gr,h=Lt(Ee.toArrayBuffer(t));K.assert(h,"keyData");try{p.fromSchema(h.result)}catch{throw new Error("Incorrect keyData")}if(!p.parsedKey)throw new Error("Incorrect keyData");switch(v.name.toUpperCase()){case"RSA-PSS":switch((i=v.hash)===null||i===void 0?void 0:i.name.toUpperCase()){case"SHA-1":g.alg="PS1";break;case"SHA-256":g.alg="PS256";break;case"SHA-384":g.alg="PS384";break;case"SHA-512":g.alg="PS512";break;default:throw new Error(`Incorrect hash algorithm: ${(o=v.hash)===null||o===void 0?void 0:o.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":{if(n=["sign"],g.kty="RSA",g.ext=a,g.key_ops=n,p.privateKeyAlgorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error(`Incorrect private key algorithm: ${p.privateKeyAlgorithm.algorithmId}`);if(!("alg"in g))switch((l=v.hash)===null||l===void 0?void 0:l.name.toUpperCase()){case"SHA-1":g.alg="RS1";break;case"SHA-256":g.alg="RS256";break;case"SHA-384":g.alg="RS384";break;case"SHA-512":g.alg="RS512";break;default:throw new Error(`Incorrect hash algorithm: ${(u=v.hash)===null||u===void 0?void 0:u.name.toUpperCase()}`)}const d=p.toJSON();Object.assign(g,d)}break;case"ECDSA":n=["sign"];case"ECDH":{if(g={kty:"EC",ext:a,key_ops:n},p.privateKeyAlgorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error(`Incorrect algorithm: ${p.privateKeyAlgorithm.algorithmId}`);const d=p.toJSON();Object.assign(g,d)}break;case"RSA-OAEP":{if(g.kty="RSA",g.ext=a,g.key_ops=n,this.name.toLowerCase()==="safari")g.alg="RSA-OAEP";else switch((c=v.hash)===null||c===void 0?void 0:c.name.toUpperCase()){case"SHA-1":g.alg="RSA-OAEP";break;case"SHA-256":g.alg="RSA-OAEP-256";break;case"SHA-384":g.alg="RSA-OAEP-384";break;case"SHA-512":g.alg="RSA-OAEP-512";break;default:throw new Error(`Incorrect hash algorithm: ${(f=v.hash)===null||f===void 0?void 0:f.name.toUpperCase()}`)}const d=p.toJSON();Object.assign(g,d)}break;case"RSAES-PKCS1-V1_5":{n=["decrypt"],g.kty="RSA",g.ext=a,g.key_ops=n,g.alg="PS1";const d=p.toJSON();Object.assign(g,d)}break;default:throw new Error(`Incorrect algorithm name: ${v.name.toUpperCase()}`)}}break;case"jwk":g=t;break;default:throw new Error(`Incorrect format: ${e}`)}if(this.name.toLowerCase()==="safari")try{return this.subtle.importKey("jwk",lu(JSON.stringify(g)),r,a,n)}catch{return this.subtle.importKey("jwk",g,r,a,n)}return this.subtle.importKey("jwk",g,r,a,n)}async exportKey(e,t){let r=await this.subtle.exportKey("jwk",t);switch(this.name.toLowerCase()==="safari"&&r instanceof ArrayBuffer&&(r=JSON.parse(R0(r))),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":{const a=new Sr;try{a.fromJSON(r)}catch{throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"pkcs8":{const a=new Gr;try{a.fromJSON(r)}catch{throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"jwk":return r;default:throw new Error(`Incorrect format: ${e}`)}}async convert(e,t,r,a,n,i){if(e.toLowerCase()===t.toLowerCase())return r;const o=await this.importKey(e,r,a,n,i);return this.exportKey(t,o)}getAlgorithmByOID(e,t=!1,r){switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}if(t)throw new Error(`Unsupported algorithm identifier ${r?`for ${r} `:S}: ${e}`);return{}}getOIDByAlgorithm(e,t=!1,r){let a=S;switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":a="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.1.1.5";break;case"SHA-256":a="1.2.840.113549.1.1.11";break;case"SHA-384":a="1.2.840.113549.1.1.12";break;case"SHA-512":a="1.2.840.113549.1.1.13";break}break;case"RSA-PSS":a="1.2.840.113549.1.1.10";break;case"RSA-OAEP":a="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.10045.4.1";break;case"SHA-256":a="1.2.840.10045.4.3.2";break;case"SHA-384":a="1.2.840.10045.4.3.3";break;case"SHA-512":a="1.2.840.10045.4.3.4";break}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":a="1.3.133.16.840.63.0.2";break;case"SHA-256":a="1.3.132.1.11.1";break;case"SHA-384":a="1.3.132.1.11.2";break;case"SHA-512":a="1.3.132.1.11.3";break}break;case"AES-CTR":break;case"AES-CBC":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.2";break;case 192:a="2.16.840.1.101.3.4.1.22";break;case 256:a="2.16.840.1.101.3.4.1.42";break}break;case"AES-CMAC":break;case"AES-GCM":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.6";break;case 192:a="2.16.840.1.101.3.4.1.26";break;case 256:a="2.16.840.1.101.3.4.1.46";break}break;case"AES-CFB":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.4";break;case 192:a="2.16.840.1.101.3.4.1.24";break;case 256:a="2.16.840.1.101.3.4.1.44";break}break;case"AES-KW":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.5";break;case 192:a="2.16.840.1.101.3.4.1.25";break;case 256:a="2.16.840.1.101.3.4.1.45";break}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.2.7";break;case"SHA-256":a="1.2.840.113549.2.9";break;case"SHA-384":a="1.2.840.113549.2.10";break;case"SHA-512":a="1.2.840.113549.2.11";break}break;case"DH":a="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":a="1.3.14.3.2.26";break;case"SHA-256":a="2.16.840.1.101.3.4.2.1";break;case"SHA-384":a="2.16.840.1.101.3.4.2.2";break;case"SHA-512":a="2.16.840.1.101.3.4.2.3";break;case"CONCAT":break;case"HKDF":break;case"PBKDF2":a="1.2.840.113549.1.5.12";break;case"P-256":a="1.2.840.10045.3.1.7";break;case"P-384":a="1.3.132.0.34";break;case"P-521":a="1.3.132.0.35";break}if(!a&&t)throw new Error(`Unsupported algorithm ${r?`for ${r} `:S}: ${e.name}`);return a}getAlgorithmParameters(e,t){let r={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":r={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":r={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":r={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":r={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;case"exportkey":default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":r={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":r={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":r={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":r={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":switch(t.toLowerCase()){case"derivekey":r={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"HKDF"},usages:[]}}break;case"PBKDF2":switch(t.toLowerCase()){case"derivekey":r={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"PBKDF2"},usages:[]}}break}return r}getHashAlgorithm(e){let t=S;switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{const r=new Yt({schema:e.algorithmParams});if(r.hashAlgorithm){const a=this.getAlgorithmByOID(r.hashAlgorithm.algorithmId);if("name"in a)t=a.name;else return S}else t="SHA-1"}catch{}break}return t}async encryptEncryptedContentInfo(e){Ge.assert(e,"password","contentEncryptionAlgorithm","hmacHashAlgorithm","iterationCount","contentToEncrypt","contentToEncrypt","contentType");const t=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm,!0,"contentEncryptionAlgorithm"),r=this.getOIDByAlgorithm({name:"PBKDF2"},!0,"PBKDF2"),a=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),n=new ArrayBuffer(16),i=new Uint8Array(n);this.getRandomValues(i);const o=new ArrayBuffer(64),l=new Uint8Array(o);this.getRandomValues(l);const u=new Uint8Array(e.contentToEncrypt),c=new ur({salt:new z({valueHex:o}),iterationCount:e.iterationCount,prf:new $({algorithmId:a,algorithmParams:new xt})}),f=new Uint8Array(e.password),g=await this.importKey("raw",f,"PBKDF2",!1,["deriveKey"]),v=await this.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:l,iterations:e.iterationCount},g,e.contentEncryptionAlgorithm,!1,["encrypt"]),p=await this.encrypt({name:e.contentEncryptionAlgorithm.name,iv:i},v,u),h=new to({keyDerivationFunc:new $({algorithmId:r,algorithmParams:c.toSchema()}),encryptionScheme:new $({algorithmId:t,algorithmParams:new z({valueHex:n})})});return new Rt({contentType:e.contentType,contentEncryptionAlgorithm:new $({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:h.toSchema()}),encryptedContent:new z({valueHex:p})})}async decryptEncryptedContentInfo(e){if(Ge.assert(e,"password","encryptedContentInfo"),e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId!=="1.2.840.113549.1.5.13")throw new Error(`Unknown "contentEncryptionAlgorithm": ${e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId}`);let t;try{t=new to({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch{throw new Error('Incorrectly encoded "pbes2Parameters"')}let r;try{r=new ur({schema:t.keyDerivationFunc.algorithmParams})}catch{throw new Error('Incorrectly encoded "pbkdf2Params"')}const a=this.getAlgorithmByOID(t.encryptionScheme.algorithmId,!0),n=t.encryptionScheme.algorithmParams.valueBlock.valueHex,i=new Uint8Array(n),o=r.salt.valueBlock.valueHex,l=new Uint8Array(o),u=r.iterationCount;let c="SHA-1";r.prf&&(c=this.getAlgorithmByOID(r.prf.algorithmId,!0).hash.name);const f=await this.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"]),g=await this.deriveKey({name:"PBKDF2",hash:{name:c},salt:l,iterations:u},f,a,!1,["decrypt"]),v=e.encryptedContentInfo.getEncryptedContent();return this.decrypt({name:a.name,iv:i},g,v)}async stampDataWithPassword(e){if(!(e instanceof Object))throw new Error('Parameters must have type "Object"');Ge.assert(e,"password","hashAlgorithm","iterationCount","salt","contentToStamp");let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}const r={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await wp(this,e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),r,!1,["sign"]);return this.sign(r,n,new Uint8Array(e.contentToStamp))}async verifyDataStampedWithPassword(e){Ge.assert(e,"password","hashAlgorithm","salt","iterationCount","contentToVerify","signatureToVerify");let t=0;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}const r={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await wp(this,e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),r,!1,["verify"]);return this.verify(r,n,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify))}async getSignatureParameters(e,t="SHA-1"){this.getOIDByAlgorithm({name:t},!0,"hashAlgorithm");const r=new $,a=this.getAlgorithmParameters(e.algorithm.name,"sign");if(!Object.keys(a.algorithm).length)throw new Error("Parameter 'algorithm' is empty");const n=a.algorithm;switch(n.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":r.algorithmId=this.getOIDByAlgorithm(n,!0);break;case"RSA-PSS":{switch(t.toUpperCase()){case"SHA-256":n.saltLength=32;break;case"SHA-384":n.saltLength=48;break;case"SHA-512":n.saltLength=64;break}const i={};if(t.toUpperCase()!=="SHA-1"){const l=this.getOIDByAlgorithm({name:t},!0,"hashAlgorithm");i.hashAlgorithm=new $({algorithmId:l,algorithmParams:new xt}),i.maskGenAlgorithm=new $({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:i.hashAlgorithm.toSchema()})}n.saltLength!==20&&(i.saltLength=n.saltLength);const o=new Yt(i);r.algorithmId="1.2.840.113549.1.1.10",r.algorithmParams=o.toSchema()}break;default:throw new Error(`Unsupported signature algorithm: ${e.algorithm.name}`)}return{signatureAlgorithm:r,parameters:a}}async signWithPrivateKey(e,t,r){const a=await this.sign(r.algorithm,t,e);return r.algorithm.name==="ECDSA"?jE(a):a}fillPublicKeyParameters(e,t){const r={},a=this.getHashAlgorithm(t);if(a===S)throw new Error(`Unsupported signature algorithm: ${t.algorithmId}`);let n;t.algorithmId==="1.2.840.113549.1.1.10"?n=t.algorithmId:n=e.algorithm.algorithmId;const i=this.getAlgorithmByOID(n,!0);if(r.algorithm=this.getAlgorithmParameters(i.name,"importKey"),"hash"in r.algorithm.algorithm&&(r.algorithm.algorithm.hash.name=a),i.name==="ECDSA"){const o=e.algorithm;if(!o.algorithmParams)throw new Error("Algorithm parameters for ECDSA public key are missed");const l=o.algorithmParams;if("idBlock"in o.algorithmParams&&!(l.idBlock.tagClass===1&&l.idBlock.tagNumber===6))throw new Error("Incorrect type for ECDSA public key parameters");const u=this.getAlgorithmByOID(l.valueBlock.toString(),!0);r.algorithm.algorithm.namedCurve=u.name}return r}async getPublicKey(e,t,r){r||(r=this.fillPublicKeyParameters(e,t));const a=e.toSchema().toBER(!1);return this.importKey("spki",a,r.algorithm.algorithm,!0,r.algorithm.usages)}async verifyWithPublicKey(e,t,r,a,n){let i;if(n){const u={};let c;a.algorithmId==="1.2.840.113549.1.1.10"?c=a.algorithmId:c=r.algorithm.algorithmId;const f=this.getAlgorithmByOID(c,!0);if(u.algorithm=this.getAlgorithmParameters(f.name,"importKey"),"hash"in u.algorithm.algorithm&&(u.algorithm.algorithm.hash.name=n),f.name==="ECDSA"){let g=!1;if("algorithmParams"in r.algorithm&&"idBlock"in r.algorithm.algorithmParams&&r.algorithm.algorithmParams.idBlock.tagClass===1&&r.algorithm.algorithmParams.idBlock.tagNumber===6&&(g=!0),g===!1)throw new Error("Incorrect type for ECDSA public key parameters");const v=this.getAlgorithmByOID(r.algorithm.algorithmParams.valueBlock.toString(),!0);u.algorithm.algorithm.namedCurve=v.name}i=await this.getPublicKey(r,null,u)}else{if(n=this.getHashAlgorithm(a),!n)throw new Error(`Unsupported signature algorithm: ${a.algorithmId}`);i=await this.getPublicKey(r,a)}const o=this.getAlgorithmParameters(i.algorithm.name,"verify");"hash"in o.algorithm&&(o.algorithm.hash.name=n);let l=t.valueBlock.valueHexView;if(i.algorithm.name==="ECDSA"){const u=En.find(i.algorithm.namedCurve);if(!u)throw new Error("Unsupported named curve in use");const c=Lt(l);K.assert(c,"Signature value"),l=WE(c.result,u.size)}if(i.algorithm.name==="RSA-PSS"){const u=new Yt({schema:a.algorithmParams});"saltLength"in u?o.algorithm.saltLength=u.saltLength:o.algorithm.saltLength=20;let c="SHA-1";"hashAlgorithm"in u&&(c=this.getAlgorithmByOID(u.hashAlgorithm.algorithmId,!0).name),o.algorithm.hash.name=c}return this.verify(o.algorithm,i,l,e)}}let f1={name:"none",crypto:null};function Sp(s){return!!(s&&typeof s=="object"&&"crypto"in s)}function Cp(s,...e){let t=null;if(e.length<2)e.length?t=e[0]:t=typeof self<"u"&&self.crypto?new $0({name:"browser",crypto:self.crypto}):null;else{const r=e[0],a=e[1];Sp(a)?t=a:Sp(r)?t=r:"subtle"in r&&"getRandomValues"in r&&(t=new $0({crypto:r}))}if(typeof process<"u"&&"pid"in process&&typeof global<"u"&&typeof window>"u"){if(typeof global[process.pid]>"u")global[process.pid]={};else if(typeof global[process.pid]!="object")throw new Error(`Name global.${process.pid} already exists and it is not an object`);if(typeof global[process.pid].pkijs>"u")global[process.pid].pkijs={};else if(typeof global[process.pid].pkijs!="object")throw new Error(`Name global.${process.pid}.pkijs already exists and it is not an object`);global[process.pid].pkijs.engine={name:s,crypto:t}}else f1={name:s,crypto:t}}function GE(){if(typeof process<"u"&&"pid"in process&&typeof global<"u"&&typeof window>"u"){let s;try{s=global[process.pid].pkijs.engine}catch{throw new Error("Please call 'setEngine' before call to 'getEngine'")}return s}return f1}function Le(s=!1){const e=GE();if(!e.crypto&&s)throw new Error("Unable to create WebCrypto object");return e.crypto}function jE(s){if(s.byteLength%2!==0)return Ot;const e=s.byteLength/2,t=new ArrayBuffer(e);new Uint8Array(t).set(new Uint8Array(s,0,e));const a=new _({valueHex:t}),n=new ArrayBuffer(e);new Uint8Array(n).set(new Uint8Array(s,e,e));const o=new _({valueHex:n});return new b({value:[a.convertToDER(),o.convertToDER()]}).toBER(!1)}function WE(s,e){if(!(s instanceof b&&s.valueBlock.value.length===2&&s.valueBlock.value[0]instanceof _&&s.valueBlock.value[1]instanceof _))return Ot;const t=s.valueBlock.value[0].convertFromDER().valueBlock.valueHexView,r=s.valueBlock.value[1].convertFromDER().valueBlock.valueHexView,a=new Uint8Array(e*2);return a.set(t,e-t.byteLength),a.set(r,2*e-r.byteLength),a.buffer}async function QE(s,e,t,r,a){switch(s.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;default:throw new rt(`Unknown hash function: ${s}`)}if(rt.assert(e,"zBuffer","ArrayBuffer"),e.byteLength===0)throw new rt("'zBuffer' has zero length, error");if(rt.assert(r,"SharedInfo","ArrayBuffer"),t>255)throw new rt("Please set 'Counter' argument to value less or equal to 255");const n=new ArrayBuffer(4),i=new Uint8Array(n);i[0]=0,i[1]=0,i[2]=0,i[3]=t;let o=Ot;o=Ql(o,e),o=Ql(o,n),o=Ql(o,r);const l=await a.digest({name:s},o);return{counter:t,result:l}}async function Ap(s,e,t,r,a=Le(!0)){let n=0,i=1;switch(s.toUpperCase()){case"SHA-1":n=160;break;case"SHA-256":n=256;break;case"SHA-384":n=384;break;case"SHA-512":n=512;break;default:throw new rt(`Unknown hash function: ${s}`)}if(rt.assert(e,"Zbuffer","ArrayBuffer"),e.byteLength===0)throw new rt("'Zbuffer' has zero length, error");rt.assert(r,"SharedInfo","ArrayBuffer");const o=t/n;Math.floor(o)>0&&(i=Math.floor(o),o-i>0&&i++);const l=[];for(let g=1;g<=i;g++)l.push(await QE(s,e,g,r,a));let u=Ot,c=1,f=!0;for(;f;){f=!1;for(const g of l)if(g.counter===c){u=Ql(u,g.result),f=!0;break}c++}if(t>>=3,u.byteLength>t){const g=new ArrayBuffer(t),v=new Uint8Array(g),p=new Uint8Array(u);for(let h=0;h<t;h++)v[h]=p[h];return g}return u}const kd="version",Id="logID",Bd="extensions",xd="timestamp",Nd="hashAlgorithm",Td="signatureAlgorithm",Rd="signature",Ep="none",bp="md5",kp="sha1",Ip="sha224",Bp="sha256",xp="sha384",Np="sha512",Tp="anonymous",Rp="rsa",Vp="dsa",_p="ecdsa";class Ss extends G{constructor(e={}){super(),this.version=m(e,kd,Ss.defaultValues(kd)),this.logID=m(e,Id,Ss.defaultValues(Id)),this.timestamp=m(e,xd,Ss.defaultValues(xd)),this.extensions=m(e,Bd,Ss.defaultValues(Bd)),this.hashAlgorithm=m(e,Nd,Ss.defaultValues(Nd)),this.signatureAlgorithm=m(e,Td,Ss.defaultValues(Td)),this.signature=m(e,Rd,Ss.defaultValues(Rd)),"stream"in e&&e.stream&&this.fromStream(e.stream),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case kd:return 0;case Id:case Bd:return Ot;case xd:return new Date(0);case Nd:case Td:return S;case Rd:return new xe;default:return super.defaultValues(e)}}fromSchema(e){if(!(e instanceof _0))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");const t=new An({stream:new bt({buffer:e.data})});this.fromStream(t)}fromStream(e){const t=e.getUint16();if(this.version=e.getBlock(1)[0],this.version===0){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(ao(new Uint8Array(e.getBlock(8)),8));const r=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(r)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm=Ep;break;case 1:this.hashAlgorithm=bp;break;case 2:this.hashAlgorithm=kp;break;case 3:this.hashAlgorithm=Ip;break;case 4:this.hashAlgorithm=Bp;break;case 5:this.hashAlgorithm=xp;break;case 6:this.hashAlgorithm=Np;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm=Tp;break;case 1:this.signatureAlgorithm=Rp;break;case 2:this.signatureAlgorithm=Vp;break;case 3:this.signatureAlgorithm=_p;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}const a=e.getUint16(),n=new Uint8Array(e.getBlock(a)).buffer.slice(0),i=Lt(n);if(K.assert(i,"SignedCertificateTimestamp"),this.signature=i.result,t!==47+r+a)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}toSchema(){const e=this.toStream();return new _0({data:e.stream.buffer})}toStream(){const e=new An;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecodeView.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));const t=new ArrayBuffer(8),r=new Uint8Array(t),a=fa(this.timestamp.valueOf(),8);r.set(new Uint8Array(a),8-a.byteLength),e.appendView(r),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions));let n;switch(this.hashAlgorithm.toLowerCase()){case Ep:n=0;break;case bp:n=1;break;case kp:n=2;break;case Ip:n=3;break;case Bp:n=4;break;case xp:n=5;break;case Np:n=6;break;default:throw new Error(`Incorrect data for hashAlgorithm: ${this.hashAlgorithm}`)}e.appendChar(n);let i;switch(this.signatureAlgorithm.toLowerCase()){case Tp:i=0;break;case Rp:i=1;break;case Vp:i=2;break;case _p:i=3;break;default:throw new Error(`Incorrect data for signatureAlgorithm: ${this.signatureAlgorithm}`)}e.appendChar(i);const o=this.signature.toBER(!1);return e.appendUint16(o.byteLength),e.appendView(new Uint8Array(o)),e}toJSON(){return{version:this.version,logID:up(this.logID),timestamp:this.timestamp,extensions:up(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}async verify(e,t,r=0,a=Le(!0)){const n=pg(R0(this.logID));let i=null;const o=new An;for(const v of e)if(v.log_id===n){i=v.key;break}if(!i)throw new Error(`Public key not found for CT with logId: ${n}`);const l=lu(Hf(i)),u=Sr.fromBER(l);o.appendChar(0),o.appendChar(0);const c=new ArrayBuffer(8),f=new Uint8Array(c),g=fa(this.timestamp.valueOf(),8);return f.set(new Uint8Array(g),8-g.byteLength),o.appendView(f),o.appendUint16(r),r===0&&o.appendUint24(t.byteLength),o.appendView(new Uint8Array(t)),o.appendUint16(this.extensions.byteLength),this.extensions.byteLength!==0&&o.appendView(new Uint8Array(this.extensions)),a.verifyWithPublicKey(o.buffer.slice(0,o.length),new z({valueHex:this.signature.toBER(!1)}),u,{algorithmId:S},"SHA-256")}}Ss.CLASS_NAME="SignedCertificateTimestamp";const Sh="timestamps";class cd extends G{constructor(e={}){super(),this.timestamps=m(e,Sh,cd.defaultValues(Sh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Sh:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Sh:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){var t;const r=m(e,"names",{});return(t=r.optional)!==null&&t!==void 0||(r.optional=!1),new z({name:r.blockName||"SignedCertificateTimestampList",optional:r.optional})}fromSchema(e){if(!(e instanceof z))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");const t=new An({stream:new bt({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new Ss({stream:t}))}toSchema(){const e=new An;let t=0;const r=[];for(const a of this.timestamps){const n=a.toStream();r.push(n),t+=n.stream.buffer.byteLength}e.appendUint16(t);for(const a of r)e.appendView(a.stream.view);return new z({valueHex:e.stream.buffer.slice(0)})}toJSON(){return{timestamps:Array.from(this.timestamps,e=>e.toJSON())}}}cd.CLASS_NAME="SignedCertificateTimestampList";const bc="attributes",YE=[bc];class zf extends G{constructor(e={}){super(),this.attributes=m(e,bc,zf.defaultValues(bc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bc:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _e({name:t.attributes||S,value:mt.schema()})]})}fromSchema(e){W(e,YE);const t=j(e,e,zf.schema({names:{attributes:bc}}));K.assertSchema(t,this.className),this.attributes=Array.from(t.result.attributes,r=>new mt({schema:r}))}toSchema(){return new b({value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){return{attributes:Array.from(this.attributes,e=>e.toJSON())}}}zf.CLASS_NAME="SubjectDirectoryAttributes";class At{static getItems(){return this.types||(this.types={},At.register(Qv,"SubjectAltName",cu),At.register(Yv,"IssuerAltName",cu),At.register(vm,"AuthorityKeyIdentifier",mn),At.register(pm,"BasicConstraints",Qi),At.register(hE,"MicrosoftCaVersion",jf),At.register(t1,"CertificatePolicies",fu),At.register(iE,"CertificatePoliciesMicrosoft",fu),At.register(fE,"MicrosoftCertTemplateV2",jl),At.register(e1,"CRLDistributionPoints",hu),At.register(ym,"FreshestCRL",hu),At.register(oE,"ExtKeyUsage",Wf),At.register(Xv,"CertificateIssuer",Ht),At.register(wm,"AuthorityInfoAccess",du),At.register(uE,"SubjectInfoAccess",du),At.register(zv,"IssuingDistributionPoint",Qt),At.register(Zv,"NameConstraints",zl),At.register(s1,"PolicyConstraints",Xl),At.register(r1,"PolicyMappings",Qf),At.register(tE,"PrivateKeyUsagePeriod",Zl),At.register(dE,"QCStatements",Yf),At.register(cE,"SignedCertificateTimestampList",cd),At.register(XA,"SubjectDirectoryAttributes",zf)),this.types}static fromBER(e,t){const r=Lt(t);if(r.offset===-1)return null;const a=this.find(e);if(a)try{return new a.type({schema:r.result})}catch{const i=new a.type;return i.parsingError=`Incorrectly formatted value of extension ${a.name} (${e})`,i}return r.result}static find(e){return this.getItems()[e]||null}static register(e,t,r){this.getItems()[e]={name:t,type:r}}}const kc="extnID",Da="critical",Ic="extnValue",Ch="parsedValue",zE=[kc,Da,Ic];class Vt extends G{constructor(e={}){super(),this.extnID=m(e,kc,Vt.defaultValues(kc)),this.critical=m(e,Da,Vt.defaultValues(Da)),Ic in e?this.extnValue=new z({valueHex:e.extnValue}):this.extnValue=Vt.defaultValues(Ic),Ch in e&&(this.parsedValue=m(e,Ch,Vt.defaultValues(Ch))),e.schema&&this.fromSchema(e.schema)}get parsedValue(){if(this._parsedValue===void 0){const e=At.fromBER(this.extnID,this.extnValue.valueBlock.valueHexView);this._parsedValue=e}return this._parsedValue||void 0}set parsedValue(e){this._parsedValue=e}static defaultValues(e){switch(e){case kc:return S;case Da:return!1;case Ic:return new z;case Ch:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.extnID||S}),new Ds({name:t.critical||S,optional:!0}),new z({name:t.extnValue||S})]})}fromSchema(e){W(e,zE);const t=j(e,e,Vt.schema({names:{extnID:kc,critical:Da,extnValue:Ic}}));K.assertSchema(t,this.className),this.extnID=t.result.extnID.valueBlock.toString(),Da in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue}toSchema(){const e=[];return e.push(new he({value:this.extnID})),this.critical!==Vt.defaultValues(Da)&&e.push(new Ds({value:this.critical})),e.push(this.extnValue),new b({value:e})}toJSON(){const e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==Vt.defaultValues(Da)&&(e.critical=this.critical),this.parsedValue&&this.parsedValue.toJSON&&(e.parsedValue=this.parsedValue.toJSON()),e}}Vt.CLASS_NAME="Extension";const Bc="extensions",XE=[Bc];class Pt extends G{constructor(e={}){super(),this.extensions=m(e,Bc,Pt.defaultValues(Bc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bc:return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const r=m(e,"names",{});return new b({optional:t,name:r.blockName||S,value:[new _e({name:r.extensions||S,value:Vt.schema(r.extension||{})})]})}fromSchema(e){W(e,XE);const t=j(e,e,Pt.schema({names:{extensions:Bc}}));K.assertSchema(t,this.className),this.extensions=Array.from(t.result.extensions,r=>new Vt({schema:r}))}toSchema(){return new b({value:Array.from(this.extensions,e=>e.toSchema())})}toJSON(){return{extensions:this.extensions.map(e=>e.toJSON())}}}Pt.CLASS_NAME="Extensions";const xc="issuer",Nc="serialNumber",zn="issuerUID",ZE=[xc,Nc,zn];class wr extends G{constructor(e={}){super(),this.issuer=m(e,xc,wr.defaultValues(xc)),this.serialNumber=m(e,Nc,wr.defaultValues(Nc)),zn in e&&(this.issuerUID=m(e,zn,wr.defaultValues(zn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xc:return new Ht;case Nc:return new _;case zn:return new He;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[Ht.schema(t.issuer||{}),new _({name:t.serialNumber||S}),new He({optional:!0,name:t.issuerUID||S})]})}fromSchema(e){W(e,ZE);const t=j(e,e,wr.schema({names:{issuer:{names:{blockName:xc}},serialNumber:Nc,issuerUID:zn}}));K.assertSchema(t,this.className),this.issuer=new Ht({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber,zn in t.result&&(this.issuerUID=t.result.issuerUID)}toSchema(){const e=new b({value:[this.issuer.toSchema(),this.serialNumber]});return this.issuerUID&&e.valueBlock.value.push(this.issuerUID),e}toJSON(){const e={issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()};return this.issuerUID&&(e.issuerUID=this.issuerUID.toJSON()),e}}wr.CLASS_NAME="IssuerSerial";const Tc="version",Xn="baseCertificateID",Zn="subjectName",Rc="issuer",Vc="signature",_c="serialNumber",$c="attrCertValidityPeriod",Dc="attributes",ei="issuerUniqueID",ti="extensions",eb=[Tc,Xn,Zn,Rc,Vc,_c,$c,Dc,ei,ti];class lr extends G{constructor(e={}){super(),this.version=m(e,Tc,lr.defaultValues(Tc)),Xn in e&&(this.baseCertificateID=m(e,Xn,lr.defaultValues(Xn))),Zn in e&&(this.subjectName=m(e,Zn,lr.defaultValues(Zn))),this.issuer=m(e,Rc,lr.defaultValues(Rc)),this.signature=m(e,Vc,lr.defaultValues(Vc)),this.serialNumber=m(e,_c,lr.defaultValues(_c)),this.attrCertValidityPeriod=m(e,$c,lr.defaultValues($c)),this.attributes=m(e,Dc,lr.defaultValues(Dc)),ei in e&&(this.issuerUniqueID=m(e,ei,lr.defaultValues(ei))),ti in e&&(this.extensions=m(e,ti,lr.defaultValues(ti))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Tc:return 0;case Xn:return new wr;case Zn:return new Ht;case Rc:return new Ht;case Vc:return new $;case _c:return new _;case $c:return new hs;case Dc:return[];case ei:return new He;case ti:return new Pt;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _({name:t.version||S}),new Ct({value:[new N({name:t.baseCertificateID||S,idBlock:{tagClass:3,tagNumber:0},value:wr.schema().valueBlock.value}),new N({name:t.subjectName||S,idBlock:{tagClass:3,tagNumber:1},value:Ht.schema().valueBlock.value})]}),Ht.schema({names:{blockName:t.issuer||S}}),$.schema(t.signature||{}),new _({name:t.serialNumber||S}),hs.schema(t.attrCertValidityPeriod||{}),new b({name:t.attributes||S,value:[new _e({value:mt.schema()})]}),new He({optional:!0,name:t.issuerUniqueID||S}),Pt.schema(t.extensions||{},!0)]})}fromSchema(e){W(e,eb);const t=j(e,e,lr.schema({names:{version:Tc,baseCertificateID:Xn,subjectName:Zn,issuer:Rc,signature:{names:{blockName:Vc}},serialNumber:_c,attrCertValidityPeriod:{names:{blockName:$c}},attributes:Dc,issuerUniqueID:ei,extensions:{names:{blockName:ti}}}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Xn in t.result&&(this.baseCertificateID=new wr({schema:new b({value:t.result.baseCertificateID.valueBlock.value})})),Zn in t.result&&(this.subjectName=new Ht({schema:new b({value:t.result.subjectName.valueBlock.value})})),this.issuer=t.result.issuer,this.signature=new $({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new hs({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,r=>new mt({schema:r})),ei in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),ti in t.result&&(this.extensions=new Pt({schema:t.result.extensions}))}toSchema(){const e=new b({value:[new _({value:this.version})]});return this.baseCertificateID&&e.valueBlock.value.push(new N({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.subjectName&&e.valueBlock.value.push(new N({idBlock:{tagClass:3,tagNumber:1},value:this.subjectName.toSchema().valueBlock.value})),e.valueBlock.value.push(this.issuer.toSchema()),e.valueBlock.value.push(this.signature.toSchema()),e.valueBlock.value.push(this.serialNumber),e.valueBlock.value.push(this.attrCertValidityPeriod.toSchema()),e.valueBlock.value.push(new b({value:Array.from(this.attributes,t=>t.toSchema())})),this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.subjectName&&(e.subjectName=this.subjectName.toJSON()),e.issuer=this.issuer.toJSON(),e.signature=this.signature.toJSON(),e.serialNumber=this.serialNumber.toJSON(),e.attrCertValidityPeriod=this.attrCertValidityPeriod.toJSON(),e.attributes=Array.from(this.attributes,t=>t.toJSON()),this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}lr.CLASS_NAME="AttributeCertificateInfoV1";const Lc="acinfo",Oc="signatureAlgorithm",Pc="signatureValue",tb=[Lc,Pc,Oc];class ta extends G{constructor(e={}){super(),this.acinfo=m(e,Lc,ta.defaultValues(Lc)),this.signatureAlgorithm=m(e,Oc,ta.defaultValues(Oc)),this.signatureValue=m(e,Pc,ta.defaultValues(Pc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Lc:return new lr;case Oc:return new $;case Pc:return new He;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[lr.schema(t.acinfo||{}),$.schema(t.signatureAlgorithm||{}),new He({name:t.signatureValue||S})]})}fromSchema(e){W(e,tb);const t=j(e,e,ta.schema({names:{acinfo:{names:{blockName:Lc}},signatureAlgorithm:{names:{blockName:Oc}},signatureValue:Pc}}));K.assertSchema(t,this.className),this.acinfo=new lr({schema:t.result.acinfo}),this.signatureAlgorithm=new $({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new b({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}ta.CLASS_NAME="AttributeCertificateV1";const Uc="digestedObjectType",ri="otherObjectTypeID",Kc="digestAlgorithm",Mc="objectDigest",rb=[Uc,ri,Kc,Mc];class Pr extends G{constructor(e={}){super(),this.digestedObjectType=m(e,Uc,Pr.defaultValues(Uc)),ri in e&&(this.otherObjectTypeID=m(e,ri,Pr.defaultValues(ri))),this.digestAlgorithm=m(e,Kc,Pr.defaultValues(Kc)),this.objectDigest=m(e,Mc,Pr.defaultValues(Mc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Uc:return new no;case ri:return new he;case Kc:return new $;case Mc:return new He;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new no({name:t.digestedObjectType||S}),new he({optional:!0,name:t.otherObjectTypeID||S}),$.schema(t.digestAlgorithm||{}),new He({name:t.objectDigest||S})]})}fromSchema(e){W(e,rb);const t=j(e,e,Pr.schema({names:{digestedObjectType:Uc,otherObjectTypeID:ri,digestAlgorithm:{names:{blockName:Kc}},objectDigest:Mc}}));K.assertSchema(t,this.className),this.digestedObjectType=t.result.digestedObjectType,ri in t.result&&(this.otherObjectTypeID=t.result.otherObjectTypeID),this.digestAlgorithm=new $({schema:t.result.digestAlgorithm}),this.objectDigest=t.result.objectDigest}toSchema(){const e=new b({value:[this.digestedObjectType]});return this.otherObjectTypeID&&e.valueBlock.value.push(this.otherObjectTypeID),e.valueBlock.value.push(this.digestAlgorithm.toSchema()),e.valueBlock.value.push(this.objectDigest),e}toJSON(){const e={digestedObjectType:this.digestedObjectType.toJSON(),digestAlgorithm:this.digestAlgorithm.toJSON(),objectDigest:this.objectDigest.toJSON()};return this.otherObjectTypeID&&(e.otherObjectTypeID=this.otherObjectTypeID.toJSON()),e}}Pr.CLASS_NAME="ObjectDigestInfo";const si="issuerName",ai="baseCertificateID",ni="objectDigestInfo",sb=[si,ai,ni];class yn extends G{constructor(e={}){super(),si in e&&(this.issuerName=m(e,si,yn.defaultValues(si))),ai in e&&(this.baseCertificateID=m(e,ai,yn.defaultValues(ai))),ni in e&&(this.objectDigestInfo=m(e,ni,yn.defaultValues(ni))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case si:return new Ht;case ai:return new wr;case ni:return new Pr;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[Ht.schema({names:{blockName:t.issuerName}},!0),new N({optional:!0,name:t.baseCertificateID||S,idBlock:{tagClass:3,tagNumber:0},value:wr.schema().valueBlock.value}),new N({optional:!0,name:t.objectDigestInfo||S,idBlock:{tagClass:3,tagNumber:1},value:Pr.schema().valueBlock.value})]})}fromSchema(e){W(e,sb);const t=j(e,e,yn.schema({names:{issuerName:si,baseCertificateID:ai,objectDigestInfo:ni}}));K.assertSchema(t,this.className),si in t.result&&(this.issuerName=new Ht({schema:t.result.issuerName})),ai in t.result&&(this.baseCertificateID=new wr({schema:new b({value:t.result.baseCertificateID.valueBlock.value})})),ni in t.result&&(this.objectDigestInfo=new Pr({schema:new b({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new b;return this.issuerName&&e.valueBlock.value.push(this.issuerName.toSchema()),this.baseCertificateID&&e.valueBlock.value.push(new N({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new N({idBlock:{tagClass:3,tagNumber:1},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.issuerName&&(e.issuerName=this.issuerName.toJSON()),this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}yn.CLASS_NAME="V2Form";const ii="baseCertificateID",oi="entityName",li="objectDigestInfo",ab=[ii,oi,li];class ra extends G{constructor(e={}){super(),ii in e&&(this.baseCertificateID=m(e,ii,ra.defaultValues(ii))),oi in e&&(this.entityName=m(e,oi,ra.defaultValues(oi))),li in e&&(this.objectDigestInfo=m(e,li,ra.defaultValues(li))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ii:return new wr;case oi:return new Ht;case li:return new Pr;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new N({optional:!0,name:t.baseCertificateID||S,idBlock:{tagClass:3,tagNumber:0},value:wr.schema().valueBlock.value}),new N({optional:!0,name:t.entityName||S,idBlock:{tagClass:3,tagNumber:1},value:Ht.schema().valueBlock.value}),new N({optional:!0,name:t.objectDigestInfo||S,idBlock:{tagClass:3,tagNumber:2},value:Pr.schema().valueBlock.value})]})}fromSchema(e){W(e,ab);const t=j(e,e,ra.schema({names:{baseCertificateID:ii,entityName:oi,objectDigestInfo:li}}));K.assertSchema(t,this.className),ii in t.result&&(this.baseCertificateID=new wr({schema:new b({value:t.result.baseCertificateID.valueBlock.value})})),oi in t.result&&(this.entityName=new Ht({schema:new b({value:t.result.entityName.valueBlock.value})})),li in t.result&&(this.objectDigestInfo=new Pr({schema:new b({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new b;return this.baseCertificateID&&e.valueBlock.value.push(new N({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.entityName&&e.valueBlock.value.push(new N({idBlock:{tagClass:3,tagNumber:1},value:this.entityName.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new N({idBlock:{tagClass:3,tagNumber:2},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.entityName&&(e.entityName=this.entityName.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}ra.CLASS_NAME="Holder";const Hc="version",Fc="holder",qc="issuer",Jc="signature",Gc="serialNumber",jc="attrCertValidityPeriod",Wc="attributes",ui="issuerUniqueID",ci="extensions",nb=[Hc,Fc,qc,Jc,Gc,jc,Wc,ui,ci];class dr extends G{constructor(e={}){super(),this.version=m(e,Hc,dr.defaultValues(Hc)),this.holder=m(e,Fc,dr.defaultValues(Fc)),this.issuer=m(e,qc,dr.defaultValues(qc)),this.signature=m(e,Jc,dr.defaultValues(Jc)),this.serialNumber=m(e,Gc,dr.defaultValues(Gc)),this.attrCertValidityPeriod=m(e,jc,dr.defaultValues(jc)),this.attributes=m(e,Wc,dr.defaultValues(Wc)),ui in e&&(this.issuerUniqueID=m(e,ui,dr.defaultValues(ui))),ci in e&&(this.extensions=m(e,ci,dr.defaultValues(ci))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hc:return 1;case Fc:return new ra;case qc:return{};case Jc:return new $;case Gc:return new _;case jc:return new hs;case Wc:return[];case ui:return new He;case ci:return new Pt;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _({name:t.version||S}),ra.schema(t.holder||{}),new Ct({value:[Ht.schema({names:{blockName:t.issuer||S}}),new N({name:t.issuer||S,idBlock:{tagClass:3,tagNumber:0},value:yn.schema().valueBlock.value})]}),$.schema(t.signature||{}),new _({name:t.serialNumber||S}),hs.schema(t.attrCertValidityPeriod||{}),new b({name:t.attributes||S,value:[new _e({value:mt.schema()})]}),new He({optional:!0,name:t.issuerUniqueID||S}),Pt.schema(t.extensions||{},!0)]})}fromSchema(e){W(e,nb);const t=j(e,e,dr.schema({names:{version:Hc,holder:{names:{blockName:Fc}},issuer:qc,signature:{names:{blockName:Jc}},serialNumber:Gc,attrCertValidityPeriod:{names:{blockName:jc}},attributes:Wc,issuerUniqueID:ui,extensions:{names:{blockName:ci}}}}));switch(K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.holder=new ra({schema:t.result.holder}),t.result.issuer.idBlock.tagClass){case 3:this.issuer=new yn({schema:new b({value:t.result.issuer.valueBlock.value})});break;case 1:default:throw new Error("Incorrect value for 'issuer' in AttributeCertificateInfoV2")}this.signature=new $({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new hs({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,r=>new mt({schema:r})),ui in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),ci in t.result&&(this.extensions=new Pt({schema:t.result.extensions}))}toSchema(){const e=new b({value:[new _({value:this.version}),this.holder.toSchema(),new N({idBlock:{tagClass:3,tagNumber:0},value:this.issuer.toSchema().valueBlock.value}),this.signature.toSchema(),this.serialNumber,this.attrCertValidityPeriod.toSchema(),new b({value:Array.from(this.attributes,t=>t.toSchema())})]});return this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version,holder:this.holder.toJSON(),issuer:this.issuer.toJSON(),signature:this.signature.toJSON(),serialNumber:this.serialNumber.toJSON(),attrCertValidityPeriod:this.attrCertValidityPeriod.toJSON(),attributes:Array.from(this.attributes,t=>t.toJSON())};return this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}dr.CLASS_NAME="AttributeCertificateInfoV2";const Qc="acinfo",Yc="signatureAlgorithm",zc="signatureValue",ib=[Qc,Yc,zc];class Ur extends G{constructor(e={}){super(),this.acinfo=m(e,Qc,Ur.defaultValues(Qc)),this.signatureAlgorithm=m(e,Yc,Ur.defaultValues(Yc)),this.signatureValue=m(e,zc,Ur.defaultValues(zc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qc:return new dr;case Yc:return new $;case zc:return new He;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[dr.schema(t.acinfo||{}),$.schema(t.signatureAlgorithm||{}),new He({name:t.signatureValue||S})]})}fromSchema(e){W(e,ib);const t=j(e,e,Ur.schema({names:{acinfo:{names:{blockName:Qc}},signatureAlgorithm:{names:{blockName:Yc}},signatureValue:zc}}));K.assertSchema(t,this.className),this.acinfo=new dr({schema:t.result.acinfo}),this.signatureAlgorithm=new $({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new b({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}Ur.CLASS_NAME="AttributeCertificateV2";const fi="contentType",Do="content",ob=[fi,Do];class ft extends G{constructor(e={}){super(),this.contentType=m(e,fi,ft.defaultValues(fi)),this.content=m(e,Do,ft.defaultValues(Do)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fi:return S;case Do:return new xe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fi:return typeof t=="string"&&t===this.defaultValues(fi);case Do:return t instanceof xe;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return"optional"in t||(t.optional=!1),new b({name:t.blockName||"ContentInfo",optional:t.optional,value:[new he({name:t.contentType||fi}),new N({idBlock:{tagClass:3,tagNumber:0},value:[new xe({name:t.content||Do})]})]})}fromSchema(e){W(e,ob);const t=j(e,e,ft.schema());K.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.content=t.result.content}toSchema(){return new b({value:[new he({value:this.contentType}),new N({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}toJSON(){const e={contentType:this.contentType};return this.content instanceof xe||(e.content=this.content.toJSON()),e}}ft.CLASS_NAME="ContentInfo";ft.DATA=Sm;ft.SIGNED_DATA=a1;ft.ENVELOPED_DATA=n1;ft.ENCRYPTED_DATA=i1;const Vd="type",_d="value",Sg="utcTimeName",Cg="generalTimeName",lb=[Sg,Cg];var $p;(function(s){s[s.UTCTime=0]="UTCTime",s[s.GeneralizedTime=1]="GeneralizedTime",s[s.empty=2]="empty"})($p||($p={}));class Dt extends G{constructor(e={}){super(),this.type=m(e,Vd,Dt.defaultValues(Vd)),this.value=m(e,_d,Dt.defaultValues(_d)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vd:return 0;case _d:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={},t=!1){const r=m(e,"names",{});return new Ct({optional:t,value:[new uu({name:r.utcTimeName||S}),new St({name:r.generalTimeName||S})]})}fromSchema(e){W(e,lb);const t=j(e,e,Dt.schema({names:{utcTimeName:Sg,generalTimeName:Cg}}));K.assertSchema(t,this.className),Sg in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),Cg in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}toSchema(){return this.type===0?new uu({valueDate:this.value}):this.type===1?new St({valueDate:this.value}):{}}toJSON(){return{type:this.type,value:this.value}}}Dt.CLASS_NAME="Time";const $d="tbs",La="version",Jh="serialNumber",Gh="signature",jh="issuer",Wh="notBefore",Qh="notAfter",Yh="subject",zh="subjectPublicKeyInfo",Xc="issuerUniqueID",Zc="subjectUniqueID",ef="extensions",tf="signatureAlgorithm",rf="signatureValue",Mr="tbsCertificate",D0=`${Mr}.${La}`,Cm=`${Mr}.${Jh}`,Am=`${Mr}.${Gh}`,Em=`${Mr}.${jh}`,L0=`${Mr}.${Wh}`,O0=`${Mr}.${Qh}`,bm=`${Mr}.${Yh}`,km=`${Mr}.${zh}`,P0=`${Mr}.${Xc}`,U0=`${Mr}.${Zc}`,Pf=`${Mr}.${ef}`,ub=[Mr,D0,Cm,Am,Em,L0,O0,bm,km,P0,U0,Pf,tf,rf];function cb(s={}){const e=m(s,"names",{});return new b({name:e.blockName||Mr,value:[new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new _({name:e.tbsCertificateVersion||D0})]}),new _({name:e.tbsCertificateSerialNumber||Cm}),$.schema(e.signature||{names:{blockName:Am}}),st.schema(e.issuer||{names:{blockName:Em}}),new b({name:e.tbsCertificateValidity||"tbsCertificate.validity",value:[Dt.schema(e.notBefore||{names:{utcTimeName:L0,generalTimeName:L0}}),Dt.schema(e.notAfter||{names:{utcTimeName:O0,generalTimeName:O0}})]}),st.schema(e.subject||{names:{blockName:bm}}),Sr.schema(e.subjectPublicKeyInfo||{names:{blockName:km}}),new Ie({name:e.tbsCertificateIssuerUniqueID||P0,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Ie({name:e.tbsCertificateSubjectUniqueID||U0,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[Pt.schema(e.extensions||{names:{blockName:Pf}})]})]})}class Xe extends G{constructor(e={}){super(),this.tbsView=new Uint8Array(m(e,$d,Xe.defaultValues($d))),this.version=m(e,La,Xe.defaultValues(La)),this.serialNumber=m(e,Jh,Xe.defaultValues(Jh)),this.signature=m(e,Gh,Xe.defaultValues(Gh)),this.issuer=m(e,jh,Xe.defaultValues(jh)),this.notBefore=m(e,Wh,Xe.defaultValues(Wh)),this.notAfter=m(e,Qh,Xe.defaultValues(Qh)),this.subject=m(e,Yh,Xe.defaultValues(Yh)),this.subjectPublicKeyInfo=m(e,zh,Xe.defaultValues(zh)),Xc in e&&(this.issuerUniqueID=m(e,Xc,Xe.defaultValues(Xc))),Zc in e&&(this.subjectUniqueID=m(e,Zc,Xe.defaultValues(Zc))),ef in e&&(this.extensions=m(e,ef,Xe.defaultValues(ef))),this.signatureAlgorithm=m(e,tf,Xe.defaultValues(tf)),this.signatureValue=m(e,rf,Xe.defaultValues(rf)),e.schema&&this.fromSchema(e.schema)}get tbs(){return Ee.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}static defaultValues(e){switch(e){case $d:return Ot;case La:return 0;case Jh:return new _;case Gh:return new $;case jh:return new st;case Wh:return new Dt;case Qh:return new Dt;case Yh:return new st;case zh:return new Sr;case Xc:return Ot;case Zc:return Ot;case ef:return[];case tf:return new $;case rf:return new He;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[cb(t.tbsCertificate),$.schema(t.signatureAlgorithm||{names:{blockName:tf}}),new He({name:t.signatureValue||rf})]})}fromSchema(e){W(e,ub);const t=j(e,e,Xe.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:Pf}}}}}}));K.assertSchema(t,this.className),this.tbsView=t.result.tbsCertificate.valueBeforeDecodeView,D0 in t.result&&(this.version=t.result[D0].valueBlock.valueDec),this.serialNumber=t.result[Cm],this.signature=new $({schema:t.result[Am]}),this.issuer=new st({schema:t.result[Em]}),this.notBefore=new Dt({schema:t.result[L0]}),this.notAfter=new Dt({schema:t.result[O0]}),this.subject=new st({schema:t.result[bm]}),this.subjectPublicKeyInfo=new Sr({schema:t.result[km]}),P0 in t.result&&(this.issuerUniqueID=t.result[P0].valueBlock.valueHex),U0 in t.result&&(this.subjectUniqueID=t.result[U0].valueBlock.valueHex),Pf in t.result&&(this.extensions=Array.from(t.result[Pf],r=>new Vt({schema:r}))),this.signatureAlgorithm=new $({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return La in this&&this.version!==Xe.defaultValues(La)&&e.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new _({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new b({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),this.issuerUniqueID&&e.push(new Ie({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),this.subjectUniqueID&&e.push(new Ie({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),this.extensions&&e.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new b({value:Array.from(this.extensions,t=>t.toSchema())})]})),new b({value:e})}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return Xe.schema().value[0];const r=Lt(this.tbsView);K.assert(r,"TBS Certificate"),t=r.result}else t=this.encodeTBS();return new b({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:ke.ToHex(this.tbsView),version:this.version,serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return La in this&&this.version!==Xe.defaultValues(La)&&(e.version=this.version),this.issuerUniqueID&&(e.issuerUniqueID=ke.ToHex(this.issuerUniqueID)),this.subjectUniqueID&&(e.subjectUniqueID=ke.ToHex(this.subjectUniqueID)),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async getPublicKey(e,t=Le(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}async getKeyHash(e="SHA-1",t=Le(!0)){return t.digest({name:e},this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView)}async sign(e,t="SHA-1",r=Le(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await r.getSignatureParameters(e,t),n=a.parameters;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await r.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new He({valueHex:i})}async verify(e,t=Le(!0)){let r;if(e?r=e.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(r=this.subjectPublicKeyInfo),!(r instanceof Sr))throw new Error("Please provide issuer certificate as a parameter");return t.verifyWithPublicKey(this.tbsView,this.signatureValue,r,this.signatureAlgorithm)}}Xe.CLASS_NAME="Certificate";function h1(s,e=null){if(e&&s.issuer.isEqual(e.issuer)&&s.serialNumber.isEqual(e.serialNumber))return null;let t=!1;if(s.extensions){for(const r of s.extensions)if(r.extnID===pm&&r.parsedValue instanceof Qi&&r.parsedValue.cA){t=!0;break}}return t?s:null}const Lo="certId",Oo="certValue",po="parsedValue",fb=[Lo,Oo];class qi extends G{constructor(e={}){super(),this.certId=m(e,Lo,qi.defaultValues(Lo)),this.certValue=m(e,Oo,qi.defaultValues(Oo)),po in e&&(this.parsedValue=m(e,po,qi.defaultValues(po))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Lo:return S;case Oo:return new xe;case po:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Lo:return t===S;case Oo:return t instanceof xe;case po:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.id||"id"}),new N({idBlock:{tagClass:3,tagNumber:0},value:[new xe({name:t.value||"value"})]})]})}fromSchema(e){W(e,fb);const t=j(e,e,qi.schema({names:{id:Lo,value:Oo}}));K.assertSchema(t,this.className),this.certId=t.result.certId.valueBlock.toString(),this.certValue=t.result.certValue;const r=this.certValue.valueBlock.valueHexView;switch(this.certId){case mp:try{this.parsedValue=Xe.fromBER(r)}catch{Ur.fromBER(r)}break;case pp:this.parsedValue=Ur.fromBER(r);break;case mE:default:throw new Error(`Incorrect CERT_ID value in CertBag: ${this.certId}`)}}toSchema(){return po in this&&("acinfo"in this.parsedValue?this.certId=pp:this.certId=mp,this.certValue=new z({valueHex:this.parsedValue.toSchema().toBER(!1)})),new b({value:[new he({value:this.certId}),new N({idBlock:{tagClass:3,tagNumber:0},value:["toSchema"in this.certValue?this.certValue.toSchema():this.certValue]})]})}toJSON(){return{certId:this.certId,certValue:this.certValue.toJSON()}}}qi.CLASS_NAME="CertBag";const sf="userCertificate",Po="revocationDate",hi="crlEntryExtensions",hb=[sf,Po,hi];class Ji extends G{constructor(e={}){super(),this.userCertificate=m(e,sf,Ji.defaultValues(sf)),this.revocationDate=m(e,Po,Ji.defaultValues(Po)),hi in e&&(this.crlEntryExtensions=m(e,hi,Ji.defaultValues(hi))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case sf:return new _;case Po:return new Dt;case hi:return new Pt;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _({name:t.userCertificate||sf}),Dt.schema({names:{utcTimeName:t.revocationDate||Po,generalTimeName:t.revocationDate||Po}}),Pt.schema({names:{blockName:t.crlEntryExtensions||hi}},!0)]})}fromSchema(e){W(e,hb);const t=j(e,e,Ji.schema());K.assertSchema(t,this.className),this.userCertificate=t.result.userCertificate,this.revocationDate=new Dt({schema:t.result.revocationDate}),hi in t.result&&(this.crlEntryExtensions=new Pt({schema:t.result.crlEntryExtensions}))}toSchema(){const e=[this.userCertificate,this.revocationDate.toSchema()];return this.crlEntryExtensions&&e.push(this.crlEntryExtensions.toSchema()),new b({value:e})}toJSON(){const e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON()};return this.crlEntryExtensions&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}Ji.CLASS_NAME="RevokedCertificate";const Dd="tbs",xu="version",Ld="signature",Od="issuer",Pd="thisUpdate",Ah="nextUpdate",Eh="revokedCertificates",bh="crlExtensions",af="signatureAlgorithm",nf="signatureValue",ga="tbsCertList",K0=`${ga}.version`,Im=`${ga}.signature`,Bm=`${ga}.issuer`,M0=`${ga}.thisUpdate`,Xf=`${ga}.nextUpdate`,H0=`${ga}.revokedCertificates`,F0=`${ga}.extensions`,db=[ga,K0,Im,Bm,M0,Xf,H0,F0,af,nf];function gb(s={}){const e=m(s,"names",{});return new b({name:e.blockName||ga,value:[new _({optional:!0,name:e.tbsCertListVersion||K0,value:2}),$.schema(e.signature||{names:{blockName:Im}}),st.schema(e.issuer||{names:{blockName:Bm}}),Dt.schema(e.tbsCertListThisUpdate||{names:{utcTimeName:M0,generalTimeName:M0}}),Dt.schema(e.tbsCertListNextUpdate||{names:{utcTimeName:Xf,generalTimeName:Xf}},!0),new b({optional:!0,value:[new _e({name:e.tbsCertListRevokedCertificates||H0,value:new b({value:[new _,Dt.schema(),Pt.schema({},!0)]})})]}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Pt.schema(e.crlExtensions||{names:{blockName:F0}})]})]})}const mb=[vm,Yv,rE,sE,zv,ym,wm,aE,nE,Xv];class Kt extends G{constructor(e={}){super(),this.tbsView=new Uint8Array(m(e,Dd,Kt.defaultValues(Dd))),this.version=m(e,xu,Kt.defaultValues(xu)),this.signature=m(e,Ld,Kt.defaultValues(Ld)),this.issuer=m(e,Od,Kt.defaultValues(Od)),this.thisUpdate=m(e,Pd,Kt.defaultValues(Pd)),Ah in e&&(this.nextUpdate=m(e,Ah,Kt.defaultValues(Ah))),Eh in e&&(this.revokedCertificates=m(e,Eh,Kt.defaultValues(Eh))),bh in e&&(this.crlExtensions=m(e,bh,Kt.defaultValues(bh))),this.signatureAlgorithm=m(e,af,Kt.defaultValues(af)),this.signatureValue=m(e,nf,Kt.defaultValues(nf)),e.schema&&this.fromSchema(e.schema)}get tbs(){return Ee.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}static defaultValues(e){switch(e){case Dd:return Ot;case xu:return 0;case Ld:return new $;case Od:return new st;case Pd:return new Dt;case Ah:return new Dt;case Eh:return[];case bh:return new Pt;case af:return new $;case nf:return new He;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||"CertificateList",value:[gb(e),$.schema(t.signatureAlgorithm||{names:{blockName:af}}),new He({name:t.signatureValue||nf})]})}fromSchema(e){W(e,db);const t=j(e,e,Kt.schema());K.assertSchema(t,this.className),this.tbsView=t.result.tbsCertList.valueBeforeDecodeView,K0 in t.result&&(this.version=t.result[K0].valueBlock.valueDec),this.signature=new $({schema:t.result[Im]}),this.issuer=new st({schema:t.result[Bm]}),this.thisUpdate=new Dt({schema:t.result[M0]}),Xf in t.result&&(this.nextUpdate=new Dt({schema:t.result[Xf]})),H0 in t.result&&(this.revokedCertificates=Array.from(t.result[H0],r=>new Ji({schema:r}))),F0 in t.result&&(this.crlExtensions=new Pt({schema:t.result[F0]})),this.signatureAlgorithm=new $({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return this.version!==Kt.defaultValues(xu)&&e.push(new _({value:this.version})),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(this.thisUpdate.toSchema()),this.nextUpdate&&e.push(this.nextUpdate.toSchema()),this.revokedCertificates&&e.push(new b({value:Array.from(this.revokedCertificates,t=>t.toSchema())})),this.crlExtensions&&e.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new b({value:e})}toSchema(e=!1){let t;if(e)t=this.encodeTBS();else{if(!this.tbsView.byteLength)return Kt.schema();const r=Lt(this.tbsView);K.assert(r,"TBS Certificate Revocation List"),t=r.result}return new b({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:ke.ToHex(this.tbsView),version:this.version,signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==Kt.defaultValues(xu)&&(e.version=this.version),this.nextUpdate&&(e.nextUpdate=this.nextUpdate.toJSON()),this.revokedCertificates&&(e.revokedCertificates=Array.from(this.revokedCertificates,t=>t.toJSON())),this.crlExtensions&&(e.crlExtensions=this.crlExtensions.toJSON()),e}isCertificateRevoked(e){if(!this.issuer.isEqual(e.issuer)||!this.revokedCertificates)return!1;for(const t of this.revokedCertificates)if(t.userCertificate.isEqual(e.serialNumber))return!0;return!1}async sign(e,t="SHA-1",r=Le(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await r.getSignatureParameters(e,t),{parameters:n}=a;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await r.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new He({valueHex:i})}async verify(e={},t=Le(!0)){let r;if(e.issuerCertificate&&(r=e.issuerCertificate.subjectPublicKeyInfo,!this.issuer.isEqual(e.issuerCertificate.subject)))return!1;if(e.publicKeyInfo&&(r=e.publicKeyInfo),!r)throw new Error("Issuer's certificate must be provided as an input parameter");if(this.crlExtensions){for(const a of this.crlExtensions.extensions)if(a.critical&&!mb.includes(a.extnID))return!1}return t.verifyWithPublicKey(this.tbsView,this.signatureValue,r,this.signatureAlgorithm)}}Kt.CLASS_NAME="CertificateRevocationList";const Uo="crlId",Ko="crlValue",Nu="parsedValue",pb=[Uo,Ko];class Gi extends G{constructor(e={}){super(),this.crlId=m(e,Uo,Gi.defaultValues(Uo)),this.crlValue=m(e,Ko,Gi.defaultValues(Ko)),Nu in e&&(this.parsedValue=m(e,Nu,Gi.defaultValues(Nu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Uo:return S;case Ko:return new xe;case Nu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Uo:return t===S;case Ko:return t instanceof xe;case Nu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.id||"id"}),new N({idBlock:{tagClass:3,tagNumber:0},value:[new xe({name:t.value||"value"})]})]})}fromSchema(e){W(e,pb);const t=j(e,e,Gi.schema({names:{id:Uo,value:Ko}}));switch(K.assertSchema(t,this.className),this.crlId=t.result.crlId.valueBlock.toString(),this.crlValue=t.result.crlValue,this.crlId){case yp:this.parsedValue=Kt.fromBER(this.certValue.valueBlock.valueHex);break;default:throw new Error(`Incorrect CRL_ID value in CRLBag: ${this.crlId}`)}}toSchema(){return this.parsedValue&&(this.crlId=yp,this.crlValue=new z({valueHex:this.parsedValue.toSchema().toBER(!1)})),new b({value:[new he({value:this.crlId}),new N({idBlock:{tagClass:3,tagNumber:0},value:[this.crlValue.toSchema()]})]})}toJSON(){return{crlId:this.crlId,crlValue:this.crlValue.toJSON()}}}Gi.CLASS_NAME="CRLBag";const Mo="version",Ho="encryptedContentInfo",Oa="unprotectedAttrs",yb=[Mo,Ho,Oa];class Ns extends G{constructor(e={}){super(),this.version=m(e,Mo,Ns.defaultValues(Mo)),this.encryptedContentInfo=m(e,Ho,Ns.defaultValues(Ho)),Oa in e&&(this.unprotectedAttrs=m(e,Oa,Ns.defaultValues(Oa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mo:return 0;case Ho:return new Rt;case Oa:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Mo:return t===0;case Ho:return Rt.compareWithDefault("contentType",t.contentType)&&Rt.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&Rt.compareWithDefault("encryptedContent",t.encryptedContent);case Oa:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _({name:t.version||S}),Rt.schema(t.encryptedContentInfo||{}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new _e({name:t.unprotectedAttrs||S,value:mt.schema()})]})]})}fromSchema(e){W(e,yb);const t=j(e,e,Ns.schema({names:{version:Mo,encryptedContentInfo:{names:{blockName:Ho}},unprotectedAttrs:Oa}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.encryptedContentInfo=new Rt({schema:t.result.encryptedContentInfo}),Oa in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,r=>new mt({schema:r})))}toSchema(){const e=[];return e.push(new _({value:this.version})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new b({value:e})}toJSON(){const e={version:this.version,encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}async encrypt(e,t=Le(!0)){rt.assert(e,"parameters","object");const r={...e,contentType:"1.2.840.113549.1.7.1"};this.encryptedContentInfo=await t.encryptEncryptedContentInfo(r)}async decrypt(e,t=Le(!0)){rt.assert(e,"parameters","object");const r={...e,encryptedContentInfo:this.encryptedContentInfo};return t.decryptEncryptedContentInfo(r)}}Ns.CLASS_NAME="EncryptedData";const di="encryptionAlgorithm",Pa="encryptedData",Tu="parsedValue",vb=[di,Pa];class on extends G{constructor(e={}){super(),this.encryptionAlgorithm=m(e,di,on.defaultValues(di)),this.encryptedData=m(e,Pa,on.defaultValues(Pa)),Tu in e&&(this.parsedValue=m(e,Tu,on.defaultValues(Tu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case di:return new $;case Pa:return new z;case Tu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case di:return $.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case Pa:return t.isEqual(on.defaultValues(e));case Tu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[$.schema(t.encryptionAlgorithm||{names:{blockName:di}}),new Ct({value:[new z({name:t.encryptedData||Pa}),new z({idBlock:{isConstructed:!0},name:t.encryptedData||Pa})]})]})}fromSchema(e){W(e,vb);const t=j(e,e,on.schema({names:{encryptionAlgorithm:{names:{blockName:di}},encryptedData:Pa}}));K.assertSchema(t,this.className),this.encryptionAlgorithm=new $({schema:t.result.encryptionAlgorithm}),this.encryptedData=t.result.encryptedData}toSchema(){return new b({value:[this.encryptionAlgorithm.toSchema(),this.encryptedData]})}toJSON(){return{encryptionAlgorithm:this.encryptionAlgorithm.toJSON(),encryptedData:this.encryptedData.toJSON()}}async parseInternalValues(e,t=Le(!0)){const a=await new Ns({encryptedContentInfo:new Rt({contentEncryptionAlgorithm:this.encryptionAlgorithm,encryptedContent:this.encryptedData})}).decrypt(e,t);this.parsedValue=Gr.fromBER(a)}async makeInternalValues(e,t=Le(!0)){if(!this.parsedValue)throw new Error('Please initialize "parsedValue" first');const r=new Ns,a={...e,contentToEncrypt:this.parsedValue.toSchema().toBER(!1)};if(await r.encrypt(a,t),!r.encryptedContentInfo.encryptedContent)throw new Error("The filed `encryptedContent` in EncryptedContentInfo is empty");this.encryptionAlgorithm=r.encryptedContentInfo.contentEncryptionAlgorithm,this.encryptedData=r.encryptedContentInfo.encryptedContent}}on.CLASS_NAME="PKCS8ShroudedKeyBag";const Fo="secretTypeId",qo="secretValue",wb=[Fo,qo];class eu extends G{constructor(e={}){super(),this.secretTypeId=m(e,Fo,eu.defaultValues(Fo)),this.secretValue=m(e,qo,eu.defaultValues(qo)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fo:return S;case qo:return new xe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Fo:return t===S;case qo:return t instanceof xe;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.id||"id"}),new N({idBlock:{tagClass:3,tagNumber:0},value:[new xe({name:t.value||"value"})]})]})}fromSchema(e){W(e,wb);const t=j(e,e,eu.schema({names:{id:Fo,value:qo}}));K.assertSchema(t,this.className),this.secretTypeId=t.result.secretTypeId.valueBlock.toString(),this.secretValue=t.result.secretValue}toSchema(){return new b({value:[new he({value:this.secretTypeId}),new N({idBlock:{tagClass:3,tagNumber:0},value:[this.secretValue.toSchema()]})]})}toJSON(){return{secretTypeId:this.secretTypeId,secretValue:this.secretValue.toJSON()}}}eu.CLASS_NAME="SecretBag";class an{static getItems(){return this.items||(this.items={},an.register("1.2.840.113549.1.12.10.1.1",Gr),an.register("1.2.840.113549.1.12.10.1.2",on),an.register("1.2.840.113549.1.12.10.1.3",qi),an.register("1.2.840.113549.1.12.10.1.4",Gi),an.register("1.2.840.113549.1.12.10.1.5",eu),an.register("1.2.840.113549.1.12.10.1.6",sa)),this.items}static register(e,t){this.getItems()[e]=t}static find(e){return this.getItems()[e]||null}}const gi="bagId",mi="bagValue",Js="bagAttributes",Sb=[gi,mi,Js];class vn extends G{constructor(e={}){super(),this.bagId=m(e,gi,vn.defaultValues(gi)),this.bagValue=m(e,mi,vn.defaultValues(mi)),Js in e&&(this.bagAttributes=m(e,Js,vn.defaultValues(Js))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gi:return S;case mi:return new xe;case Js:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case gi:return t===S;case mi:return t instanceof xe;case Js:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.bagId||gi}),new N({idBlock:{tagClass:3,tagNumber:0},value:[new xe({name:t.bagValue||mi})]}),new Nt({optional:!0,value:[new _e({name:t.bagAttributes||Js,value:mt.schema()})]})]})}fromSchema(e){W(e,Sb);const t=j(e,e,vn.schema({names:{bagId:gi,bagValue:mi,bagAttributes:Js}}));K.assertSchema(t,this.className),this.bagId=t.result.bagId.valueBlock.toString();const r=an.find(this.bagId);if(!r)throw new Error(`Invalid BAG_ID for SafeBag: ${this.bagId}`);this.bagValue=new r({schema:t.result.bagValue}),Js in t.result&&(this.bagAttributes=Array.from(t.result.bagAttributes,a=>new mt({schema:a})))}toSchema(){const e=[new he({value:this.bagId}),new N({idBlock:{tagClass:3,tagNumber:0},value:[this.bagValue.toSchema()]})];return this.bagAttributes&&e.push(new Nt({value:Array.from(this.bagAttributes,t=>t.toSchema())})),new b({value:e})}toJSON(){const e={bagId:this.bagId,bagValue:this.bagValue.toJSON()};return this.bagAttributes&&(e.bagAttributes=Array.from(this.bagAttributes,t=>t.toJSON())),e}}vn.CLASS_NAME="SafeBag";const yo="safeBags";class sa extends G{constructor(e={}){super(),this.safeBags=m(e,yo,sa.defaultValues(yo)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case yo:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case yo:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _e({name:t.safeBags||S,value:vn.schema()})]})}fromSchema(e){W(e,[yo]);const t=j(e,e,sa.schema({names:{safeBags:yo}}));K.assertSchema(t,this.className),this.safeBags=Array.from(t.result.safeBags,r=>new vn({schema:r}))}toSchema(){return new b({value:Array.from(this.safeBags,e=>e.toSchema())})}toJSON(){return{safeBags:Array.from(this.safeBags,e=>e.toJSON())}}}sa.CLASS_NAME="SafeContents";const of="otherCertFormat",lf="otherCert",Cb=[of,lf];class bn extends G{constructor(e={}){super(),this.otherCertFormat=m(e,of,bn.defaultValues(of)),this.otherCert=m(e,lf,bn.defaultValues(lf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case of:return S;case lf:return new xe;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.otherCertFormat||of}),new xe({name:t.otherCert||lf})]})}fromSchema(e){W(e,Cb);const t=j(e,e,bn.schema());K.assertSchema(t,this.className),this.otherCertFormat=t.result.otherCertFormat.valueBlock.toString(),this.otherCert=t.result.otherCert}toSchema(){return new b({value:[new he({value:this.otherCertFormat}),this.otherCert]})}toJSON(){const e={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof xe||(e.otherCert=this.otherCert.toJSON()),e}}const uf="certificates",Ab=[uf];class Vs extends G{constructor(e={}){super(),this.certificates=m(e,uf,Vs.defaultValues(uf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uf:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new Nt({name:t.blockName||S,value:[new _e({name:t.certificates||uf,value:new Ct({value:[Xe.schema(),new N({idBlock:{tagClass:3,tagNumber:0},value:[new xe]}),new N({idBlock:{tagClass:3,tagNumber:1},value:[new b]}),new N({idBlock:{tagClass:3,tagNumber:2},value:Ur.schema().valueBlock.value}),new N({idBlock:{tagClass:3,tagNumber:3},value:bn.schema().valueBlock.value})]})})]})}fromSchema(e){W(e,Ab);const t=j(e,e,Vs.schema());K.assertSchema(t,this.className),this.certificates=Array.from(t.result.certificates||[],r=>{const a=r.idBlock.tagNumber;if(r.idBlock.tagClass===1)return new Xe({schema:r});const n=new b({value:r.valueBlock.value});switch(a){case 1:return n.valueBlock.value[0].valueBlock.value[0].valueBlock.valueDec===1?new Ur({schema:n}):new ta({schema:n});case 2:return new Ur({schema:n});case 3:return new bn({schema:n})}return r})}toSchema(){return new Nt({value:Array.from(this.certificates,e=>{switch(!0){case e instanceof Xe:return e.toSchema();case e instanceof ta:return new N({idBlock:{tagClass:3,tagNumber:1},value:e.toSchema().valueBlock.value});case e instanceof Ur:return new N({idBlock:{tagClass:3,tagNumber:2},value:e.toSchema().valueBlock.value});case e instanceof bn:return new N({idBlock:{tagClass:3,tagNumber:3},value:e.toSchema().valueBlock.value})}return e.toSchema()})})}toJSON(){return{certificates:Array.from(this.certificates,e=>e.toJSON())}}}Vs.CLASS_NAME="CertificateSet";const cf="otherRevInfoFormat",ff="otherRevInfo",Eb=[cf,ff];class la extends G{constructor(e={}){super(),this.otherRevInfoFormat=m(e,cf,la.defaultValues(cf)),this.otherRevInfo=m(e,ff,la.defaultValues(ff)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cf:return S;case ff:return new xe;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.otherRevInfoFormat||cf}),new xe({name:t.otherRevInfo||ff})]})}fromSchema(e){W(e,Eb);const t=j(e,e,la.schema());K.assertSchema(t,this.className),this.otherRevInfoFormat=t.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=t.result.otherRevInfo}toSchema(){return new b({value:[new he({value:this.otherRevInfoFormat}),this.otherRevInfo]})}toJSON(){const e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof xe||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}la.CLASS_NAME="OtherRevocationInfoFormat";const hf="crls",Ud="otherRevocationInfos",bb=[hf];class ua extends G{constructor(e={}){super(),this.crls=m(e,hf,ua.defaultValues(hf)),this.otherRevocationInfos=m(e,Ud,ua.defaultValues(Ud)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hf:return[];case Ud:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new Nt({name:t.blockName||S,value:[new _e({name:t.crls||S,value:new Ct({value:[Kt.schema(),new N({idBlock:{tagClass:3,tagNumber:1},value:[new he,new xe]})]})})]})}fromSchema(e){W(e,bb);const t=j(e,e,ua.schema({names:{crls:hf}}));if(K.assertSchema(t,this.className),t.result.crls)for(const r of t.result.crls)r.idBlock.tagClass===1?this.crls.push(new Kt({schema:r})):this.otherRevocationInfos.push(new la({schema:r}))}toSchema(){const e=[];return e.push(...Array.from(this.crls,t=>t.toSchema())),e.push(...Array.from(this.otherRevocationInfos,t=>{const r=t.toSchema();return r.idBlock.tagClass=3,r.idBlock.tagNumber=1,r})),new Nt({value:e})}toJSON(){return{crls:Array.from(this.crls,e=>e.toJSON()),otherRevocationInfos:Array.from(this.otherRevocationInfos,e=>e.toJSON())}}}ua.CLASS_NAME="RevocationInfoChoices";const df="certs",pi="crls",kb=[df,pi];class ro extends G{constructor(e={}){super(),this.crls=m(e,pi,ro.defaultValues(pi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case df:return new Vs;case pi:return new ua;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case df:return t.certificates.length===0;case pi:return t.crls.length===0&&t.otherRevocationInfos.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new N({name:t.certs||S,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Vs.schema().valueBlock.value}),new N({name:t.crls||S,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:ua.schema().valueBlock.value})]})}fromSchema(e){W(e,kb);const t=j(e,e,ro.schema({names:{certs:df,crls:pi}}));K.assertSchema(t,this.className),df in t.result&&(this.certs=new Vs({schema:new Nt({value:t.result.certs.valueBlock.value})})),pi in t.result&&(this.crls=new ua({schema:new Nt({value:t.result.crls.valueBlock.value})}))}toSchema(){const e=[];return this.certs&&e.push(new N({idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value})),this.crls&&e.push(new N({idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})),new b({value:e})}toJSON(){const e={};return this.certs&&(e.certs=this.certs.toJSON()),this.crls&&(e.crls=this.crls.toJSON()),e}}ro.CLASS_NAME="OriginatorInfo";const gf="issuer",mf="serialNumber",Ib=[gf,mf];class Ut extends G{constructor(e={}){super(),this.issuer=m(e,gf,Ut.defaultValues(gf)),this.serialNumber=m(e,mf,Ut.defaultValues(mf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gf:return new st;case mf:return new _;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[st.schema(t.issuer||{}),new _({name:t.serialNumber||S})]})}fromSchema(e){W(e,Ib);const t=j(e,e,Ut.schema({names:{issuer:{names:{blockName:gf}},serialNumber:mf}}));K.assertSchema(t,this.className),this.issuer=new st({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber}toSchema(){return new b({value:[this.issuer.toSchema(),this.serialNumber]})}toJSON(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}Ut.CLASS_NAME="IssuerAndSerialNumber";const kh="variant",Ru="value",Bb=["blockName"];class tu extends G{constructor(e={}){super(),this.variant=m(e,kh,tu.defaultValues(kh)),Ru in e&&(this.value=m(e,Ru,tu.defaultValues(Ru))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case kh:return-1;case Ru:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case kh:return t===-1;case Ru:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new Ct({value:[Ut.schema({names:{blockName:t.blockName||S}}),new Ie({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:0}})]})}fromSchema(e){W(e,Bb);const t=j(e,e,tu.schema({names:{blockName:"blockName"}}));K.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ut({schema:t.result.blockName})):(this.variant=2,this.value=new z({valueHex:t.result.blockName.valueBlock.valueHex}))}toSchema(){switch(this.variant){case 1:if(!(this.value instanceof Ut))throw new Error("Incorrect type of RecipientIdentifier.value. It should be IssuerAndSerialNumber.");return this.value.toSchema();case 2:if(!(this.value instanceof z))throw new Error("Incorrect type of RecipientIdentifier.value. It should be ASN.1 OctetString.");return new Ie({idBlock:{tagClass:3,tagNumber:0},valueHex:this.value.valueBlock.valueHexView});default:return new xe}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&this.value&&(e.value=this.value.toJSON()),e}}tu.CLASS_NAME="RecipientIdentifier";const yi="version",Jo="rid",Go="keyEncryptionAlgorithm",jo="encryptedKey",Ih="recipientCertificate",xb=[yi,Jo,Go,jo];class Rr extends G{constructor(e={}){super(),this.version=m(e,yi,Rr.defaultValues(yi)),this.rid=m(e,Jo,Rr.defaultValues(Jo)),this.keyEncryptionAlgorithm=m(e,Go,Rr.defaultValues(Go)),this.encryptedKey=m(e,jo,Rr.defaultValues(jo)),this.recipientCertificate=m(e,Ih,Rr.defaultValues(Ih)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case yi:return-1;case Jo:return{};case Go:return new $;case jo:return new z;case Ih:return new Xe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case yi:return t===Rr.defaultValues(yi);case Jo:return Object.keys(t).length===0;case Go:case jo:return t.isEqual(Rr.defaultValues(e));case Ih:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _({name:t.version||S}),tu.schema(t.rid||{}),$.schema(t.keyEncryptionAlgorithm||{}),new z({name:t.encryptedKey||S})]})}fromSchema(e){W(e,xb);const t=j(e,e,Rr.schema({names:{version:yi,rid:{names:{blockName:Jo}},keyEncryptionAlgorithm:{names:{blockName:Go}},encryptedKey:jo}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,t.result.rid.idBlock.tagClass===3?this.rid=new z({valueHex:t.result.rid.valueBlock.valueHex}):this.rid=new Ut({schema:t.result.rid}),this.keyEncryptionAlgorithm=new $({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return this.rid instanceof Ut?(this.version=0,e.push(new _({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new _({value:this.version})),e.push(new Ie({idBlock:{tagClass:3,tagNumber:0},valueHex:this.rid.valueBlock.valueHexView}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new b({value:e})}toJSON(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Rr.CLASS_NAME="KeyTransRecipientInfo";const Wo="algorithm",Qo="publicKey",Nb=[Wo,Qo];class aa extends G{constructor(e={}){super(),this.algorithm=m(e,Wo,aa.defaultValues(Wo)),this.publicKey=m(e,Qo,aa.defaultValues(Qo)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Wo:return new $;case Qo:return new He;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Wo:case Qo:return t.isEqual(aa.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[$.schema(t.algorithm||{}),new He({name:t.publicKey||S})]})}fromSchema(e){W(e,Nb);const t=j(e,e,aa.schema({names:{algorithm:{names:{blockName:Wo}},publicKey:Qo}}));K.assertSchema(t,this.className),this.algorithm=new $({schema:t.result.algorithm}),this.publicKey=t.result.publicKey}toSchema(){return new b({value:[this.algorithm.toSchema(),this.publicKey]})}toJSON(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}aa.CLASS_NAME="OriginatorPublicKey";const Bh="variant",Vu="value",Tb=["blockName"];class ca extends G{constructor(e={}){super(),this.variant=m(e,Bh,ca.defaultValues(Bh)),Vu in e&&(this.value=m(e,Vu,ca.defaultValues(Vu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bh:return-1;case Vu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Bh:return t===-1;case Vu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new Ct({value:[Ut.schema({names:{blockName:t.blockName||S}}),new Ie({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||S}),new N({idBlock:{tagClass:3,tagNumber:1},name:t.blockName||S,value:aa.schema().valueBlock.value})]})}fromSchema(e){W(e,Tb);const t=j(e,e,ca.schema({names:{blockName:"blockName"}}));K.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ut({schema:t.result.blockName})):t.result.blockName.idBlock.tagNumber===0?(t.result.blockName.idBlock.tagClass=1,t.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=t.result.blockName):(this.variant=3,this.value=new aa({schema:new b({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:{const e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e}default:return new xe}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2||this.variant===3)&&(e.value=this.value.toJSON()),e}}ca.CLASS_NAME="OriginatorIdentifierOrKey";const Yo="keyAttrId",vs="keyAttr",Rb=[Yo,vs];class ds extends G{constructor(e={}){super(),this.keyAttrId=m(e,Yo,ds.defaultValues(Yo)),vs in e&&(this.keyAttr=m(e,vs,ds.defaultValues(vs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yo:return S;case vs:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Yo:return typeof t=="string"&&t===S;case vs:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({optional:t.optional||!0,name:t.blockName||S,value:[new he({name:t.keyAttrId||S}),new xe({optional:!0,name:t.keyAttr||S})]})}fromSchema(e){W(e,Rb);const t=j(e,e,ds.schema({names:{keyAttrId:Yo,keyAttr:vs}}));K.assertSchema(t,this.className),this.keyAttrId=t.result.keyAttrId.valueBlock.toString(),vs in t.result&&(this.keyAttr=t.result.keyAttr)}toSchema(){const e=[];return e.push(new he({value:this.keyAttrId})),vs in this&&e.push(this.keyAttr),new b({value:e})}toJSON(){const e={keyAttrId:this.keyAttrId};return vs in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}ds.CLASS_NAME="OtherKeyAttribute";const vi="subjectKeyIdentifier",Ua="date",Ka="other",Vb=[vi,Ua,Ka];class Is extends G{constructor(e={}){super(),this.subjectKeyIdentifier=m(e,vi,Is.defaultValues(vi)),Ua in e&&(this.date=m(e,Ua,Is.defaultValues(Ua))),Ka in e&&(this.other=m(e,Ka,Is.defaultValues(Ka))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vi:return new z;case Ua:return new St;case Ka:return new ds;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case vi:return t.isEqual(Is.defaultValues(vi));case Ua:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case Ka:return t.keyAttrId===S&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new z({name:t.subjectKeyIdentifier||S}),new St({optional:!0,name:t.date||S}),ds.schema(t.other||{})]})}fromSchema(e){W(e,Vb);const t=j(e,e,Is.schema({names:{subjectKeyIdentifier:vi,date:Ua,other:{names:{blockName:Ka}}}}));K.assertSchema(t,this.className),this.subjectKeyIdentifier=t.result.subjectKeyIdentifier,Ua in t.result&&(this.date=t.result.date),Ka in t.result&&(this.other=new ds({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.subjectKeyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new b({value:e})}toJSON(){const e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return this.date&&(e.date=this.date.toJSON()),this.other&&(e.other=this.other.toJSON()),e}}Is.CLASS_NAME="RecipientKeyIdentifier";const xh="variant",Nh="value",_b=["blockName"];class _s extends G{constructor(e={}){super(),this.variant=m(e,xh,_s.defaultValues(xh)),this.value=m(e,Nh,_s.defaultValues(Nh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xh:return-1;case Nh:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case xh:return t===-1;case Nh:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new Ct({value:[Ut.schema(t.issuerAndSerialNumber||{names:{blockName:t.blockName||S}}),new N({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:0},value:Is.schema(t.rKeyId||{names:{blockName:t.blockName||S}}).valueBlock.value})]})}fromSchema(e){W(e,_b);const t=j(e,e,_s.schema({names:{blockName:"blockName"}}));K.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ut({schema:t.result.blockName})):(this.variant=2,this.value=new Is({schema:new b({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new N({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new xe}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&(e.value=this.value.toJSON()),e}}_s.CLASS_NAME="KeyAgreeRecipientIdentifier";const zo="rid",wi="encryptedKey",$b=[zo,wi];class na extends G{constructor(e={}){super(),this.rid=m(e,zo,na.defaultValues(zo)),this.encryptedKey=m(e,wi,na.defaultValues(wi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zo:return new _s;case wi:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case zo:return t.variant===-1&&!("value"in t);case wi:return t.isEqual(na.defaultValues(wi));default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[_s.schema(t.rid||{}),new z({name:t.encryptedKey||S})]})}fromSchema(e){W(e,$b);const t=j(e,e,na.schema({names:{rid:{names:{blockName:zo}},encryptedKey:wi}}));K.assertSchema(t,this.className),this.rid=new _s({schema:t.result.rid}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new b({value:[this.rid.toSchema(),this.encryptedKey]})}toJSON(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}na.CLASS_NAME="RecipientEncryptedKey";const Th="encryptedKeys",d1="RecipientEncryptedKeys",Db=[d1];class kn extends G{constructor(e={}){super(),this.encryptedKeys=m(e,Th,kn.defaultValues(Th)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Th:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Th:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _e({name:t.RecipientEncryptedKeys||S,value:na.schema()})]})}fromSchema(e){W(e,Db);const t=j(e,e,kn.schema({names:{RecipientEncryptedKeys:d1}}));K.assertSchema(t,this.className),this.encryptedKeys=Array.from(t.result.RecipientEncryptedKeys,r=>new na({schema:r}))}toSchema(){return new b({value:Array.from(this.encryptedKeys,e=>e.toSchema())})}toJSON(){return{encryptedKeys:Array.from(this.encryptedKeys,e=>e.toJSON())}}}kn.CLASS_NAME="RecipientEncryptedKeys";const Xo="version",Zo="originator",Gs="ukm",el="keyEncryptionAlgorithm",tl="recipientEncryptedKeys",Rh="recipientCertificate",Vh="recipientPublicKey",Lb=[Xo,Zo,Gs,el,tl];class Er extends G{constructor(e={}){super(),this.version=m(e,Xo,Er.defaultValues(Xo)),this.originator=m(e,Zo,Er.defaultValues(Zo)),Gs in e&&(this.ukm=m(e,Gs,Er.defaultValues(Gs))),this.keyEncryptionAlgorithm=m(e,el,Er.defaultValues(el)),this.recipientEncryptedKeys=m(e,tl,Er.defaultValues(tl)),this.recipientCertificate=m(e,Rh,Er.defaultValues(Rh)),this.recipientPublicKey=m(e,Vh,Er.defaultValues(Vh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xo:return 0;case Zo:return new ca;case Gs:return new z;case el:return new $;case tl:return new kn;case Rh:return new Xe;case Vh:return null;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Xo:return t===0;case Zo:return t.variant===-1&&!("value"in t);case Gs:return t.isEqual(Er.defaultValues(Gs));case el:return t.algorithmId===S&&!("algorithmParams"in t);case tl:return t.encryptedKeys.length===0;case Rh:return!1;case Vh:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _({name:t.version||S}),new N({idBlock:{tagClass:3,tagNumber:0},value:[ca.schema(t.originator||{})]}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new z({name:t.ukm||S})]}),$.schema(t.keyEncryptionAlgorithm||{}),kn.schema(t.recipientEncryptedKeys||{})]})}fromSchema(e){W(e,Lb);const t=j(e,e,Er.schema({names:{version:Xo,originator:{names:{blockName:Zo}},ukm:Gs,keyEncryptionAlgorithm:{names:{blockName:el}},recipientEncryptedKeys:{names:{blockName:tl}}}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.originator=new ca({schema:t.result.originator}),Gs in t.result&&(this.ukm=t.result.ukm),this.keyEncryptionAlgorithm=new $({schema:t.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new kn({schema:t.result.recipientEncryptedKeys})}toSchema(){const e=[];return e.push(new _({value:this.version})),e.push(new N({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),this.ukm&&e.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new b({value:e})}toJSON(){const e={version:this.version,originator:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()};return this.ukm&&(e.ukm=this.ukm.toJSON()),e}}Er.CLASS_NAME="KeyAgreeRecipientInfo";const Si="keyIdentifier",Ma="date",Ha="other",Ob=[Si,Ma,Ha];class ls extends G{constructor(e={}){super(),this.keyIdentifier=m(e,Si,ls.defaultValues(Si)),Ma in e&&(this.date=m(e,Ma,ls.defaultValues(Ma))),Ha in e&&(this.other=m(e,Ha,ls.defaultValues(Ha))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Si:return new z;case Ma:return new St;case Ha:return new ds;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Si:return t.isEqual(ls.defaultValues(Si));case Ma:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case Ha:return t.compareWithDefault("keyAttrId",t.keyAttrId)&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new z({name:t.keyIdentifier||S}),new St({optional:!0,name:t.date||S}),ds.schema(t.other||{})]})}fromSchema(e){W(e,Ob);const t=j(e,e,ls.schema({names:{keyIdentifier:Si,date:Ma,other:{names:{blockName:Ha}}}}));K.assertSchema(t,this.className),this.keyIdentifier=t.result.keyIdentifier,Ma in t.result&&(this.date=t.result.date),Ha in t.result&&(this.other=new ds({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.keyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new b({value:e})}toJSON(){const e={keyIdentifier:this.keyIdentifier.toJSON()};return this.date&&(e.date=this.date),this.other&&(e.other=this.other.toJSON()),e}}ls.CLASS_NAME="KEKIdentifier";const rl="version",sl="kekid",al="keyEncryptionAlgorithm",Ci="encryptedKey",_h="preDefinedKEK",Pb=[rl,sl,al,Ci];class Vr extends G{constructor(e={}){super(),this.version=m(e,rl,Vr.defaultValues(rl)),this.kekid=m(e,sl,Vr.defaultValues(sl)),this.keyEncryptionAlgorithm=m(e,al,Vr.defaultValues(al)),this.encryptedKey=m(e,Ci,Vr.defaultValues(Ci)),this.preDefinedKEK=m(e,_h,Vr.defaultValues(_h)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rl:return 0;case sl:return new ls;case al:return new $;case Ci:return new z;case _h:return Ot;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"KEKRecipientInfo":return t===Vr.defaultValues(rl);case sl:return t.compareWithDefault("keyIdentifier",t.keyIdentifier)&&!("date"in t)&&!("other"in t);case al:return t.algorithmId===S&&!("algorithmParams"in t);case Ci:return t.isEqual(Vr.defaultValues(Ci));case _h:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _({name:t.version||S}),ls.schema(t.kekid||{}),$.schema(t.keyEncryptionAlgorithm||{}),new z({name:t.encryptedKey||S})]})}fromSchema(e){W(e,Pb);const t=j(e,e,Vr.schema({names:{version:rl,kekid:{names:{blockName:sl}},keyEncryptionAlgorithm:{names:{blockName:al}},encryptedKey:Ci}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.kekid=new ls({schema:t.result.kekid}),this.keyEncryptionAlgorithm=new $({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new b({value:[new _({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}toJSON(){return{version:this.version,kekid:this.kekid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Vr.CLASS_NAME="KEKRecipientInfo";const nl="version",Fa="keyDerivationAlgorithm",il="keyEncryptionAlgorithm",Ai="encryptedKey",$h="password",Ub=[nl,Fa,il,Ai];class Jr extends G{constructor(e={}){super(),this.version=m(e,nl,Jr.defaultValues(nl)),Fa in e&&(this.keyDerivationAlgorithm=m(e,Fa,Jr.defaultValues(Fa))),this.keyEncryptionAlgorithm=m(e,il,Jr.defaultValues(il)),this.encryptedKey=m(e,Ai,Jr.defaultValues(Ai)),this.password=m(e,$h,Jr.defaultValues($h)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nl:return-1;case Fa:return new $;case il:return new $;case Ai:return new z;case $h:return Ot;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case nl:return t===-1;case Fa:case il:return t.algorithmId===S&&!("algorithmParams"in t);case Ai:return t.isEqual(Jr.defaultValues(Ai));case $h:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _({name:t.version||S}),new N({name:t.keyDerivationAlgorithm||S,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:$.schema().valueBlock.value}),$.schema(t.keyEncryptionAlgorithm||{}),new z({name:t.encryptedKey||S})]})}fromSchema(e){W(e,Ub);const t=j(e,e,Jr.schema({names:{version:nl,keyDerivationAlgorithm:Fa,keyEncryptionAlgorithm:{names:{blockName:il}},encryptedKey:Ai}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Fa in t.result&&(this.keyDerivationAlgorithm=new $({schema:new b({value:t.result.keyDerivationAlgorithm.valueBlock.value})})),this.keyEncryptionAlgorithm=new $({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return e.push(new _({value:this.version})),this.keyDerivationAlgorithm&&e.push(new N({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new b({value:e})}toJSON(){const e={version:this.version,keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()};return this.keyDerivationAlgorithm&&(e.keyDerivationAlgorithm=this.keyDerivationAlgorithm.toJSON()),e}}Jr.CLASS_NAME="PasswordRecipientInfo";const ol="oriType",Ei="oriValue",Kb=[ol,Ei];class wn extends G{constructor(e={}){super(),this.oriType=m(e,ol,wn.defaultValues(ol)),this.oriValue=m(e,Ei,wn.defaultValues(Ei)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ol:return S;case Ei:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ol:return t===S;case Ei:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.oriType||S}),new xe({name:t.oriValue||S})]})}fromSchema(e){W(e,Kb);const t=j(e,e,wn.schema({names:{oriType:ol,oriValue:Ei}}));K.assertSchema(t,this.className),this.oriType=t.result.oriType.valueBlock.toString(),this.oriValue=t.result.oriValue}toSchema(){return new b({value:[new he({value:this.oriType}),this.oriValue]})}toJSON(){const e={oriType:this.oriType};return wn.compareWithDefault(Ei,this.oriValue)||(e.oriValue=this.oriValue.toJSON()),e}}wn.CLASS_NAME="OtherRecipientInfo";const Dh="variant",_u="value",Mb=["blockName"];class jr extends G{constructor(e={}){super(),this.variant=m(e,Dh,jr.defaultValues(Dh)),_u in e&&(this.value=m(e,_u,jr.defaultValues(_u))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Dh:return-1;case _u:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Dh:return t===jr.defaultValues(e);case _u:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new Ct({value:[Rr.schema({names:{blockName:t.blockName||S}}),new N({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:1},value:Er.schema().valueBlock.value}),new N({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:2},value:Vr.schema().valueBlock.value}),new N({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:3},value:Jr.schema().valueBlock.value}),new N({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:4},value:wn.schema().valueBlock.value})]})}fromSchema(e){W(e,Mb);const t=j(e,e,jr.schema({names:{blockName:"blockName"}}));if(K.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1)this.variant=1,this.value=new Rr({schema:t.result.blockName});else{const r=new b({value:t.result.blockName.valueBlock.value});switch(t.result.blockName.idBlock.tagNumber){case 1:this.variant=2,this.value=new Er({schema:r});break;case 2:this.variant=3,this.value=new Vr({schema:r});break;case 3:this.variant=4,this.value=new Jr({schema:r});break;case 4:this.variant=5,this.value=new wn({schema:r});break;default:throw new Error("Incorrect structure of RecipientInfo block")}}}toSchema(){Ge.assertEmpty(this.value,"value","RecipientInfo");const e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new xe}}toJSON(){const e={variant:this.variant};return this.value&&this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}jr.CLASS_NAME="RecipientInfo";const qa="hashAlgorithm",Ja="maskGenAlgorithm",Ga="pSourceAlgorithm",Hb=[qa,Ja,Ga];class gr extends G{constructor(e={}){super(),this.hashAlgorithm=m(e,qa,gr.defaultValues(qa)),this.maskGenAlgorithm=m(e,Ja,gr.defaultValues(Ja)),this.pSourceAlgorithm=m(e,Ga,gr.defaultValues(Ga)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case qa:return new $({algorithmId:"1.3.14.3.2.26",algorithmParams:new xt});case Ja:return new $({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new $({algorithmId:"1.3.14.3.2.26",algorithmParams:new xt}).toSchema()});case Ga:return new $({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new z({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new N({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[$.schema(t.hashAlgorithm||{})]}),new N({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[$.schema(t.maskGenAlgorithm||{})]}),new N({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[$.schema(t.pSourceAlgorithm||{})]})]})}fromSchema(e){W(e,Hb);const t=j(e,e,gr.schema({names:{hashAlgorithm:{names:{blockName:qa}},maskGenAlgorithm:{names:{blockName:Ja}},pSourceAlgorithm:{names:{blockName:Ga}}}}));K.assertSchema(t,this.className),qa in t.result&&(this.hashAlgorithm=new $({schema:t.result.hashAlgorithm})),Ja in t.result&&(this.maskGenAlgorithm=new $({schema:t.result.maskGenAlgorithm})),Ga in t.result&&(this.pSourceAlgorithm=new $({schema:t.result.pSourceAlgorithm}))}toSchema(){const e=[];return this.hashAlgorithm.isEqual(gr.defaultValues(qa))||e.push(new N({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(gr.defaultValues(Ja))||e.push(new N({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(gr.defaultValues(Ga))||e.push(new N({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new b({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(gr.defaultValues(qa))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(gr.defaultValues(Ja))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(gr.defaultValues(Ga))||(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e}}gr.CLASS_NAME="RSAESOAEPParams";const ll="keyInfo",ja="entityUInfo",ul="suppPubInfo",Fb=[ll,ja,ul];class Xs extends G{constructor(e={}){super(),this.keyInfo=m(e,ll,Xs.defaultValues(ll)),ja in e&&(this.entityUInfo=m(e,ja,Xs.defaultValues(ja))),this.suppPubInfo=m(e,ul,Xs.defaultValues(ul)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ll:return new $;case ja:return new z;case ul:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ll:case ja:case ul:return t.isEqual(Xs.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[$.schema(t.keyInfo||{}),new N({name:t.entityUInfo||S,idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new z]}),new N({name:t.suppPubInfo||S,idBlock:{tagClass:3,tagNumber:2},value:[new z]})]})}fromSchema(e){W(e,Fb);const t=j(e,e,Xs.schema({names:{keyInfo:{names:{blockName:ll}},entityUInfo:ja,suppPubInfo:ul}}));K.assertSchema(t,this.className),this.keyInfo=new $({schema:t.result.keyInfo}),ja in t.result&&(this.entityUInfo=t.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=t.result.suppPubInfo.valueBlock.value[0]}toSchema(){const e=[];return e.push(this.keyInfo.toSchema()),this.entityUInfo&&e.push(new N({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new N({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new b({value:e})}toJSON(){const e={keyInfo:this.keyInfo.toJSON(),suppPubInfo:this.suppPubInfo.toJSON()};return this.entityUInfo&&(e.entityUInfo=this.entityUInfo.toJSON()),e}}Xs.CLASS_NAME="ECCCMSSharedInfo";const cl="version",Wa="originatorInfo",fl="recipientInfos",hl="encryptedContentInfo",Qa="unprotectedAttrs",qb=[cl,Wa,fl,hl,Qa],Dp={kdfAlgorithm:"SHA-512",kekEncryptionLength:256},Jb={"P-256":256,"P-384":384,"P-521":528};class is extends G{constructor(e={}){super(),this.version=m(e,cl,is.defaultValues(cl)),Wa in e&&(this.originatorInfo=m(e,Wa,is.defaultValues(Wa))),this.recipientInfos=m(e,fl,is.defaultValues(fl)),this.encryptedContentInfo=m(e,hl,is.defaultValues(hl)),Qa in e&&(this.unprotectedAttrs=m(e,Qa,is.defaultValues(Qa))),this.policy={disableSplit:!!e.disableSplit},e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cl:return 0;case Wa:return new ro;case fl:return[];case hl:return new Rt;case Qa:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case cl:return t===is.defaultValues(e);case Wa:return t.certs.certificates.length===0&&t.crls.crls.length===0;case fl:case Qa:return t.length===0;case hl:return Rt.compareWithDefault("contentType",t.contentType)&&Rt.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&Rt.compareWithDefault("encryptedContent",t.encryptedContent);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _({name:t.version||S}),new N({name:t.originatorInfo||S,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:ro.schema().valueBlock.value}),new Nt({value:[new _e({name:t.recipientInfos||S,value:jr.schema()})]}),Rt.schema(t.encryptedContentInfo||{}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new _e({name:t.unprotectedAttrs||S,value:mt.schema()})]})]})}fromSchema(e){W(e,qb);const t=j(e,e,is.schema({names:{version:cl,originatorInfo:Wa,recipientInfos:fl,encryptedContentInfo:{names:{blockName:hl}},unprotectedAttrs:Qa}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Wa in t.result&&(this.originatorInfo=new ro({schema:new b({value:t.result.originatorInfo.valueBlock.value})})),this.recipientInfos=Array.from(t.result.recipientInfos,r=>new jr({schema:r})),this.encryptedContentInfo=new Rt({schema:t.result.encryptedContentInfo}),Qa in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,r=>new mt({schema:r})))}toSchema(){const e=[];return e.push(new _({value:this.version})),this.originatorInfo&&e.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new Nt({value:Array.from(this.recipientInfos,t=>t.toSchema())})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new b({value:e})}toJSON(){const e={version:this.version,recipientInfos:Array.from(this.recipientInfos,t=>t.toJSON()),encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.originatorInfo&&(e.originatorInfo=this.originatorInfo.toJSON()),this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}addRecipientByCertificate(e,t,r,a=Le(!0)){const n=Object.assign({useOAEP:!0,oaepHashAlgorithm:"SHA-512"},Dp,t||{});if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549")!==-1)r=1;else if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045")!==-1)r=2;else throw new Error(`Unknown type of certificate's public key: ${e.subjectPublicKeyInfo.algorithm.algorithmId}`);switch(r){case 1:{let i,o;if(n.useOAEP===!0){i=a.getOIDByAlgorithm({name:"RSA-OAEP"},!0,"keyEncryptionAlgorithm");const u=a.getOIDByAlgorithm({name:n.oaepHashAlgorithm},!0,"RSAES-OAEP-params"),c=new $({algorithmId:u,algorithmParams:new xt});o=new gr({hashAlgorithm:c,maskGenAlgorithm:new $({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:c.toSchema()})}).toSchema()}else{if(i=a.getOIDByAlgorithm({name:"RSAES-PKCS1-v1_5"}),i===S)throw new Error("Can not find OID for RSAES-PKCS1-v1_5");o=new xt}const l=new Rr({version:0,rid:new Ut({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new $({algorithmId:i,algorithmParams:o}),recipientCertificate:e});this.recipientInfos.push(new jr({variant:1,value:l}))}break;case 2:{const i=new _s({variant:1,value:new Ut({issuer:e.issuer,serialNumber:e.serialNumber})});this._addKeyAgreeRecipientInfo(i,n,{recipientCertificate:e},a)}break;default:throw new Error(`Unknown "variant" value: ${r}`)}return!0}addRecipientByPreDefinedData(e,t={},r,a=Le(!0)){if(rt.assert(e,"preDefinedData","ArrayBuffer"),!e.byteLength)throw new Error("Pre-defined data could have zero length");if(!t.keyIdentifier){const n=new ArrayBuffer(16),i=new Uint8Array(n);a.getRandomValues(i),t.keyIdentifier=n}switch(t.hmacHashAlgorithm||(t.hmacHashAlgorithm="SHA-512"),t.iterationCount===void 0&&(t.iterationCount=2048),t.keyEncryptionAlgorithm||(t.keyEncryptionAlgorithm={name:"AES-KW",length:256}),t.keyEncryptionAlgorithmParams||(t.keyEncryptionAlgorithmParams=new xt),r){case 1:{const n=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),i=new Vr({version:4,kekid:new ls({keyIdentifier:new z({valueHex:t.keyIdentifier})}),keyEncryptionAlgorithm:new $({algorithmId:n,algorithmParams:t.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new jr({variant:3,value:i}))}break;case 2:{const n=a.getOIDByAlgorithm({name:"PBKDF2"},!0,"keyDerivationAlgorithm"),i=new ArrayBuffer(64),o=new Uint8Array(i);a.getRandomValues(o);const l=a.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),u=new ur({salt:new z({valueHex:i}),iterationCount:t.iterationCount,prf:new $({algorithmId:l,algorithmParams:new xt})}),c=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),f=new Jr({version:0,keyDerivationAlgorithm:new $({algorithmId:n,algorithmParams:u.toSchema()}),keyEncryptionAlgorithm:new $({algorithmId:c,algorithmParams:t.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new jr({variant:4,value:f}))}break;default:throw new Error(`Unknown value for "variant": ${r}`)}}addRecipientByKeyIdentifier(e,t,r,a=Le(!0)){const n=Object.assign({},Dp,r||{}),i=new _s({variant:2,value:new Is({subjectKeyIdentifier:new z({valueHex:t})})});this._addKeyAgreeRecipientInfo(i,n,{recipientPublicKey:e},a)}_addKeyAgreeRecipientInfo(e,t,r,a=Le(!0)){const n=new na({rid:e}),i=a.getOIDByAlgorithm({name:"AES-KW",length:t.kekEncryptionLength},!0,"keyEncryptionAlgorithm"),o=new $({algorithmId:i}),l=a.getOIDByAlgorithm({name:"ECDH",kdf:t.kdfAlgorithm},!0,"KeyAgreeRecipientInfo"),u=new ArrayBuffer(64),c=new Uint8Array(u);a.getRandomValues(c);const f={version:3,ukm:new z({valueHex:u}),keyEncryptionAlgorithm:new $({algorithmId:l,algorithmParams:o.toSchema()}),recipientEncryptedKeys:new kn({encryptedKeys:[n]})},g=new Er(Object.assign(f,r));this.recipientInfos.push(new jr({variant:2,value:g}))}async encrypt(e,t,r=Le(!0)){const a=new ArrayBuffer(16),n=new Uint8Array(a);r.getRandomValues(n);const i=new Uint8Array(t),o=r.getOIDByAlgorithm(e,!0,"contentEncryptionAlgorithm"),l=await r.generateKey(e,!0,["encrypt"]),u=await r.encrypt({name:e.name,iv:n},l,i),c=await r.exportKey("raw",l);this.version=2,this.encryptedContentInfo=new Rt({disableSplit:this.policy.disableSplit,contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new $({algorithmId:o,algorithmParams:new z({valueHex:a})}),encryptedContent:new z({valueHex:u})});const f=async d=>{const y=this.recipientInfos[d].value;let E,k;if(y.recipientPublicKey)E=y.recipientPublicKey.algorithm.namedCurve,k=y.recipientPublicKey;else if(y.recipientCertificate){const te=y.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(te.constructor.blockName()!==he.blockName())throw new Error(`Incorrect "recipientCertificate" for index ${d}`);switch(te.valueBlock.toString()){case"1.2.840.10045.3.1.7":E="P-256";break;case"1.3.132.0.34":E="P-384";break;case"1.3.132.0.35":E="P-521";break;default:throw new Error(`Incorrect curve OID for index ${d}`)}k=await y.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:E},usages:[]}},r)}else throw new Error("Unsupported RecipientInfo");const R=Jb[E],V=await r.generateKey({name:"ECDH",namedCurve:E},!0,["deriveBits"]),L=await r.exportKey("spki",V.publicKey),ne=await r.deriveBits({name:"ECDH",public:k},V.privateKey,R),ae=new $({schema:y.keyEncryptionAlgorithm.algorithmParams}),ve=r.getAlgorithmByOID(ae.algorithmId,!0,"aesKWAlgorithm");let Te=ve.length;const ye=new ArrayBuffer(4),Ce=new Uint8Array(ye);for(let te=3;te>=0;te--)Ce[te]=Te,Te>>=8;const Pe=new Xs({keyInfo:new $({algorithmId:ae.algorithmId}),entityUInfo:y.ukm,suppPubInfo:new z({valueHex:ye})}).toSchema().toBER(!1),pe=r.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm"),$e=await Ap(pe.kdf,ne,ve.length,Pe,r),ie=await r.importKey("raw",$e,{name:"AES-KW"},!0,["wrapKey"]),ot=await r.wrapKey("raw",l,ie,{name:"AES-KW"}),Me=new ca;return Me.variant=3,Me.value=aa.fromBER(L),y.originator=Me,y.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new z({valueHex:ot}),{ecdhPrivateKey:V.privateKey}},g=async d=>{const y=this.recipientInfos[d].value,E=r.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(E.name==="RSA-OAEP"){const k=y.keyEncryptionAlgorithm.algorithmParams,R=new gr({schema:k});if(E.hash=r.getAlgorithmByOID(R.hashAlgorithm.algorithmId),!("name"in E.hash))throw new Error(`Incorrect OID for hash algorithm: ${R.hashAlgorithm.algorithmId}`)}try{const k=await y.recipientCertificate.getPublicKey({algorithm:{algorithm:E,usages:["encrypt","wrapKey"]}},r),R=await r.encrypt(k.algorithm,k,c);y.encryptedKey=new z({valueHex:R})}catch{}},v=async d=>{const y=this.recipientInfos[d].value,E=r.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),k=await r.importKey("raw",new Uint8Array(y.preDefinedKEK),E,!0,["wrapKey"]),R=await r.wrapKey("raw",l,k,E);y.encryptedKey=new z({valueHex:R})},p=async d=>{const y=this.recipientInfos[d].value;let E;if(!y.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!y.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{E=new ur({schema:y.keyDerivationAlgorithm.algorithmParams})}catch{throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const k=new Uint8Array(y.password),R=await r.importKey("raw",k,"PBKDF2",!1,["deriveKey"]),V=r.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm");let L="SHA-1";E.prf&&(L=r.getAlgorithmByOID(E.prf.algorithmId,!0,"prfAlgorithm").hash.name);const ne=new Uint8Array(E.salt.valueBlock.valueHex),ae=E.iterationCount,ve=await r.deriveKey({name:"PBKDF2",hash:{name:L},salt:ne,iterations:ae},R,V,!0,["wrapKey"]),Te=await r.wrapKey("raw",l,ve,V);y.encryptedKey=new z({valueHex:Te})},h=[];for(let d=0;d<this.recipientInfos.length;d++)switch(this.recipientInfos[d].variant){case 1:h.push(await g(d));break;case 2:h.push(await f(d));break;case 3:h.push(await v(d));break;case 4:h.push(await p(d));break;default:throw new Error(`Unknown recipient type in array with index ${d}`)}return h}async decrypt(e,t,r=Le(!0)){const a=t||{};if(e+1>this.recipientInfos.length)throw new Error(`Maximum value for "index" is: ${this.recipientInfos.length-1}`);const n=async h=>{const d=this.recipientInfos[h].value;let y,E,k;const R=d.originator;if(a.recipientCertificate){const pe=a.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(pe.constructor.blockName()!==he.blockName())throw new Error(`Incorrect "recipientCertificate" for index ${h}`);y=pe.valueBlock.toString()}else if(R.value.algorithm.algorithmParams){const pe=R.value.algorithm.algorithmParams;if(pe.constructor.blockName()!==he.blockName())throw new Error(`Incorrect originator for index ${h}`);y=pe.valueBlock.toString()}else throw new Error('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo" if algorithm params are missing from originator');if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');switch(y){case"1.2.840.10045.3.1.7":E="P-256",k=256;break;case"1.3.132.0.34":E="P-384",k=384;break;case"1.3.132.0.35":E="P-521",k=528;break;default:throw new Error(`Incorrect curve OID for index ${h}`)}let V,L=r;Ee.isBufferSource(a.recipientPrivateKey)?V=await r.importKey("pkcs8",a.recipientPrivateKey,{name:"ECDH",namedCurve:E},!0,["deriveBits"]):(V=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(L=a.crypto.subtle)),"algorithmParams"in R.value.algorithm||(R.value.algorithm.algorithmParams=new he({value:y}));const ne=R.value.toSchema().toBER(!1),ae=await r.importKey("spki",ne,{name:"ECDH",namedCurve:E},!0,[]),ve=await L.deriveBits({name:"ECDH",public:ae},V,k);async function Te(pe){pe=pe||!1;const $e=new $({schema:d.keyEncryptionAlgorithm.algorithmParams}),ie=r.getAlgorithmByOID($e.algorithmId,!0,"kwAlgorithm");let ot=ie.length;const Me=new ArrayBuffer(4),te=new Uint8Array(Me);for(let qe=3;qe>=0;qe--)te[qe]=ot,ot>>=8;const oe={algorithmId:$e.algorithmId};pe&&(oe.algorithmParams=new xt);const me=new Xs({keyInfo:new $(oe),entityUInfo:d.ukm,suppPubInfo:new z({valueHex:Me})}).toSchema().toBER(!1),Ae=r.getAlgorithmByOID(d.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm");if(!Ae.name)throw new Error(`Incorrect OID for key encryption algorithm: ${d.keyEncryptionAlgorithm.algorithmId}`);return Ap(Ae.kdf,ve,ie.length,me,r)}const ye=await Te(),Ce=async pe=>r.importKey("raw",pe,{name:"AES-KW"},!0,["unwrapKey"]),Ve=await Ce(ye),Pe=async pe=>{const $e=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,ie=r.getAlgorithmByOID($e,!0,"contentEncryptionAlgorithm");return r.unwrapKey("raw",d.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHexView,pe,{name:"AES-KW"},ie,!0,["decrypt"])};try{return await Pe(Ve)}catch{const pe=await Te(!0),$e=await Ce(pe);return Pe($e)}},i=async h=>{const d=this.recipientInfos[h].value;if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');const y=r.getAlgorithmByOID(d.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(y.name==="RSA-OAEP"){const ne=d.keyEncryptionAlgorithm.algorithmParams,ae=new gr({schema:ne});if(y.hash=r.getAlgorithmByOID(ae.hashAlgorithm.algorithmId),!("name"in y.hash))throw new Error(`Incorrect OID for hash algorithm: ${ae.hashAlgorithm.algorithmId}`)}let E,k=r;Ee.isBufferSource(a.recipientPrivateKey)?E=await r.importKey("pkcs8",a.recipientPrivateKey,y,!0,["decrypt"]):(E=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(k=a.crypto.subtle));const R=await k.decrypt(E.algorithm,E,d.encryptedKey.valueBlock.valueHexView),V=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,L=r.getAlgorithmByOID(V,!0,"contentEncryptionAlgorithm");if(!("name"in L))throw new Error(`Incorrect "contentEncryptionAlgorithm": ${V}`);return r.importKey("raw",R,L,!0,["decrypt"])},o=async h=>{const d=this.recipientInfos[h].value;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');const y=r.getAlgorithmByOID(d.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),E=await r.importKey("raw",a.preDefinedData,y,!0,["unwrapKey"]),k=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,R=r.getAlgorithmByOID(k,!0,"contentEncryptionAlgorithm");if(!R.name)throw new Error(`Incorrect "contentEncryptionAlgorithm": ${k}`);return r.unwrapKey("raw",d.encryptedKey.valueBlock.valueHexView,E,y,R,!0,["decrypt"])},l=async h=>{const d=this.recipientInfos[h].value;let y;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');if(!d.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!d.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{y=new ur({schema:d.keyDerivationAlgorithm.algorithmParams})}catch{throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const E=await r.importKey("raw",a.preDefinedData,"PBKDF2",!1,["deriveKey"]),k=r.getAlgorithmByOID(d.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm"),R=y.prf?r.getAlgorithmByOID(y.prf.algorithmId,!0,"prfAlgorithm").hash.name:"SHA-1",V=new Uint8Array(y.salt.valueBlock.valueHex),L=y.iterationCount,ne=await r.deriveKey({name:"PBKDF2",hash:{name:R},salt:V,iterations:L},E,k,!0,["unwrapKey"]),ae=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,ve=r.getAlgorithmByOID(ae,!0,"contentEncryptionAlgorithm");return r.unwrapKey("raw",d.encryptedKey.valueBlock.valueHexView,ne,k,ve,!0,["decrypt"])};let u;switch(this.recipientInfos[e].variant){case 1:u=await i(e);break;case 2:u=await n(e);break;case 3:u=await o(e);break;case 4:u=await l(e);break;default:throw new Error(`Unknown recipient type in array with index ${e}`)}const c=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,f=r.getAlgorithmByOID(c,!0,"contentEncryptionAlgorithm"),g=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex,v=new Uint8Array(g);if(!this.encryptedContentInfo.encryptedContent)throw new Error("Required property `encryptedContent` is empty");const p=this.encryptedContentInfo.getEncryptedContent();return r.decrypt({name:f.name,iv:v},u,p)}}is.CLASS_NAME="EnvelopedData";const vo="safeContents",$u="parsedValue",Lp="contentInfos";class so extends G{constructor(e={}){super(),this.safeContents=m(e,vo,so.defaultValues(vo)),$u in e&&(this.parsedValue=m(e,$u,so.defaultValues($u))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vo:return[];case $u:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case vo:return t.length===0;case $u:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _e({name:t.contentInfos||S,value:ft.schema()})]})}fromSchema(e){W(e,[Lp]);const t=j(e,e,so.schema({names:{contentInfos:Lp}}));K.assertSchema(t,this.className),this.safeContents=Array.from(t.result.contentInfos,r=>new ft({schema:r}))}toSchema(){return new b({value:Array.from(this.safeContents,e=>e.toSchema())})}toJSON(){return{safeContents:Array.from(this.safeContents,e=>e.toJSON())}}async parseInternalValues(e,t=Le(!0)){if(Ge.assert(e,vo),rt.assert(e.safeContents,vo,"Array"),e.safeContents.length!==this.safeContents.length)throw new rt('Length of "parameters.safeContents" must be equal to "this.safeContents.length"');this.parsedValue={safeContents:[]};for(const[r,a]of this.safeContents.entries()){const n=e.safeContents[r],i=`parameters.safeContents[${r}]`;switch(a.contentType){case Sm:{rt.assert(a.content,"this.safeContents[j].content",z);const o=a.content.getValue();this.parsedValue.safeContents.push({privacyMode:0,value:sa.fromBER(o)})}break;case n1:{const o=new is({schema:a.content});Ge.assert(i,n,"recipientCertificate","recipientKey");const l=n,u=l.recipientCertificate,c=l.recipientKey,f=await o.decrypt(0,{recipientCertificate:u,recipientPrivateKey:c},t);this.parsedValue.safeContents.push({privacyMode:2,value:sa.fromBER(f)})}break;case i1:{const o=new Ns({schema:a.content});Ge.assert(i,n,"password");const l=n.password,u=await o.decrypt({password:l},t);this.parsedValue.safeContents.push({privacyMode:1,value:sa.fromBER(u)})}break;default:throw new Error(`Unknown "contentType" for AuthenticatedSafe: " ${a.contentType}`)}}}async makeInternalValues(e,t=Le(!0)){if(!this.parsedValue)throw new Error('Please run "parseValues" first or add "parsedValue" manually');if(rt.assert(this.parsedValue,"this.parsedValue","object"),rt.assert(this.parsedValue.safeContents,"this.parsedValue.safeContents","Array"),rt.assert(e,"parameters","object"),Ge.assert(e,"safeContents"),rt.assert(e.safeContents,"parameters.safeContents","Array"),e.safeContents.length!==this.parsedValue.safeContents.length)throw new rt('Length of "parameters.safeContents" must be equal to "this.parsedValue.safeContents"');this.safeContents=[];for(const[r,a]of this.parsedValue.safeContents.entries())switch(Ge.assert("content",a,"privacyMode","value"),rt.assert(a.value,"content.value",sa),a.privacyMode){case 0:{const n=a.value.toSchema().toBER(!1);this.safeContents.push(new ft({contentType:"1.2.840.113549.1.7.1",content:new z({valueHex:n})}))}break;case 1:{const n=new Ns,i=e.safeContents[r];i.contentToEncrypt=a.value.toSchema().toBER(!1),await n.encrypt(i,t),this.safeContents.push(new ft({contentType:"1.2.840.113549.1.7.6",content:n.toSchema()}))}break;case 2:{const n=new is,i=a.value.toSchema().toBER(!1),o=e.safeContents[r];switch(Ge.assert(`parameters.safeContents[${r}]`,o,"encryptingCertificate","encryptionAlgorithm"),!0){case o.encryptionAlgorithm.name.toLowerCase()==="aes-cbc":case o.encryptionAlgorithm.name.toLowerCase()==="aes-gcm":break;default:throw new Error(`Incorrect parameter "encryptionAlgorithm" in "parameters.safeContents[i]": ${o.encryptionAlgorithm}`)}switch(!0){case o.encryptionAlgorithm.length===128:case o.encryptionAlgorithm.length===192:case o.encryptionAlgorithm.length===256:break;default:throw new Error(`Incorrect parameter "encryptionAlgorithm.length" in "parameters.safeContents[i]": ${o.encryptionAlgorithm.length}`)}const l=o.encryptionAlgorithm;n.addRecipientByCertificate(o.encryptingCertificate,{},void 0,t),await n.encrypt(l,i,t),this.safeContents.push(new ft({contentType:"1.2.840.113549.1.7.3",content:n.toSchema()}))}break;default:throw new Error(`Incorrect value for "content.privacyMode": ${a.privacyMode}`)}return this}}so.CLASS_NAME="AuthenticatedSafe";const bi="hashAlgorithm",dl="issuerNameHash",gl="issuerKeyHash",ki="serialNumber",Gb=[bi,dl,gl,ki];class _t extends G{constructor(e={}){super(),this.hashAlgorithm=m(e,bi,_t.defaultValues(bi)),this.issuerNameHash=m(e,dl,_t.defaultValues(dl)),this.issuerKeyHash=m(e,gl,_t.defaultValues(gl)),this.serialNumber=m(e,ki,_t.defaultValues(ki)),e.schema&&this.fromSchema(e.schema)}static async create(e,t,r=Le(!0)){const a=new _t;return await a.createForCertificate(e,t,r),a}static defaultValues(e){switch(e){case bi:return new $;case dl:case gl:return new z;case ki:return new _;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bi:return t.algorithmId===S&&!("algorithmParams"in t);case dl:case gl:case ki:return t.isEqual(_t.defaultValues(ki));default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[$.schema(t.hashAlgorithmObject||{names:{blockName:t.hashAlgorithm||S}}),new z({name:t.issuerNameHash||S}),new z({name:t.issuerKeyHash||S}),new _({name:t.serialNumber||S})]})}fromSchema(e){W(e,Gb);const t=j(e,e,_t.schema({names:{hashAlgorithm:bi,issuerNameHash:dl,issuerKeyHash:gl,serialNumber:ki}}));K.assertSchema(t,this.className),this.hashAlgorithm=new $({schema:t.result.hashAlgorithm}),this.issuerNameHash=t.result.issuerNameHash,this.issuerKeyHash=t.result.issuerKeyHash,this.serialNumber=t.result.serialNumber}toSchema(){return new b({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}isEqual(e){return!(this.hashAlgorithm.algorithmId!==e.hashAlgorithm.algorithmId||!Ee.isEqual(this.issuerNameHash.valueBlock.valueHexView,e.issuerNameHash.valueBlock.valueHexView)||!Ee.isEqual(this.issuerKeyHash.valueBlock.valueHexView,e.issuerKeyHash.valueBlock.valueHexView)||!this.serialNumber.isEqual(e.serialNumber))}async createForCertificate(e,t,r=Le(!0)){Ge.assert(t,bi,"issuerCertificate");const a=r.getOIDByAlgorithm({name:t.hashAlgorithm},!0,"hashAlgorithm");this.hashAlgorithm=new $({algorithmId:a,algorithmParams:new xt});const n=t.issuerCertificate;this.serialNumber=e.serialNumber;const i=await r.digest({name:t.hashAlgorithm},n.subject.toSchema().toBER(!1));this.issuerNameHash=new z({valueHex:i});const o=n.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView,l=await r.digest({name:t.hashAlgorithm},o);this.issuerKeyHash=new z({valueHex:l})}}_t.CLASS_NAME="CertID";const ml="certID",pl="certStatus",yl="thisUpdate",Ya="nextUpdate",Ii="singleExtensions",jb=[ml,pl,yl,Ya,Ii];class os extends G{constructor(e={}){super(),this.certID=m(e,ml,os.defaultValues(ml)),this.certStatus=m(e,pl,os.defaultValues(pl)),this.thisUpdate=m(e,yl,os.defaultValues(yl)),Ya in e&&(this.nextUpdate=m(e,Ya,os.defaultValues(Ya))),Ii in e&&(this.singleExtensions=m(e,Ii,os.defaultValues(Ii))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ml:return new _t;case pl:return{};case yl:case Ya:return new Date(0,0,0);case Ii:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ml:return _t.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&_t.compareWithDefault("issuerNameHash",t.issuerNameHash)&&_t.compareWithDefault("issuerKeyHash",t.issuerKeyHash)&&_t.compareWithDefault("serialNumber",t.serialNumber);case pl:return Object.keys(t).length===0;case yl:case Ya:return t===os.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[_t.schema(t.certID||{}),new Ct({value:[new Ie({name:t.certStatus||S,idBlock:{tagClass:3,tagNumber:0}}),new N({name:t.certStatus||S,idBlock:{tagClass:3,tagNumber:1},value:[new St,new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new no]})]}),new Ie({name:t.certStatus||S,idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new St({name:t.thisUpdate||S}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new St({name:t.nextUpdate||S})]}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Pt.schema(t.singleExtensions||{})]})]})}fromSchema(e){W(e,jb);const t=j(e,e,os.schema({names:{certID:{names:{blockName:ml}},certStatus:pl,thisUpdate:yl,nextUpdate:Ya,singleExtensions:{names:{blockName:Ii}}}}));K.assertSchema(t,this.className),this.certID=new _t({schema:t.result.certID}),this.certStatus=t.result.certStatus,this.thisUpdate=t.result.thisUpdate.toDate(),Ya in t.result&&(this.nextUpdate=t.result.nextUpdate.toDate()),Ii in t.result&&(this.singleExtensions=Array.from(t.result.singleExtensions.valueBlock.value,r=>new Vt({schema:r})))}toSchema(){const e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new St({valueDate:this.thisUpdate})),this.nextUpdate&&e.push(new N({idBlock:{tagClass:3,tagNumber:0},value:[new St({valueDate:this.nextUpdate})]})),this.singleExtensions&&e.push(new b({value:Array.from(this.singleExtensions,t=>t.toSchema())})),new b({value:e})}toJSON(){const e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return this.nextUpdate&&(e.nextUpdate=this.nextUpdate),this.singleExtensions&&(e.singleExtensions=Array.from(this.singleExtensions,t=>t.toJSON())),e}}os.CLASS_NAME="SingleResponse";const Lh="tbs",Bi="version",pf="responderID",yf="producedAt",vf="responses",vl="responseExtensions",co="ResponseData",Xh=`${co}.${Bi}`,wl=`${co}.${pf}`,Ag=`${co}.${yf}`,Eg=`${co}.${vf}`,Zh=`${co}.${vl}`,Wb=[co,Xh,wl,Ag,Eg,Zh];class qt extends G{constructor(e={}){super(),this.tbsView=new Uint8Array(m(e,Lh,qt.defaultValues(Lh))),Bi in e&&(this.version=m(e,Bi,qt.defaultValues(Bi))),this.responderID=m(e,pf,qt.defaultValues(pf)),this.producedAt=m(e,yf,qt.defaultValues(yf)),this.responses=m(e,vf,qt.defaultValues(vf)),vl in e&&(this.responseExtensions=m(e,vl,qt.defaultValues(vl))),e.schema&&this.fromSchema(e.schema)}get tbs(){return Ee.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}static defaultValues(e){switch(e){case Bi:return 0;case Lh:return Ot;case pf:return{};case yf:return new Date(0,0,0);case vf:case vl:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Lh:return t.byteLength===0;case pf:return Object.keys(t).length===0;case yf:return t===qt.defaultValues(e);case vf:case vl:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||co,value:[new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new _({name:t.version||Xh})]}),new Ct({value:[new N({name:t.responderID||wl,idBlock:{tagClass:3,tagNumber:1},value:[st.schema(t.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new N({name:t.responderID||wl,idBlock:{tagClass:3,tagNumber:2},value:[new z({name:t.ResponseDataByKey||"ResponseData.byKey"})]})]}),new St({name:t.producedAt||Ag}),new b({value:[new _e({name:Eg,value:os.schema(t.response||{})})]}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Pt.schema(t.extensions||{names:{blockName:Zh}})]})]})}fromSchema(e){W(e,Wb);const t=j(e,e,qt.schema());K.assertSchema(t,this.className),this.tbsView=t.result.ResponseData.valueBeforeDecodeView,Xh in t.result&&(this.version=t.result[Xh].valueBlock.valueDec),t.result[wl].idBlock.tagNumber===1?this.responderID=new st({schema:t.result[wl].valueBlock.value[0]}):this.responderID=t.result[wl].valueBlock.value[0],this.producedAt=t.result[Ag].toDate(),this.responses=Array.from(t.result[Eg],r=>new os({schema:r})),Zh in t.result&&(this.responseExtensions=Array.from(t.result[Zh].valueBlock.value,r=>new Vt({schema:r})))}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return qt.schema();const r=Lt(this.tbsView);K.assert(r,"TBS Response Data"),t=r.result}else{const r=[];Bi in this&&r.push(new N({idBlock:{tagClass:3,tagNumber:0},value:[new _({value:this.version})]})),this.responderID instanceof st?r.push(new N({idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]})):r.push(new N({idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),r.push(new St({valueDate:this.producedAt})),r.push(new b({value:Array.from(this.responses,a=>a.toSchema())})),this.responseExtensions&&r.push(new N({idBlock:{tagClass:3,tagNumber:1},value:[new b({value:Array.from(this.responseExtensions,a=>a.toSchema())})]})),t=new b({value:r})}return t}toJSON(){const e={};return Bi in this&&(e.version=this.version),this.responderID&&(e.responderID=this.responderID),this.producedAt&&(e.producedAt=this.producedAt),this.responses&&(e.responses=Array.from(this.responses,t=>t.toJSON())),this.responseExtensions&&(e.responseExtensions=Array.from(this.responseExtensions,t=>t.toJSON())),e}}qt.CLASS_NAME="ResponseData";const Kd="trustedCerts",Md="certs",Hd="crls",Fd="ocsps",qd="checkDate",Jd="findOrigin",Gd="findIssuer";var Ki;(function(s){s[s.unknown=-1]="unknown",s[s.success=0]="success",s[s.noRevocation=11]="noRevocation",s[s.noPath=60]="noPath",s[s.noValidPath=97]="noValidPath"})(Ki||(Ki={}));class ln extends Error{constructor(e,t){super(t),this.name=ln.NAME,this.code=e,this.message=t}}ln.NAME="ChainValidationError";function Qb(s,e){for(let t=0;t<e.length;t++)if(Ee.isEqual(s.tbsView,e[t].tbsView))return!0;return!1}class fd{constructor(e={}){this.trustedCerts=m(e,Kd,this.defaultValues(Kd)),this.certs=m(e,Md,this.defaultValues(Md)),this.crls=m(e,Hd,this.defaultValues(Hd)),this.ocsps=m(e,Fd,this.defaultValues(Fd)),this.checkDate=m(e,qd,this.defaultValues(qd)),this.findOrigin=m(e,Jd,this.defaultValues(Jd)),this.findIssuer=m(e,Gd,this.defaultValues(Gd))}static defaultFindOrigin(e,t){e.tbsView.byteLength===0&&(e.tbsView=new Uint8Array(e.encodeTBS().toBER()));for(const r of t.certs)if(r.tbsView.byteLength===0&&(r.tbsView=new Uint8Array(r.encodeTBS().toBER())),Ee.isEqual(e.tbsView,r.tbsView))return"Intermediate Certificates";for(const r of t.trustedCerts)if(r.tbsView.byteLength===0&&(r.tbsView=new Uint8Array(r.encodeTBS().toBER())),Ee.isEqual(e.tbsView,r.tbsView))return"Trusted Certificates";return"Unknown"}async defaultFindIssuer(e,t,r=Le(!0)){const a=[];let n=null,i=null,o=null;if(e.subject.isEqual(e.issuer))try{if(await e.verify(void 0,r))return[e]}catch{}if(e.extensions){for(const u of e.extensions)if(u.extnID===vm&&u.parsedValue instanceof mn){u.parsedValue.keyIdentifier?n=u.parsedValue.keyIdentifier:(u.parsedValue.authorityCertIssuer&&(i=u.parsedValue.authorityCertIssuer),u.parsedValue.authorityCertSerialNumber&&(o=u.parsedValue.authorityCertSerialNumber));break}}function l(u){if(n!==null&&u.extensions){let f=!1;for(const g of u.extensions)if(g.extnID===ZA&&g.parsedValue){f=!0,Ee.isEqual(g.parsedValue.valueBlock.valueHex,n.valueBlock.valueHexView)&&a.push(u);break}if(f)return}let c=!1;o!==null&&(c=u.serialNumber.isEqual(o)),i!==null?u.subject.isEqual(i)&&c&&a.push(u):e.issuer.isEqual(u.subject)&&a.push(u)}for(const u of t.trustedCerts)l(u);for(const u of t.certs)l(u);for(let u=a.length-1;u>=0;u--)try{await e.verify(a[u],r)===!1&&a.splice(u,1)}catch{a.splice(u,1)}return a}defaultValues(e){switch(e){case Kd:return[];case Md:return[];case Hd:return[];case Fd:return[];case qd:return new Date;case Jd:return fd.defaultFindOrigin;case Gd:return this.defaultFindIssuer;default:throw new Error(`Invalid member name for CertificateChainValidationEngine class: ${e}`)}}async sort(e=!1,t=Le(!0)){const r=[],a=async(p,h)=>{const d=[];function y(k){let R=!0;for(let V=0;V<k.length;V++){for(let L=0;L<k.length;L++)if(L!==V&&k[V]===k[L]){R=!1;break}if(!R)break}return R}if(Qb(p,this.trustedCerts))return[[p]];const E=await this.findIssuer(p,this,h);if(E.length===0)throw new Error("No valid certificate paths found");for(let k=0;k<E.length;k++){if(Ee.isEqual(E[k].tbsView,p.tbsView)){d.push([E[k]]);continue}const R=await a(E[k],h);for(let V=0;V<R.length;V++){const L=R[V].slice();L.splice(0,0,E[k]),y(L)?d.push(L):d.push(R[V])}}return d},n=async p=>{const h=[],d=[],y=[];if(h.push(...r.filter(E=>p.issuer.isEqual(E.subject))),h.length===0)return{status:1,statusMessage:"No certificate's issuers"};if(d.push(...this.crls.filter(E=>E.issuer.isEqual(p.issuer))),d.length===0)return{status:2,statusMessage:"No CRLs for specific certificate issuer"};for(let E=0;E<d.length;E++){const k=d[E];if(!(k.nextUpdate&&k.nextUpdate.value<this.checkDate))for(let R=0;R<h.length;R++)try{if(await d[E].verify({issuerCertificate:h[R]},t)){y.push({crl:d[E],certificate:h[R]});break}}catch{}}return y.length?{status:0,statusMessage:S,result:y}:{status:3,statusMessage:"No valid CRLs found"}},i=async(p,h)=>{const d=t.getAlgorithmByOID(p.signatureAlgorithm.algorithmId);if(!d.name||!d.hash)return 1;for(let y=0;y<this.ocsps.length;y++){const k=await this.ocsps[y].getCertificateStatus(p,h,t);if(k.isForCertificate)return k.status===0?0:1}return 2};async function o(p,h=!1){let d=!1,y=!1,E=!1,k=!1;if(p.extensions){for(let R=0;R<p.extensions.length;R++){const V=p.extensions[R];if(V.critical&&!V.parsedValue)return{result:!1,resultCode:6,resultMessage:`Unable to parse critical certificate extension: ${V.extnID}`};if(V.extnID===eE){E=!0;const L=new Uint8Array(V.parsedValue.valueBlock.valueHex);(L[0]&4)===4&&(y=!0),(L[0]&2)===2&&(k=!0)}V.extnID===pm&&"cA"in V.parsedValue&&V.parsedValue.cA===!0&&(d=!0)}if(y===!0&&d===!1)return{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstraints'};if(E===!0&&d===!0&&y===!1)return{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'};if(d===!0&&E===!0&&h&&k===!1)return{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'}}return d===!1?{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"}:{result:!0,resultCode:0,resultMessage:S}}const l=async(p,h)=>{for(let d=0;d<p.length;d++)if(p[d].notBefore.value>h||p[d].notAfter.value<h)return{result:!1,resultCode:8,resultMessage:"The certificate is either not yet valid or expired"};if(p.length<2)return{result:!1,resultCode:9,resultMessage:"Too short certificate path"};for(let d=p.length-2;d>=0;d--)if(p[d].issuer.isEqual(p[d].subject)===!1&&p[d].issuer.isEqual(p[d+1].subject)===!1)return{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"};if(this.crls.length!==0||this.ocsps.length!==0)for(let d=0;d<p.length-1;d++){let y=2,E={status:0,statusMessage:S};if(this.ocsps.length!==0)switch(y=await i(p[d],p[d+1]),y){case 0:continue;case 1:return{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"}}if(this.crls.length!==0){if(E=await n(p[d]),E.status===0&&E.result)for(let k=0;k<E.result.length;k++){if(E.result[k].crl.isCertificateRevoked(p[d]))return{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"};if((await o(E.result[k].certificate,!0)).result===!1)return{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"}}else if(e===!1)throw new ln(Ki.noRevocation,`No revocation values found for one of certificates: ${E.statusMessage}`)}else if(y===2)return{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"};if(y===2&&E.status===2&&e){const k=p[d+1];let R=!1;if(k.extensions)for(const V of k.extensions)switch(V.extnID){case e1:case ym:case wm:R=!0;break}if(R)throw new ln(Ki.noRevocation,`No revocation values found for one of certificates: ${E.statusMessage}`)}}for(const[d,y]of p.entries()){if(!d)continue;if(!(await o(y)).result)return{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"}}return{result:!0}};r.push(...this.trustedCerts),r.push(...this.certs);for(let p=0;p<r.length;p++)for(let h=0;h<r.length;h++)if(p!==h&&Ee.isEqual(r[p].tbsView,r[h].tbsView)){r.splice(h,1),p=0;break}const u=r[r.length-1];let c;const f=[u];if(c=await a(u,t),c.length===0)throw new ln(Ki.noPath,"Unable to find certificate path");for(let p=c.length-1;p>=0;p--){let h=!1;for(let d=0;d<c[p].length;d++){const y=c[p][d];for(let E=0;E<this.trustedCerts.length;E++)if(Ee.isEqual(y.tbsView,this.trustedCerts[E].tbsView)){h=!0;break}if(h)break}h||c.splice(p,1)}if(c.length===0)throw new ln(Ki.noValidPath,"No valid certificate paths found");let g=c[0].length,v=0;for(let p=0;p<c.length;p++)c[p].length<g&&(g=c[p].length,v=p);for(let p=0;p<c[v].length;p++)f.push(c[v][p]);if(c=await l(f,this.checkDate),c.result===!1)throw c;return f}async verify(e={},t=Le(!0)){function r(l,u){const c=sn(l),f=sn(u),g=c.split("."),v=f.split("."),p=g.length,h=v.length;if(p===0||h===0||p<h)return!1;for(let d=0;d<p;d++)if(g[d].length===0)return!1;for(let d=0;d<h;d++)if(v[d].length===0){if(d===0){if(h===1)return!1;continue}return!1}for(let d=0;d<h;d++)if(v[h-1-d].length!==0&&g[p-1-d].localeCompare(v[h-1-d])!==0)return!1;return!0}function a(l,u){const c=sn(l),f=sn(u),g=c.split("@"),v=f.split("@");if(g.length===0||v.length===0||g.length<v.length)return!1;if(v.length===1){if(r(g[1],v[0])){const h=g[1].split("."),d=v[0].split(".");return d[0].length===0?!0:h.length===d.length}return!1}return c.localeCompare(f)===0}function n(l,u){let c=sn(l);const f=sn(u),g=c.split("/");if(f.split("/").length>1)return!1;if(g.length>1){for(let h=0;h<g.length;h++)if(g[h].length>0&&g[h].charAt(g[h].length-1)!==":"){c=g[h].split(":")[0];break}}if(r(c,f)){const h=c.split("."),d=f.split(".");return d[0].length===0?!0:h.length===d.length}return!1}function i(l,u){const c=l.valueBlock.valueHexView,f=u.valueBlock.valueHexView;if(c.length===4&&f.length===8){for(let g=0;g<4;g++)if((c[g]^f[g])&f[g+4])return!1;return!0}if(c.length===16&&f.length===32){for(let g=0;g<16;g++)if((c[g]^f[g])&f[g+16])return!1;return!0}return!1}function o(l,u){if(l.typesAndValues.length===0||u.typesAndValues.length===0)return!0;if(l.typesAndValues.length<u.typesAndValues.length)return!1;let c=!0,f=0;for(let g=0;g<u.typesAndValues.length;g++){let v=!1;for(let p=f;p<l.typesAndValues.length;p++)if(v=l.typesAndValues[p].isEqual(u.typesAndValues[g]),l.typesAndValues[p].type===u.typesAndValues[g].type&&(c=c&&v),v===!0)if(f===0||f===p){f=p+1;break}else return!1;if(v===!1)return!1}return f===0?!1:c}try{if(this.certs.length===0)throw new Error("Empty certificate array");const l=e.passedWhenNotRevValues||!1,u=e.initialPolicySet||[Hr],c=e.initialExplicitPolicy||!1,f=e.initialPolicyMappingInhibit||!1,g=e.initialInhibitPolicy||!1,v=e.initialPermittedSubtreesSet||[],p=e.initialExcludedSubtreesSet||[],h=e.initialRequiredNameForms||[];let d=c,y=f,E=g;const k=[!1,!1,!1];let R=0,V=0,L=0,ne=v,ae=p;const ve=h;let Te=1;this.certs=await this.sort(l,t);const ye=[];ye.push(Hr);const Ce=[],Ve=new Array(this.certs.length-1);for(let te=0;te<this.certs.length-1;te++)Ve[te]=!0;Ce.push(Ve);const Pe=new Array(this.certs.length-1),pe=new Array(this.certs.length-1);let $e=d?this.certs.length-1:-1;for(let te=this.certs.length-2;te>=0;te--,Te++){const oe=this.certs[te];if(oe.extensions){for(let se=0;se<oe.extensions.length;se++){const me=oe.extensions[se];if(me.extnID===t1){pe[te]=me.parsedValue;for(let Ae=0;Ae<ye.length;Ae++)if(ye[Ae]===Hr){delete Ce[Ae][te];break}for(let Ae=0;Ae<me.parsedValue.certificatePolicies.length;Ae++){let qe=-1;const it=me.parsedValue.certificatePolicies[Ae].policyIdentifier;for(let Ue=0;Ue<ye.length;Ue++)if(it===ye[Ue]){qe=Ue;break}if(qe===-1){ye.push(it);const Ue=new Array(this.certs.length-1);Ue[te]=!0,Ce.push(Ue)}else Ce[qe][te]=!0}}if(me.extnID===r1){if(y)return{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"};Pe[te]=me.parsedValue}me.extnID===s1&&d===!1&&(me.parsedValue.requireExplicitPolicy===0?(d=!0,$e=te):k[0]===!1?(k[0]=!0,R=me.parsedValue.requireExplicitPolicy):R=R>me.parsedValue.requireExplicitPolicy?me.parsedValue.requireExplicitPolicy:R,me.parsedValue.inhibitPolicyMapping===0?y=!0:k[1]===!1?(k[1]=!0,V=me.parsedValue.inhibitPolicyMapping+1):V=V>me.parsedValue.inhibitPolicyMapping+1?me.parsedValue.inhibitPolicyMapping+1:V),me.extnID===lE&&E===!1&&(me.parsedValue.valueBlock.valueDec===0?E=!0:k[2]===!1?(k[2]=!0,L=me.parsedValue.valueBlock.valueDec):L=L>me.parsedValue.valueBlock.valueDec?me.parsedValue.valueBlock.valueDec:L)}if(E===!0){let se=-1;for(let me=0;me<ye.length;me++)if(ye[me]===Hr){se=me;break}se!==-1&&delete Ce[0][te]}d===!1&&k[0]===!0&&(R--,R===0&&(d=!0,$e=te,k[0]=!1)),y===!1&&k[1]===!0&&(V--,V===0&&(y=!0,k[1]=!1)),E===!1&&k[2]===!0&&(L--,L===0&&(E=!0,k[2]=!1))}}for(let te=0;te<this.certs.length-1;te++)if(te<this.certs.length-2&&typeof Pe[te+1]<"u")for(let oe=0;oe<Pe[te+1].mappings.length;oe++){if(Pe[te+1].mappings[oe].issuerDomainPolicy===Hr||Pe[te+1].mappings[oe].subjectDomainPolicy===Hr)return{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'};let se=-1,me=-1;for(let Ae=0;Ae<ye.length;Ae++)ye[Ae]===Pe[te+1].mappings[oe].issuerDomainPolicy&&(se=Ae),ye[Ae]===Pe[te+1].mappings[oe].subjectDomainPolicy&&(me=Ae);typeof Ce[se][te]<"u"&&delete Ce[se][te];for(let Ae=0;Ae<pe[te].certificatePolicies.length;Ae++)if(Pe[te+1].mappings[oe].subjectDomainPolicy===pe[te].certificatePolicies[Ae].policyIdentifier&&se!==-1&&me!==-1)for(let qe=0;qe<=te;qe++)typeof Ce[me][qe]<"u"&&(Ce[se][qe]=!0,delete Ce[me][qe])}for(let te=0;te<ye.length;te++)if(ye[te]===Hr)for(let oe=0;oe<$e;oe++)delete Ce[te][oe];const ie=[];for(let te=0;te<Ce.length;te++){let oe=!0;for(let se=0;se<this.certs.length-1;se++){let me=!1;if(se<$e&&ye[te]===Hr&&ye.length>1){oe=!1;break}if(typeof Ce[te][se]>"u"){if(se>=$e){for(let Ae=0;Ae<ye.length;Ae++)if(ye[Ae]===Hr){Ce[Ae][se]===!0&&(me=!0);break}}if(!me){oe=!1;break}}}oe===!0&&ie.push(ye[te])}let ot=[];if(u.length===1&&u[0]===Hr&&d===!1)ot=u;else if(ie.length===1&&ie[0]===Hr)ot=u;else for(let te=0;te<ie.length;te++)for(let oe=0;oe<u.length;oe++)if(u[oe]===ie[te]||u[oe]===Hr){ot.push(ie[te]);break}const Me={result:ot.length>0,resultCode:0,resultMessage:ot.length>0?S:'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:ie,userConstrPolicies:ot,explicitPolicyIndicator:d,policyMappings:Pe,certificatePath:this.certs};if(ot.length===0||Me.result===!1)return Me;Te=1;for(let te=this.certs.length-2;te>=0;te--,Te++){const oe=this.certs[te];let se=[],me=[],Ae=[];if(oe.extensions)for(let Ne=0;Ne<oe.extensions.length;Ne++){const fe=oe.extensions[Ne];fe.extnID===Zv&&("permittedSubtrees"in fe.parsedValue&&(me=me.concat(fe.parsedValue.permittedSubtrees)),"excludedSubtrees"in fe.parsedValue&&(Ae=Ae.concat(fe.parsedValue.excludedSubtrees))),fe.extnID===Qv&&(se=se.concat(fe.parsedValue.altNames))}let qe=ve.length<=0;for(let Ne=0;Ne<ve.length;Ne++)switch(ve[Ne].base.type){case 4:{if(ve[Ne].base.value.typesAndValues.length!==oe.subject.typesAndValues.length)continue;qe=!0;for(let fe=0;fe<oe.subject.typesAndValues.length;fe++)if(oe.subject.typesAndValues[fe].type!==ve[Ne].base.value.typesAndValues[fe].type){qe=!1;break}if(qe===!0)break}break;default:}if(qe===!1)throw Me.result=!1,Me.resultCode=21,Me.resultMessage="No necessary name form found",Me;const it=[[],[],[],[],[]];for(let Ne=0;Ne<ne.length;Ne++)switch(ne[Ne].base.type){case 1:it[0].push(ne[Ne]);break;case 2:it[1].push(ne[Ne]);break;case 4:it[2].push(ne[Ne]);break;case 6:it[3].push(ne[Ne]);break;case 7:it[4].push(ne[Ne]);break;default:}for(let Ne=0;Ne<5;Ne++){let fe=!1,ht=!1;const lt=it[Ne];for(let ut=0;ut<lt.length;ut++){switch(Ne){case 0:if(se.length>0)for(let Oe=0;Oe<se.length;Oe++)se[Oe].type===1&&(ht=!0,fe=fe||a(se[Oe].value,lt[ut].base.value));else for(let Oe=0;Oe<oe.subject.typesAndValues.length;Oe++)(oe.subject.typesAndValues[Oe].type==="1.2.840.113549.1.9.1"||oe.subject.typesAndValues[Oe].type==="0.9.2342.19200300.100.1.3")&&(ht=!0,fe=fe||a(oe.subject.typesAndValues[Oe].value.valueBlock.value,lt[ut].base.value));break;case 1:if(se.length>0)for(let Oe=0;Oe<se.length;Oe++)se[Oe].type===2&&(ht=!0,fe=fe||r(se[Oe].value,lt[ut].base.value));break;case 2:ht=!0,fe=o(oe.subject,lt[ut].base.value);break;case 3:if(se.length>0)for(let Oe=0;Oe<se.length;Oe++)se[Oe].type===6&&(ht=!0,fe=fe||n(se[Oe].value,lt[ut].base.value));break;case 4:if(se.length>0)for(let Oe=0;Oe<se.length;Oe++)se[Oe].type===7&&(ht=!0,fe=fe||i(se[Oe].value,lt[ut].base.value));break;default:}if(fe)break}if(fe===!1&&lt.length>0&&ht)throw Me.result=!1,Me.resultCode=41,Me.resultMessage='Failed to meet "permitted sub-trees" name constraint',Me}let Ue=!1;for(let Ne=0;Ne<ae.length;Ne++){switch(ae[Ne].base.type){case 1:if(se.length>=0)for(let fe=0;fe<se.length;fe++)se[fe].type===1&&(Ue=Ue||a(se[fe].value,ae[Ne].base.value));else for(let fe=0;fe<oe.subject.typesAndValues.length;fe++)(oe.subject.typesAndValues[fe].type==="1.2.840.113549.1.9.1"||oe.subject.typesAndValues[fe].type==="0.9.2342.19200300.100.1.3")&&(Ue=Ue||a(oe.subject.typesAndValues[fe].value.valueBlock.value,ae[Ne].base.value));break;case 2:if(se.length>0)for(let fe=0;fe<se.length;fe++)se[fe].type===2&&(Ue=Ue||r(se[fe].value,ae[Ne].base.value));break;case 4:Ue=Ue||o(oe.subject,ae[Ne].base.value);break;case 6:if(se.length>0)for(let fe=0;fe<se.length;fe++)se[fe].type===6&&(Ue=Ue||n(se[fe].value,ae[Ne].base.value));break;case 7:if(se.length>0)for(let fe=0;fe<se.length;fe++)se[fe].type===7&&(Ue=Ue||i(se[fe].value,ae[Ne].base.value));break;default:}if(Ue)break}if(Ue===!0)throw Me.result=!1,Me.resultCode=42,Me.resultMessage='Failed to meet "excluded sub-trees" name constraint',Me;ne=ne.concat(me),ae=ae.concat(Ae)}return Me}catch(l){return l instanceof Error?l instanceof ln?{result:!1,resultCode:l.code,resultMessage:l.message,error:l}:{result:!1,resultCode:Ki.unknown,resultMessage:l.message,error:l}:l&&typeof l=="object"&&"resultMessage"in l?l:{result:!1,resultCode:-1,resultMessage:`${l}`}}}}const e0="tbsResponseData",wf="signatureAlgorithm",Sf="signature",Sl="certs",lh="BasicOCSPResponse",bg=`${lh}.${e0}`,kg=`${lh}.${wf}`,Ig=`${lh}.${Sf}`,t0=`${lh}.${Sl}`,Yb=[bg,kg,Ig,t0];class Wr extends G{constructor(e={}){super(),this.tbsResponseData=m(e,e0,Wr.defaultValues(e0)),this.signatureAlgorithm=m(e,wf,Wr.defaultValues(wf)),this.signature=m(e,Sf,Wr.defaultValues(Sf)),Sl in e&&(this.certs=m(e,Sl,Wr.defaultValues(Sl))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case e0:return new qt;case wf:return new $;case Sf:return new He;case Sl:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"type":{let r=qt.compareWithDefault("tbs",t.tbs)&&qt.compareWithDefault("responderID",t.responderID)&&qt.compareWithDefault("producedAt",t.producedAt)&&qt.compareWithDefault("responses",t.responses);return"responseExtensions"in t&&(r=r&&qt.compareWithDefault("responseExtensions",t.responseExtensions)),r}case wf:return t.algorithmId===S&&!("algorithmParams"in t);case Sf:return t.isEqual(Wr.defaultValues(e));case Sl:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||lh,value:[qt.schema(t.tbsResponseData||{names:{blockName:bg}}),$.schema(t.signatureAlgorithm||{names:{blockName:kg}}),new He({name:t.signature||Ig}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new b({value:[new _e({name:t0,value:Xe.schema(t.certs||{})})]})]})]})}fromSchema(e){W(e,Yb);const t=j(e,e,Wr.schema());K.assertSchema(t,this.className),this.tbsResponseData=new qt({schema:t.result[bg]}),this.signatureAlgorithm=new $({schema:t.result[kg]}),this.signature=t.result[Ig],t0 in t.result&&(this.certs=Array.from(t.result[t0],r=>new Xe({schema:r})))}toSchema(){const e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new N({idBlock:{tagClass:3,tagNumber:0},value:[new b({value:Array.from(this.certs,t=>t.toSchema())})]})),new b({value:e})}toJSON(){const e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}async getCertificateStatus(e,t,r=Le(!0)){const a={isForCertificate:!1,status:2},n={},i=[];for(const o of this.tbsResponseData.responses){const l=r.getAlgorithmByOID(o.certID.hashAlgorithm.algorithmId,!0,"CertID.hashAlgorithm");if(!n[l.name]){n[l.name]=1;const u=new _t;i.push(u),await u.createForCertificate(e,{hashAlgorithm:l.name,issuerCertificate:t},r)}}for(const o of this.tbsResponseData.responses)for(const l of i)if(o.certID.isEqual(l)){a.isForCertificate=!0;try{switch(o.certStatus.idBlock.isConstructed){case!0:o.certStatus.idBlock.tagNumber===1&&(a.status=1);break;case!1:switch(o.certStatus.idBlock.tagNumber){case 0:a.status=0;break;case 2:a.status=2;break;default:}break;default:}}catch{}return a}return a}async sign(e,t="SHA-1",r=Le(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await r.getSignatureParameters(e,t),n=a.parameters.algorithm;if(!("name"in n))throw new Error("Empty algorithm");this.signatureAlgorithm=a.signatureAlgorithm,this.tbsResponseData.tbsView=new Uint8Array(this.tbsResponseData.toSchema(!0).toBER());const i=await r.signWithPrivateKey(this.tbsResponseData.tbsView,e,{algorithm:n});this.signature=new He({valueHex:i})}async verify(e={},t=Le(!0)){let r=null,a=-1;const n=e.trustedCerts||[];if(!this.certs)throw new Error("No certificates attached to the BasicOCSPResponse");switch(!0){case this.tbsResponseData.responderID instanceof st:for(const[u,c]of this.certs.entries())if(c.subject.isEqual(this.tbsResponseData.responderID)){a=u;break}break;case this.tbsResponseData.responderID instanceof z:for(const[u,c]of this.certs.entries()){const f=await t.digest({name:"sha-1"},c.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(ou(f,this.tbsResponseData.responderID.valueBlock.valueHex)){a=u;break}}break;default:throw new Error("Wrong value for responderID")}if(a===-1)throw new Error("Correct certificate was not found in OCSP response");r=this.certs[a];const i=[r];for(const u of this.certs){const c=await h1(u,r);c&&i.push(c)}if(!(await new fd({certs:i,trustedCerts:n}).verify({},t)).result)throw new Error("Validation of signer's certificate failed");return t.verifyWithPublicKey(this.tbsResponseData.tbsView,this.signature,this.certs[a].subjectPublicKeyInfo,this.signatureAlgorithm)}}Wr.CLASS_NAME="BasicOCSPResponse";const jd="tbs",Wd="version",Qd="subject",Yd="subjectPublicKeyInfo",wo="attributes",Cf="signatureAlgorithm",Af="signatureValue",vu="CertificationRequestInfo",xm=`${vu}.version`,Nm=`${vu}.subject`,Tm=`${vu}.subjectPublicKeyInfo`,q0=`${vu}.attributes`,zb=[vu,xm,Nm,Tm,q0,Cf,Af];function Xb(s={}){const e=m(s,"names",{});return new b({name:e.CertificationRequestInfo||vu,value:[new _({name:e.CertificationRequestInfoVersion||xm}),st.schema(e.subject||{names:{blockName:Nm}}),Sr.schema({names:{blockName:Tm}}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new _e({optional:!0,name:e.CertificationRequestInfoAttributes||q0,value:mt.schema(e.attributes||{})})]})]})}class ns extends G{constructor(e={}){super(),this.tbsView=new Uint8Array(m(e,jd,ns.defaultValues(jd))),this.version=m(e,Wd,ns.defaultValues(Wd)),this.subject=m(e,Qd,ns.defaultValues(Qd)),this.subjectPublicKeyInfo=m(e,Yd,ns.defaultValues(Yd)),wo in e&&(this.attributes=m(e,wo,ns.defaultValues(wo))),this.signatureAlgorithm=m(e,Cf,ns.defaultValues(Cf)),this.signatureValue=m(e,Af,ns.defaultValues(Af)),e.schema&&this.fromSchema(e.schema)}get tbs(){return Ee.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}static defaultValues(e){switch(e){case jd:return Ot;case Wd:return 0;case Qd:return new st;case Yd:return new Sr;case wo:return[];case Cf:return new $;case Af:return new He;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({value:[Xb(t.certificationRequestInfo||{}),new b({name:t.signatureAlgorithm||Cf,value:[new he,new xe({optional:!0})]}),new He({name:t.signatureValue||Af})]})}fromSchema(e){W(e,zb);const t=j(e,e,ns.schema());K.assertSchema(t,this.className),this.tbsView=t.result.CertificationRequestInfo.valueBeforeDecodeView,this.version=t.result[xm].valueBlock.valueDec,this.subject=new st({schema:t.result[Nm]}),this.subjectPublicKeyInfo=new Sr({schema:t.result[Tm]}),q0 in t.result&&(this.attributes=Array.from(t.result[q0],r=>new mt({schema:r}))),this.signatureAlgorithm=new $({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[new _({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];return wo in this&&e.push(new N({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes||[],t=>t.toSchema())})),new b({value:e})}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return ns.schema();const r=Lt(this.tbsView);K.assert(r,"PKCS#10 Certificate Request"),t=r.result}else t=this.encodeTBS();return new b({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:ke.ToHex(this.tbsView),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return wo in this&&(e.attributes=Array.from(this.attributes||[],t=>t.toJSON())),e}async sign(e,t="SHA-1",r=Le(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await r.getSignatureParameters(e,t),n=a.parameters;this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await r.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new He({valueHex:i})}async verify(e=Le(!0)){return e.verifyWithPublicKey(this.tbsView,this.signatureValue,this.subjectPublicKeyInfo,this.signatureAlgorithm)}async getPublicKey(e,t=Le(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}}ns.CLASS_NAME="CertificationRequest";const xi="digestAlgorithm",Ni="digest",Zb=[xi,Ni];class Yr extends G{constructor(e={}){super(),this.digestAlgorithm=m(e,xi,Yr.defaultValues(xi)),this.digest=m(e,Ni,Yr.defaultValues(Ni)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xi:return new $;case Ni:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case xi:return $.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case Ni:return t.isEqual(Yr.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[$.schema(t.digestAlgorithm||{names:{blockName:xi}}),new z({name:t.digest||Ni})]})}fromSchema(e){W(e,Zb);const t=j(e,e,Yr.schema({names:{digestAlgorithm:{names:{blockName:xi}},digest:Ni}}));K.assertSchema(t,this.className),this.digestAlgorithm=new $({schema:t.result.digestAlgorithm}),this.digest=t.result.digest}toSchema(){return new b({value:[this.digestAlgorithm.toSchema(),this.digest]})}toJSON(){return{digestAlgorithm:this.digestAlgorithm.toJSON(),digest:this.digest.toJSON()}}}Yr.CLASS_NAME="DigestInfo";const Cl="eContentType",ss="eContent",e2=[Cl,ss];class kr extends G{constructor(e={}){if(super(),this.eContentType=m(e,Cl,kr.defaultValues(Cl)),ss in e&&(this.eContent=m(e,ss,kr.defaultValues(ss)),this.eContent.idBlock.tagClass===1&&this.eContent.idBlock.tagNumber===4&&this.eContent.idBlock.isConstructed===!1)){const t=new z({idBlock:{isConstructed:!0},isConstructed:!0});let r=0;const a=this.eContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const i=new Uint8Array(a,r,r+65536>a.byteLength?a.byteLength-r:65536),o=new ArrayBuffer(i.length),l=new Uint8Array(o);for(let u=0;u<l.length;u++)l[u]=i[u];t.valueBlock.value.push(new z({valueHex:o})),n-=i.length,r+=i.length}this.eContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Cl:return S;case ss:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Cl:return t===S;case ss:return t.idBlock.tagClass===1&&t.idBlock.tagNumber===4?t.isEqual(kr.defaultValues(ss)):!1;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.eContentType||S}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new xe({name:t.eContent||S})]})]})}fromSchema(e){W(e,e2);const t=j(e,e,kr.schema({names:{eContentType:Cl,eContent:ss}}));K.assertSchema(t,this.className),this.eContentType=t.result.eContentType.valueBlock.toString(),ss in t.result&&(this.eContent=t.result.eContent)}toSchema(){const e=[];return e.push(new he({value:this.eContentType})),this.eContent&&kr.compareWithDefault(ss,this.eContent)===!1&&e.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new b({value:e})}toJSON(){const e={eContentType:this.eContentType};return this.eContent&&kr.compareWithDefault(ss,this.eContent)===!1&&(e.eContent=this.eContent.toJSON()),e}}kr.CLASS_NAME="EncapsulatedContentInfo";const Ti="mac",Ri="macSalt",js="iterations",t2=[Ti,Ri,js];class pr extends G{constructor(e={}){super(),this.mac=m(e,Ti,pr.defaultValues(Ti)),this.macSalt=m(e,Ri,pr.defaultValues(Ri)),js in e&&(this.iterations=m(e,js,pr.defaultValues(js))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ti:return new Yr;case Ri:return new z;case js:return 1;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ti:return Yr.compareWithDefault("digestAlgorithm",t.digestAlgorithm)&&Yr.compareWithDefault("digest",t.digest);case Ri:return t.isEqual(pr.defaultValues(e));case js:return t===pr.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,optional:t.optional||!0,value:[Yr.schema(t.mac||{names:{blockName:Ti}}),new z({name:t.macSalt||Ri}),new _({optional:!0,name:t.iterations||js})]})}fromSchema(e){W(e,t2);const t=j(e,e,pr.schema({names:{mac:{names:{blockName:Ti}},macSalt:Ri,iterations:js}}));K.assertSchema(t,this.className),this.mac=new Yr({schema:t.result.mac}),this.macSalt=t.result.macSalt,js in t.result&&(this.iterations=t.result.iterations.valueBlock.valueDec)}toSchema(){const e=[this.mac.toSchema(),this.macSalt];return this.iterations!==void 0&&e.push(new _({value:this.iterations})),new b({value:e})}toJSON(){const e={mac:this.mac.toJSON(),macSalt:this.macSalt.toJSON()};return this.iterations!==void 0&&(e.iterations=this.iterations),e}}pr.CLASS_NAME="MacData";const Mi="hashAlgorithm",Hi="hashedMessage",r2=[Mi,Hi];class ar extends G{constructor(e={}){super(),this.hashAlgorithm=m(e,Mi,ar.defaultValues(Mi)),this.hashedMessage=m(e,Hi,ar.defaultValues(Hi)),e.schema&&this.fromSchema(e.schema)}static async create(e,t,r=Le(!0)){const a=r.getOIDByAlgorithm({name:e},!0,"hashAlgorithm"),n=await r.digest(e,t);return new ar({hashAlgorithm:new $({algorithmId:a,algorithmParams:new xt}),hashedMessage:new z({valueHex:n})})}static defaultValues(e){switch(e){case Mi:return new $;case Hi:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Mi:return t.algorithmId===S&&!("algorithmParams"in t);case Hi:return t.isEqual(ar.defaultValues(e))===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[$.schema(t.hashAlgorithm||{}),new z({name:t.hashedMessage||S})]})}fromSchema(e){W(e,r2);const t=j(e,e,ar.schema({names:{hashAlgorithm:{names:{blockName:Mi}},hashedMessage:Hi}}));K.assertSchema(t,this.className),this.hashAlgorithm=new $({schema:t.result.hashAlgorithm}),this.hashedMessage=t.result.hashedMessage}toSchema(){return new b({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}ar.CLASS_NAME="MessageImprint";const Al="reqCert",za="singleRequestExtensions",s2=[Al,za];class ia extends G{constructor(e={}){super(),this.reqCert=m(e,Al,ia.defaultValues(Al)),za in e&&(this.singleRequestExtensions=m(e,za,ia.defaultValues(za))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Al:return new _t;case za:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Al:return t.isEqual(ia.defaultValues(e));case za:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[_t.schema(t.reqCert||{}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Vt.schema(t.extensions||{names:{blockName:t.singleRequestExtensions||S}})]})]})}fromSchema(e){W(e,s2);const t=j(e,e,ia.schema({names:{reqCert:{names:{blockName:Al}},extensions:{names:{blockName:za}}}}));K.assertSchema(t,this.className),this.reqCert=new _t({schema:t.result.reqCert}),za in t.result&&(this.singleRequestExtensions=Array.from(t.result.singleRequestExtensions.valueBlock.value,r=>new Vt({schema:r})))}toSchema(){const e=[];return e.push(this.reqCert.toSchema()),this.singleRequestExtensions&&e.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new b({value:Array.from(this.singleRequestExtensions,t=>t.toSchema())})]})),new b({value:e})}toJSON(){const e={reqCert:this.reqCert.toJSON()};return this.singleRequestExtensions&&(e.singleRequestExtensions=Array.from(this.singleRequestExtensions,t=>t.toJSON())),e}}ia.CLASS_NAME="Request";const Oh="tbs",El="version",bl="requestorName",Ph="requestList",kl="requestExtensions",wu="TBSRequest",r0=`${wu}.${El}`,s0=`${wu}.${bl}`,Bg=`${wu}.requests`,a0=`${wu}.${kl}`,a2=[wu,r0,s0,Bg,a0];class Xt extends G{constructor(e={}){super(),this.tbsView=new Uint8Array(m(e,Oh,Xt.defaultValues(Oh))),El in e&&(this.version=m(e,El,Xt.defaultValues(El))),bl in e&&(this.requestorName=m(e,bl,Xt.defaultValues(bl))),this.requestList=m(e,Ph,Xt.defaultValues(Ph)),kl in e&&(this.requestExtensions=m(e,kl,Xt.defaultValues(kl))),e.schema&&this.fromSchema(e.schema)}get tbs(){return Ee.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}static defaultValues(e){switch(e){case Oh:return Ot;case El:return 0;case bl:return new ze;case Ph:case kl:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Oh:return t.byteLength===0;case El:return t===Xt.defaultValues(e);case bl:return t.type===ze.defaultValues("type")&&Object.keys(t.value).length===0;case Ph:case kl:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||wu,value:[new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new _({name:t.TBSRequestVersion||r0})]}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[ze.schema(t.requestorName||{names:{blockName:s0}})]}),new b({name:t.requestList||"TBSRequest.requestList",value:[new _e({name:t.requests||Bg,value:ia.schema(t.requestNames||{})})]}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[Pt.schema(t.extensions||{names:{blockName:t.requestExtensions||a0}})]})]})}fromSchema(e){W(e,a2);const t=j(e,e,Xt.schema());K.assertSchema(t,this.className),this.tbsView=t.result.TBSRequest.valueBeforeDecodeView,r0 in t.result&&(this.version=t.result[r0].valueBlock.valueDec),s0 in t.result&&(this.requestorName=new ze({schema:t.result[s0]})),this.requestList=Array.from(t.result[Bg],r=>new ia({schema:r})),a0 in t.result&&(this.requestExtensions=Array.from(t.result[a0].valueBlock.value,r=>new Vt({schema:r})))}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return Xt.schema();const r=Lt(this.tbsView);if(K.assert(r,"TBS Request"),!(r.result instanceof b))throw new Error("ASN.1 result should be SEQUENCE");t=r.result}else{const r=[];this.version!==void 0&&r.push(new N({idBlock:{tagClass:3,tagNumber:0},value:[new _({value:this.version})]})),this.requestorName&&r.push(new N({idBlock:{tagClass:3,tagNumber:1},value:[this.requestorName.toSchema()]})),r.push(new b({value:Array.from(this.requestList,a=>a.toSchema())})),this.requestExtensions&&r.push(new N({idBlock:{tagClass:3,tagNumber:2},value:[new b({value:Array.from(this.requestExtensions,a=>a.toSchema())})]})),t=new b({value:r})}return t}toJSON(){const e={};return this.version!=null&&(e.version=this.version),this.requestorName&&(e.requestorName=this.requestorName.toJSON()),e.requestList=Array.from(this.requestList,t=>t.toJSON()),this.requestExtensions&&(e.requestExtensions=Array.from(this.requestExtensions,t=>t.toJSON())),e}}Xt.CLASS_NAME="TBSRequest";const So="signatureAlgorithm",Co="signature",va="certs";class Lr extends G{constructor(e={}){super(),this.signatureAlgorithm=m(e,So,Lr.defaultValues(So)),this.signature=m(e,Co,Lr.defaultValues(Co)),va in e&&(this.certs=m(e,va,Lr.defaultValues(va))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case So:return new $;case Co:return new He;case va:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case So:return t.algorithmId===S&&!("algorithmParams"in t);case Co:return t.isEqual(Lr.defaultValues(e));case va:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[$.schema(t.signatureAlgorithm||{}),new He({name:t.signature||S}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new b({value:[new _e({name:t.certs||S,value:Xe.schema({})})]})]})]})}fromSchema(e){W(e,[So,Co,va]);const t=j(e,e,Lr.schema({names:{signatureAlgorithm:{names:{blockName:So}},signature:Co,certs:va}}));K.assertSchema(t,this.className),this.signatureAlgorithm=new $({schema:t.result.signatureAlgorithm}),this.signature=t.result.signature,va in t.result&&(this.certs=Array.from(t.result.certs,r=>new Xe({schema:r})))}toSchema(){const e=[];return e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new b({value:Array.from(this.certs,t=>t.toSchema())})]})),new b({value:e})}toJSON(){const e={signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}}Lr.CLASS_NAME="Signature";const Il="tbsRequest",Xa="optionalSignature",n2=[Il,Xa];class Uf extends G{constructor(e={}){super(),this.tbsRequest=m(e,Il,Uf.defaultValues(Il)),Xa in e&&(this.optionalSignature=m(e,Xa,Uf.defaultValues(Xa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Il:return new Xt;case Xa:return new Lr;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Il:return Xt.compareWithDefault("tbs",t.tbs)&&Xt.compareWithDefault("version",t.version)&&Xt.compareWithDefault("requestorName",t.requestorName)&&Xt.compareWithDefault("requestList",t.requestList)&&Xt.compareWithDefault("requestExtensions",t.requestExtensions);case Xa:return Lr.compareWithDefault("signatureAlgorithm",t.signatureAlgorithm)&&Lr.compareWithDefault("signature",t.signature)&&Lr.compareWithDefault("certs",t.certs);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||"OCSPRequest",value:[Xt.schema(t.tbsRequest||{names:{blockName:Il}}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Lr.schema(t.optionalSignature||{names:{blockName:Xa}})]})]})}fromSchema(e){W(e,n2);const t=j(e,e,Uf.schema());K.assertSchema(t,this.className),this.tbsRequest=new Xt({schema:t.result.tbsRequest}),Xa in t.result&&(this.optionalSignature=new Lr({schema:t.result.optionalSignature}))}toSchema(e=!1){const t=[];return t.push(this.tbsRequest.toSchema(e)),this.optionalSignature&&t.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.optionalSignature.toSchema()]})),new b({value:t})}toJSON(){const e={tbsRequest:this.tbsRequest.toJSON()};return this.optionalSignature&&(e.optionalSignature=this.optionalSignature.toJSON()),e}async createForCertificate(e,t,r=Le(!0)){const a=new _t;await a.createForCertificate(e,t,r),this.tbsRequest.requestList.push(new ia({reqCert:a}))}async sign(e,t="SHA-1",r=Le(!0)){if(Ge.assertEmpty(e,"privateKey","OCSPRequest.sign method"),!this.optionalSignature)throw new Error('Need to create "optionalSignature" field before signing');const a=await r.getSignatureParameters(e,t),n=a.parameters;this.optionalSignature.signatureAlgorithm=a.signatureAlgorithm;const i=this.tbsRequest.toSchema(!0).toBER(!1),o=await r.signWithPrivateKey(i,e,n);this.optionalSignature.signature=new He({valueHex:o})}verify(){}}Uf.CLASS_NAME="OCSPRequest";const Bl="responseType",xl="response",i2=[Bl,xl];class us extends G{constructor(e={}){super(),this.responseType=m(e,Bl,us.defaultValues(Bl)),this.response=m(e,xl,us.defaultValues(xl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bl:return S;case xl:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Bl:return t===S;case xl:return t.isEqual(us.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new he({name:t.responseType||S}),new z({name:t.response||S})]})}fromSchema(e){W(e,i2);const t=j(e,e,us.schema({names:{responseType:Bl,response:xl}}));K.assertSchema(t,this.className),this.responseType=t.result.responseType.valueBlock.toString(),this.response=t.result.response}toSchema(){return new b({value:[new he({value:this.responseType}),this.response]})}toJSON(){return{responseType:this.responseType,response:this.response.toJSON()}}}us.CLASS_NAME="ResponseBytes";const Ao="responseStatus",Os="responseBytes";class Wl extends G{constructor(e={}){super(),this.responseStatus=m(e,Ao,Wl.defaultValues(Ao)),Os in e&&(this.responseBytes=m(e,Os,Wl.defaultValues(Os))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ao:return new no;case Os:return new us;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ao:return t.isEqual(Wl.defaultValues(e));case Os:return us.compareWithDefault("responseType",t.responseType)&&us.compareWithDefault("response",t.response);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||"OCSPResponse",value:[new no({name:t.responseStatus||Ao}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[us.schema(t.responseBytes||{names:{blockName:Os}})]})]})}fromSchema(e){W(e,[Ao,Os]);const t=j(e,e,Wl.schema());K.assertSchema(t,this.className),this.responseStatus=t.result.responseStatus,Os in t.result&&(this.responseBytes=new us({schema:t.result.responseBytes}))}toSchema(){const e=[];return e.push(this.responseStatus),this.responseBytes&&e.push(new N({idBlock:{tagClass:3,tagNumber:0},value:[this.responseBytes.toSchema()]})),new b({value:e})}toJSON(){const e={responseStatus:this.responseStatus.toJSON()};return this.responseBytes&&(e.responseBytes=this.responseBytes.toJSON()),e}async getCertificateStatus(e,t,r=Le(!0)){let a;const n={isForCertificate:!1,status:2};if(!this.responseBytes||this.responseBytes.responseType!==qh)return n;try{const i=Lt(this.responseBytes.response.valueBlock.valueHexView);K.assert(i,"Basic OCSP response"),a=new Wr({schema:i.result})}catch{return n}return a.getCertificateStatus(e,t,r)}async sign(e,t,r=Le(!0)){var a;if(this.responseBytes&&this.responseBytes.responseType===qh)return Wr.fromBER(this.responseBytes.response.valueBlock.valueHexView).sign(e,t,r);throw new Error(`Unknown ResponseBytes type: ${((a=this.responseBytes)===null||a===void 0?void 0:a.responseType)||"Unknown"}`)}async verify(e=null,t=Le(!0)){var r;if(!(Os in this))throw new Error("Empty ResponseBytes field");if(this.responseBytes&&this.responseBytes.responseType===qh){const a=Wr.fromBER(this.responseBytes.response.valueBlock.valueHexView);return e!==null&&(a.certs||(a.certs=[]),a.certs.push(e)),a.verify({},t)}throw new Error(`Unknown ResponseBytes type: ${((r=this.responseBytes)===null||r===void 0?void 0:r.responseType)||"Unknown"}`)}}Wl.CLASS_NAME="OCSPResponse";const Ln="type",Ws="attributes",Uh="encodedValue",o2=[Ws];class Et extends G{constructor(e={}){super(),this.type=m(e,Ln,Et.defaultValues(Ln)),this.attributes=m(e,Ws,Et.defaultValues(Ws)),this.encodedValue=m(e,Uh,Et.defaultValues(Uh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ln:return-1;case Ws:return[];case Uh:return Ot;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ln:return t===Et.defaultValues(Ln);case Ws:return t.length===0;case Uh:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new N({name:t.blockName||S,optional:!0,idBlock:{tagClass:3,tagNumber:t.tagNumber||0},value:[new _e({name:t.attributes||S,value:mt.schema()})]})}fromSchema(e){W(e,o2);const t=j(e,e,Et.schema({names:{tagNumber:this.type,attributes:Ws}}));K.assertSchema(t,this.className),this.type=t.result.idBlock.tagNumber,this.encodedValue=Ee.toArrayBuffer(t.result.valueBeforeDecodeView);const r=new Uint8Array(this.encodedValue);if(r[0]=49,!(Ws in t.result)){if(this.type===0)throw new Error("Wrong structure of SignedUnsignedAttributes");return}this.attributes=Array.from(t.result.attributes,a=>new mt({schema:a}))}toSchema(){if(Et.compareWithDefault(Ln,this.type)||Et.compareWithDefault(Ws,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new N({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){if(Et.compareWithDefault(Ln,this.type)||Et.compareWithDefault(Ws,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,e=>e.toJSON())}}}Et.CLASS_NAME="SignedAndUnsignedAttributes";const Nl="version",Vi="sid",Tl="digestAlgorithm",Za="signedAttrs",Rl="signatureAlgorithm",Ef="signature",en="unsignedAttrs",Rn="SignerInfo",xg=`${Rn}.${Nl}`,bf=`${Rn}.${Vi}`,Ng=`${Rn}.${Tl}`,n0=`${Rn}.${Za}`,Tg=`${Rn}.${Rl}`,Rg=`${Rn}.${Ef}`,i0=`${Rn}.${en}`,l2=[xg,bf,Ng,n0,Tg,Rg,i0];class Bt extends G{constructor(e={}){super(),this.version=m(e,Nl,Bt.defaultValues(Nl)),this.sid=m(e,Vi,Bt.defaultValues(Vi)),this.digestAlgorithm=m(e,Tl,Bt.defaultValues(Tl)),Za in e&&(this.signedAttrs=m(e,Za,Bt.defaultValues(Za))),this.signatureAlgorithm=m(e,Rl,Bt.defaultValues(Rl)),this.signature=m(e,Ef,Bt.defaultValues(Ef)),en in e&&(this.unsignedAttrs=m(e,en,Bt.defaultValues(en))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Nl:return 0;case Vi:return new xe;case Tl:return new $;case Za:return new Et({type:0});case Rl:return new $;case Ef:return new z;case en:return new Et({type:1});default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Nl:return Bt.defaultValues(Nl)===t;case Vi:return t instanceof xe;case Tl:return t instanceof $?t.isEqual(Bt.defaultValues(Tl)):!1;case Za:return Et.compareWithDefault("type",t.type)&&Et.compareWithDefault("attributes",t.attributes)&&Et.compareWithDefault("encodedValue",t.encodedValue);case Rl:return t instanceof $?t.isEqual(Bt.defaultValues(Rl)):!1;case Ef:case en:return Et.compareWithDefault("type",t.type)&&Et.compareWithDefault("attributes",t.attributes)&&Et.compareWithDefault("encodedValue",t.encodedValue);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:Rn,value:[new _({name:t.version||xg}),new Ct({value:[Ut.schema(t.sidSchema||{names:{blockName:bf}}),new Ct({value:[new N({optional:!0,name:t.sid||bf,idBlock:{tagClass:3,tagNumber:0},value:[new z]}),new Ie({optional:!0,name:t.sid||bf,idBlock:{tagClass:3,tagNumber:0}})]})]}),$.schema(t.digestAlgorithm||{names:{blockName:Ng}}),Et.schema(t.signedAttrs||{names:{blockName:n0,tagNumber:0}}),$.schema(t.signatureAlgorithm||{names:{blockName:Tg}}),new z({name:t.signature||Rg}),Et.schema(t.unsignedAttrs||{names:{blockName:i0,tagNumber:1}})]})}fromSchema(e){W(e,l2);const t=j(e,e,Bt.schema());K.assertSchema(t,this.className),this.version=t.result[xg].valueBlock.valueDec;const r=t.result[bf];r.idBlock.tagClass===1?this.sid=new Ut({schema:r}):this.sid=r,this.digestAlgorithm=new $({schema:t.result[Ng]}),n0 in t.result&&(this.signedAttrs=new Et({type:0,schema:t.result[n0]})),this.signatureAlgorithm=new $({schema:t.result[Tg]}),this.signature=t.result[Rg],i0 in t.result&&(this.unsignedAttrs=new Et({type:1,schema:t.result[i0]}))}toSchema(){if(Bt.compareWithDefault(Vi,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e=[];return e.push(new _({value:this.version})),this.sid instanceof Ut?e.push(this.sid.toSchema()):e.push(this.sid),e.push(this.digestAlgorithm.toSchema()),this.signedAttrs&&Bt.compareWithDefault(Za,this.signedAttrs)===!1&&e.push(this.signedAttrs.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.unsignedAttrs&&Bt.compareWithDefault(en,this.unsignedAttrs)===!1&&e.push(this.unsignedAttrs.toSchema()),new b({value:e})}toJSON(){if(Bt.compareWithDefault(Vi,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e={version:this.version,digestAlgorithm:this.digestAlgorithm.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.sid instanceof xe||(e.sid=this.sid.toJSON()),this.signedAttrs&&Bt.compareWithDefault(Za,this.signedAttrs)===!1&&(e.signedAttrs=this.signedAttrs.toJSON()),this.unsignedAttrs&&Bt.compareWithDefault(en,this.unsignedAttrs)===!1&&(e.unsignedAttrs=this.unsignedAttrs.toJSON()),e}}Bt.CLASS_NAME="SignerInfo";const kf="version",If="policy",Bf="messageImprint",xf="serialNumber",Nf="genTime",_i="ordering",$i="nonce",Vl="accuracy",_l="tsa",$l="extensions",ps="TSTInfo",Vg=`${ps}.${kf}`,_g=`${ps}.${If}`,$g=`${ps}.${Bf}`,Dg=`${ps}.${xf}`,Lg=`${ps}.${Nf}`,o0=`${ps}.${Vl}`,l0=`${ps}.${_i}`,u0=`${ps}.${$i}`,c0=`${ps}.${_l}`,f0=`${ps}.${$l}`,u2=[Vg,_g,$g,Dg,Lg,o0,l0,u0,c0,f0];class or extends G{constructor(e={}){super(),this.version=m(e,kf,or.defaultValues(kf)),this.policy=m(e,If,or.defaultValues(If)),this.messageImprint=m(e,Bf,or.defaultValues(Bf)),this.serialNumber=m(e,xf,or.defaultValues(xf)),this.genTime=m(e,Nf,or.defaultValues(Nf)),Vl in e&&(this.accuracy=m(e,Vl,or.defaultValues(Vl))),_i in e&&(this.ordering=m(e,_i,or.defaultValues(_i))),$i in e&&(this.nonce=m(e,$i,or.defaultValues($i))),_l in e&&(this.tsa=m(e,_l,or.defaultValues(_l))),$l in e&&(this.extensions=m(e,$l,or.defaultValues($l))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case kf:return 0;case If:return S;case Bf:return new ar;case xf:return new _;case Nf:return new Date(0,0,0);case Vl:return new Dr;case _i:return!1;case $i:return new _;case _l:return new ze;case $l:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case kf:case If:case Nf:case _i:return t===or.defaultValues(_i);case Bf:return ar.compareWithDefault(Mi,t.hashAlgorithm)&&ar.compareWithDefault(Hi,t.hashedMessage);case xf:case $i:return t.isEqual(or.defaultValues($i));case Vl:return Dr.compareWithDefault(wa,t.seconds)&&Dr.compareWithDefault(Sa,t.millis)&&Dr.compareWithDefault(Ca,t.micros);case _l:return ze.compareWithDefault(Uu,t.type)&&ze.compareWithDefault(Ku,t.value);case $l:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||ps,value:[new _({name:t.version||Vg}),new he({name:t.policy||_g}),ar.schema(t.messageImprint||{names:{blockName:$g}}),new _({name:t.serialNumber||Dg}),new St({name:t.genTime||Lg}),Dr.schema(t.accuracy||{names:{blockName:o0}}),new Ds({name:t.ordering||l0,optional:!0}),new _({name:t.nonce||u0,optional:!0}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[ze.schema(t.tsa||{names:{blockName:c0}})]}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new _e({name:t.extensions||f0,value:Vt.schema(t.extension||{})})]})]})}fromSchema(e){W(e,u2);const t=j(e,e,or.schema());K.assertSchema(t,this.className),this.version=t.result[Vg].valueBlock.valueDec,this.policy=t.result[_g].valueBlock.toString(),this.messageImprint=new ar({schema:t.result[$g]}),this.serialNumber=t.result[Dg],this.genTime=t.result[Lg].toDate(),o0 in t.result&&(this.accuracy=new Dr({schema:t.result[o0]})),l0 in t.result&&(this.ordering=t.result[l0].valueBlock.value),u0 in t.result&&(this.nonce=t.result[u0]),c0 in t.result&&(this.tsa=new ze({schema:t.result[c0]})),f0 in t.result&&(this.extensions=Array.from(t.result[f0],r=>new Vt({schema:r})))}toSchema(){const e=[];return e.push(new _({value:this.version})),e.push(new he({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new St({valueDate:this.genTime})),this.accuracy&&e.push(this.accuracy.toSchema()),this.ordering!==void 0&&e.push(new Ds({value:this.ordering})),this.nonce&&e.push(this.nonce),this.tsa&&e.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),this.extensions&&e.push(new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,t=>t.toSchema())})),new b({value:e})}toJSON(){const e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return this.accuracy&&(e.accuracy=this.accuracy.toJSON()),this.ordering!==void 0&&(e.ordering=this.ordering),this.nonce&&(e.nonce=this.nonce.toJSON()),this.tsa&&(e.tsa=this.tsa.toJSON()),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async verify(e,t=Le(!0)){if(!e.data)throw new Error('"data" is a mandatory attribute for TST_INFO verification');const r=e.data;if(e.notBefore&&this.genTime<e.notBefore)throw new Error("Generation time for TSTInfo object is less than notBefore value");if(e.notAfter&&this.genTime>e.notAfter)throw new Error("Generation time for TSTInfo object is more than notAfter value");const a=t.getAlgorithmByOID(this.messageImprint.hashAlgorithm.algorithmId,!0,"MessageImprint.hashAlgorithm"),n=await t.digest(a.name,new Uint8Array(r));return Ee.isEqual(n,this.messageImprint.hashedMessage.valueBlock.valueHexView)}}or.CLASS_NAME="TSTInfo";const Dl="version",Tf="digestAlgorithms",Rf="encapContentInfo",Ll="certificates",Ol="crls",Vf="signerInfos",Du="ocsps",fo="SignedData",Og=`${fo}.${Dl}`,h0=`${fo}.${Tf}`,Pg=`${fo}.${Rf}`,d0=`${fo}.${Ll}`,g0=`${fo}.${Ol}`,m0=`${fo}.${Vf}`,c2=[Og,h0,Pg,d0,g0,m0];class ir extends Error{constructor({message:e,code:t=0,date:r=new Date,signatureVerified:a=null,signerCertificate:n=null,signerCertificateVerified:i=null,timestampSerial:o=null,certificatePath:l=[]}){super(e),this.name="SignedDataVerifyError",this.date=r,this.code=t,this.timestampSerial=o,this.signatureVerified=a,this.signerCertificate=n,this.signerCertificateVerified=i,this.certificatePath=l}}class tr extends G{constructor(e={}){super(),this.version=m(e,Dl,tr.defaultValues(Dl)),this.digestAlgorithms=m(e,Tf,tr.defaultValues(Tf)),this.encapContentInfo=m(e,Rf,tr.defaultValues(Rf)),Ll in e&&(this.certificates=m(e,Ll,tr.defaultValues(Ll))),Ol in e&&(this.crls=m(e,Ol,tr.defaultValues(Ol))),Du in e&&(this.ocsps=m(e,Du,tr.defaultValues(Du))),this.signerInfos=m(e,Vf,tr.defaultValues(Vf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Dl:return 0;case Tf:return[];case Rf:return new kr;case Ll:return[];case Ol:return[];case Du:return[];case Vf:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Dl:return t===tr.defaultValues(Dl);case Rf:return kr.compareWithDefault("eContentType",t.eContentType)&&kr.compareWithDefault("eContent",t.eContent);case Tf:case Ll:case Ol:case Du:case Vf:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return t.optional===void 0&&(t.optional=!1),new b({name:t.blockName||fo,optional:t.optional,value:[new _({name:t.version||Og}),new Nt({value:[new _e({name:t.digestAlgorithms||h0,value:$.schema()})]}),kr.schema(t.encapContentInfo||{names:{blockName:Pg}}),new N({name:t.certificates||d0,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Vs.schema().valueBlock.value}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:ua.schema(t.crls||{names:{crls:g0}}).valueBlock.value}),new Nt({value:[new _e({name:t.signerInfos||m0,value:Bt.schema()})]})]})}fromSchema(e){W(e,c2);const t=j(e,e,tr.schema());if(K.assertSchema(t,this.className),this.version=t.result[Og].valueBlock.valueDec,h0 in t.result&&(this.digestAlgorithms=Array.from(t.result[h0],r=>new $({schema:r}))),this.encapContentInfo=new kr({schema:t.result[Pg]}),d0 in t.result){const r=new Vs({schema:new Nt({value:t.result[d0].valueBlock.value})});this.certificates=r.certificates.slice(0)}g0 in t.result&&(this.crls=Array.from(t.result[g0],r=>r.idBlock.tagClass===1?new Kt({schema:r}):(r.idBlock.tagClass=1,r.idBlock.tagNumber=16,new la({schema:r})))),m0 in t.result&&(this.signerInfos=Array.from(t.result[m0],r=>new Bt({schema:r})))}toSchema(e=!1){const t=[];if(this.certificates&&this.certificates.length&&this.certificates.some(r=>r instanceof bn)||this.crls&&this.crls.length&&this.crls.some(r=>r instanceof la)?this.version=5:this.certificates&&this.certificates.length&&this.certificates.some(r=>r instanceof Ur)?this.version=4:this.certificates&&this.certificates.length&&this.certificates.some(r=>r instanceof ta)||this.signerInfos.some(r=>r.version===3)||this.encapContentInfo.eContentType!==tr.ID_DATA?this.version=3:this.version=1,t.push(new _({value:this.version})),t.push(new Nt({value:Array.from(this.digestAlgorithms,r=>r.toSchema())})),t.push(this.encapContentInfo.toSchema()),this.certificates){const a=new Vs({certificates:this.certificates}).toSchema();t.push(new N({idBlock:{tagClass:3,tagNumber:0},value:a.valueBlock.value}))}return this.crls&&t.push(new N({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,r=>{if(r instanceof la){const a=r.toSchema();return a.idBlock.tagClass=3,a.idBlock.tagNumber=1,a}return r.toSchema(e)})})),t.push(new Nt({value:Array.from(this.signerInfos,r=>r.toSchema())})),new b({value:t})}toJSON(){const e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,t=>t.toJSON()),encapContentInfo:this.encapContentInfo.toJSON(),signerInfos:Array.from(this.signerInfos,t=>t.toJSON())};return this.certificates&&(e.certificates=Array.from(this.certificates,t=>t.toJSON())),this.crls&&(e.crls=Array.from(this.crls,t=>t.toJSON())),e}async verify({signer:e=-1,data:t=Ot,trustedCerts:r=[],checkDate:a=new Date,checkChain:n=!1,passedWhenNotRevValues:i=!1,extendedMode:o=!1,findOrigin:l=null,findIssuer:u=null}={},c=Le(!0)){let f=null,g=null;try{let v=Ot,p=S,h=[];const d=this.signerInfos[e];if(!d)throw new ir({date:a,code:1,message:"Unable to get signer by supplied index"});if(!this.certificates)throw new ir({date:a,code:2,message:"No certificates attached to this signed data"});if(d.sid instanceof Ut){for(const R of this.certificates)if(R instanceof Xe&&R.issuer.isEqual(d.sid.issuer)&&R.serialNumber.isEqual(d.sid.serialNumber)){f=R;break}}else{const R=d.sid,V=R.idBlock.isConstructed?R.valueBlock.value[0].valueBlock.valueHex:R.valueBlock.valueHex;for(const L of this.certificates){if(!(L instanceof Xe))continue;const ne=await c.digest({name:"sha-1"},L.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(ou(ne,V)){f=L;break}}}if(!f)throw new ir({date:a,code:3,message:"Unable to find signer certificate"});if(this.encapContentInfo.eContentType===gE){if(!this.encapContentInfo.eContent)throw new ir({date:a,code:15,message:"Error during verification: TSTInfo eContent is empty",signatureVerified:null,signerCertificate:f,timestampSerial:g,signerCertificateVerified:!0});let R;try{R=or.fromBER(this.encapContentInfo.eContent.valueBlock.valueHexView)}catch{throw new ir({date:a,code:15,message:"Error during verification: TSTInfo wrong ASN.1 schema ",signatureVerified:null,signerCertificate:f,timestampSerial:g,signerCertificateVerified:!0})}if(a=R.genTime,g=R.serialNumber.valueBlock.valueHexView.slice(),t.byteLength===0)throw new ir({date:a,code:4,message:"Missed detached data input array"});if(!await R.verify({data:t},c))throw new ir({date:a,code:15,message:"Error during verification: TSTInfo verification is failed",signatureVerified:!1,signerCertificate:f,timestampSerial:g,signerCertificateVerified:!0})}if(n){const R=this.certificates.filter(ae=>ae instanceof Xe&&!!h1(ae,f)),V={checkDate:a,certs:R,trustedCerts:r};u&&(V.findIssuer=u),l&&(V.findOrigin=l);const L=new fd(V);if(L.certs.push(f),this.crls)for(const ae of this.crls)"thisUpdate"in ae?L.crls.push(ae):ae.otherRevInfoFormat===qh&&L.ocsps.push(new Wr({schema:ae.otherRevInfo}));this.ocsps&&L.ocsps.push(...this.ocsps);const ne=await L.verify({passedWhenNotRevValues:i},c).catch(ae=>{throw new ir({date:a,code:5,message:`Validation of signer's certificate failed with error: ${ae instanceof Object?ae.resultMessage:ae}`,signerCertificate:f,signerCertificateVerified:!1})});if(ne.certificatePath&&(h=ne.certificatePath),!ne.result)throw new ir({date:a,code:5,message:`Validation of signer's certificate failed: ${ne.resultMessage}`,signerCertificate:f,signerCertificateVerified:!1})}const y=c.getAlgorithmByOID(d.digestAlgorithm.algorithmId);if(!("name"in y))throw new ir({date:a,code:7,message:`Unsupported signature algorithm: ${d.digestAlgorithm.algorithmId}`,signerCertificate:f,signerCertificateVerified:!0});p=y.name;const E=this.encapContentInfo.eContent;if(E)E.idBlock.tagClass===1&&E.idBlock.tagNumber===4?t=E.getValue():t=E.valueBlock.valueBeforeDecodeView;else if(t.byteLength===0)throw new ir({date:a,code:8,message:"Missed detached data input array",signerCertificate:f,signerCertificateVerified:!0});if(d.signedAttrs){let R=!1,V=!1;for(const L of d.signedAttrs.attributes)if(L.type==="1.2.840.113549.1.9.3"&&(R=!0),L.type==="1.2.840.113549.1.9.4"&&(V=!0,v=L.values[0].valueBlock.valueHex),R&&V)break;if(R===!1)throw new ir({date:a,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signerCertificate:f,signerCertificateVerified:!0});if(V===!1)throw new ir({date:a,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:f,signerCertificateVerified:!0})}if(d.signedAttrs){const R=await c.digest(p,new Uint8Array(t));if(!ou(R,v))throw new ir({date:a,code:15,message:"Error during verification: Message digest doesn't match",signatureVerified:null,signerCertificate:f,timestampSerial:g,signerCertificateVerified:!0});t=d.signedAttrs.encodedValue}const k=await c.verifyWithPublicKey(t,d.signature,f.subjectPublicKeyInfo,f.signatureAlgorithm,p);return o?{date:a,code:14,message:S,signatureVerified:k,signerCertificate:f,timestampSerial:g,signerCertificateVerified:!0,certificatePath:h}:k}catch(v){throw v instanceof ir?v:new ir({date:a,code:15,message:`Error during verification: ${v instanceof Error?v.message:v}`,signatureVerified:null,signerCertificate:f,timestampSerial:g,signerCertificateVerified:!0})}}async sign(e,t,r="SHA-1",a=Ot,n=Le(!0)){if(!e)throw new Error("Need to provide a private key for signing");const i=n.getOIDByAlgorithm({name:r},!0,"hashAlgorithm");this.digestAlgorithms.filter(f=>f.algorithmId===i).length===0&&this.digestAlgorithms.push(new $({algorithmId:i,algorithmParams:new xt}));const o=this.signerInfos[t];if(!o)throw new RangeError("SignerInfo index is out of range");o.digestAlgorithm=new $({algorithmId:i,algorithmParams:new xt});const l=await n.getSignatureParameters(e,r),u=l.parameters;if(o.signatureAlgorithm=l.signatureAlgorithm,o.signedAttrs)if(o.signedAttrs.encodedValue.byteLength!==0)a=o.signedAttrs.encodedValue;else{a=o.signedAttrs.toSchema().toBER();const f=Ee.toUint8Array(a);f[0]=49}else{const f=this.encapContentInfo.eContent;if(f)f.idBlock.tagClass===1&&f.idBlock.tagNumber===4?a=f.getValue():a=f.valueBlock.valueBeforeDecodeView;else if(a.byteLength===0)throw new Error("Missed detached data input array")}const c=await n.signWithPrivateKey(a,e,u);o.signature=new z({valueHex:c})}}tr.CLASS_NAME="SignedData";tr.ID_DATA=Sm;const Di="version",Li="authSafe",Qs="macData",Lu="parsedValue",f2=[Di,Li,Qs];class nn extends G{constructor(e={}){super(),this.version=m(e,Di,nn.defaultValues(Di)),this.authSafe=m(e,Li,nn.defaultValues(Li)),Qs in e&&(this.macData=m(e,Qs,nn.defaultValues(Qs))),Lu in e&&(this.parsedValue=m(e,Lu,nn.defaultValues(Lu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Di:return 3;case Li:return new ft;case Qs:return new pr;case Lu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Di:return t===nn.defaultValues(e);case Li:return ft.compareWithDefault("contentType",t.contentType)&&ft.compareWithDefault("content",t.content);case Qs:return pr.compareWithDefault("mac",t.mac)&&pr.compareWithDefault("macSalt",t.macSalt)&&pr.compareWithDefault("iterations",t.iterations);case Lu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _({name:t.version||Di}),ft.schema(t.authSafe||{names:{blockName:Li}}),pr.schema(t.macData||{names:{blockName:Qs,optional:!0}})]})}fromSchema(e){W(e,f2);const t=j(e,e,nn.schema({names:{version:Di,authSafe:{names:{blockName:Li}},macData:{names:{blockName:Qs}}}}));K.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.authSafe=new ft({schema:t.result.authSafe}),Qs in t.result&&(this.macData=new pr({schema:t.result.macData}))}toSchema(){const e=[new _({value:this.version}),this.authSafe.toSchema()];return this.macData&&e.push(this.macData.toSchema()),new b({value:e})}toJSON(){const e={version:this.version,authSafe:this.authSafe.toJSON()};return this.macData&&(e.macData=this.macData.toJSON()),e}async makeInternalValues(e={},t=Le(!0)){if(rt.assert(e,"parameters","object"),!this.parsedValue)throw new Error('Please call "parseValues" function first in order to make "parsedValue" data');switch(Ge.assertEmpty(this.parsedValue.integrityMode,"integrityMode","parsedValue"),Ge.assertEmpty(this.parsedValue.authenticatedSafe,"authenticatedSafe","parsedValue"),this.parsedValue.integrityMode){case 0:{if(!("iterations"in e))throw new Ge("iterations");Ge.assertEmpty(e.pbkdf2HashAlgorithm,"pbkdf2HashAlgorithm"),Ge.assertEmpty(e.hmacHashAlgorithm,"hmacHashAlgorithm"),Ge.assertEmpty(e.password,"password");const r=new ArrayBuffer(64),a=new Uint8Array(r);t.getRandomValues(a);const n=this.parsedValue.authenticatedSafe.toSchema().toBER(!1);this.authSafe=new ft({contentType:ft.DATA,content:new z({valueHex:n})});const i=await t.stampDataWithPassword({password:e.password,hashAlgorithm:e.hmacHashAlgorithm,salt:r,iterationCount:e.iterations,contentToStamp:n});this.macData=new pr({mac:new Yr({digestAlgorithm:new $({algorithmId:t.getOIDByAlgorithm({name:e.hmacHashAlgorithm},!0,"hmacHashAlgorithm")}),digest:new z({valueHex:i})}),macSalt:new z({valueHex:r}),iterations:e.iterations})}break;case 1:{if(!("signingCertificate"in e))throw new Ge("signingCertificate");Ge.assertEmpty(e.privateKey,"privateKey"),Ge.assertEmpty(e.hashAlgorithm,"hashAlgorithm");const r=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),a=new tr({version:1,encapContentInfo:new kr({eContentType:"1.2.840.113549.1.7.1",eContent:new z({valueHex:r})}),certificates:[e.signingCertificate]}),n=await t.digest({name:e.hashAlgorithm},new Uint8Array(r)),i=[];i.push(new mt({type:"1.2.840.113549.1.9.3",values:[new he({value:"1.2.840.113549.1.7.1"})]})),i.push(new mt({type:"1.2.840.113549.1.9.5",values:[new uu({valueDate:new Date})]})),i.push(new mt({type:"1.2.840.113549.1.9.4",values:[new z({valueHex:n})]})),a.signerInfos.push(new Bt({version:1,sid:new Ut({issuer:e.signingCertificate.issuer,serialNumber:e.signingCertificate.serialNumber}),signedAttrs:new Et({type:0,attributes:i})})),await a.sign(e.privateKey,0,e.hashAlgorithm,void 0,t),this.authSafe=new ft({contentType:"1.2.840.113549.1.7.2",content:a.toSchema(!0)})}break;default:throw new Error(`Parameter "integrityMode" has unknown value: ${this.parsedValue.integrityMode}`)}}async parseInternalValues(e,t=Le(!0)){switch(rt.assert(e,"parameters","object"),e.checkIntegrity===void 0&&(e.checkIntegrity=!0),this.parsedValue={},this.authSafe.contentType){case ft.DATA:{Ge.assertEmpty(e.password,"password"),this.parsedValue.integrityMode=0,rt.assert(this.authSafe.content,"authSafe.content",z);const r=this.authSafe.content.getValue();if(this.parsedValue.authenticatedSafe=so.fromBER(r),e.checkIntegrity){if(!this.macData)throw new Error('Absent "macData" value, can not check PKCS#12 data integrity');const a=t.getAlgorithmByOID(this.macData.mac.digestAlgorithm.algorithmId,!0,"digestAlgorithm");if(!await t.verifyDataStampedWithPassword({password:e.password,hashAlgorithm:a.name,salt:Ee.toArrayBuffer(this.macData.macSalt.valueBlock.valueHexView),iterationCount:this.macData.iterations||1,contentToVerify:r,signatureToVerify:Ee.toArrayBuffer(this.macData.mac.digest.valueBlock.valueHexView)}))throw new Error("Integrity for the PKCS#12 data is broken!")}}break;case ft.SIGNED_DATA:{this.parsedValue.integrityMode=1;const r=new tr({schema:this.authSafe.content}),a=r.encapContentInfo.eContent;Ge.assert(a,"eContent","cmsSigned.encapContentInfo"),rt.assert(a,"eContent",z);const n=a.getValue();if(this.parsedValue.authenticatedSafe=so.fromBER(n),!await r.verify({signer:0,checkChain:!1},t))throw new Error("Integrity for the PKCS#12 data is broken!")}break;default:throw new Error(`Incorrect value for "this.authSafe.contentType": ${this.authSafe.contentType}`)}}}nn.CLASS_NAME="PFX";const Pl="status",tn="statusStrings",rn="failInfo",h2=[Pl,tn,rn];var Op;(function(s){s[s.granted=0]="granted",s[s.grantedWithMods=1]="grantedWithMods",s[s.rejection=2]="rejection",s[s.waiting=3]="waiting",s[s.revocationWarning=4]="revocationWarning",s[s.revocationNotification=5]="revocationNotification"})(Op||(Op={}));class Qr extends G{constructor(e={}){super(),this.status=m(e,Pl,Qr.defaultValues(Pl)),tn in e&&(this.statusStrings=m(e,tn,Qr.defaultValues(tn))),rn in e&&(this.failInfo=m(e,rn,Qr.defaultValues(rn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pl:return 2;case tn:return[];case rn:return new He;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Pl:return t===Qr.defaultValues(e);case tn:return t.length===0;case rn:return t.isEqual(Qr.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||S,value:[new _({name:t.status||S}),new b({optional:!0,value:[new _e({name:t.statusStrings||S,value:new gs})]}),new He({name:t.failInfo||S,optional:!0})]})}fromSchema(e){W(e,h2);const t=j(e,e,Qr.schema({names:{status:Pl,statusStrings:tn,failInfo:rn}}));K.assertSchema(t,this.className);const r=t.result.status;if(r.valueBlock.isHexOnly===!0||r.valueBlock.valueDec<0||r.valueBlock.valueDec>5)throw new Error('PKIStatusInfo "status" has invalid value');this.status=r.valueBlock.valueDec,tn in t.result&&(this.statusStrings=t.result.statusStrings),rn in t.result&&(this.failInfo=t.result.failInfo)}toSchema(){const e=[];return e.push(new _({value:this.status})),this.statusStrings&&e.push(new b({optional:!0,value:this.statusStrings})),this.failInfo&&e.push(this.failInfo),new b({value:e})}toJSON(){const e={status:this.status};return this.statusStrings&&(e.statusStrings=Array.from(this.statusStrings,t=>t.toJSON())),this.failInfo&&(e.failInfo=this.failInfo.toJSON()),e}}Qr.CLASS_NAME="PKIStatusInfo";const _f="version",$f="messageImprint",Ul="reqPolicy",Kl="nonce",Ys="certReq",Ml="extensions",ho="TimeStampReq",Ug=`${ho}.${_f}`,Kg=`${ho}.${$f}`,p0=`${ho}.${Ul}`,y0=`${ho}.${Kl}`,v0=`${ho}.${Ys}`,w0=`${ho}.${Ml}`,d2=[Ug,Kg,p0,y0,v0,w0];class Tr extends G{constructor(e={}){super(),this.version=m(e,_f,Tr.defaultValues(_f)),this.messageImprint=m(e,$f,Tr.defaultValues($f)),Ul in e&&(this.reqPolicy=m(e,Ul,Tr.defaultValues(Ul))),Kl in e&&(this.nonce=m(e,Kl,Tr.defaultValues(Kl))),Ys in e&&(this.certReq=m(e,Ys,Tr.defaultValues(Ys))),Ml in e&&(this.extensions=m(e,Ml,Tr.defaultValues(Ml))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _f:return 0;case $f:return new ar;case Ul:return S;case Kl:return new _;case Ys:return!1;case Ml:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case _f:case Ul:case Ys:return t===Tr.defaultValues(e);case $f:return ar.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&ar.compareWithDefault("hashedMessage",t.hashedMessage);case Kl:return t.isEqual(Tr.defaultValues(e));case Ml:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||ho,value:[new _({name:t.version||Ug}),ar.schema(t.messageImprint||{names:{blockName:Kg}}),new he({name:t.reqPolicy||p0,optional:!0}),new _({name:t.nonce||y0,optional:!0}),new Ds({name:t.certReq||v0,optional:!0}),new N({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new _e({name:t.extensions||w0,value:Vt.schema()})]})]})}fromSchema(e){W(e,d2);const t=j(e,e,Tr.schema());K.assertSchema(t,this.className),this.version=t.result[Ug].valueBlock.valueDec,this.messageImprint=new ar({schema:t.result[Kg]}),p0 in t.result&&(this.reqPolicy=t.result[p0].valueBlock.toString()),y0 in t.result&&(this.nonce=t.result[y0]),v0 in t.result&&(this.certReq=t.result[v0].valueBlock.value),w0 in t.result&&(this.extensions=Array.from(t.result[w0],r=>new Vt({schema:r})))}toSchema(){const e=[];return e.push(new _({value:this.version})),e.push(this.messageImprint.toSchema()),this.reqPolicy&&e.push(new he({value:this.reqPolicy})),this.nonce&&e.push(this.nonce),Ys in this&&Tr.compareWithDefault(Ys,this.certReq)===!1&&e.push(new Ds({value:this.certReq})),this.extensions&&e.push(new N({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.extensions,t=>t.toSchema())})),new b({value:e})}toJSON(){const e={version:this.version,messageImprint:this.messageImprint.toJSON()};return this.reqPolicy!==void 0&&(e.reqPolicy=this.reqPolicy),this.nonce!==void 0&&(e.nonce=this.nonce.toJSON()),this.certReq!==void 0&&Tr.compareWithDefault(Ys,this.certReq)===!1&&(e.certReq=this.certReq),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}}Tr.CLASS_NAME="TimeStampReq";const Hl="status",Fl="timeStampToken",Rm="TimeStampResp",Mg=`${Rm}.${Hl}`,S0=`${Rm}.${Fl}`,g2=[Mg,S0];class Kf extends G{constructor(e={}){super(),this.status=m(e,Hl,Kf.defaultValues(Hl)),Fl in e&&(this.timeStampToken=m(e,Fl,Kf.defaultValues(Fl))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hl:return new Qr;case Fl:return new ft;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Hl:return Qr.compareWithDefault(Hl,t.status)&&!("statusStrings"in t)&&!("failInfo"in t);case Fl:return t.contentType===S&&t.content instanceof xe;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new b({name:t.blockName||Rm,value:[Qr.schema(t.status||{names:{blockName:Mg}}),ft.schema(t.timeStampToken||{names:{blockName:S0,optional:!0}})]})}fromSchema(e){W(e,g2);const t=j(e,e,Kf.schema());K.assertSchema(t,this.className),this.status=new Qr({schema:t.result[Mg]}),S0 in t.result&&(this.timeStampToken=new ft({schema:t.result[S0]}))}toSchema(){const e=[];return e.push(this.status.toSchema()),this.timeStampToken&&e.push(this.timeStampToken.toSchema()),new b({value:e})}toJSON(){const e={status:this.status.toJSON()};return this.timeStampToken&&(e.timeStampToken=this.timeStampToken.toJSON()),e}async sign(e,t,r=Le(!0)){return this.assertContentType(),new tr({schema:this.timeStampToken.content}).sign(e,0,t,void 0,r)}async verify(e={signer:0,trustedCerts:[],data:Ot},t=Le(!0)){return this.assertContentType(),new tr({schema:this.timeStampToken.content}).verify(e,t)}assertContentType(){if(!this.timeStampToken)throw new Error("timeStampToken is absent in TSP response");if(this.timeStampToken.contentType!==a1)throw new Error(`Wrong format of timeStampToken: ${this.timeStampToken.contentType}`)}}Kf.CLASS_NAME="TimeStampResp";function m2(){if(typeof self<"u"){if("crypto"in self){let s="webcrypto";"webkitSubtle"in self.crypto&&(s="safari"),Cp(s,new $0({name:s,crypto}))}}else if(typeof crypto<"u"&&"webcrypto"in crypto){const s="NodeJS ^15",e=crypto.webcrypto;Cp(s,new $0({name:s,crypto:e}))}}m2();function Pp(s,e,t){const r=s.slice();return r[68]=e[t],r[70]=t,r}function Up(s,e,t){const r=s.slice();return r[71]=e[t],r[70]=t,r}function Kp(s,e,t){const r=s.slice();return r[73]=e[t],r[70]=t,r}function Mp(s,e,t){const r=s.slice();return r[75]=e[t],r[70]=t,r}function p2(s){let e;return{c(){e=pt("No")},l(t){e=yt(t,"No")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function y2(s){let e;return{c(){e=pt("Alias Name")},l(t){e=yt(t,"Alias Name")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function v2(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p,h,d;return e=new at({props:{class:"!p-4"}}),r=new at({props:{$$slots:{default:[p2]},$$scope:{ctx:s}}}),n=new at({props:{class:"w-64",$$slots:{default:[y2]},$$scope:{ctx:s}}}),o=new at({props:{class:"w-64"}}),u=new at({props:{class:"w-96"}}),f=new at({props:{class:"w-36"}}),v=new at({}),h=new at({}),{c(){H(e.$$.fragment),t=Z(),H(r.$$.fragment),a=Z(),H(n.$$.fragment),i=Z(),H(o.$$.fragment),l=Z(),H(u.$$.fragment),c=Z(),H(f.$$.fragment),g=Z(),H(v.$$.fragment),p=Z(),H(h.$$.fragment)},l(y){F(e.$$.fragment,y),t=ee(y),F(r.$$.fragment,y),a=ee(y),F(n.$$.fragment,y),i=ee(y),F(o.$$.fragment,y),l=ee(y),F(u.$$.fragment,y),c=ee(y),F(f.$$.fragment,y),g=ee(y),F(v.$$.fragment,y),p=ee(y),F(h.$$.fragment,y)},m(y,E){q(e,y,E),U(y,t,E),q(r,y,E),U(y,a,E),q(n,y,E),U(y,i,E),q(o,y,E),U(y,l,E),q(u,y,E),U(y,c,E),q(f,y,E),U(y,g,E),q(v,y,E),U(y,p,E),q(h,y,E),d=!0},p(y,E){const k={};E[2]&32768&&(k.$$scope={dirty:E,ctx:y}),r.$set(k);const R={};E[2]&32768&&(R.$$scope={dirty:E,ctx:y}),n.$set(R)},i(y){d||(D(e.$$.fragment,y),D(r.$$.fragment,y),D(n.$$.fragment,y),D(o.$$.fragment,y),D(u.$$.fragment,y),D(f.$$.fragment,y),D(v.$$.fragment,y),D(h.$$.fragment,y),d=!0)},o(y){O(e.$$.fragment,y),O(r.$$.fragment,y),O(n.$$.fragment,y),O(o.$$.fragment,y),O(u.$$.fragment,y),O(f.$$.fragment,y),O(v.$$.fragment,y),O(h.$$.fragment,y),d=!1},d(y){J(e,y),y&&P(t),J(r,y),y&&P(a),J(n,y),y&&P(i),J(o,y),y&&P(l),J(u,y),y&&P(c),J(f,y),y&&P(g),J(v,y),y&&P(p),J(h,y)}}}function Hp(s){let e,t,r=s[17],a=[];for(let i=0;i<r.length;i+=1)a[i]=Fp(Mp(s,r,i));const n=i=>O(a[i],1,1,()=>{a[i]=null});return{c(){for(let i=0;i<a.length;i+=1)a[i].c();e=$s()},l(i){for(let o=0;o<a.length;o+=1)a[o].l(i);e=$s()},m(i,o){for(let l=0;l<a.length;l+=1)a[l].m(i,o);U(i,e,o),t=!0},p(i,o){if(o[0]&131072){r=i[17];let l;for(l=0;l<r.length;l+=1){const u=Mp(i,r,l);a[l]?(a[l].p(u,o),D(a[l],1)):(a[l]=Fp(u),a[l].c(),D(a[l],1),a[l].m(e.parentNode,e))}for(xn(),l=r.length;l<a.length;l+=1)n(l);Nn()}},i(i){if(!t){for(let o=0;o<r.length;o+=1)D(a[o]);t=!0}},o(i){a=a.filter(Boolean);for(let o=0;o<a.length;o+=1)O(a[o]);t=!1},d(i){J0(a,i),i&&P(e)}}}function w2(s){let e=s[70]+1+"",t;return{c(){t=pt(e)},l(r){t=yt(r,e)},m(r,a){U(r,t,a)},p:rh,d(r){r&&P(t)}}}function S2(s){let e=s[75]+"",t;return{c(){t=pt(e)},l(r){t=yt(r,e)},m(r,a){U(r,t,a)},p(r,a){a[0]&131072&&e!==(e=r[75]+"")&&io(t,e)},d(r){r&&P(t)}}}function C2(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p,h,d,y;return e=new Se({props:{class:"!p-4"}}),r=new Se({props:{class:"w-10",$$slots:{default:[w2]},$$scope:{ctx:s}}}),n=new Se({props:{class:"w-64",$$slots:{default:[S2]},$$scope:{ctx:s}}}),o=new Se({props:{class:"w-64"}}),u=new Se({props:{class:"w-96"}}),f=new Se({props:{class:"w-36"}}),v=new Se({}),h=new at({}),{c(){H(e.$$.fragment),t=Z(),H(r.$$.fragment),a=Z(),H(n.$$.fragment),i=Z(),H(o.$$.fragment),l=Z(),H(u.$$.fragment),c=Z(),H(f.$$.fragment),g=Z(),H(v.$$.fragment),p=Z(),H(h.$$.fragment),d=Z()},l(E){F(e.$$.fragment,E),t=ee(E),F(r.$$.fragment,E),a=ee(E),F(n.$$.fragment,E),i=ee(E),F(o.$$.fragment,E),l=ee(E),F(u.$$.fragment,E),c=ee(E),F(f.$$.fragment,E),g=ee(E),F(v.$$.fragment,E),p=ee(E),F(h.$$.fragment,E),d=ee(E)},m(E,k){q(e,E,k),U(E,t,k),q(r,E,k),U(E,a,k),q(n,E,k),U(E,i,k),q(o,E,k),U(E,l,k),q(u,E,k),U(E,c,k),q(f,E,k),U(E,g,k),q(v,E,k),U(E,p,k),q(h,E,k),U(E,d,k),y=!0},p(E,k){const R={};k[2]&32768&&(R.$$scope={dirty:k,ctx:E}),r.$set(R);const V={};k[0]&131072|k[2]&32768&&(V.$$scope={dirty:k,ctx:E}),n.$set(V)},i(E){y||(D(e.$$.fragment,E),D(r.$$.fragment,E),D(n.$$.fragment,E),D(o.$$.fragment,E),D(u.$$.fragment,E),D(f.$$.fragment,E),D(v.$$.fragment,E),D(h.$$.fragment,E),y=!0)},o(E){O(e.$$.fragment,E),O(r.$$.fragment,E),O(n.$$.fragment,E),O(o.$$.fragment,E),O(u.$$.fragment,E),O(f.$$.fragment,E),O(v.$$.fragment,E),O(h.$$.fragment,E),y=!1},d(E){J(e,E),E&&P(t),J(r,E),E&&P(a),J(n,E),E&&P(i),J(o,E),E&&P(l),J(u,E),E&&P(c),J(f,E),E&&P(g),J(v,E),E&&P(p),J(h,E),E&&P(d)}}}function Fp(s){let e,t;return e=new Tn({props:{$$slots:{default:[C2]},$$scope:{ctx:s}}}),{c(){H(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&131072|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(D(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function A2(s){let e,t,r;function a(i){s[33](i)}let n={style:"filled",id:"floating_filled",name:"floating_filled",type:"text",label:"Alias Name"};return s[5]!==void 0&&(n.value=s[5]),e=new sh({props:n}),Zf.push(()=>eh(e,"value",a,s[5])),{c(){H(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,o){q(e,i,o),r=!0},p(i,o){const l={};!t&&o[0]&32&&(t=!0,l.value=i[5],th(()=>t=!1)),e.$set(l)},i(i){r||(D(e.$$.fragment,i),r=!0)},o(i){O(e.$$.fragment,i),r=!1},d(i){J(e,i)}}}function E2(s){let e,t,r;function a(i){s[34](i)}let n={style:"filled",id:"floating_filled2",name:"floating_filled2",type:"text",label:"PKCS#12 Password"};return s[6]!==void 0&&(n.value=s[6]),e=new sh({props:n}),Zf.push(()=>eh(e,"value",a,s[6])),{c(){H(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,o){q(e,i,o),r=!0},p(i,o){const l={};!t&&o[0]&64&&(t=!0,l.value=i[6],th(()=>t=!1)),e.$set(l)},i(i){r||(D(e.$$.fragment,i),r=!0)},o(i){O(e.$$.fragment,i),r=!1},d(i){J(e,i)}}}function b2(s){let e,t,r,a,n,i,o,l,u;return{c(){e=Ts("label"),t=pt("Choose File"),r=Z(),a=Ts("input"),n=Z(),i=Ts("span"),o=pt(s[7]),this.h()},l(c){e=Rs(c,"LABEL",{for:!0,class:!0});var f=ru(e);t=yt(f,"Choose File"),f.forEach(P),r=ee(c),a=Rs(c,"INPUT",{type:!0,id:!0,class:!0,style:!0}),n=ee(c),i=Rs(c,"SPAN",{class:!0});var g=ru(i);o=yt(g,s[7]),g.forEach(P),this.h()},h(){$t(e,"for","MachineCertUpload"),$t(e,"class","text-center font-medium focus:ring-4 focus:outline-none inline-flex items-center justify-center px-5 py-2.5 text-sm text-white bg-gray-800 hover:bg-gray-900 focus:ring-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700 dark:focus:ring-gray-700 rounded-lg"),$t(a,"type","file"),$t(a,"id","MachineCertUpload"),$t(a,"class","block w-full disabled:cursor-not-allowed disabled:opacity-50 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500 bg-gray-50 text-gray-900 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 border-gray-300 dark:border-gray-600 p-2.5 text-sm rounded-lg border !p-0 dark:text-gray-400"),Hg(a,"display","none"),$t(i,"class","pl-4")},m(c,f){U(c,e,f),su(e,t),U(c,r,f),U(c,a,f),U(c,n,f),U(c,i,f),su(i,o),l||(u=G0(a,"change",s[18]),l=!0)},p(c,f){f[0]&128&&io(o,c[7])},d(c){c&&P(e),c&&P(r),c&&P(a),c&&P(n),c&&P(i),l=!1,u()}}}function k2(s){let e;return{c(){e=pt("Upload")},l(t){e=yt(t,"Upload")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function I2(s){let e,t;return e=new j0({props:{color:"dark",$$slots:{default:[k2]},$$scope:{ctx:s}}}),e.$on("click",s[19]),{c(){H(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(D(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function B2(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p,h,d;return e=new Se({props:{class:"!p-4"}}),r=new Se({props:{class:"w-10"}}),n=new Se({props:{class:"w-64",$$slots:{default:[A2]},$$scope:{ctx:s}}}),o=new Se({props:{class:"w-64",$$slots:{default:[E2]},$$scope:{ctx:s}}}),u=new Se({props:{class:"w-96",$$slots:{default:[b2]},$$scope:{ctx:s}}}),f=new Se({props:{class:"w-36",$$slots:{default:[I2]},$$scope:{ctx:s}}}),v=new Se({}),h=new Se({}),{c(){H(e.$$.fragment),t=Z(),H(r.$$.fragment),a=Z(),H(n.$$.fragment),i=Z(),H(o.$$.fragment),l=Z(),H(u.$$.fragment),c=Z(),H(f.$$.fragment),g=Z(),H(v.$$.fragment),p=Z(),H(h.$$.fragment)},l(y){F(e.$$.fragment,y),t=ee(y),F(r.$$.fragment,y),a=ee(y),F(n.$$.fragment,y),i=ee(y),F(o.$$.fragment,y),l=ee(y),F(u.$$.fragment,y),c=ee(y),F(f.$$.fragment,y),g=ee(y),F(v.$$.fragment,y),p=ee(y),F(h.$$.fragment,y)},m(y,E){q(e,y,E),U(y,t,E),q(r,y,E),U(y,a,E),q(n,y,E),U(y,i,E),q(o,y,E),U(y,l,E),q(u,y,E),U(y,c,E),q(f,y,E),U(y,g,E),q(v,y,E),U(y,p,E),q(h,y,E),d=!0},p(y,E){const k={};E[0]&32|E[2]&32768&&(k.$$scope={dirty:E,ctx:y}),n.$set(k);const R={};E[0]&64|E[2]&32768&&(R.$$scope={dirty:E,ctx:y}),o.$set(R);const V={};E[0]&128|E[2]&32768&&(V.$$scope={dirty:E,ctx:y}),u.$set(V);const L={};E[2]&32768&&(L.$$scope={dirty:E,ctx:y}),f.$set(L)},i(y){d||(D(e.$$.fragment,y),D(r.$$.fragment,y),D(n.$$.fragment,y),D(o.$$.fragment,y),D(u.$$.fragment,y),D(f.$$.fragment,y),D(v.$$.fragment,y),D(h.$$.fragment,y),d=!0)},o(y){O(e.$$.fragment,y),O(r.$$.fragment,y),O(n.$$.fragment,y),O(o.$$.fragment,y),O(u.$$.fragment,y),O(f.$$.fragment,y),O(v.$$.fragment,y),O(h.$$.fragment,y),d=!1},d(y){J(e,y),y&&P(t),J(r,y),y&&P(a),J(n,y),y&&P(i),J(o,y),y&&P(l),J(u,y),y&&P(c),J(f,y),y&&P(g),J(v,y),y&&P(p),J(h,y)}}}function x2(s){let e,t,r,a=s[16]==1&&Hp(s);return t=new Tn({props:{$$slots:{default:[B2]},$$scope:{ctx:s}}}),{c(){a&&a.c(),e=Z(),H(t.$$.fragment)},l(n){a&&a.l(n),e=ee(n),F(t.$$.fragment,n)},m(n,i){a&&a.m(n,i),U(n,e,i),q(t,n,i),r=!0},p(n,i){n[16]==1?a?(a.p(n,i),i[0]&65536&&D(a,1)):(a=Hp(n),a.c(),D(a,1),a.m(e.parentNode,e)):a&&(xn(),O(a,1,1,()=>{a=null}),Nn());const o={};i[0]&224|i[2]&32768&&(o.$$scope={dirty:i,ctx:n}),t.$set(o)},i(n){r||(D(a),D(t.$$.fragment,n),r=!0)},o(n){O(a),O(t.$$.fragment,n),r=!1},d(n){a&&a.d(n),n&&P(e),J(t,n)}}}function N2(s){let e,t,r,a;return e=new Y0({props:{$$slots:{default:[v2]},$$scope:{ctx:s}}}),r=new Q0({props:{$$slots:{default:[x2]},$$scope:{ctx:s}}}),{c(){H(e.$$.fragment),t=Z(),H(r.$$.fragment)},l(n){F(e.$$.fragment,n),t=ee(n),F(r.$$.fragment,n)},m(n,i){q(e,n,i),U(n,t,i),q(r,n,i),a=!0},p(n,i){const o={};i[2]&32768&&(o.$$scope={dirty:i,ctx:n}),e.$set(o);const l={};i[0]&196832|i[2]&32768&&(l.$$scope={dirty:i,ctx:n}),r.$set(l)},i(n){a||(D(e.$$.fragment,n),D(r.$$.fragment,n),a=!0)},o(n){O(e.$$.fragment,n),O(r.$$.fragment,n),a=!1},d(n){J(e,n),n&&P(t),J(r,n)}}}function T2(s){let e,t;return e=new W0({props:{shadow:!0,striped:!0,tableNoWFull:!0,$$slots:{default:[N2]},$$scope:{ctx:s}}}),{c(){H(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&196832|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(D(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function R2(s){let e;return{c(){e=pt("No")},l(t){e=yt(t,"No")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function V2(s){let e;return{c(){e=pt("Alias Name")},l(t){e=yt(t,"Alias Name")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function _2(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p;return e=new at({props:{class:"!p-4"}}),r=new at({props:{$$slots:{default:[R2]},$$scope:{ctx:s}}}),n=new at({props:{$$slots:{default:[V2]},$$scope:{ctx:s}}}),o=new at({}),u=new at({}),f=new at({}),v=new at({}),{c(){H(e.$$.fragment),t=Z(),H(r.$$.fragment),a=Z(),H(n.$$.fragment),i=Z(),H(o.$$.fragment),l=Z(),H(u.$$.fragment),c=Z(),H(f.$$.fragment),g=Z(),H(v.$$.fragment)},l(h){F(e.$$.fragment,h),t=ee(h),F(r.$$.fragment,h),a=ee(h),F(n.$$.fragment,h),i=ee(h),F(o.$$.fragment,h),l=ee(h),F(u.$$.fragment,h),c=ee(h),F(f.$$.fragment,h),g=ee(h),F(v.$$.fragment,h)},m(h,d){q(e,h,d),U(h,t,d),q(r,h,d),U(h,a,d),q(n,h,d),U(h,i,d),q(o,h,d),U(h,l,d),q(u,h,d),U(h,c,d),q(f,h,d),U(h,g,d),q(v,h,d),p=!0},p(h,d){const y={};d[2]&32768&&(y.$$scope={dirty:d,ctx:h}),r.$set(y);const E={};d[2]&32768&&(E.$$scope={dirty:d,ctx:h}),n.$set(E)},i(h){p||(D(e.$$.fragment,h),D(r.$$.fragment,h),D(n.$$.fragment,h),D(o.$$.fragment,h),D(u.$$.fragment,h),D(f.$$.fragment,h),D(v.$$.fragment,h),p=!0)},o(h){O(e.$$.fragment,h),O(r.$$.fragment,h),O(n.$$.fragment,h),O(o.$$.fragment,h),O(u.$$.fragment,h),O(f.$$.fragment,h),O(v.$$.fragment,h),p=!1},d(h){J(e,h),h&&P(t),J(r,h),h&&P(a),J(n,h),h&&P(i),J(o,h),h&&P(l),J(u,h),h&&P(c),J(f,h),h&&P(g),J(v,h)}}}function qp(s){let e,t,r=s[15],a=[];for(let i=0;i<r.length;i+=1)a[i]=Jp(Kp(s,r,i));const n=i=>O(a[i],1,1,()=>{a[i]=null});return{c(){for(let i=0;i<a.length;i+=1)a[i].c();e=$s()},l(i){for(let o=0;o<a.length;o+=1)a[o].l(i);e=$s()},m(i,o){for(let l=0;l<a.length;l+=1)a[l].m(i,o);U(i,e,o),t=!0},p(i,o){if(o[0]&32768){r=i[15];let l;for(l=0;l<r.length;l+=1){const u=Kp(i,r,l);a[l]?(a[l].p(u,o),D(a[l],1)):(a[l]=Jp(u),a[l].c(),D(a[l],1),a[l].m(e.parentNode,e))}for(xn(),l=r.length;l<a.length;l+=1)n(l);Nn()}},i(i){if(!t){for(let o=0;o<r.length;o+=1)D(a[o]);t=!0}},o(i){a=a.filter(Boolean);for(let o=0;o<a.length;o+=1)O(a[o]);t=!1},d(i){J0(a,i),i&&P(e)}}}function $2(s){let e=s[70]+1+"",t;return{c(){t=pt(e)},l(r){t=yt(r,e)},m(r,a){U(r,t,a)},p:rh,d(r){r&&P(t)}}}function D2(s){let e=s[73]+"",t;return{c(){t=pt(e)},l(r){t=yt(r,e)},m(r,a){U(r,t,a)},p(r,a){a[0]&32768&&e!==(e=r[73]+"")&&io(t,e)},d(r){r&&P(t)}}}function L2(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p,h;return e=new Se({props:{class:"!p-4"}}),r=new Se({props:{class:"w-10",$$slots:{default:[$2]},$$scope:{ctx:s}}}),n=new Se({props:{class:"w-64",$$slots:{default:[D2]},$$scope:{ctx:s}}}),o=new Se({props:{class:"w-96"}}),u=new Se({props:{class:"w-36"}}),f=new Se({}),v=new Se({}),{c(){H(e.$$.fragment),t=Z(),H(r.$$.fragment),a=Z(),H(n.$$.fragment),i=Z(),H(o.$$.fragment),l=Z(),H(u.$$.fragment),c=Z(),H(f.$$.fragment),g=Z(),H(v.$$.fragment),p=Z()},l(d){F(e.$$.fragment,d),t=ee(d),F(r.$$.fragment,d),a=ee(d),F(n.$$.fragment,d),i=ee(d),F(o.$$.fragment,d),l=ee(d),F(u.$$.fragment,d),c=ee(d),F(f.$$.fragment,d),g=ee(d),F(v.$$.fragment,d),p=ee(d)},m(d,y){q(e,d,y),U(d,t,y),q(r,d,y),U(d,a,y),q(n,d,y),U(d,i,y),q(o,d,y),U(d,l,y),q(u,d,y),U(d,c,y),q(f,d,y),U(d,g,y),q(v,d,y),U(d,p,y),h=!0},p(d,y){const E={};y[2]&32768&&(E.$$scope={dirty:y,ctx:d}),r.$set(E);const k={};y[0]&32768|y[2]&32768&&(k.$$scope={dirty:y,ctx:d}),n.$set(k)},i(d){h||(D(e.$$.fragment,d),D(r.$$.fragment,d),D(n.$$.fragment,d),D(o.$$.fragment,d),D(u.$$.fragment,d),D(f.$$.fragment,d),D(v.$$.fragment,d),h=!0)},o(d){O(e.$$.fragment,d),O(r.$$.fragment,d),O(n.$$.fragment,d),O(o.$$.fragment,d),O(u.$$.fragment,d),O(f.$$.fragment,d),O(v.$$.fragment,d),h=!1},d(d){J(e,d),d&&P(t),J(r,d),d&&P(a),J(n,d),d&&P(i),J(o,d),d&&P(l),J(u,d),d&&P(c),J(f,d),d&&P(g),J(v,d),d&&P(p)}}}function Jp(s){let e,t;return e=new Tn({props:{$$slots:{default:[L2]},$$scope:{ctx:s}}}),{c(){H(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&32768|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(D(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function O2(s){let e,t,r;function a(i){s[35](i)}let n={style:"filled",id:"floating_filled",name:"floating_filled",type:"text",label:"Alias Name"};return s[2]!==void 0&&(n.value=s[2]),e=new sh({props:n}),Zf.push(()=>eh(e,"value",a,s[2])),{c(){H(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,o){q(e,i,o),r=!0},p(i,o){const l={};!t&&o[0]&4&&(t=!0,l.value=i[2],th(()=>t=!1)),e.$set(l)},i(i){r||(D(e.$$.fragment,i),r=!0)},o(i){O(e.$$.fragment,i),r=!1},d(i){J(e,i)}}}function P2(s){let e,t,r,a,n,i,o,l,u;return{c(){e=Ts("label"),t=pt("Choose File"),r=Z(),a=Ts("input"),n=Z(),i=Ts("span"),o=pt(s[8]),this.h()},l(c){e=Rs(c,"LABEL",{for:!0,class:!0});var f=ru(e);t=yt(f,"Choose File"),f.forEach(P),r=ee(c),a=Rs(c,"INPUT",{type:!0,id:!0,class:!0,style:!0}),n=ee(c),i=Rs(c,"SPAN",{class:!0});var g=ru(i);o=yt(g,s[8]),g.forEach(P),this.h()},h(){$t(e,"for","CACertUpload"),$t(e,"class","text-center font-medium focus:ring-4 focus:outline-none inline-flex items-center justify-center px-5 py-2.5 text-sm text-white bg-gray-800 hover:bg-gray-900 focus:ring-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700 dark:focus:ring-gray-700 rounded-lg"),$t(a,"type","file"),$t(a,"id","CACertUpload"),$t(a,"class","block w-full disabled:cursor-not-allowed disabled:opacity-50 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500 bg-gray-50 text-gray-900 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 border-gray-300 dark:border-gray-600 p-2.5 text-sm rounded-lg border !p-0 dark:text-gray-400"),Hg(a,"display","none"),$t(i,"class","pl-4")},m(c,f){U(c,e,f),su(e,t),U(c,r,f),U(c,a,f),U(c,n,f),U(c,i,f),su(i,o),l||(u=G0(a,"change",s[20]),l=!0)},p(c,f){f[0]&256&&io(o,c[8])},d(c){c&&P(e),c&&P(r),c&&P(a),c&&P(n),c&&P(i),l=!1,u()}}}function U2(s){let e;return{c(){e=pt("Upload")},l(t){e=yt(t,"Upload")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function K2(s){let e,t;return e=new j0({props:{color:"dark",$$slots:{default:[U2]},$$scope:{ctx:s}}}),e.$on("click",s[21]),{c(){H(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(D(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function M2(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p;return e=new Se({props:{class:"!p-4"}}),r=new Se({props:{class:"w-10"}}),n=new Se({props:{class:"w-64",$$slots:{default:[O2]},$$scope:{ctx:s}}}),o=new Se({props:{class:"w-96",$$slots:{default:[P2]},$$scope:{ctx:s}}}),u=new Se({props:{class:"w-36",$$slots:{default:[K2]},$$scope:{ctx:s}}}),f=new Se({}),v=new Se({}),{c(){H(e.$$.fragment),t=Z(),H(r.$$.fragment),a=Z(),H(n.$$.fragment),i=Z(),H(o.$$.fragment),l=Z(),H(u.$$.fragment),c=Z(),H(f.$$.fragment),g=Z(),H(v.$$.fragment)},l(h){F(e.$$.fragment,h),t=ee(h),F(r.$$.fragment,h),a=ee(h),F(n.$$.fragment,h),i=ee(h),F(o.$$.fragment,h),l=ee(h),F(u.$$.fragment,h),c=ee(h),F(f.$$.fragment,h),g=ee(h),F(v.$$.fragment,h)},m(h,d){q(e,h,d),U(h,t,d),q(r,h,d),U(h,a,d),q(n,h,d),U(h,i,d),q(o,h,d),U(h,l,d),q(u,h,d),U(h,c,d),q(f,h,d),U(h,g,d),q(v,h,d),p=!0},p(h,d){const y={};d[0]&4|d[2]&32768&&(y.$$scope={dirty:d,ctx:h}),n.$set(y);const E={};d[0]&256|d[2]&32768&&(E.$$scope={dirty:d,ctx:h}),o.$set(E);const k={};d[2]&32768&&(k.$$scope={dirty:d,ctx:h}),u.$set(k)},i(h){p||(D(e.$$.fragment,h),D(r.$$.fragment,h),D(n.$$.fragment,h),D(o.$$.fragment,h),D(u.$$.fragment,h),D(f.$$.fragment,h),D(v.$$.fragment,h),p=!0)},o(h){O(e.$$.fragment,h),O(r.$$.fragment,h),O(n.$$.fragment,h),O(o.$$.fragment,h),O(u.$$.fragment,h),O(f.$$.fragment,h),O(v.$$.fragment,h),p=!1},d(h){J(e,h),h&&P(t),J(r,h),h&&P(a),J(n,h),h&&P(i),J(o,h),h&&P(l),J(u,h),h&&P(c),J(f,h),h&&P(g),J(v,h)}}}function H2(s){let e,t,r,a=s[14]==1&&qp(s);return t=new Tn({props:{$$slots:{default:[M2]},$$scope:{ctx:s}}}),{c(){a&&a.c(),e=Z(),H(t.$$.fragment)},l(n){a&&a.l(n),e=ee(n),F(t.$$.fragment,n)},m(n,i){a&&a.m(n,i),U(n,e,i),q(t,n,i),r=!0},p(n,i){n[14]==1?a?(a.p(n,i),i[0]&16384&&D(a,1)):(a=qp(n),a.c(),D(a,1),a.m(e.parentNode,e)):a&&(xn(),O(a,1,1,()=>{a=null}),Nn());const o={};i[0]&260|i[2]&32768&&(o.$$scope={dirty:i,ctx:n}),t.$set(o)},i(n){r||(D(a),D(t.$$.fragment,n),r=!0)},o(n){O(a),O(t.$$.fragment,n),r=!1},d(n){a&&a.d(n),n&&P(e),J(t,n)}}}function F2(s){let e,t,r,a;return e=new Y0({props:{$$slots:{default:[_2]},$$scope:{ctx:s}}}),r=new Q0({props:{$$slots:{default:[H2]},$$scope:{ctx:s}}}),{c(){H(e.$$.fragment),t=Z(),H(r.$$.fragment)},l(n){F(e.$$.fragment,n),t=ee(n),F(r.$$.fragment,n)},m(n,i){q(e,n,i),U(n,t,i),q(r,n,i),a=!0},p(n,i){const o={};i[2]&32768&&(o.$$scope={dirty:i,ctx:n}),e.$set(o);const l={};i[0]&49412|i[2]&32768&&(l.$$scope={dirty:i,ctx:n}),r.$set(l)},i(n){a||(D(e.$$.fragment,n),D(r.$$.fragment,n),a=!0)},o(n){O(e.$$.fragment,n),O(r.$$.fragment,n),a=!1},d(n){J(e,n),n&&P(t),J(r,n)}}}function q2(s){let e,t;return e=new W0({props:{shadow:!0,striped:!0,tableNoWFull:!0,$$slots:{default:[F2]},$$scope:{ctx:s}}}),{c(){H(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&49412|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(D(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function J2(s){let e;return{c(){e=pt("No")},l(t){e=yt(t,"No")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function G2(s){let e;return{c(){e=pt("Alias Name")},l(t){e=yt(t,"Alias Name")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function j2(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p;return e=new at({props:{class:"!p-4"}}),r=new at({props:{$$slots:{default:[J2]},$$scope:{ctx:s}}}),n=new at({props:{$$slots:{default:[G2]},$$scope:{ctx:s}}}),o=new at({}),u=new at({}),f=new at({}),v=new at({}),{c(){H(e.$$.fragment),t=Z(),H(r.$$.fragment),a=Z(),H(n.$$.fragment),i=Z(),H(o.$$.fragment),l=Z(),H(u.$$.fragment),c=Z(),H(f.$$.fragment),g=Z(),H(v.$$.fragment)},l(h){F(e.$$.fragment,h),t=ee(h),F(r.$$.fragment,h),a=ee(h),F(n.$$.fragment,h),i=ee(h),F(o.$$.fragment,h),l=ee(h),F(u.$$.fragment,h),c=ee(h),F(f.$$.fragment,h),g=ee(h),F(v.$$.fragment,h)},m(h,d){q(e,h,d),U(h,t,d),q(r,h,d),U(h,a,d),q(n,h,d),U(h,i,d),q(o,h,d),U(h,l,d),q(u,h,d),U(h,c,d),q(f,h,d),U(h,g,d),q(v,h,d),p=!0},p(h,d){const y={};d[2]&32768&&(y.$$scope={dirty:d,ctx:h}),r.$set(y);const E={};d[2]&32768&&(E.$$scope={dirty:d,ctx:h}),n.$set(E)},i(h){p||(D(e.$$.fragment,h),D(r.$$.fragment,h),D(n.$$.fragment,h),D(o.$$.fragment,h),D(u.$$.fragment,h),D(f.$$.fragment,h),D(v.$$.fragment,h),p=!0)},o(h){O(e.$$.fragment,h),O(r.$$.fragment,h),O(n.$$.fragment,h),O(o.$$.fragment,h),O(u.$$.fragment,h),O(f.$$.fragment,h),O(v.$$.fragment,h),p=!1},d(h){J(e,h),h&&P(t),J(r,h),h&&P(a),J(n,h),h&&P(i),J(o,h),h&&P(l),J(u,h),h&&P(c),J(f,h),h&&P(g),J(v,h)}}}function Gp(s){let e,t,r=s[11],a=[];for(let i=0;i<r.length;i+=1)a[i]=jp(Up(s,r,i));const n=i=>O(a[i],1,1,()=>{a[i]=null});return{c(){for(let i=0;i<a.length;i+=1)a[i].c();e=$s()},l(i){for(let o=0;o<a.length;o+=1)a[o].l(i);e=$s()},m(i,o){for(let l=0;l<a.length;l+=1)a[l].m(i,o);U(i,e,o),t=!0},p(i,o){if(o[0]&2048){r=i[11];let l;for(l=0;l<r.length;l+=1){const u=Up(i,r,l);a[l]?(a[l].p(u,o),D(a[l],1)):(a[l]=jp(u),a[l].c(),D(a[l],1),a[l].m(e.parentNode,e))}for(xn(),l=r.length;l<a.length;l+=1)n(l);Nn()}},i(i){if(!t){for(let o=0;o<r.length;o+=1)D(a[o]);t=!0}},o(i){a=a.filter(Boolean);for(let o=0;o<a.length;o+=1)O(a[o]);t=!1},d(i){J0(a,i),i&&P(e)}}}function W2(s){let e=s[70]+1+"",t;return{c(){t=pt(e)},l(r){t=yt(r,e)},m(r,a){U(r,t,a)},p:rh,d(r){r&&P(t)}}}function Q2(s){let e=s[71]+"",t;return{c(){t=pt(e)},l(r){t=yt(r,e)},m(r,a){U(r,t,a)},p(r,a){a[0]&2048&&e!==(e=r[71]+"")&&io(t,e)},d(r){r&&P(t)}}}function Y2(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p,h;return e=new Se({props:{class:"!p-4"}}),r=new Se({props:{class:"w-10",$$slots:{default:[W2]},$$scope:{ctx:s}}}),n=new Se({props:{class:"w-64",$$slots:{default:[Q2]},$$scope:{ctx:s}}}),o=new Se({}),u=new Se({}),f=new Se({}),v=new Se({}),{c(){H(e.$$.fragment),t=Z(),H(r.$$.fragment),a=Z(),H(n.$$.fragment),i=Z(),H(o.$$.fragment),l=Z(),H(u.$$.fragment),c=Z(),H(f.$$.fragment),g=Z(),H(v.$$.fragment),p=Z()},l(d){F(e.$$.fragment,d),t=ee(d),F(r.$$.fragment,d),a=ee(d),F(n.$$.fragment,d),i=ee(d),F(o.$$.fragment,d),l=ee(d),F(u.$$.fragment,d),c=ee(d),F(f.$$.fragment,d),g=ee(d),F(v.$$.fragment,d),p=ee(d)},m(d,y){q(e,d,y),U(d,t,y),q(r,d,y),U(d,a,y),q(n,d,y),U(d,i,y),q(o,d,y),U(d,l,y),q(u,d,y),U(d,c,y),q(f,d,y),U(d,g,y),q(v,d,y),U(d,p,y),h=!0},p(d,y){const E={};y[2]&32768&&(E.$$scope={dirty:y,ctx:d}),r.$set(E);const k={};y[0]&2048|y[2]&32768&&(k.$$scope={dirty:y,ctx:d}),n.$set(k)},i(d){h||(D(e.$$.fragment,d),D(r.$$.fragment,d),D(n.$$.fragment,d),D(o.$$.fragment,d),D(u.$$.fragment,d),D(f.$$.fragment,d),D(v.$$.fragment,d),h=!0)},o(d){O(e.$$.fragment,d),O(r.$$.fragment,d),O(n.$$.fragment,d),O(o.$$.fragment,d),O(u.$$.fragment,d),O(f.$$.fragment,d),O(v.$$.fragment,d),h=!1},d(d){J(e,d),d&&P(t),J(r,d),d&&P(a),J(n,d),d&&P(i),J(o,d),d&&P(l),J(u,d),d&&P(c),J(f,d),d&&P(g),J(v,d),d&&P(p)}}}function jp(s){let e,t;return e=new Tn({props:{$$slots:{default:[Y2]},$$scope:{ctx:s}}}),{c(){H(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&2048|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(D(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function z2(s){let e,t,r;function a(i){s[36](i)}let n={style:"filled",id:"floating_filled",name:"floating_filled",type:"text",label:"Alias Name"};return s[3]!==void 0&&(n.value=s[3]),e=new sh({props:n}),Zf.push(()=>eh(e,"value",a,s[3])),{c(){H(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,o){q(e,i,o),r=!0},p(i,o){const l={};!t&&o[0]&8&&(t=!0,l.value=i[3],th(()=>t=!1)),e.$set(l)},i(i){r||(D(e.$$.fragment,i),r=!0)},o(i){O(e.$$.fragment,i),r=!1},d(i){J(e,i)}}}function X2(s){let e,t,r,a,n,i,o,l,u;return{c(){e=Ts("label"),t=pt("Choose File"),r=Z(),a=Ts("input"),n=Z(),i=Ts("span"),o=pt(s[9]),this.h()},l(c){e=Rs(c,"LABEL",{for:!0,class:!0});var f=ru(e);t=yt(f,"Choose File"),f.forEach(P),r=ee(c),a=Rs(c,"INPUT",{type:!0,id:!0,class:!0,style:!0}),n=ee(c),i=Rs(c,"SPAN",{class:!0});var g=ru(i);o=yt(g,s[9]),g.forEach(P),this.h()},h(){$t(e,"for","RemoteCertUpload"),$t(e,"class","text-center font-medium focus:ring-4 focus:outline-none inline-flex items-center justify-center px-5 py-2.5 text-sm text-white bg-gray-800 hover:bg-gray-900 focus:ring-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700 dark:focus:ring-gray-700 rounded-lg"),$t(a,"type","file"),$t(a,"id","RemoteCertUpload"),$t(a,"class","block w-full disabled:cursor-not-allowed disabled:opacity-50 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500 bg-gray-50 text-gray-900 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 border-gray-300 dark:border-gray-600 p-2.5 text-sm rounded-lg border !p-0 dark:text-gray-400"),Hg(a,"display","none"),$t(i,"class","pl-4")},m(c,f){U(c,e,f),su(e,t),U(c,r,f),U(c,a,f),U(c,n,f),U(c,i,f),su(i,o),l||(u=G0(a,"change",s[24]),l=!0)},p(c,f){f[0]&512&&io(o,c[9])},d(c){c&&P(e),c&&P(r),c&&P(a),c&&P(n),c&&P(i),l=!1,u()}}}function Z2(s){let e;return{c(){e=pt("Upload")},l(t){e=yt(t,"Upload")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function ek(s){let e,t;return e=new j0({props:{color:"dark",$$slots:{default:[Z2]},$$scope:{ctx:s}}}),e.$on("click",s[25]),{c(){H(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(D(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function tk(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p;return e=new Se({props:{class:"!p-4"}}),r=new Se({props:{class:"w-10"}}),n=new Se({props:{class:"w-64",$$slots:{default:[z2]},$$scope:{ctx:s}}}),o=new Se({props:{class:"w-96",$$slots:{default:[X2]},$$scope:{ctx:s}}}),u=new Se({props:{class:"w-36",$$slots:{default:[ek]},$$scope:{ctx:s}}}),f=new Se({}),v=new Se({}),{c(){H(e.$$.fragment),t=Z(),H(r.$$.fragment),a=Z(),H(n.$$.fragment),i=Z(),H(o.$$.fragment),l=Z(),H(u.$$.fragment),c=Z(),H(f.$$.fragment),g=Z(),H(v.$$.fragment)},l(h){F(e.$$.fragment,h),t=ee(h),F(r.$$.fragment,h),a=ee(h),F(n.$$.fragment,h),i=ee(h),F(o.$$.fragment,h),l=ee(h),F(u.$$.fragment,h),c=ee(h),F(f.$$.fragment,h),g=ee(h),F(v.$$.fragment,h)},m(h,d){q(e,h,d),U(h,t,d),q(r,h,d),U(h,a,d),q(n,h,d),U(h,i,d),q(o,h,d),U(h,l,d),q(u,h,d),U(h,c,d),q(f,h,d),U(h,g,d),q(v,h,d),p=!0},p(h,d){const y={};d[0]&8|d[2]&32768&&(y.$$scope={dirty:d,ctx:h}),n.$set(y);const E={};d[0]&512|d[2]&32768&&(E.$$scope={dirty:d,ctx:h}),o.$set(E);const k={};d[2]&32768&&(k.$$scope={dirty:d,ctx:h}),u.$set(k)},i(h){p||(D(e.$$.fragment,h),D(r.$$.fragment,h),D(n.$$.fragment,h),D(o.$$.fragment,h),D(u.$$.fragment,h),D(f.$$.fragment,h),D(v.$$.fragment,h),p=!0)},o(h){O(e.$$.fragment,h),O(r.$$.fragment,h),O(n.$$.fragment,h),O(o.$$.fragment,h),O(u.$$.fragment,h),O(f.$$.fragment,h),O(v.$$.fragment,h),p=!1},d(h){J(e,h),h&&P(t),J(r,h),h&&P(a),J(n,h),h&&P(i),J(o,h),h&&P(l),J(u,h),h&&P(c),J(f,h),h&&P(g),J(v,h)}}}function rk(s){let e,t,r,a=s[10]==1&&Gp(s);return t=new Tn({props:{$$slots:{default:[tk]},$$scope:{ctx:s}}}),{c(){a&&a.c(),e=Z(),H(t.$$.fragment)},l(n){a&&a.l(n),e=ee(n),F(t.$$.fragment,n)},m(n,i){a&&a.m(n,i),U(n,e,i),q(t,n,i),r=!0},p(n,i){n[10]==1?a?(a.p(n,i),i[0]&1024&&D(a,1)):(a=Gp(n),a.c(),D(a,1),a.m(e.parentNode,e)):a&&(xn(),O(a,1,1,()=>{a=null}),Nn());const o={};i[0]&520|i[2]&32768&&(o.$$scope={dirty:i,ctx:n}),t.$set(o)},i(n){r||(D(a),D(t.$$.fragment,n),r=!0)},o(n){O(a),O(t.$$.fragment,n),r=!1},d(n){a&&a.d(n),n&&P(e),J(t,n)}}}function sk(s){let e,t,r,a;return e=new Y0({props:{$$slots:{default:[j2]},$$scope:{ctx:s}}}),r=new Q0({props:{$$slots:{default:[rk]},$$scope:{ctx:s}}}),{c(){H(e.$$.fragment),t=Z(),H(r.$$.fragment)},l(n){F(e.$$.fragment,n),t=ee(n),F(r.$$.fragment,n)},m(n,i){q(e,n,i),U(n,t,i),q(r,n,i),a=!0},p(n,i){const o={};i[2]&32768&&(o.$$scope={dirty:i,ctx:n}),e.$set(o);const l={};i[0]&3592|i[2]&32768&&(l.$$scope={dirty:i,ctx:n}),r.$set(l)},i(n){a||(D(e.$$.fragment,n),D(r.$$.fragment,n),a=!0)},o(n){O(e.$$.fragment,n),O(r.$$.fragment,n),a=!1},d(n){J(e,n),n&&P(t),J(r,n)}}}function ak(s){let e,t;return e=new W0({props:{shadow:!0,striped:!0,tableNoWFull:!0,$$slots:{default:[sk]},$$scope:{ctx:s}}}),{c(){H(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&3592|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(D(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function nk(s){let e,t;return e=new Kh({props:{title:"CRL",$$slots:{default:[wk]},$$scope:{ctx:s}}}),e.$on("click",s[30]),{c(){H(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&12304|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(D(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function ik(s){let e;return{c(){e=pt("No")},l(t){e=yt(t,"No")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function ok(s){let e;return{c(){e=pt("Alias Name")},l(t){e=yt(t,"Alias Name")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function lk(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p;return e=new at({props:{class:"!p-4"}}),r=new at({props:{$$slots:{default:[ik]},$$scope:{ctx:s}}}),n=new at({props:{$$slots:{default:[ok]},$$scope:{ctx:s}}}),o=new at({}),u=new at({}),f=new at({}),v=new at({}),{c(){H(e.$$.fragment),t=Z(),H(r.$$.fragment),a=Z(),H(n.$$.fragment),i=Z(),H(o.$$.fragment),l=Z(),H(u.$$.fragment),c=Z(),H(f.$$.fragment),g=Z(),H(v.$$.fragment)},l(h){F(e.$$.fragment,h),t=ee(h),F(r.$$.fragment,h),a=ee(h),F(n.$$.fragment,h),i=ee(h),F(o.$$.fragment,h),l=ee(h),F(u.$$.fragment,h),c=ee(h),F(f.$$.fragment,h),g=ee(h),F(v.$$.fragment,h)},m(h,d){q(e,h,d),U(h,t,d),q(r,h,d),U(h,a,d),q(n,h,d),U(h,i,d),q(o,h,d),U(h,l,d),q(u,h,d),U(h,c,d),q(f,h,d),U(h,g,d),q(v,h,d),p=!0},p(h,d){const y={};d[2]&32768&&(y.$$scope={dirty:d,ctx:h}),r.$set(y);const E={};d[2]&32768&&(E.$$scope={dirty:d,ctx:h}),n.$set(E)},i(h){p||(D(e.$$.fragment,h),D(r.$$.fragment,h),D(n.$$.fragment,h),D(o.$$.fragment,h),D(u.$$.fragment,h),D(f.$$.fragment,h),D(v.$$.fragment,h),p=!0)},o(h){O(e.$$.fragment,h),O(r.$$.fragment,h),O(n.$$.fragment,h),O(o.$$.fragment,h),O(u.$$.fragment,h),O(f.$$.fragment,h),O(v.$$.fragment,h),p=!1},d(h){J(e,h),h&&P(t),J(r,h),h&&P(a),J(n,h),h&&P(i),J(o,h),h&&P(l),J(u,h),h&&P(c),J(f,h),h&&P(g),J(v,h)}}}function Wp(s){let e,t,r=s[13],a=[];for(let i=0;i<r.length;i+=1)a[i]=Qp(Pp(s,r,i));const n=i=>O(a[i],1,1,()=>{a[i]=null});return{c(){for(let i=0;i<a.length;i+=1)a[i].c();e=$s()},l(i){for(let o=0;o<a.length;o+=1)a[o].l(i);e=$s()},m(i,o){for(let l=0;l<a.length;l+=1)a[l].m(i,o);U(i,e,o),t=!0},p(i,o){if(o[0]&8192){r=i[13];let l;for(l=0;l<r.length;l+=1){const u=Pp(i,r,l);a[l]?(a[l].p(u,o),D(a[l],1)):(a[l]=Qp(u),a[l].c(),D(a[l],1),a[l].m(e.parentNode,e))}for(xn(),l=r.length;l<a.length;l+=1)n(l);Nn()}},i(i){if(!t){for(let o=0;o<r.length;o+=1)D(a[o]);t=!0}},o(i){a=a.filter(Boolean);for(let o=0;o<a.length;o+=1)O(a[o]);t=!1},d(i){J0(a,i),i&&P(e)}}}function uk(s){let e=s[70]+1+"",t;return{c(){t=pt(e)},l(r){t=yt(r,e)},m(r,a){U(r,t,a)},p:rh,d(r){r&&P(t)}}}function ck(s){let e=s[68]+"",t;return{c(){t=pt(e)},l(r){t=yt(r,e)},m(r,a){U(r,t,a)},p(r,a){a[0]&8192&&e!==(e=r[68]+"")&&io(t,e)},d(r){r&&P(t)}}}function fk(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p,h;return e=new Se({props:{class:"!p-4"}}),r=new Se({props:{class:"w-10",$$slots:{default:[uk]},$$scope:{ctx:s}}}),n=new Se({props:{class:"w-64",$$slots:{default:[ck]},$$scope:{ctx:s}}}),o=new Se({}),u=new Se({}),f=new Se({}),v=new Se({}),{c(){H(e.$$.fragment),t=Z(),H(r.$$.fragment),a=Z(),H(n.$$.fragment),i=Z(),H(o.$$.fragment),l=Z(),H(u.$$.fragment),c=Z(),H(f.$$.fragment),g=Z(),H(v.$$.fragment),p=Z()},l(d){F(e.$$.fragment,d),t=ee(d),F(r.$$.fragment,d),a=ee(d),F(n.$$.fragment,d),i=ee(d),F(o.$$.fragment,d),l=ee(d),F(u.$$.fragment,d),c=ee(d),F(f.$$.fragment,d),g=ee(d),F(v.$$.fragment,d),p=ee(d)},m(d,y){q(e,d,y),U(d,t,y),q(r,d,y),U(d,a,y),q(n,d,y),U(d,i,y),q(o,d,y),U(d,l,y),q(u,d,y),U(d,c,y),q(f,d,y),U(d,g,y),q(v,d,y),U(d,p,y),h=!0},p(d,y){const E={};y[2]&32768&&(E.$$scope={dirty:y,ctx:d}),r.$set(E);const k={};y[0]&8192|y[2]&32768&&(k.$$scope={dirty:y,ctx:d}),n.$set(k)},i(d){h||(D(e.$$.fragment,d),D(r.$$.fragment,d),D(n.$$.fragment,d),D(o.$$.fragment,d),D(u.$$.fragment,d),D(f.$$.fragment,d),D(v.$$.fragment,d),h=!0)},o(d){O(e.$$.fragment,d),O(r.$$.fragment,d),O(n.$$.fragment,d),O(o.$$.fragment,d),O(u.$$.fragment,d),O(f.$$.fragment,d),O(v.$$.fragment,d),h=!1},d(d){J(e,d),d&&P(t),J(r,d),d&&P(a),J(n,d),d&&P(i),J(o,d),d&&P(l),J(u,d),d&&P(c),J(f,d),d&&P(g),J(v,d),d&&P(p)}}}function Qp(s){let e,t;return e=new Tn({props:{$$slots:{default:[fk]},$$scope:{ctx:s}}}),{c(){H(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&8192|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(D(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function hk(s){let e,t,r;function a(i){s[37](i)}let n={style:"filled",id:"floating_filled",name:"floating_filled",type:"text",label:"Alias Name"};return s[4]!==void 0&&(n.value=s[4]),e=new sh({props:n}),Zf.push(()=>eh(e,"value",a,s[4])),{c(){H(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,o){q(e,i,o),r=!0},p(i,o){const l={};!t&&o[0]&16&&(t=!0,l.value=i[4],th(()=>t=!1)),e.$set(l)},i(i){r||(D(e.$$.fragment,i),r=!0)},o(i){O(e.$$.fragment,i),r=!1},d(i){J(e,i)}}}function dk(s){let e,t,r;return{c(){e=Ts("input"),this.h()},l(a){e=Rs(a,"INPUT",{type:!0,id:!0,class:!0}),this.h()},h(){$t(e,"type","file"),$t(e,"id","crlUpload"),$t(e,"class","block w-full disabled:cursor-not-allowed disabled:opacity-50 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500 bg-gray-50 text-gray-900 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 border-gray-300 dark:border-gray-600 p-2.5 text-sm rounded-lg border !p-0 dark:text-gray-400")},m(a,n){U(a,e,n),t||(r=G0(e,"change",s[22]),t=!0)},p:rh,d(a){a&&P(e),t=!1,r()}}}function gk(s){let e;return{c(){e=pt("Upload")},l(t){e=yt(t,"Upload")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function mk(s){let e,t;return e=new j0({props:{color:"dark",$$slots:{default:[gk]},$$scope:{ctx:s}}}),e.$on("click",s[23]),{c(){H(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(D(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function pk(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p;return e=new Se({props:{class:"!p-4"}}),r=new Se({props:{class:"w-10"}}),n=new Se({props:{class:"w-64",$$slots:{default:[hk]},$$scope:{ctx:s}}}),o=new Se({props:{class:"w-96",$$slots:{default:[dk]},$$scope:{ctx:s}}}),u=new Se({props:{class:"w-36",$$slots:{default:[mk]},$$scope:{ctx:s}}}),f=new Se({}),v=new Se({}),{c(){H(e.$$.fragment),t=Z(),H(r.$$.fragment),a=Z(),H(n.$$.fragment),i=Z(),H(o.$$.fragment),l=Z(),H(u.$$.fragment),c=Z(),H(f.$$.fragment),g=Z(),H(v.$$.fragment)},l(h){F(e.$$.fragment,h),t=ee(h),F(r.$$.fragment,h),a=ee(h),F(n.$$.fragment,h),i=ee(h),F(o.$$.fragment,h),l=ee(h),F(u.$$.fragment,h),c=ee(h),F(f.$$.fragment,h),g=ee(h),F(v.$$.fragment,h)},m(h,d){q(e,h,d),U(h,t,d),q(r,h,d),U(h,a,d),q(n,h,d),U(h,i,d),q(o,h,d),U(h,l,d),q(u,h,d),U(h,c,d),q(f,h,d),U(h,g,d),q(v,h,d),p=!0},p(h,d){const y={};d[0]&16|d[2]&32768&&(y.$$scope={dirty:d,ctx:h}),n.$set(y);const E={};d[2]&32768&&(E.$$scope={dirty:d,ctx:h}),o.$set(E);const k={};d[2]&32768&&(k.$$scope={dirty:d,ctx:h}),u.$set(k)},i(h){p||(D(e.$$.fragment,h),D(r.$$.fragment,h),D(n.$$.fragment,h),D(o.$$.fragment,h),D(u.$$.fragment,h),D(f.$$.fragment,h),D(v.$$.fragment,h),p=!0)},o(h){O(e.$$.fragment,h),O(r.$$.fragment,h),O(n.$$.fragment,h),O(o.$$.fragment,h),O(u.$$.fragment,h),O(f.$$.fragment,h),O(v.$$.fragment,h),p=!1},d(h){J(e,h),h&&P(t),J(r,h),h&&P(a),J(n,h),h&&P(i),J(o,h),h&&P(l),J(u,h),h&&P(c),J(f,h),h&&P(g),J(v,h)}}}function yk(s){let e,t,r,a=s[12]==1&&Wp(s);return t=new Tn({props:{$$slots:{default:[pk]},$$scope:{ctx:s}}}),{c(){a&&a.c(),e=Z(),H(t.$$.fragment)},l(n){a&&a.l(n),e=ee(n),F(t.$$.fragment,n)},m(n,i){a&&a.m(n,i),U(n,e,i),q(t,n,i),r=!0},p(n,i){n[12]==1?a?(a.p(n,i),i[0]&4096&&D(a,1)):(a=Wp(n),a.c(),D(a,1),a.m(e.parentNode,e)):a&&(xn(),O(a,1,1,()=>{a=null}),Nn());const o={};i[0]&16|i[2]&32768&&(o.$$scope={dirty:i,ctx:n}),t.$set(o)},i(n){r||(D(a),D(t.$$.fragment,n),r=!0)},o(n){O(a),O(t.$$.fragment,n),r=!1},d(n){a&&a.d(n),n&&P(e),J(t,n)}}}function vk(s){let e,t,r,a;return e=new Y0({props:{$$slots:{default:[lk]},$$scope:{ctx:s}}}),r=new Q0({props:{$$slots:{default:[yk]},$$scope:{ctx:s}}}),{c(){H(e.$$.fragment),t=Z(),H(r.$$.fragment)},l(n){F(e.$$.fragment,n),t=ee(n),F(r.$$.fragment,n)},m(n,i){q(e,n,i),U(n,t,i),q(r,n,i),a=!0},p(n,i){const o={};i[2]&32768&&(o.$$scope={dirty:i,ctx:n}),e.$set(o);const l={};i[0]&12304|i[2]&32768&&(l.$$scope={dirty:i,ctx:n}),r.$set(l)},i(n){a||(D(e.$$.fragment,n),D(r.$$.fragment,n),a=!0)},o(n){O(e.$$.fragment,n),O(r.$$.fragment,n),a=!1},d(n){J(e,n),n&&P(t),J(r,n)}}}function wk(s){let e,t;return e=new W0({props:{shadow:!0,striped:!0,tableNoWFull:!0,$$slots:{default:[vk]},$$scope:{ctx:s}}}),{c(){H(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&12304|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(D(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function Sk(s){let e,t,r,a,n,i,o,l,u,c=0;t=new Kh({props:{open:!0,title:"Machine Certificates",$$slots:{default:[T2]},$$scope:{ctx:s}}}),t.$on("click",s[27]),a=new Kh({props:{title:"CA Certificates",$$slots:{default:[q2]},$$scope:{ctx:s}}}),a.$on("click",s[28]),i=new Kh({props:{title:"Remote Certificates",$$slots:{default:[ak]},$$scope:{ctx:s}}}),i.$on("click",s[29]);let f=nk(s);return{c(){e=Z(),H(t.$$.fragment),r=Z(),H(a.$$.fragment),n=Z(),H(i.$$.fragment),o=Z(),f&&f.c(),l=$s()},l(g){e=ee(g),F(t.$$.fragment,g),r=ee(g),F(a.$$.fragment,g),n=ee(g),F(i.$$.fragment,g),o=ee(g),f&&f.l(g),l=$s()},m(g,v){U(g,e,v),q(t,g,v),U(g,r,v),q(a,g,v),U(g,n,v),q(i,g,v),U(g,o,v),f&&f.m(g,v),U(g,l,v),u=!0},p(g,v){const p={};v[0]&196832|v[2]&32768&&(p.$$scope={dirty:v,ctx:g}),t.$set(p);const h={};v[0]&49412|v[2]&32768&&(h.$$scope={dirty:v,ctx:g}),a.$set(h);const d={};v[0]&3592|v[2]&32768&&(d.$$scope={dirty:v,ctx:g}),i.$set(d),f.p(g,v)},i(g){u||(D(c),D(t.$$.fragment,g),D(a.$$.fragment,g),D(i.$$.fragment,g),D(f),u=!0)},o(g){O(c),O(t.$$.fragment,g),O(a.$$.fragment,g),O(i.$$.fragment,g),O(f),u=!1},d(g){g&&P(e),J(t,g),g&&P(r),J(a,g),g&&P(n),J(i,g),g&&P(o),f&&f.d(g),g&&P(l)}}}function Ck(s){let e,t;return e=new T1({props:{style:"underline",$$slots:{default:[Sk]},$$scope:{ctx:s}}}),{c(){H(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&262143|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(D(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function Ak(s,e,t){let r="",a={},n={},i=0,o=[],l,u;N1.subscribe(be=>{l=be}),$m.subscribe(be=>{o=be}),dd.subscribe(be=>{n=be});let c=null,f="",g="",v=null,p="",h="",d=null,y="",E="",k=null,R="",V="",L="",ne="",ae="",ve="No file chosen",Te="No file chosen",ye="No file chosen",Ce=0,Ve=[];async function Pe(){const be=await fetch(window.location.origin+"/GetRemotecert",{method:"POST",body:u});be.status==200&&(t(11,Ve=await be.json()),console.log(Ve),t(10,Ce=1))}let pe=0,$e=[];async function ie(){const be=await fetch(window.location.origin+"/GeTCRL",{method:"POST",body:u});be.status==200&&(t(13,$e=await be.json()),console.log($e),t(12,pe=1))}let ot=0,Me=[];async function te(){const be=await fetch(window.location.origin+"/getCaCERt",{method:"POST",body:u});be.status==200&&(t(15,Me=await be.json()),console.log(Me),t(14,ot=1))}let oe=0,se=[];async function me(){const be=await fetch(window.location.origin+"/getMachinECert",{method:"POST",body:u});be.status==200&&(t(17,se=await be.json()),console.log(se),t(16,oe=1))}async function Ae(be){const tt=be.target.files[0];if(tt){if(t(7,ve=tt.name),k=tt,l){const Ft=l.match(/.{1,2}/g).map(Nr=>parseInt(Nr,16));u=new Uint8Array(Ft)}const It=new FileReader;It.onload=jt=>{ae=new Uint8Array(jt.target.result)},It.readAsArrayBuffer(tt)}}async function qe(){if(L==""||ne==""||ae=="")alert("Alias Name is null or PKCS#12 password is null or machineCertData is null"),console.log(L),console.log(ne),console.log(ae);else if(k&&ae!=""){console.log(L),console.log(ne),console.log(ae);let be,tt=0;try{const It=Ar.util.createBuffer(ae),jt=Ar.asn1.fromDer(It);be=Ar.pkcs12.pkcs12FromAsn1(jt,ne)}catch(It){console.log("error: "+It),tt=1,alert("p12 password is invalid")}if(tt==0){const jt=be.getBags({bagType:Ar.pki.oids.certBag})[Ar.pki.oids.certBag][0];console.log("certBag"),console.log(jt);const Ft=be.getBags({bagType:Ar.pki.oids.pkcs8ShroudedKeyBag});console.log("bags2"),console.log(Ft);const Nr=Ft[Ar.pki.oids.pkcs8ShroudedKeyBag][0];console.log("keyBag"),console.log(Nr);let ma="",go="",Vm=0;if(jt.cert==null){let Su={type:"CERTIFICATE",body:Ar.asn1.toDer(jt.asn1).getBytes()};ma=Ar.pem.encode(Su),console.log(ma),console.log(ma.length)}else ma=Ar.pki.certificateToPem(jt.cert),console.log(ma),console.log(ma.length);if(Nr.key==null){let Su={type:"PRIVATE KEY",body:Ar.asn1.toDer(Nr.asn1).getBytes()};go=Ar.pem.encode(Su);let uh="";uh=Ar.pki.getPrivateKeyOid(Nr.asn1),console.log(uh),uh=="1.2.840.10045.2.1"?(console.log("EC private key"),Vm=1):uh=="1.2.840.113549.1.1.1"&&console.log("RSA Private key")}else go=Ar.pki.privateKeyToPem(Nr.key);console.log("KeyPem"),console.log(go),console.log(go.length);const hd=new TextEncoder;let _m=hd.encode(L);R=new Uint8Array(ma.length+u.length+64),R.set(u,0),R.set(_m,u.length);let E1=hd.encode(ma);R.set(E1,u.length+64),V=new Uint8Array(go.length+u.length+64),V.set(u,0),V.set(_m,u.length);let b1=hd.encode(go);V.set(b1,u.length+64),(await fetch(window.location.origin+"/UploadMachineCert",{method:"POST",body:R,headers:{"Content-Type":"application/octet-stream"}})).status==200?console.log("200 Upload machineCertContent"):console.log("error Upload machineCertContent"),Vm==1?(await fetch(window.location.origin+"/UploadEcMachinePrivate",{method:"POST",body:V,headers:{"Content-Type":"application/octet-stream"}})).status==200?console.log("200 Upload machineEcPrivateKeyContent"):console.log("error Upload machineEcPrivateKeyContent"):(await fetch(window.location.origin+"/UploadrsaMachinePrivate",{method:"POST",body:V,headers:{"Content-Type":"application/octet-stream"}})).status==200?console.log("200 Upload machineRSAPrivateKeyContent"):console.log("error Upload machineRSAPrivateKeyContent"),me()}}}async function it(be){const tt=be.target.files[0];if(tt){if(t(8,Te=tt.name),c=tt,l){const Ft=l.match(/.{1,2}/g).map(Nr=>parseInt(Nr,16));u=new Uint8Array(Ft)}const It=new FileReader;It.onload=jt=>{const Ft=new Uint8Array(jt.target.result);f=new Uint8Array(Ft.length+u.length+64),f.set(u,0),f.set(Ft,u.length+64)},It.readAsArrayBuffer(tt)}}async function Ue(){if(g==""||f=="")alert("Alias Name is null or caCertContent is null");else if(c){console.log(g);let tt=new TextEncoder().encode(g);console.log("caCertContent"),console.log(f),f.set(tt,u.length),console.log(g),(await fetch(window.location.origin+"/UploaDCaCert",{method:"POST",body:f,headers:{"Content-Type":"application/octet-stream"}})).status==200?(console.log("200 UploadCACert"),te()):console.log("error UploadCACert")}}async function Ne(be){const tt=be.target.files[0];if(tt){if(d=tt,l){const Ft=l.match(/.{1,2}/g).map(Nr=>parseInt(Nr,16));u=new Uint8Array(Ft)}const It=new FileReader;It.onload=jt=>{const Ft=new Uint8Array(jt.target.result);y=new Uint8Array(Ft.length+u.length+64),y.set(u,0),y.set(Ft,u.length+64)},It.readAsArrayBuffer(tt)}}async function fe(){if(E==""||y=="")alert("Alias Name is null or content is null");else if(d){console.log(E);let tt=new TextEncoder().encode(E);y.set(tt,u.length),(await fetch(window.location.origin+"/UpLoaDcrl",{method:"POST",body:y,headers:{"Content-Type":"application/octet-stream"}})).status==200?(console.log("200 Upload crl"),ie()):console.log("error Upload crl")}}async function ht(be){const tt=be.target.files[0];if(tt){if(v=tt,t(9,ye=tt.name),l){const Ft=l.match(/.{1,2}/g).map(Nr=>parseInt(Nr,16));u=new Uint8Array(Ft)}const It=new FileReader;It.onload=jt=>{const Ft=new Uint8Array(jt.target.result);p=new Uint8Array(Ft.length+u.length+64),p.set(u,0),p.set(Ft,u.length+64)},It.readAsArrayBuffer(tt)}}async function lt(){if(h==""||p=="")alert("Alias Name is null or content is null");else if(v){console.log(h);let tt=new TextEncoder().encode(h);p.set(tt,u.length),(await fetch(window.location.origin+"/UpLoadRemoteCert",{method:"POST",body:p,headers:{"Content-Type":"application/octet-stream"}})).status==200?(console.log("200 UploadRemoteCert"),Pe()):console.log("error UploadRemoteCert")}}function ut(){if(console.log("save certificate"),o.length!=0&&(o=[]),a.config.authentication_certificate_certificateSettings.checkCert!=r.config.authentication_certificate_certificateSettings.checkCert){n.config.authentication_certificate_certificateSettings.checkCert=a.config.authentication_certificate_certificateSettings.checkCert;let be="Check the validity period of certificates and CRLs is changed to "+a.config.authentication_certificate_certificateSettings.checkCert;o=[...o,be]}$m.set(o),dd.set(n),console.log(o)}const Oe=()=>{t(7,ve="No file chosen"),me()},Jt=()=>{t(8,Te="No file chosen"),te()},Gt=()=>{t(9,ye="No file chosen"),Pe()},g1=()=>{ie()};async function m1(){const be=await fetch(window.location.origin+"/GetCertificateData",{method:"POST",body:u});be.status==200&&(r=await be.json(),console.log(r),R1.set(r),t(0,a=JSON.parse(JSON.stringify(r))),n=JSON.parse(JSON.stringify(r)),dd.set(n),t(1,i=1))}x1(()=>{if(console.log("certificate sessionid: "),console.log(l),l&&r==""){const tt=l.match(/.{1,2}/g).map(It=>parseInt(It,16));u=new Uint8Array(tt),m1(),Pe(),te(),me(),ie()}else if(l&&r!=""){const tt=l.match(/.{1,2}/g).map(It=>parseInt(It,16));u=new Uint8Array(tt),t(1,i=1),o.length==0&&(t(0,a=JSON.parse(JSON.stringify(n))),t(0,a.config.authentication_certificate_certificateSettings=JSON.parse(JSON.stringify(r.config.authentication_certificate_certificateSettings)),a))}});function p1(be){s.$$.not_equal(a.config.authentication_certificate_certificateSettings.checkCert,be)&&(a.config.authentication_certificate_certificateSettings.checkCert=be,t(0,a))}function y1(be){s.$$.not_equal(a.config.authentication_certificate_certificateSettings.checkCert,be)&&(a.config.authentication_certificate_certificateSettings.checkCert=be,t(0,a))}function v1(be){L=be,t(5,L)}function w1(be){ne=be,t(6,ne)}function S1(be){g=be,t(2,g)}function C1(be){h=be,t(3,h)}function A1(be){E=be,t(4,E)}return[a,i,g,h,E,L,ne,ve,Te,ye,Ce,Ve,pe,$e,ot,Me,oe,se,Ae,qe,it,Ue,Ne,fe,ht,lt,ut,Oe,Jt,Gt,g1,p1,y1,v1,w1,S1,C1,A1]}class Lk extends k1{constructor(e){super(),I1(this,e,Ak,Ck,B1,{},null,[-1,-1,-1])}}export{Lk as default};
