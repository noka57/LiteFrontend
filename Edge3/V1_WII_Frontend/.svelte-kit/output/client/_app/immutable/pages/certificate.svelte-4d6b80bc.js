import{S as ew,i as tw,s as rw,x as K,y as F,z as q,f as L,t as O,C as J,o as sw,a as Z,e as Os,c as ee,b as U,h as P,g as On,d as Pn,r as mt,u as pt,a1 as ld,a4 as dh,a5 as gh,a6 as mh,l as Vs,m as $s,n as gu,p as $t,q as lm,I as mu,J as ud,v as yo,F as ph}from"../chunks/index-e8550257.js";import{s as aw}from"../chunks/Indicator.svelte_svelte_type_style_lang-7fe7a7f4.js";import{B as cd}from"../chunks/Button-b398faf8.js";import{F as yh}from"../chunks/FloatingLabelInput-a009fedb.js";import{T as fd}from"../chunks/Table-20966f47.js";import{T as hd,a as Un,b as we}from"../chunks/TableBodyRow-8687920a.js";import{T as dd,a as st}from"../chunks/TableHeadCell-912bcc4d.js";import{T as s0}from"../chunks/TabItem-508de2ef.js";import{T as nw}from"../chunks/Tabs-8a8b55c9.js";import{c as iw,g as ow,a as lw}from"../chunks/_commonjsHelpers-ee9ee889.js";import{af as rp,b9 as _d,bw as uw}from"../chunks/configG-f85cdd02.js";import"../chunks/index-733060bd.js";var Ay={exports:{}},Me={options:{usePureJavaScript:!1}},um={},cw=um,sp={};um.encode=function(s,e,t){if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');if(t!==void 0&&typeof t!="number")throw new TypeError('"maxline" must be a number.');var r="";if(!(s instanceof Uint8Array))r=fw(s,e);else{var a=0,n=e.length,i=e.charAt(0),o=[0];for(a=0;a<s.length;++a){for(var l=0,u=s[a];l<o.length;++l)u+=o[l]<<8,o[l]=u%n,u=u/n|0;for(;u>0;)o.push(u%n),u=u/n|0}for(a=0;s[a]===0&&a<s.length-1;++a)r+=i;for(a=o.length-1;a>=0;--a)r+=e[o[a]]}if(t){var c=new RegExp(".{1,"+t+"}","g");r=r.match(c).join(`\r
`)}return r};um.decode=function(s,e){if(typeof s!="string")throw new TypeError('"input" must be a string.');if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');var t=sp[e];if(!t){t=sp[e]=[];for(var r=0;r<e.length;++r)t[e.charCodeAt(r)]=r}s=s.replace(/\s/g,"");for(var a=e.length,n=e.charAt(0),i=[0],r=0;r<s.length;r++){var o=t[s.charCodeAt(r)];if(o===void 0)return;for(var l=0,u=o;l<i.length;++l)u+=i[l]*a,i[l]=u&255,u>>=8;for(;u>0;)i.push(u&255),u>>=8}for(var c=0;s[c]===n&&c<s.length-1;++c)i.push(0);return typeof Buffer<"u"?Buffer.from(i.reverse()):new Uint8Array(i.reverse())};function fw(s,e){var t=0,r=e.length,a=e.charAt(0),n=[0];for(t=0;t<s.length();++t){for(var i=0,o=s.at(t);i<n.length;++i)o+=n[i]<<8,n[i]=o%r,o=o/r|0;for(;o>0;)n.push(o%r),o=o/r|0}var l="";for(t=0;s.at(t)===0&&t<s.length()-1;++t)l+=a;for(t=n.length-1;t>=0;--t)l+=e[n[t]];return l}var ap=Me,np=cw,k=ap.util=ap.util||{};(function(){if(typeof process<"u"&&process.nextTick&&!process.browser){k.nextTick=process.nextTick,typeof setImmediate=="function"?k.setImmediate=setImmediate:k.setImmediate=k.nextTick;return}if(typeof setImmediate=="function"){k.setImmediate=function(){return setImmediate.apply(void 0,arguments)},k.nextTick=function(i){return setImmediate(i)};return}if(k.setImmediate=function(i){setTimeout(i,0)},typeof window<"u"&&typeof window.postMessage=="function"){let i=function(o){if(o.source===window&&o.data===s){o.stopPropagation();var l=e.slice();e.length=0,l.forEach(function(u){u()})}};var s="forge.setImmediate",e=[];k.setImmediate=function(o){e.push(o),e.length===1&&window.postMessage(s,"*")},window.addEventListener("message",i,!0)}if(typeof MutationObserver<"u"){var t=Date.now(),r=!0,a=document.createElement("div"),e=[];new MutationObserver(function(){var o=e.slice();e.length=0,o.forEach(function(l){l()})}).observe(a,{attributes:!0});var n=k.setImmediate;k.setImmediate=function(o){Date.now()-t>15?(t=Date.now(),n(o)):(e.push(o),e.length===1&&a.setAttribute("a",r=!r))}}k.nextTick=k.setImmediate})();k.isNodejs=typeof process<"u"&&process.versions&&process.versions.node;k.globalScope=function(){return k.isNodejs?iw:typeof self>"u"?window:self}();k.isArray=Array.isArray||function(s){return Object.prototype.toString.call(s)==="[object Array]"};k.isArrayBuffer=function(s){return typeof ArrayBuffer<"u"&&s instanceof ArrayBuffer};k.isArrayBufferView=function(s){return s&&k.isArrayBuffer(s.buffer)&&s.byteLength!==void 0};function vh(s){if(!(s===8||s===16||s===24||s===32))throw new Error("Only 8, 16, 24, or 32 bits supported: "+s)}k.ByteBuffer=cm;function cm(s){if(this.data="",this.read=0,typeof s=="string")this.data=s;else if(k.isArrayBuffer(s)||k.isArrayBufferView(s))if(typeof Buffer<"u"&&s instanceof Buffer)this.data=s.toString("binary");else{var e=new Uint8Array(s);try{this.data=String.fromCharCode.apply(null,e)}catch{for(var t=0;t<e.length;++t)this.putByte(e[t])}}else(s instanceof cm||typeof s=="object"&&typeof s.data=="string"&&typeof s.read=="number")&&(this.data=s.data,this.read=s.read);this._constructedStringLength=0}k.ByteStringBuffer=cm;var hw=4096;k.ByteStringBuffer.prototype._optimizeConstructedString=function(s){this._constructedStringLength+=s,this._constructedStringLength>hw&&(this.data.substr(0,1),this._constructedStringLength=0)};k.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};k.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0};k.ByteStringBuffer.prototype.putByte=function(s){return this.putBytes(String.fromCharCode(s))};k.ByteStringBuffer.prototype.fillWithByte=function(s,e){s=String.fromCharCode(s);for(var t=this.data;e>0;)e&1&&(t+=s),e>>>=1,e>0&&(s+=s);return this.data=t,this._optimizeConstructedString(e),this};k.ByteStringBuffer.prototype.putBytes=function(s){return this.data+=s,this._optimizeConstructedString(s.length),this};k.ByteStringBuffer.prototype.putString=function(s){return this.putBytes(k.encodeUtf8(s))};k.ByteStringBuffer.prototype.putInt16=function(s){return this.putBytes(String.fromCharCode(s>>8&255)+String.fromCharCode(s&255))};k.ByteStringBuffer.prototype.putInt24=function(s){return this.putBytes(String.fromCharCode(s>>16&255)+String.fromCharCode(s>>8&255)+String.fromCharCode(s&255))};k.ByteStringBuffer.prototype.putInt32=function(s){return this.putBytes(String.fromCharCode(s>>24&255)+String.fromCharCode(s>>16&255)+String.fromCharCode(s>>8&255)+String.fromCharCode(s&255))};k.ByteStringBuffer.prototype.putInt16Le=function(s){return this.putBytes(String.fromCharCode(s&255)+String.fromCharCode(s>>8&255))};k.ByteStringBuffer.prototype.putInt24Le=function(s){return this.putBytes(String.fromCharCode(s&255)+String.fromCharCode(s>>8&255)+String.fromCharCode(s>>16&255))};k.ByteStringBuffer.prototype.putInt32Le=function(s){return this.putBytes(String.fromCharCode(s&255)+String.fromCharCode(s>>8&255)+String.fromCharCode(s>>16&255)+String.fromCharCode(s>>24&255))};k.ByteStringBuffer.prototype.putInt=function(s,e){vh(e);var t="";do e-=8,t+=String.fromCharCode(s>>e&255);while(e>0);return this.putBytes(t)};k.ByteStringBuffer.prototype.putSignedInt=function(s,e){return s<0&&(s+=2<<e-1),this.putInt(s,e)};k.ByteStringBuffer.prototype.putBuffer=function(s){return this.putBytes(s.getBytes())};k.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};k.ByteStringBuffer.prototype.getInt16=function(){var s=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,s};k.ByteStringBuffer.prototype.getInt24=function(){var s=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,s};k.ByteStringBuffer.prototype.getInt32=function(){var s=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,s};k.ByteStringBuffer.prototype.getInt16Le=function(){var s=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,s};k.ByteStringBuffer.prototype.getInt24Le=function(){var s=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,s};k.ByteStringBuffer.prototype.getInt32Le=function(){var s=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,s};k.ByteStringBuffer.prototype.getInt=function(s){vh(s);var e=0;do e=(e<<8)+this.data.charCodeAt(this.read++),s-=8;while(s>0);return e};k.ByteStringBuffer.prototype.getSignedInt=function(s){var e=this.getInt(s),t=2<<s-2;return e>=t&&(e-=t<<1),e};k.ByteStringBuffer.prototype.getBytes=function(s){var e;return s?(s=Math.min(this.length(),s),e=this.data.slice(this.read,this.read+s),this.read+=s):s===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};k.ByteStringBuffer.prototype.bytes=function(s){return typeof s>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+s)};k.ByteStringBuffer.prototype.at=function(s){return this.data.charCodeAt(this.read+s)};k.ByteStringBuffer.prototype.setAt=function(s,e){return this.data=this.data.substr(0,this.read+s)+String.fromCharCode(e)+this.data.substr(this.read+s+1),this};k.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)};k.ByteStringBuffer.prototype.copy=function(){var s=k.createBuffer(this.data);return s.read=this.read,s};k.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this};k.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this};k.ByteStringBuffer.prototype.truncate=function(s){var e=Math.max(0,this.length()-s);return this.data=this.data.substr(this.read,e),this.read=0,this};k.ByteStringBuffer.prototype.toHex=function(){for(var s="",e=this.read;e<this.data.length;++e){var t=this.data.charCodeAt(e);t<16&&(s+="0"),s+=t.toString(16)}return s};k.ByteStringBuffer.prototype.toString=function(){return k.decodeUtf8(this.bytes())};function dw(s,e){e=e||{},this.read=e.readOffset||0,this.growSize=e.growSize||1024;var t=k.isArrayBuffer(s),r=k.isArrayBufferView(s);if(t||r){t?this.data=new DataView(s):this.data=new DataView(s.buffer,s.byteOffset,s.byteLength),this.write="writeOffset"in e?e.writeOffset:this.data.byteLength;return}this.data=new DataView(new ArrayBuffer(0)),this.write=0,s!=null&&this.putBytes(s),"writeOffset"in e&&(this.write=e.writeOffset)}k.DataBuffer=dw;k.DataBuffer.prototype.length=function(){return this.write-this.read};k.DataBuffer.prototype.isEmpty=function(){return this.length()<=0};k.DataBuffer.prototype.accommodate=function(s,e){if(this.length()>=s)return this;e=Math.max(e||this.growSize,s);var t=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),r=new Uint8Array(this.length()+e);return r.set(t),this.data=new DataView(r.buffer),this};k.DataBuffer.prototype.putByte=function(s){return this.accommodate(1),this.data.setUint8(this.write++,s),this};k.DataBuffer.prototype.fillWithByte=function(s,e){this.accommodate(e);for(var t=0;t<e;++t)this.data.setUint8(s);return this};k.DataBuffer.prototype.putBytes=function(s,e){if(k.isArrayBufferView(s)){var t=new Uint8Array(s.buffer,s.byteOffset,s.byteLength),r=t.byteLength-t.byteOffset;this.accommodate(r);var a=new Uint8Array(this.data.buffer,this.write);return a.set(t),this.write+=r,this}if(k.isArrayBuffer(s)){var t=new Uint8Array(s);this.accommodate(t.byteLength);var a=new Uint8Array(this.data.buffer);return a.set(t,this.write),this.write+=t.byteLength,this}if(s instanceof k.DataBuffer||typeof s=="object"&&typeof s.read=="number"&&typeof s.write=="number"&&k.isArrayBufferView(s.data)){var t=new Uint8Array(s.data.byteLength,s.read,s.length());this.accommodate(t.byteLength);var a=new Uint8Array(s.data.byteLength,this.write);return a.set(t),this.write+=t.byteLength,this}if(s instanceof k.ByteStringBuffer&&(s=s.data,e="binary"),e=e||"binary",typeof s=="string"){var n;if(e==="hex")return this.accommodate(Math.ceil(s.length/2)),n=new Uint8Array(this.data.buffer,this.write),this.write+=k.binary.hex.decode(s,n,this.write),this;if(e==="base64")return this.accommodate(Math.ceil(s.length/4)*3),n=new Uint8Array(this.data.buffer,this.write),this.write+=k.binary.base64.decode(s,n,this.write),this;if(e==="utf8"&&(s=k.encodeUtf8(s),e="binary"),e==="binary"||e==="raw")return this.accommodate(s.length),n=new Uint8Array(this.data.buffer,this.write),this.write+=k.binary.raw.decode(n),this;if(e==="utf16")return this.accommodate(s.length*2),n=new Uint16Array(this.data.buffer,this.write),this.write+=k.text.utf16.encode(n),this;throw new Error("Invalid encoding: "+e)}throw Error("Invalid parameter: "+s)};k.DataBuffer.prototype.putBuffer=function(s){return this.putBytes(s),s.clear(),this};k.DataBuffer.prototype.putString=function(s){return this.putBytes(s,"utf16")};k.DataBuffer.prototype.putInt16=function(s){return this.accommodate(2),this.data.setInt16(this.write,s),this.write+=2,this};k.DataBuffer.prototype.putInt24=function(s){return this.accommodate(3),this.data.setInt16(this.write,s>>8&65535),this.data.setInt8(this.write,s>>16&255),this.write+=3,this};k.DataBuffer.prototype.putInt32=function(s){return this.accommodate(4),this.data.setInt32(this.write,s),this.write+=4,this};k.DataBuffer.prototype.putInt16Le=function(s){return this.accommodate(2),this.data.setInt16(this.write,s,!0),this.write+=2,this};k.DataBuffer.prototype.putInt24Le=function(s){return this.accommodate(3),this.data.setInt8(this.write,s>>16&255),this.data.setInt16(this.write,s>>8&65535,!0),this.write+=3,this};k.DataBuffer.prototype.putInt32Le=function(s){return this.accommodate(4),this.data.setInt32(this.write,s,!0),this.write+=4,this};k.DataBuffer.prototype.putInt=function(s,e){vh(e),this.accommodate(e/8);do e-=8,this.data.setInt8(this.write++,s>>e&255);while(e>0);return this};k.DataBuffer.prototype.putSignedInt=function(s,e){return vh(e),this.accommodate(e/8),s<0&&(s+=2<<e-1),this.putInt(s,e)};k.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)};k.DataBuffer.prototype.getInt16=function(){var s=this.data.getInt16(this.read);return this.read+=2,s};k.DataBuffer.prototype.getInt24=function(){var s=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,s};k.DataBuffer.prototype.getInt32=function(){var s=this.data.getInt32(this.read);return this.read+=4,s};k.DataBuffer.prototype.getInt16Le=function(){var s=this.data.getInt16(this.read,!0);return this.read+=2,s};k.DataBuffer.prototype.getInt24Le=function(){var s=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,s};k.DataBuffer.prototype.getInt32Le=function(){var s=this.data.getInt32(this.read,!0);return this.read+=4,s};k.DataBuffer.prototype.getInt=function(s){vh(s);var e=0;do e=(e<<8)+this.data.getInt8(this.read++),s-=8;while(s>0);return e};k.DataBuffer.prototype.getSignedInt=function(s){var e=this.getInt(s),t=2<<s-2;return e>=t&&(e-=t<<1),e};k.DataBuffer.prototype.getBytes=function(s){var e;return s?(s=Math.min(this.length(),s),e=this.data.slice(this.read,this.read+s),this.read+=s):s===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};k.DataBuffer.prototype.bytes=function(s){return typeof s>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+s)};k.DataBuffer.prototype.at=function(s){return this.data.getUint8(this.read+s)};k.DataBuffer.prototype.setAt=function(s,e){return this.data.setUint8(s,e),this};k.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)};k.DataBuffer.prototype.copy=function(){return new k.DataBuffer(this)};k.DataBuffer.prototype.compact=function(){if(this.read>0){var s=new Uint8Array(this.data.buffer,this.read),e=new Uint8Array(s.byteLength);e.set(s),this.data=new DataView(e),this.write-=this.read,this.read=0}return this};k.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this};k.DataBuffer.prototype.truncate=function(s){return this.write=Math.max(0,this.length()-s),this.read=Math.min(this.read,this.write),this};k.DataBuffer.prototype.toHex=function(){for(var s="",e=this.read;e<this.data.byteLength;++e){var t=this.data.getUint8(e);t<16&&(s+="0"),s+=t.toString(16)}return s};k.DataBuffer.prototype.toString=function(s){var e=new Uint8Array(this.data,this.read,this.length());if(s=s||"utf8",s==="binary"||s==="raw")return k.binary.raw.encode(e);if(s==="hex")return k.binary.hex.encode(e);if(s==="base64")return k.binary.base64.encode(e);if(s==="utf8")return k.text.utf8.decode(e);if(s==="utf16")return k.text.utf16.decode(e);throw new Error("Invalid encoding: "+s)};k.createBuffer=function(s,e){return e=e||"raw",s!==void 0&&e==="utf8"&&(s=k.encodeUtf8(s)),new k.ByteBuffer(s)};k.fillString=function(s,e){for(var t="";e>0;)e&1&&(t+=s),e>>>=1,e>0&&(s+=s);return t};k.xorBytes=function(s,e,t){for(var r="",a="",n="",i=0,o=0;t>0;--t,++i)a=s.charCodeAt(i)^e.charCodeAt(i),o>=10&&(r+=n,n="",o=0),n+=String.fromCharCode(a),++o;return r+=n,r};k.hexToBytes=function(s){var e="",t=0;for(s.length&!0&&(t=1,e+=String.fromCharCode(parseInt(s[0],16)));t<s.length;t+=2)e+=String.fromCharCode(parseInt(s.substr(t,2),16));return e};k.bytesToHex=function(s){return k.createBuffer(s).toHex()};k.int32ToBytes=function(s){return String.fromCharCode(s>>24&255)+String.fromCharCode(s>>16&255)+String.fromCharCode(s>>8&255)+String.fromCharCode(s&255)};var vn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",wn=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],by="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";k.encode64=function(s,e){for(var t="",r="",a,n,i,o=0;o<s.length;)a=s.charCodeAt(o++),n=s.charCodeAt(o++),i=s.charCodeAt(o++),t+=vn.charAt(a>>2),t+=vn.charAt((a&3)<<4|n>>4),isNaN(n)?t+="==":(t+=vn.charAt((n&15)<<2|i>>6),t+=isNaN(i)?"=":vn.charAt(i&63)),e&&t.length>e&&(r+=t.substr(0,e)+`\r
`,t=t.substr(e));return r+=t,r};k.decode64=function(s){s=s.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var e="",t,r,a,n,i=0;i<s.length;)t=wn[s.charCodeAt(i++)-43],r=wn[s.charCodeAt(i++)-43],a=wn[s.charCodeAt(i++)-43],n=wn[s.charCodeAt(i++)-43],e+=String.fromCharCode(t<<2|r>>4),a!==64&&(e+=String.fromCharCode((r&15)<<4|a>>2),n!==64&&(e+=String.fromCharCode((a&3)<<6|n)));return e};k.encodeUtf8=function(s){return unescape(encodeURIComponent(s))};k.decodeUtf8=function(s){return decodeURIComponent(escape(s))};k.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:np.encode,decode:np.decode}};k.binary.raw.encode=function(s){return String.fromCharCode.apply(null,s)};k.binary.raw.decode=function(s,e,t){var r=e;r||(r=new Uint8Array(s.length)),t=t||0;for(var a=t,n=0;n<s.length;++n)r[a++]=s.charCodeAt(n);return e?a-t:r};k.binary.hex.encode=k.bytesToHex;k.binary.hex.decode=function(s,e,t){var r=e;r||(r=new Uint8Array(Math.ceil(s.length/2))),t=t||0;var a=0,n=t;for(s.length&1&&(a=1,r[n++]=parseInt(s[0],16));a<s.length;a+=2)r[n++]=parseInt(s.substr(a,2),16);return e?n-t:r};k.binary.base64.encode=function(s,e){for(var t="",r="",a,n,i,o=0;o<s.byteLength;)a=s[o++],n=s[o++],i=s[o++],t+=vn.charAt(a>>2),t+=vn.charAt((a&3)<<4|n>>4),isNaN(n)?t+="==":(t+=vn.charAt((n&15)<<2|i>>6),t+=isNaN(i)?"=":vn.charAt(i&63)),e&&t.length>e&&(r+=t.substr(0,e)+`\r
`,t=t.substr(e));return r+=t,r};k.binary.base64.decode=function(s,e,t){var r=e;r||(r=new Uint8Array(Math.ceil(s.length/4)*3)),s=s.replace(/[^A-Za-z0-9\+\/\=]/g,""),t=t||0;for(var a,n,i,o,l=0,u=t;l<s.length;)a=wn[s.charCodeAt(l++)-43],n=wn[s.charCodeAt(l++)-43],i=wn[s.charCodeAt(l++)-43],o=wn[s.charCodeAt(l++)-43],r[u++]=a<<2|n>>4,i!==64&&(r[u++]=(n&15)<<4|i>>2,o!==64&&(r[u++]=(i&3)<<6|o));return e?u-t:r.subarray(0,u)};k.binary.base58.encode=function(s,e){return k.binary.baseN.encode(s,by,e)};k.binary.base58.decode=function(s,e){return k.binary.baseN.decode(s,by,e)};k.text={utf8:{},utf16:{}};k.text.utf8.encode=function(s,e,t){s=k.encodeUtf8(s);var r=e;r||(r=new Uint8Array(s.length)),t=t||0;for(var a=t,n=0;n<s.length;++n)r[a++]=s.charCodeAt(n);return e?a-t:r};k.text.utf8.decode=function(s){return k.decodeUtf8(String.fromCharCode.apply(null,s))};k.text.utf16.encode=function(s,e,t){var r=e;r||(r=new Uint8Array(s.length*2));var a=new Uint16Array(r.buffer);t=t||0;for(var n=t,i=t,o=0;o<s.length;++o)a[i++]=s.charCodeAt(o),n+=2;return e?n-t:r};k.text.utf16.decode=function(s){return String.fromCharCode.apply(null,new Uint16Array(s.buffer))};k.deflate=function(s,e,t){if(e=k.decode64(s.deflate(k.encode64(e)).rval),t){var r=2,a=e.charCodeAt(1);a&32&&(r=6),e=e.substring(r,e.length-4)}return e};k.inflate=function(s,e,t){var r=s.inflate(k.encode64(e)).rval;return r===null?null:k.decode64(r)};var fm=function(s,e,t){if(!s)throw new Error("WebStorage not available.");var r;if(t===null?r=s.removeItem(e):(t=k.encode64(JSON.stringify(t)),r=s.setItem(e,t)),typeof r<"u"&&r.rval!==!0){var a=new Error(r.error.message);throw a.id=r.error.id,a.name=r.error.name,a}},hm=function(s,e){if(!s)throw new Error("WebStorage not available.");var t=s.getItem(e);if(s.init)if(t.rval===null){if(t.error){var r=new Error(t.error.message);throw r.id=t.error.id,r.name=t.error.name,r}t=null}else t=t.rval;return t!==null&&(t=JSON.parse(k.decode64(t))),t},gw=function(s,e,t,r){var a=hm(s,e);a===null&&(a={}),a[t]=r,fm(s,e,a)},mw=function(s,e,t){var r=hm(s,e);return r!==null&&(r=t in r?r[t]:null),r},pw=function(s,e,t){var r=hm(s,e);if(r!==null&&t in r){delete r[t];var a=!0;for(var n in r){a=!1;break}a&&(r=null),fm(s,e,r)}},yw=function(s,e){fm(s,e,null)},gd=function(s,e,t){var r=null;typeof t>"u"&&(t=["web","flash"]);var a,n=!1,i=null;for(var o in t){a=t[o];try{if(a==="flash"||a==="both"){if(e[0]===null)throw new Error("Flash local storage not available.");r=s.apply(this,e),n=a==="flash"}(a==="web"||a==="both")&&(e[0]=localStorage,r=s.apply(this,e),n=!0)}catch(l){i=l}if(n)break}if(!n)throw i;return r};k.setItem=function(s,e,t,r,a){gd(gw,arguments,a)};k.getItem=function(s,e,t,r){return gd(mw,arguments,r)};k.removeItem=function(s,e,t,r){gd(pw,arguments,r)};k.clearItems=function(s,e,t){gd(yw,arguments,t)};k.isEmpty=function(s){for(var e in s)if(s.hasOwnProperty(e))return!1;return!0};k.format=function(s){for(var e=/%./g,t,r,a=0,n=[],i=0;t=e.exec(s);){r=s.substring(i,e.lastIndex-2),r.length>0&&n.push(r),i=e.lastIndex;var o=t[0][1];switch(o){case"s":case"o":a<arguments.length?n.push(arguments[a+++1]):n.push("<?>");break;case"%":n.push("%");break;default:n.push("<%"+o+"?>")}}return n.push(s.substring(i)),n.join("")};k.formatNumber=function(s,e,t,r){var a=s,n=isNaN(e=Math.abs(e))?2:e,i=t===void 0?",":t,o=r===void 0?".":r,l=a<0?"-":"",u=parseInt(a=Math.abs(+a||0).toFixed(n),10)+"",c=u.length>3?u.length%3:0;return l+(c?u.substr(0,c)+o:"")+u.substr(c).replace(/(\d{3})(?=\d)/g,"$1"+o)+(n?i+Math.abs(a-u).toFixed(n).slice(2):"")};k.formatSize=function(s){return s>=1073741824?s=k.formatNumber(s/1073741824,2,".","")+" GiB":s>=1048576?s=k.formatNumber(s/1048576,2,".","")+" MiB":s>=1024?s=k.formatNumber(s/1024,0)+" KiB":s=k.formatNumber(s,0)+" bytes",s};k.bytesFromIP=function(s){return s.indexOf(".")!==-1?k.bytesFromIPv4(s):s.indexOf(":")!==-1?k.bytesFromIPv6(s):null};k.bytesFromIPv4=function(s){if(s=s.split("."),s.length!==4)return null;for(var e=k.createBuffer(),t=0;t<s.length;++t){var r=parseInt(s[t],10);if(isNaN(r))return null;e.putByte(r)}return e.getBytes()};k.bytesFromIPv6=function(s){var e=0;s=s.split(":").filter(function(i){return i.length===0&&++e,!0});for(var t=(8-s.length+e)*2,r=k.createBuffer(),a=0;a<8;++a){if(!s[a]||s[a].length===0){r.fillWithByte(0,t),t=0;continue}var n=k.hexToBytes(s[a]);n.length<2&&r.putByte(0),r.putBytes(n)}return r.getBytes()};k.bytesToIP=function(s){return s.length===4?k.bytesToIPv4(s):s.length===16?k.bytesToIPv6(s):null};k.bytesToIPv4=function(s){if(s.length!==4)return null;for(var e=[],t=0;t<s.length;++t)e.push(s.charCodeAt(t));return e.join(".")};k.bytesToIPv6=function(s){if(s.length!==16)return null;for(var e=[],t=[],r=0,a=0;a<s.length;a+=2){for(var n=k.bytesToHex(s[a]+s[a+1]);n[0]==="0"&&n!=="0";)n=n.substr(1);if(n==="0"){var i=t[t.length-1],o=e.length;!i||o!==i.end+1?t.push({start:o,end:o}):(i.end=o,i.end-i.start>t[r].end-t[r].start&&(r=t.length-1))}e.push(n)}if(t.length>0){var l=t[r];l.end-l.start>0&&(e.splice(l.start,l.end-l.start+1,""),l.start===0&&e.unshift(""),l.end===7&&e.push(""))}return e.join(":")};k.estimateCores=function(s,e){if(typeof s=="function"&&(e=s,s={}),s=s||{},"cores"in k&&!s.update)return e(null,k.cores);if(typeof navigator<"u"&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return k.cores=navigator.hardwareConcurrency,e(null,k.cores);if(typeof Worker>"u")return k.cores=1,e(null,k.cores);if(typeof Blob>"u")return k.cores=2,e(null,k.cores);var t=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(i){var o=Date.now(),l=o+4;self.postMessage({st:o,et:l})})}.toString(),")()"],{type:"application/javascript"}));r([],5,16);function r(i,o,l){if(o===0){var u=Math.floor(i.reduce(function(c,f){return c+f},0)/i.length);return k.cores=Math.max(1,u),URL.revokeObjectURL(t),e(null,k.cores)}a(l,function(c,f){i.push(n(l,f)),r(i,o-1,l)})}function a(i,o){for(var l=[],u=[],c=0;c<i;++c){var f=new Worker(t);f.addEventListener("message",function(g){if(u.push(g.data),u.length===i){for(var v=0;v<i;++v)l[v].terminate();o(null,u)}}),l.push(f)}for(var c=0;c<i;++c)l[c].postMessage(c)}function n(i,o){for(var l=[],u=0;u<i;++u)for(var c=o[u],f=l[u]=[],g=0;g<i;++g)if(u!==g){var v=o[g];(c.st>v.st&&c.st<v.et||v.st>c.st&&v.st<c.et)&&f.push(g)}return l.reduce(function(p,h){return Math.max(p,h.length)},0)}};var er=Me;er.cipher=er.cipher||{};er.cipher.algorithms=er.cipher.algorithms||{};er.cipher.createCipher=function(s,e){var t=s;if(typeof t=="string"&&(t=er.cipher.getAlgorithm(t),t&&(t=t())),!t)throw new Error("Unsupported algorithm: "+s);return new er.cipher.BlockCipher({algorithm:t,key:e,decrypt:!1})};er.cipher.createDecipher=function(s,e){var t=s;if(typeof t=="string"&&(t=er.cipher.getAlgorithm(t),t&&(t=t())),!t)throw new Error("Unsupported algorithm: "+s);return new er.cipher.BlockCipher({algorithm:t,key:e,decrypt:!0})};er.cipher.registerAlgorithm=function(s,e){s=s.toUpperCase(),er.cipher.algorithms[s]=e};er.cipher.getAlgorithm=function(s){return s=s.toUpperCase(),s in er.cipher.algorithms?er.cipher.algorithms[s]:null};var dm=er.cipher.BlockCipher=function(s){this.algorithm=s.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=s.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=s.decrypt,this.algorithm.initialize(s)};dm.prototype.start=function(s){s=s||{};var e={};for(var t in s)e[t]=s[t];e.decrypt=this._decrypt,this._finish=!1,this._input=er.util.createBuffer(),this.output=s.output||er.util.createBuffer(),this.mode.start(e)};dm.prototype.update=function(s){for(s&&this._input.putBuffer(s);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()};dm.prototype.finish=function(s){s&&(this.mode.name==="ECB"||this.mode.name==="CBC")&&(this.mode.pad=function(t){return s(this.blockSize,t,!1)},this.mode.unpad=function(t){return s(this.blockSize,t,!0)});var e={};return e.decrypt=this._decrypt,e.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,e)||(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,e))||this.mode.afterFinish&&!this.mode.afterFinish(this.output,e))};var Zt=Me;Zt.cipher=Zt.cipher||{};var Je=Zt.cipher.modes=Zt.cipher.modes||{};Je.ecb=function(s){s=s||{},this.name="ECB",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};Je.ecb.prototype.start=function(s){};Je.ecb.prototype.encrypt=function(s,e,t){if(s.length()<this.blockSize&&!(t&&s.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=s.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var r=0;r<this._ints;++r)e.putInt32(this._outBlock[r])};Je.ecb.prototype.decrypt=function(s,e,t){if(s.length()<this.blockSize&&!(t&&s.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=s.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var r=0;r<this._ints;++r)e.putInt32(this._outBlock[r])};Je.ecb.prototype.pad=function(s,e){var t=s.length()===this.blockSize?this.blockSize:this.blockSize-s.length();return s.fillWithByte(t,t),!0};Je.ecb.prototype.unpad=function(s,e){if(e.overflow>0)return!1;var t=s.length(),r=s.at(t-1);return r>this.blockSize<<2?!1:(s.truncate(r),!0)};Je.cbc=function(s){s=s||{},this.name="CBC",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};Je.cbc.prototype.start=function(s){if(s.iv===null){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else if("iv"in s)this._iv=md(s.iv,this.blockSize),this._prev=this._iv.slice(0);else throw new Error("Invalid IV parameter.")};Je.cbc.prototype.encrypt=function(s,e,t){if(s.length()<this.blockSize&&!(t&&s.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=this._prev[r]^s.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var r=0;r<this._ints;++r)e.putInt32(this._outBlock[r]);this._prev=this._outBlock};Je.cbc.prototype.decrypt=function(s,e,t){if(s.length()<this.blockSize&&!(t&&s.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=s.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var r=0;r<this._ints;++r)e.putInt32(this._prev[r]^this._outBlock[r]);this._prev=this._inBlock.slice(0)};Je.cbc.prototype.pad=function(s,e){var t=s.length()===this.blockSize?this.blockSize:this.blockSize-s.length();return s.fillWithByte(t,t),!0};Je.cbc.prototype.unpad=function(s,e){if(e.overflow>0)return!1;var t=s.length(),r=s.at(t-1);return r>this.blockSize<<2?!1:(s.truncate(r),!0)};Je.cfb=function(s){s=s||{},this.name="CFB",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=Zt.util.createBuffer(),this._partialBytes=0};Je.cfb.prototype.start=function(s){if(!("iv"in s))throw new Error("Invalid IV parameter.");this._iv=md(s.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};Je.cfb.prototype.encrypt=function(s,e,t){var r=s.length();if(r===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&r>=this.blockSize){for(var a=0;a<this._ints;++a)this._inBlock[a]=s.getInt32()^this._outBlock[a],e.putInt32(this._inBlock[a]);return}var n=(this.blockSize-r)%this.blockSize;n>0&&(n=this.blockSize-n),this._partialOutput.clear();for(var a=0;a<this._ints;++a)this._partialBlock[a]=s.getInt32()^this._outBlock[a],this._partialOutput.putInt32(this._partialBlock[a]);if(n>0)s.read-=this.blockSize;else for(var a=0;a<this._ints;++a)this._inBlock[a]=this._partialBlock[a];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),n>0&&!t)return e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=n,!0;e.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0};Je.cfb.prototype.decrypt=function(s,e,t){var r=s.length();if(r===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&r>=this.blockSize){for(var a=0;a<this._ints;++a)this._inBlock[a]=s.getInt32(),e.putInt32(this._inBlock[a]^this._outBlock[a]);return}var n=(this.blockSize-r)%this.blockSize;n>0&&(n=this.blockSize-n),this._partialOutput.clear();for(var a=0;a<this._ints;++a)this._partialBlock[a]=s.getInt32(),this._partialOutput.putInt32(this._partialBlock[a]^this._outBlock[a]);if(n>0)s.read-=this.blockSize;else for(var a=0;a<this._ints;++a)this._inBlock[a]=this._partialBlock[a];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),n>0&&!t)return e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=n,!0;e.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0};Je.ofb=function(s){s=s||{},this.name="OFB",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=Zt.util.createBuffer(),this._partialBytes=0};Je.ofb.prototype.start=function(s){if(!("iv"in s))throw new Error("Invalid IV parameter.");this._iv=md(s.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};Je.ofb.prototype.encrypt=function(s,e,t){var r=s.length();if(s.length()===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&r>=this.blockSize){for(var a=0;a<this._ints;++a)e.putInt32(s.getInt32()^this._outBlock[a]),this._inBlock[a]=this._outBlock[a];return}var n=(this.blockSize-r)%this.blockSize;n>0&&(n=this.blockSize-n),this._partialOutput.clear();for(var a=0;a<this._ints;++a)this._partialOutput.putInt32(s.getInt32()^this._outBlock[a]);if(n>0)s.read-=this.blockSize;else for(var a=0;a<this._ints;++a)this._inBlock[a]=this._outBlock[a];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),n>0&&!t)return e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=n,!0;e.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0};Je.ofb.prototype.decrypt=Je.ofb.prototype.encrypt;Je.ctr=function(s){s=s||{},this.name="CTR",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=Zt.util.createBuffer(),this._partialBytes=0};Je.ctr.prototype.start=function(s){if(!("iv"in s))throw new Error("Invalid IV parameter.");this._iv=md(s.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};Je.ctr.prototype.encrypt=function(s,e,t){var r=s.length();if(r===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&r>=this.blockSize)for(var a=0;a<this._ints;++a)e.putInt32(s.getInt32()^this._outBlock[a]);else{var n=(this.blockSize-r)%this.blockSize;n>0&&(n=this.blockSize-n),this._partialOutput.clear();for(var a=0;a<this._ints;++a)this._partialOutput.putInt32(s.getInt32()^this._outBlock[a]);if(n>0&&(s.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),n>0&&!t)return e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=n,!0;e.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}pd(this._inBlock)};Je.ctr.prototype.decrypt=Je.ctr.prototype.encrypt;Je.gcm=function(s){s=s||{},this.name="GCM",this.cipher=s.cipher,this.blockSize=s.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=Zt.util.createBuffer(),this._partialBytes=0,this._R=3774873600};Je.gcm.prototype.start=function(s){if(!("iv"in s))throw new Error("Invalid IV parameter.");var e=Zt.util.createBuffer(s.iv);this._cipherLength=0;var t;if("additionalData"in s?t=Zt.util.createBuffer(s.additionalData):t=Zt.util.createBuffer(),"tagLength"in s?this._tagLength=s.tagLength:this._tagLength=128,this._tag=null,s.decrypt&&(this._tag=Zt.util.createBuffer(s.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var r=e.length();if(r===12)this._j0=[e.getInt32(),e.getInt32(),e.getInt32(),1];else{for(this._j0=[0,0,0,0];e.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(yg(r*8)))}this._inBlock=this._j0.slice(0),pd(this._inBlock),this._partialBytes=0,t=Zt.util.createBuffer(t),this._aDataLength=yg(t.length()*8);var a=t.length()%this.blockSize;for(a&&t.fillWithByte(0,this.blockSize-a),this._s=[0,0,0,0];t.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()])};Je.gcm.prototype.encrypt=function(s,e,t){var r=s.length();if(r===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&r>=this.blockSize){for(var a=0;a<this._ints;++a)e.putInt32(this._outBlock[a]^=s.getInt32());this._cipherLength+=this.blockSize}else{var n=(this.blockSize-r)%this.blockSize;n>0&&(n=this.blockSize-n),this._partialOutput.clear();for(var a=0;a<this._ints;++a)this._partialOutput.putInt32(s.getInt32()^this._outBlock[a]);if(n<=0||t){if(t){var i=r%this.blockSize;this._cipherLength+=i,this._partialOutput.truncate(this.blockSize-i)}else this._cipherLength+=this.blockSize;for(var a=0;a<this._ints;++a)this._outBlock[a]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),n>0&&!t)return s.read-=this.blockSize,e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=n,!0;e.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),pd(this._inBlock)};Je.gcm.prototype.decrypt=function(s,e,t){var r=s.length();if(r<this.blockSize&&!(t&&r>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),pd(this._inBlock),this._hashBlock[0]=s.getInt32(),this._hashBlock[1]=s.getInt32(),this._hashBlock[2]=s.getInt32(),this._hashBlock[3]=s.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var a=0;a<this._ints;++a)e.putInt32(this._outBlock[a]^this._hashBlock[a]);r<this.blockSize?this._cipherLength+=r%this.blockSize:this._cipherLength+=this.blockSize};Je.gcm.prototype.afterFinish=function(s,e){var t=!0;e.decrypt&&e.overflow&&s.truncate(this.blockSize-e.overflow),this.tag=Zt.util.createBuffer();var r=this._aDataLength.concat(yg(this._cipherLength*8));this._s=this.ghash(this._hashSubkey,this._s,r);var a=[];this.cipher.encrypt(this._j0,a);for(var n=0;n<this._ints;++n)this.tag.putInt32(this._s[n]^a[n]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),e.decrypt&&this.tag.bytes()!==this._tag&&(t=!1),t};Je.gcm.prototype.multiply=function(s,e){for(var t=[0,0,0,0],r=e.slice(0),a=0;a<128;++a){var n=s[a/32|0]&1<<31-a%32;n&&(t[0]^=r[0],t[1]^=r[1],t[2]^=r[2],t[3]^=r[3]),this.pow(r,r)}return t};Je.gcm.prototype.pow=function(s,e){for(var t=s[3]&1,r=3;r>0;--r)e[r]=s[r]>>>1|(s[r-1]&1)<<31;e[0]=s[0]>>>1,t&&(e[0]^=this._R)};Je.gcm.prototype.tableMultiply=function(s){for(var e=[0,0,0,0],t=0;t<32;++t){var r=t/8|0,a=s[r]>>>(7-t%8)*4&15,n=this._m[t][a];e[0]^=n[0],e[1]^=n[1],e[2]^=n[2],e[3]^=n[3]}return e};Je.gcm.prototype.ghash=function(s,e,t){return e[0]^=t[0],e[1]^=t[1],e[2]^=t[2],e[3]^=t[3],this.tableMultiply(e)};Je.gcm.prototype.generateHashTable=function(s,e){for(var t=8/e,r=4*t,a=16*t,n=new Array(a),i=0;i<a;++i){var o=[0,0,0,0],l=i/r|0,u=(r-1-i%r)*e;o[l]=1<<e-1<<u,n[i]=this.generateSubHashTable(this.multiply(o,s),e)}return n};Je.gcm.prototype.generateSubHashTable=function(s,e){var t=1<<e,r=t>>>1,a=new Array(t);a[r]=s.slice(0);for(var n=r>>>1;n>0;)this.pow(a[2*n],a[n]=[]),n>>=1;for(n=2;n<r;){for(var i=1;i<n;++i){var o=a[n],l=a[i];a[n+i]=[o[0]^l[0],o[1]^l[1],o[2]^l[2],o[3]^l[3]]}n*=2}for(a[0]=[0,0,0,0],n=r+1;n<t;++n){var u=a[n^r];a[n]=[s[0]^u[0],s[1]^u[1],s[2]^u[2],s[3]^u[3]]}return a};function md(s,e){if(typeof s=="string"&&(s=Zt.util.createBuffer(s)),Zt.util.isArray(s)&&s.length>4){var t=s;s=Zt.util.createBuffer();for(var r=0;r<t.length;++r)s.putByte(t[r])}if(s.length()<e)throw new Error("Invalid IV length; got "+s.length()+" bytes and expected "+e+" bytes.");if(!Zt.util.isArray(s)){for(var a=[],n=e/4,r=0;r<n;++r)a.push(s.getInt32());s=a}return s}function pd(s){s[s.length-1]=s[s.length-1]+1&4294967295}function yg(s){return[s/4294967296|0,s&4294967295]}var dt=Me;dt.aes=dt.aes||{};dt.aes.startEncrypting=function(s,e,t,r){var a=yd({key:s,output:t,decrypt:!1,mode:r});return a.start(e),a};dt.aes.createEncryptionCipher=function(s,e){return yd({key:s,output:null,decrypt:!1,mode:e})};dt.aes.startDecrypting=function(s,e,t,r){var a=yd({key:s,output:t,decrypt:!0,mode:r});return a.start(e),a};dt.aes.createDecryptionCipher=function(s,e){return yd({key:s,output:null,decrypt:!0,mode:e})};dt.aes.Algorithm=function(s,e){gm||xy();var t=this;t.name=s,t.mode=new e({blockSize:16,cipher:{encrypt:function(r,a){return wg(t._w,r,a,!1)},decrypt:function(r,a){return wg(t._w,r,a,!0)}}}),t._init=!1};dt.aes.Algorithm.prototype.initialize=function(s){if(!this._init){var e=s.key,t;if(typeof e=="string"&&(e.length===16||e.length===24||e.length===32))e=dt.util.createBuffer(e);else if(dt.util.isArray(e)&&(e.length===16||e.length===24||e.length===32)){t=e,e=dt.util.createBuffer();for(var r=0;r<t.length;++r)e.putByte(t[r])}if(!dt.util.isArray(e)){t=e,e=[];var a=t.length();if(a===16||a===24||a===32){a=a>>>2;for(var r=0;r<a;++r)e.push(t.getInt32())}}if(!dt.util.isArray(e)||!(e.length===4||e.length===6||e.length===8))throw new Error("Invalid key parameter.");var n=this.mode.name,i=["CFB","OFB","CTR","GCM"].indexOf(n)!==-1;this._w=By(e,s.decrypt&&!i),this._init=!0}};dt.aes._expandKey=function(s,e){return gm||xy(),By(s,e)};dt.aes._updateBlock=wg;Bu("AES-ECB",dt.cipher.modes.ecb);Bu("AES-CBC",dt.cipher.modes.cbc);Bu("AES-CFB",dt.cipher.modes.cfb);Bu("AES-OFB",dt.cipher.modes.ofb);Bu("AES-CTR",dt.cipher.modes.ctr);Bu("AES-GCM",dt.cipher.modes.gcm);function Bu(s,e){var t=function(){return new dt.aes.Algorithm(s,e)};dt.cipher.registerAlgorithm(s,t)}var gm=!1,xo=4,hr,vg,Ey,Xi,hs;function xy(){gm=!0,Ey=[0,1,2,4,8,16,32,64,128,27,54];for(var s=new Array(256),e=0;e<128;++e)s[e]=e<<1,s[e+128]=e+128<<1^283;hr=new Array(256),vg=new Array(256),Xi=new Array(4),hs=new Array(4);for(var e=0;e<4;++e)Xi[e]=new Array(256),hs[e]=new Array(256);for(var t=0,r=0,a,n,i,o,l,u,c,e=0;e<256;++e){o=r^r<<1^r<<2^r<<3^r<<4,o=o>>8^o&255^99,hr[t]=o,vg[o]=t,l=s[o],a=s[t],n=s[a],i=s[n],u=l<<24^o<<16^o<<8^(o^l),c=(a^n^i)<<24^(t^i)<<16^(t^n^i)<<8^(t^a^i);for(var f=0;f<4;++f)Xi[f][t]=u,hs[f][o]=c,u=u<<24|u>>>8,c=c<<24|c>>>8;t===0?t=r=1:(t=a^s[s[s[a^i]]],r^=s[s[r]])}}function By(s,e){for(var t=s.slice(0),r,a=1,n=t.length,i=n+6+1,o=xo*i,l=n;l<o;++l)r=t[l-1],l%n===0?(r=hr[r>>>16&255]<<24^hr[r>>>8&255]<<16^hr[r&255]<<8^hr[r>>>24]^Ey[a]<<24,a++):n>6&&l%n===4&&(r=hr[r>>>24]<<24^hr[r>>>16&255]<<16^hr[r>>>8&255]<<8^hr[r&255]),t[l]=t[l-n]^r;if(e){var u,c=hs[0],f=hs[1],g=hs[2],v=hs[3],p=t.slice(0);o=t.length;for(var l=0,h=o-xo;l<o;l+=xo,h-=xo)if(l===0||l===o-xo)p[l]=t[h],p[l+1]=t[h+3],p[l+2]=t[h+2],p[l+3]=t[h+1];else for(var d=0;d<xo;++d)u=t[h+d],p[l+(3&-d)]=c[hr[u>>>24]]^f[hr[u>>>16&255]]^g[hr[u>>>8&255]]^v[hr[u&255]];t=p}return t}function wg(s,e,t,r){var a=s.length/4-1,n,i,o,l,u;r?(n=hs[0],i=hs[1],o=hs[2],l=hs[3],u=vg):(n=Xi[0],i=Xi[1],o=Xi[2],l=Xi[3],u=hr);var c,f,g,v,p,h,d;c=e[0]^s[0],f=e[r?3:1]^s[1],g=e[2]^s[2],v=e[r?1:3]^s[3];for(var y=3,A=1;A<a;++A)p=n[c>>>24]^i[f>>>16&255]^o[g>>>8&255]^l[v&255]^s[++y],h=n[f>>>24]^i[g>>>16&255]^o[v>>>8&255]^l[c&255]^s[++y],d=n[g>>>24]^i[v>>>16&255]^o[c>>>8&255]^l[f&255]^s[++y],v=n[v>>>24]^i[c>>>16&255]^o[f>>>8&255]^l[g&255]^s[++y],c=p,f=h,g=d;t[0]=u[c>>>24]<<24^u[f>>>16&255]<<16^u[g>>>8&255]<<8^u[v&255]^s[++y],t[r?3:1]=u[f>>>24]<<24^u[g>>>16&255]<<16^u[v>>>8&255]<<8^u[c&255]^s[++y],t[2]=u[g>>>24]<<24^u[v>>>16&255]<<16^u[c>>>8&255]<<8^u[f&255]^s[++y],t[r?1:3]=u[v>>>24]<<24^u[c>>>16&255]<<16^u[f>>>8&255]<<8^u[g&255]^s[++y]}function yd(s){s=s||{};var e=(s.mode||"CBC").toUpperCase(),t="AES-"+e,r;s.decrypt?r=dt.cipher.createDecipher(t,s.key):r=dt.cipher.createCipher(t,s.key);var a=r.start;return r.start=function(n,i){var o=null;i instanceof dt.util.ByteBuffer&&(o=i,i={}),i=i||{},i.output=o,i.iv=n,a.call(r,i)},r}var Wf=Me;Wf.pki=Wf.pki||{};var Sg=Wf.pki.oids=Wf.oids=Wf.oids||{};function X(s,e){Sg[s]=e,Sg[e]=s}function at(s,e){Sg[s]=e}X("1.2.840.113549.1.1.1","rsaEncryption");X("1.2.840.113549.1.1.4","md5WithRSAEncryption");X("1.2.840.113549.1.1.5","sha1WithRSAEncryption");X("1.2.840.113549.1.1.7","RSAES-OAEP");X("1.2.840.113549.1.1.8","mgf1");X("1.2.840.113549.1.1.9","pSpecified");X("1.2.840.113549.1.1.10","RSASSA-PSS");X("1.2.840.113549.1.1.11","sha256WithRSAEncryption");X("1.2.840.113549.1.1.12","sha384WithRSAEncryption");X("1.2.840.113549.1.1.13","sha512WithRSAEncryption");X("1.3.101.112","EdDSA25519");X("1.2.840.10040.4.3","dsa-with-sha1");X("1.3.14.3.2.7","desCBC");X("1.3.14.3.2.26","sha1");X("1.3.14.3.2.29","sha1WithRSASignature");X("2.16.840.1.101.3.4.2.1","sha256");X("2.16.840.1.101.3.4.2.2","sha384");X("2.16.840.1.101.3.4.2.3","sha512");X("2.16.840.1.101.3.4.2.4","sha224");X("2.16.840.1.101.3.4.2.5","sha512-224");X("2.16.840.1.101.3.4.2.6","sha512-256");X("1.2.840.113549.2.2","md2");X("1.2.840.113549.2.5","md5");X("1.2.840.113549.1.7.1","data");X("1.2.840.113549.1.7.2","signedData");X("1.2.840.113549.1.7.3","envelopedData");X("1.2.840.113549.1.7.4","signedAndEnvelopedData");X("1.2.840.113549.1.7.5","digestedData");X("1.2.840.113549.1.7.6","encryptedData");X("1.2.840.113549.1.9.1","emailAddress");X("1.2.840.113549.1.9.2","unstructuredName");X("1.2.840.113549.1.9.3","contentType");X("1.2.840.113549.1.9.4","messageDigest");X("1.2.840.113549.1.9.5","signingTime");X("1.2.840.113549.1.9.6","counterSignature");X("1.2.840.113549.1.9.7","challengePassword");X("1.2.840.113549.1.9.8","unstructuredAddress");X("1.2.840.113549.1.9.14","extensionRequest");X("1.2.840.113549.1.9.20","friendlyName");X("1.2.840.113549.1.9.21","localKeyId");X("1.2.840.113549.1.9.22.1","x509Certificate");X("1.2.840.113549.1.12.10.1.1","keyBag");X("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag");X("1.2.840.113549.1.12.10.1.3","certBag");X("1.2.840.113549.1.12.10.1.4","crlBag");X("1.2.840.113549.1.12.10.1.5","secretBag");X("1.2.840.113549.1.12.10.1.6","safeContentsBag");X("1.2.840.113549.1.5.13","pkcs5PBES2");X("1.2.840.113549.1.5.12","pkcs5PBKDF2");X("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4");X("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4");X("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC");X("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC");X("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC");X("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC");X("1.2.840.113549.2.7","hmacWithSHA1");X("1.2.840.113549.2.8","hmacWithSHA224");X("1.2.840.113549.2.9","hmacWithSHA256");X("1.2.840.113549.2.10","hmacWithSHA384");X("1.2.840.113549.2.11","hmacWithSHA512");X("1.2.840.113549.3.7","des-EDE3-CBC");X("2.16.840.1.101.3.4.1.2","aes128-CBC");X("2.16.840.1.101.3.4.1.22","aes192-CBC");X("2.16.840.1.101.3.4.1.42","aes256-CBC");X("2.5.4.3","commonName");X("2.5.4.4","surname");X("2.5.4.5","serialNumber");X("2.5.4.6","countryName");X("2.5.4.7","localityName");X("2.5.4.8","stateOrProvinceName");X("2.5.4.9","streetAddress");X("2.5.4.10","organizationName");X("2.5.4.11","organizationalUnitName");X("2.5.4.12","title");X("2.5.4.13","description");X("2.5.4.15","businessCategory");X("2.5.4.17","postalCode");X("2.5.4.42","givenName");X("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName");X("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName");X("2.16.840.1.113730.1.1","nsCertType");X("2.16.840.1.113730.1.13","nsComment");at("2.5.29.1","authorityKeyIdentifier");at("2.5.29.2","keyAttributes");at("2.5.29.3","certificatePolicies");at("2.5.29.4","keyUsageRestriction");at("2.5.29.5","policyMapping");at("2.5.29.6","subtreesConstraint");at("2.5.29.7","subjectAltName");at("2.5.29.8","issuerAltName");at("2.5.29.9","subjectDirectoryAttributes");at("2.5.29.10","basicConstraints");at("2.5.29.11","nameConstraints");at("2.5.29.12","policyConstraints");at("2.5.29.13","basicConstraints");X("2.5.29.14","subjectKeyIdentifier");X("2.5.29.15","keyUsage");at("2.5.29.16","privateKeyUsagePeriod");X("2.5.29.17","subjectAltName");X("2.5.29.18","issuerAltName");X("2.5.29.19","basicConstraints");at("2.5.29.20","cRLNumber");at("2.5.29.21","cRLReason");at("2.5.29.22","expirationDate");at("2.5.29.23","instructionCode");at("2.5.29.24","invalidityDate");at("2.5.29.25","cRLDistributionPoints");at("2.5.29.26","issuingDistributionPoint");at("2.5.29.27","deltaCRLIndicator");at("2.5.29.28","issuingDistributionPoint");at("2.5.29.29","certificateIssuer");at("2.5.29.30","nameConstraints");X("2.5.29.31","cRLDistributionPoints");X("2.5.29.32","certificatePolicies");at("2.5.29.33","policyMappings");at("2.5.29.34","policyConstraints");X("2.5.29.35","authorityKeyIdentifier");at("2.5.29.36","policyConstraints");X("2.5.29.37","extKeyUsage");at("2.5.29.46","freshestCRL");at("2.5.29.54","inhibitAnyPolicy");X("1.3.6.1.4.1.11129.2.4.2","timestampList");X("1.3.6.1.5.5.7.1.1","authorityInfoAccess");X("1.3.6.1.5.5.7.3.1","serverAuth");X("1.3.6.1.5.5.7.3.2","clientAuth");X("1.3.6.1.5.5.7.3.3","codeSigning");X("1.3.6.1.5.5.7.3.4","emailProtection");X("1.3.6.1.5.5.7.3.8","timeStamping");var yt=Me,le=yt.asn1=yt.asn1||{};le.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192};le.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30};le.create=function(s,e,t,r,a){if(yt.util.isArray(r)){for(var n=[],i=0;i<r.length;++i)r[i]!==void 0&&n.push(r[i]);r=n}var o={tagClass:s,type:e,constructed:t,composed:t||yt.util.isArray(r),value:r};return a&&"bitStringContents"in a&&(o.bitStringContents=a.bitStringContents,o.original=le.copy(o)),o};le.copy=function(s,e){var t;if(yt.util.isArray(s)){t=[];for(var r=0;r<s.length;++r)t.push(le.copy(s[r],e));return t}return typeof s=="string"?s:(t={tagClass:s.tagClass,type:s.type,constructed:s.constructed,composed:s.composed,value:le.copy(s.value,e)},e&&!e.excludeBitStringContents&&(t.bitStringContents=s.bitStringContents),t)};le.equals=function(s,e,t){if(yt.util.isArray(s)){if(!yt.util.isArray(e)||s.length!==e.length)return!1;for(var r=0;r<s.length;++r)if(!le.equals(s[r],e[r]))return!1;return!0}if(typeof s!=typeof e)return!1;if(typeof s=="string")return s===e;var a=s.tagClass===e.tagClass&&s.type===e.type&&s.constructed===e.constructed&&s.composed===e.composed&&le.equals(s.value,e.value);return t&&t.includeBitStringContents&&(a=a&&s.bitStringContents===e.bitStringContents),a};le.getBerValueLength=function(s){var e=s.getByte();if(e!==128){var t,r=e&128;return r?t=s.getInt((e&127)<<3):t=e,t}};function Yu(s,e,t){if(t>e){var r=new Error("Too few bytes to parse DER.");throw r.available=s.length(),r.remaining=e,r.requested=t,r}}var vw=function(s,e){var t=s.getByte();if(e--,t!==128){var r,a=t&128;if(!a)r=t;else{var n=t&127;Yu(s,e,n),r=s.getInt(n<<3)}if(r<0)throw new Error("Negative length: "+r);return r}};le.fromDer=function(s,e){e===void 0&&(e={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),typeof e=="boolean"&&(e={strict:e,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in e||(e.strict=!0),"parseAllBytes"in e||(e.parseAllBytes=!0),"decodeBitStrings"in e||(e.decodeBitStrings=!0),typeof s=="string"&&(s=yt.util.createBuffer(s));var t=s.length(),r=a0(s,s.length(),0,e);if(e.parseAllBytes&&s.length()!==0){var a=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw a.byteCount=t,a.remaining=s.length(),a}return r};function a0(s,e,t,r){var a;Yu(s,e,2);var n=s.getByte();e--;var i=n&192,o=n&31;a=s.length();var l=vw(s,e);if(e-=a-s.length(),l!==void 0&&l>e){if(r.strict){var u=new Error("Too few bytes to read ASN.1 value.");throw u.available=s.length(),u.remaining=e,u.requested=l,u}l=e}var c,f,g=(n&32)===32;if(g)if(c=[],l===void 0)for(;;){if(Yu(s,e,2),s.bytes(2)===String.fromCharCode(0,0)){s.getBytes(2),e-=2;break}a=s.length(),c.push(a0(s,e,t+1,r)),e-=a-s.length()}else for(;l>0;)a=s.length(),c.push(a0(s,l,t+1,r)),e-=a-s.length(),l-=a-s.length();if(c===void 0&&i===le.Class.UNIVERSAL&&o===le.Type.BITSTRING&&(f=s.bytes(l)),c===void 0&&r.decodeBitStrings&&i===le.Class.UNIVERSAL&&o===le.Type.BITSTRING&&l>1){var v=s.read,p=e,h=0;if(o===le.Type.BITSTRING&&(Yu(s,e,1),h=s.getByte(),e--),h===0)try{a=s.length();var d={strict:!0,decodeBitStrings:!0},y=a0(s,e,t+1,d),A=a-s.length();e-=A,o==le.Type.BITSTRING&&A++;var x=y.tagClass;A===l&&(x===le.Class.UNIVERSAL||x===le.Class.CONTEXT_SPECIFIC)&&(c=[y])}catch{}c===void 0&&(s.read=v,e=p)}if(c===void 0){if(l===void 0){if(r.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");l=e}if(o===le.Type.BMPSTRING)for(c="";l>0;l-=2)Yu(s,e,2),c+=String.fromCharCode(s.getInt16()),e-=2;else c=s.getBytes(l),e-=l}var N=f===void 0?null:{bitStringContents:f};return le.create(i,o,g,c,N)}le.toDer=function(s){var e=yt.util.createBuffer(),t=s.tagClass|s.type,r=yt.util.createBuffer(),a=!1;if("bitStringContents"in s&&(a=!0,s.original&&(a=le.equals(s,s.original))),a)r.putBytes(s.bitStringContents);else if(s.composed){s.constructed?t|=32:r.putByte(0);for(var n=0;n<s.value.length;++n)s.value[n]!==void 0&&r.putBuffer(le.toDer(s.value[n]))}else if(s.type===le.Type.BMPSTRING)for(var n=0;n<s.value.length;++n)r.putInt16(s.value.charCodeAt(n));else s.type===le.Type.INTEGER&&s.value.length>1&&(s.value.charCodeAt(0)===0&&(s.value.charCodeAt(1)&128)===0||s.value.charCodeAt(0)===255&&(s.value.charCodeAt(1)&128)===128)?r.putBytes(s.value.substr(1)):r.putBytes(s.value);if(e.putByte(t),r.length()<=127)e.putByte(r.length()&127);else{var i=r.length(),o="";do o+=String.fromCharCode(i&255),i=i>>>8;while(i>0);e.putByte(o.length|128);for(var n=o.length-1;n>=0;--n)e.putByte(o.charCodeAt(n))}return e.putBuffer(r),e};le.oidToDer=function(s){var e=s.split("."),t=yt.util.createBuffer();t.putByte(40*parseInt(e[0],10)+parseInt(e[1],10));for(var r,a,n,i,o=2;o<e.length;++o){r=!0,a=[],n=parseInt(e[o],10);do i=n&127,n=n>>>7,r||(i|=128),a.push(i),r=!1;while(n>0);for(var l=a.length-1;l>=0;--l)t.putByte(a[l])}return t};le.derToOid=function(s){var e;typeof s=="string"&&(s=yt.util.createBuffer(s));var t=s.getByte();e=Math.floor(t/40)+"."+t%40;for(var r=0;s.length()>0;)t=s.getByte(),r=r<<7,t&128?r+=t&127:(e+="."+(r+t),r=0);return e};le.utcTimeToDate=function(s){var e=new Date,t=parseInt(s.substr(0,2),10);t=t>=50?1900+t:2e3+t;var r=parseInt(s.substr(2,2),10)-1,a=parseInt(s.substr(4,2),10),n=parseInt(s.substr(6,2),10),i=parseInt(s.substr(8,2),10),o=0;if(s.length>11){var l=s.charAt(10),u=10;l!=="+"&&l!=="-"&&(o=parseInt(s.substr(10,2),10),u+=2)}if(e.setUTCFullYear(t,r,a),e.setUTCHours(n,i,o,0),u&&(l=s.charAt(u),l==="+"||l==="-")){var c=parseInt(s.substr(u+1,2),10),f=parseInt(s.substr(u+4,2),10),g=c*60+f;g*=6e4,l==="+"?e.setTime(+e-g):e.setTime(+e+g)}return e};le.generalizedTimeToDate=function(s){var e=new Date,t=parseInt(s.substr(0,4),10),r=parseInt(s.substr(4,2),10)-1,a=parseInt(s.substr(6,2),10),n=parseInt(s.substr(8,2),10),i=parseInt(s.substr(10,2),10),o=parseInt(s.substr(12,2),10),l=0,u=0,c=!1;s.charAt(s.length-1)==="Z"&&(c=!0);var f=s.length-5,g=s.charAt(f);if(g==="+"||g==="-"){var v=parseInt(s.substr(f+1,2),10),p=parseInt(s.substr(f+4,2),10);u=v*60+p,u*=6e4,g==="+"&&(u*=-1),c=!0}return s.charAt(14)==="."&&(l=parseFloat(s.substr(14),10)*1e3),c?(e.setUTCFullYear(t,r,a),e.setUTCHours(n,i,o,l),e.setTime(+e+u)):(e.setFullYear(t,r,a),e.setHours(n,i,o,l)),e};le.dateToUtcTime=function(s){if(typeof s=="string")return s;var e="",t=[];t.push((""+s.getUTCFullYear()).substr(2)),t.push(""+(s.getUTCMonth()+1)),t.push(""+s.getUTCDate()),t.push(""+s.getUTCHours()),t.push(""+s.getUTCMinutes()),t.push(""+s.getUTCSeconds());for(var r=0;r<t.length;++r)t[r].length<2&&(e+="0"),e+=t[r];return e+="Z",e};le.dateToGeneralizedTime=function(s){if(typeof s=="string")return s;var e="",t=[];t.push(""+s.getUTCFullYear()),t.push(""+(s.getUTCMonth()+1)),t.push(""+s.getUTCDate()),t.push(""+s.getUTCHours()),t.push(""+s.getUTCMinutes()),t.push(""+s.getUTCSeconds());for(var r=0;r<t.length;++r)t[r].length<2&&(e+="0"),e+=t[r];return e+="Z",e};le.integerToDer=function(s){var e=yt.util.createBuffer();if(s>=-128&&s<128)return e.putSignedInt(s,8);if(s>=-32768&&s<32768)return e.putSignedInt(s,16);if(s>=-8388608&&s<8388608)return e.putSignedInt(s,24);if(s>=-2147483648&&s<2147483648)return e.putSignedInt(s,32);var t=new Error("Integer too large; max is 32-bits.");throw t.integer=s,t};le.derToInteger=function(s){typeof s=="string"&&(s=yt.util.createBuffer(s));var e=s.length()*8;if(e>32)throw new Error("Integer too large; max is 32-bits.");return s.getSignedInt(e)};le.validate=function(s,e,t,r){var a=!1;if((s.tagClass===e.tagClass||typeof e.tagClass>"u")&&(s.type===e.type||typeof e.type>"u"))if(s.constructed===e.constructed||typeof e.constructed>"u"){if(a=!0,e.value&&yt.util.isArray(e.value))for(var n=0,i=0;a&&i<e.value.length;++i)a=e.value[i].optional||!1,s.value[n]&&(a=le.validate(s.value[n],e.value[i],t,r),a?++n:e.value[i].optional&&(a=!0)),!a&&r&&r.push("["+e.name+'] Tag class "'+e.tagClass+'", type "'+e.type+'" expected value length "'+e.value.length+'", got "'+s.value.length+'"');if(a&&t&&(e.capture&&(t[e.capture]=s.value),e.captureAsn1&&(t[e.captureAsn1]=s),e.captureBitStringContents&&"bitStringContents"in s&&(t[e.captureBitStringContents]=s.bitStringContents),e.captureBitStringValue&&"bitStringContents"in s))if(s.bitStringContents.length<2)t[e.captureBitStringValue]="";else{var o=s.bitStringContents.charCodeAt(0);if(o!==0)throw new Error("captureBitStringValue only supported for zero unused bits");t[e.captureBitStringValue]=s.bitStringContents.slice(1)}}else r&&r.push("["+e.name+'] Expected constructed "'+e.constructed+'", got "'+s.constructed+'"');else r&&(s.tagClass!==e.tagClass&&r.push("["+e.name+'] Expected tag class "'+e.tagClass+'", got "'+s.tagClass+'"'),s.type!==e.type&&r.push("["+e.name+'] Expected type "'+e.type+'", got "'+s.type+'"'));return a};var ip=/[^\\u0000-\\u00ff]/;le.prettyPrint=function(s,e,t){var r="";e=e||0,t=t||2,e>0&&(r+=`
`);for(var a="",n=0;n<e*t;++n)a+=" ";switch(r+=a+"Tag: ",s.tagClass){case le.Class.UNIVERSAL:r+="Universal:";break;case le.Class.APPLICATION:r+="Application:";break;case le.Class.CONTEXT_SPECIFIC:r+="Context-Specific:";break;case le.Class.PRIVATE:r+="Private:";break}if(s.tagClass===le.Class.UNIVERSAL)switch(r+=s.type,s.type){case le.Type.NONE:r+=" (None)";break;case le.Type.BOOLEAN:r+=" (Boolean)";break;case le.Type.INTEGER:r+=" (Integer)";break;case le.Type.BITSTRING:r+=" (Bit string)";break;case le.Type.OCTETSTRING:r+=" (Octet string)";break;case le.Type.NULL:r+=" (Null)";break;case le.Type.OID:r+=" (Object Identifier)";break;case le.Type.ODESC:r+=" (Object Descriptor)";break;case le.Type.EXTERNAL:r+=" (External or Instance of)";break;case le.Type.REAL:r+=" (Real)";break;case le.Type.ENUMERATED:r+=" (Enumerated)";break;case le.Type.EMBEDDED:r+=" (Embedded PDV)";break;case le.Type.UTF8:r+=" (UTF8)";break;case le.Type.ROID:r+=" (Relative Object Identifier)";break;case le.Type.SEQUENCE:r+=" (Sequence)";break;case le.Type.SET:r+=" (Set)";break;case le.Type.PRINTABLESTRING:r+=" (Printable String)";break;case le.Type.IA5String:r+=" (IA5String (ASCII))";break;case le.Type.UTCTIME:r+=" (UTC time)";break;case le.Type.GENERALIZEDTIME:r+=" (Generalized time)";break;case le.Type.BMPSTRING:r+=" (BMP String)";break}else r+=s.type;if(r+=`
`,r+=a+"Constructed: "+s.constructed+`
`,s.composed){for(var i=0,o="",n=0;n<s.value.length;++n)s.value[n]!==void 0&&(i+=1,o+=le.prettyPrint(s.value[n],e+1,t),n+1<s.value.length&&(o+=","));r+=a+"Sub values: "+i+o}else{if(r+=a+"Value: ",s.type===le.Type.OID){var l=le.derToOid(s.value);r+=l,yt.pki&&yt.pki.oids&&l in yt.pki.oids&&(r+=" ("+yt.pki.oids[l]+") ")}if(s.type===le.Type.INTEGER)try{r+=le.derToInteger(s.value)}catch{r+="0x"+yt.util.bytesToHex(s.value)}else if(s.type===le.Type.BITSTRING){if(s.value.length>1?r+="0x"+yt.util.bytesToHex(s.value.slice(1)):r+="(none)",s.value.length>0){var u=s.value.charCodeAt(0);u==1?r+=" (1 unused bit shown)":u>1&&(r+=" ("+u+" unused bits shown)")}}else if(s.type===le.Type.OCTETSTRING)ip.test(s.value)||(r+="("+s.value+") "),r+="0x"+yt.util.bytesToHex(s.value);else if(s.type===le.Type.UTF8)try{r+=yt.util.decodeUtf8(s.value)}catch(c){if(c.message==="URI malformed")r+="0x"+yt.util.bytesToHex(s.value)+" (malformed UTF8)";else throw c}else s.type===le.Type.PRINTABLESTRING||s.type===le.Type.IA5String?r+=s.value:ip.test(s.value)?r+="0x"+yt.util.bytesToHex(s.value):s.value.length===0?r+="[null]":r+=s.value}return r};var P0=Me,ww=P0.md=P0.md||{};P0.md.algorithms=P0.md.algorithms||{};var ta=Me,Sw=ta.hmac=ta.hmac||{};Sw.create=function(){var s=null,e=null,t=null,r=null,a={};return a.start=function(n,i){if(n!==null)if(typeof n=="string")if(n=n.toLowerCase(),n in ta.md.algorithms)e=ta.md.algorithms[n].create();else throw new Error('Unknown hash algorithm "'+n+'"');else e=n;if(i===null)i=s;else{if(typeof i=="string")i=ta.util.createBuffer(i);else if(ta.util.isArray(i)){var o=i;i=ta.util.createBuffer();for(var l=0;l<o.length;++l)i.putByte(o[l])}var u=i.length();u>e.blockLength&&(e.start(),e.update(i.bytes()),i=e.digest()),t=ta.util.createBuffer(),r=ta.util.createBuffer(),u=i.length();for(var l=0;l<u;++l){var o=i.at(l);t.putByte(54^o),r.putByte(92^o)}if(u<e.blockLength)for(var o=e.blockLength-u,l=0;l<o;++l)t.putByte(54),r.putByte(92);s=i,t=t.bytes(),r=r.bytes()}e.start(),e.update(t)},a.update=function(n){e.update(n)},a.getMac=function(){var n=e.digest().bytes();return e.start(),e.update(r),e.update(n),e.digest()},a.digest=a.getMac,a};var Bs=Me,Iy=Bs.md5=Bs.md5||{};Bs.md.md5=Bs.md.algorithms.md5=Iy;Iy.create=function(){ky||Cw();var s=null,e=Bs.util.createBuffer(),t=new Array(16),r={algorithm:"md5",blockLength:64,digestLength:16,messageLength:0,fullMessageLength:null,messageLengthSize:8};return r.start=function(){r.messageLength=0,r.fullMessageLength=r.messageLength64=[];for(var a=r.messageLengthSize/4,n=0;n<a;++n)r.fullMessageLength.push(0);return e=Bs.util.createBuffer(),s={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878},r},r.start(),r.update=function(a,n){n==="utf8"&&(a=Bs.util.encodeUtf8(a));var i=a.length;r.messageLength+=i,i=[i/4294967296>>>0,i>>>0];for(var o=r.fullMessageLength.length-1;o>=0;--o)r.fullMessageLength[o]+=i[1],i[1]=i[0]+(r.fullMessageLength[o]/4294967296>>>0),r.fullMessageLength[o]=r.fullMessageLength[o]>>>0,i[0]=i[1]/4294967296>>>0;return e.putBytes(a),op(s,t,e),(e.read>2048||e.length()===0)&&e.compact(),r},r.digest=function(){var a=Bs.util.createBuffer();a.putBytes(e.bytes());var n=r.fullMessageLength[r.fullMessageLength.length-1]+r.messageLengthSize,i=n&r.blockLength-1;a.putBytes(Cg.substr(0,r.blockLength-i));for(var o,l=0,u=r.fullMessageLength.length-1;u>=0;--u)o=r.fullMessageLength[u]*8+l,l=o/4294967296>>>0,a.putInt32Le(o>>>0);var c={h0:s.h0,h1:s.h1,h2:s.h2,h3:s.h3};op(c,t,a);var f=Bs.util.createBuffer();return f.putInt32Le(c.h0),f.putInt32Le(c.h1),f.putInt32Le(c.h2),f.putInt32Le(c.h3),f},r};var Cg=null,n0=null,zu=null,ru=null,ky=!1;function Cw(){Cg=String.fromCharCode(128),Cg+=Bs.util.fillString(String.fromCharCode(0),64),n0=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1,6,11,0,5,10,15,4,9,14,3,8,13,2,7,12,5,8,11,14,1,4,7,10,13,0,3,6,9,12,15,2,0,7,14,5,12,3,10,1,8,15,6,13,4,11,2,9],zu=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],ru=new Array(64);for(var s=0;s<64;++s)ru[s]=Math.floor(Math.abs(Math.sin(s+1))*4294967296);ky=!0}function op(s,e,t){for(var r,a,n,i,o,l,u,c,f=t.length();f>=64;){for(a=s.h0,n=s.h1,i=s.h2,o=s.h3,c=0;c<16;++c)e[c]=t.getInt32Le(),l=o^n&(i^o),r=a+l+ru[c]+e[c],u=zu[c],a=o,o=i,i=n,n+=r<<u|r>>>32-u;for(;c<32;++c)l=i^o&(n^i),r=a+l+ru[c]+e[n0[c]],u=zu[c],a=o,o=i,i=n,n+=r<<u|r>>>32-u;for(;c<48;++c)l=n^i^o,r=a+l+ru[c]+e[n0[c]],u=zu[c],a=o,o=i,i=n,n+=r<<u|r>>>32-u;for(;c<64;++c)l=i^(n|~o),r=a+l+ru[c]+e[n0[c]],u=zu[c],a=o,o=i,i=n,n+=r<<u|r>>>32-u;s.h0=s.h0+a|0,s.h1=s.h1+n|0,s.h2=s.h2+i|0,s.h3=s.h3+o|0,f-=64}}var U0=Me,Ny=U0.pem=U0.pem||{};Ny.encode=function(s,e){e=e||{};var t="-----BEGIN "+s.type+`-----\r
`,r;if(s.procType&&(r={name:"Proc-Type",values:[String(s.procType.version),s.procType.type]},t+=Eh(r)),s.contentDomain&&(r={name:"Content-Domain",values:[s.contentDomain]},t+=Eh(r)),s.dekInfo&&(r={name:"DEK-Info",values:[s.dekInfo.algorithm]},s.dekInfo.parameters&&r.values.push(s.dekInfo.parameters),t+=Eh(r)),s.headers)for(var a=0;a<s.headers.length;++a)t+=Eh(s.headers[a]);return s.procType&&(t+=`\r
`),t+=U0.util.encode64(s.body,e.maxline||64)+`\r
`,t+="-----END "+s.type+`-----\r
`,t};Ny.decode=function(s){for(var e=[],t=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,r=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,a=/\r?\n/,n;n=t.exec(s),!!n;){var i=n[1];i==="NEW CERTIFICATE REQUEST"&&(i="CERTIFICATE REQUEST");var o={type:i,procType:null,contentDomain:null,dekInfo:null,headers:[],body:U0.util.decode64(n[3])};if(e.push(o),!!n[2]){for(var l=n[2].split(a),u=0;n&&u<l.length;){for(var c=l[u].replace(/\s+$/,""),f=u+1;f<l.length;++f){var g=l[f];if(!/\s/.test(g[0]))break;c+=g,u=f}if(n=c.match(r),n){for(var v={name:n[1],values:[]},p=n[2].split(","),h=0;h<p.length;++h)v.values.push(Aw(p[h]));if(o.procType)if(!o.contentDomain&&v.name==="Content-Domain")o.contentDomain=p[0]||"";else if(!o.dekInfo&&v.name==="DEK-Info"){if(v.values.length===0)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');o.dekInfo={algorithm:p[0],parameters:p[1]||null}}else o.headers.push(v);else{if(v.name!=="Proc-Type")throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(v.values.length!==2)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');o.procType={version:p[0],type:p[1]}}}++u}if(o.procType==="ENCRYPTED"&&!o.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(e.length===0)throw new Error("Invalid PEM formatted message.");return e};function Eh(s){for(var e=s.name+": ",t=[],r=function(l,u){return" "+u},a=0;a<s.values.length;++a)t.push(s.values[a].replace(/^(\S+\r\n)/,r));e+=t.join(",")+`\r
`;for(var n=0,i=-1,a=0;a<e.length;++a,++n)if(n>65&&i!==-1){var o=e[i];o===","?(++i,e=e.substr(0,i)+`\r
 `+e.substr(i)):e=e.substr(0,i)+`\r
`+o+e.substr(i+1),n=a-i-1,i=-1,++a}else(e[a]===" "||e[a]==="	"||e[a]===",")&&(i=a);return e}function Aw(s){return s.replace(/^\s+/,"")}var Et=Me;Et.des=Et.des||{};Et.des.startEncrypting=function(s,e,t,r){var a=vd({key:s,output:t,decrypt:!1,mode:r||(e===null?"ECB":"CBC")});return a.start(e),a};Et.des.createEncryptionCipher=function(s,e){return vd({key:s,output:null,decrypt:!1,mode:e})};Et.des.startDecrypting=function(s,e,t,r){var a=vd({key:s,output:t,decrypt:!0,mode:r||(e===null?"ECB":"CBC")});return a.start(e),a};Et.des.createDecryptionCipher=function(s,e){return vd({key:s,output:null,decrypt:!0,mode:e})};Et.des.Algorithm=function(s,e){var t=this;t.name=s,t.mode=new e({blockSize:8,cipher:{encrypt:function(r,a){return lp(t._keys,r,a,!1)},decrypt:function(r,a){return lp(t._keys,r,a,!0)}}}),t._init=!1};Et.des.Algorithm.prototype.initialize=function(s){if(!this._init){var e=Et.util.createBuffer(s.key);if(this.name.indexOf("3DES")===0&&e.length()!==24)throw new Error("Invalid Triple-DES key size: "+e.length()*8);this._keys=_w(e),this._init=!0}};Us("DES-ECB",Et.cipher.modes.ecb);Us("DES-CBC",Et.cipher.modes.cbc);Us("DES-CFB",Et.cipher.modes.cfb);Us("DES-OFB",Et.cipher.modes.ofb);Us("DES-CTR",Et.cipher.modes.ctr);Us("3DES-ECB",Et.cipher.modes.ecb);Us("3DES-CBC",Et.cipher.modes.cbc);Us("3DES-CFB",Et.cipher.modes.cfb);Us("3DES-OFB",Et.cipher.modes.ofb);Us("3DES-CTR",Et.cipher.modes.ctr);function Us(s,e){var t=function(){return new Et.des.Algorithm(s,e)};Et.cipher.registerAlgorithm(s,t)}var bw=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],Ew=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],xw=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],Bw=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],Iw=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],kw=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],Nw=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],Tw=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function _w(s){for(var e=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],t=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],r=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],a=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],n=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],i=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],o=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],l=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],u=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],c=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],f=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],g=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],v=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],p=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],h=s.length()>8?3:1,d=[],y=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],A=0,x,N=0;N<h;N++){var _=s.getInt32(),$=s.getInt32();x=(_>>>4^$)&252645135,$^=x,_^=x<<4,x=($>>>-16^_)&65535,_^=x,$^=x<<-16,x=(_>>>2^$)&858993459,$^=x,_^=x<<2,x=($>>>-16^_)&65535,_^=x,$^=x<<-16,x=(_>>>1^$)&1431655765,$^=x,_^=x<<1,x=($>>>8^_)&16711935,_^=x,$^=x<<8,x=(_>>>1^$)&1431655765,$^=x,_^=x<<1,x=_<<8|$>>>20&240,_=$<<24|$<<8&16711680|$>>>8&65280|$>>>24&240,$=x;for(var se=0;se<y.length;++se){y[se]?(_=_<<2|_>>>26,$=$<<2|$>>>26):(_=_<<1|_>>>27,$=$<<1|$>>>27),_&=-15,$&=-15;var te=e[_>>>28]|t[_>>>24&15]|r[_>>>20&15]|a[_>>>16&15]|n[_>>>12&15]|i[_>>>8&15]|o[_>>>4&15],me=l[$>>>28]|u[$>>>24&15]|c[$>>>20&15]|f[$>>>16&15]|g[$>>>12&15]|v[$>>>8&15]|p[$>>>4&15];x=(me>>>16^te)&65535,d[A++]=te^x,d[A++]=me^x<<16}}return d}function lp(s,e,t,r){var a=s.length===32?3:9,n;a===3?n=r?[30,-2,-2]:[0,32,2]:n=r?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var i,o=e[0],l=e[1];i=(o>>>4^l)&252645135,l^=i,o^=i<<4,i=(o>>>16^l)&65535,l^=i,o^=i<<16,i=(l>>>2^o)&858993459,o^=i,l^=i<<2,i=(l>>>8^o)&16711935,o^=i,l^=i<<8,i=(o>>>1^l)&1431655765,l^=i,o^=i<<1,o=o<<1|o>>>31,l=l<<1|l>>>31;for(var u=0;u<a;u+=3){for(var c=n[u+1],f=n[u+2],g=n[u];g!=c;g+=f){var v=l^s[g],p=(l>>>4|l<<28)^s[g+1];i=o,o=l,l=i^(Ew[v>>>24&63]|Bw[v>>>16&63]|kw[v>>>8&63]|Tw[v&63]|bw[p>>>24&63]|xw[p>>>16&63]|Iw[p>>>8&63]|Nw[p&63])}i=o,o=l,l=i}o=o>>>1|o<<31,l=l>>>1|l<<31,i=(o>>>1^l)&1431655765,l^=i,o^=i<<1,i=(l>>>8^o)&16711935,o^=i,l^=i<<8,i=(l>>>2^o)&858993459,o^=i,l^=i<<2,i=(o>>>16^l)&65535,l^=i,o^=i<<16,i=(o>>>4^l)&252645135,l^=i,o^=i<<4,t[0]=o,t[1]=l}function vd(s){s=s||{};var e=(s.mode||"CBC").toUpperCase(),t="DES-"+e,r;s.decrypt?r=Et.cipher.createDecipher(t,s.key):r=Et.cipher.createCipher(t,s.key);var a=r.start;return r.start=function(n,i){var o=null;i instanceof Et.util.ByteBuffer&&(o=i,i={}),i=i||{},i.output=o,i.iv=n,a.call(r,i)},r}const Rw={},Vw=Object.freeze(Object.defineProperty({__proto__:null,default:Rw},Symbol.toStringTag,{value:"Module"})),mm=ow(Vw);var dr=Me,$w=dr.pkcs5=dr.pkcs5||{},Ks;dr.util.isNodejs&&!dr.options.usePureJavaScript&&(Ks=mm);dr.pbkdf2=$w.pbkdf2=function(s,e,t,r,a,n){if(typeof a=="function"&&(n=a,a=null),dr.util.isNodejs&&!dr.options.usePureJavaScript&&Ks.pbkdf2&&(a===null||typeof a!="object")&&(Ks.pbkdf2Sync.length>4||!a||a==="sha1"))return typeof a!="string"&&(a="sha1"),s=Buffer.from(s,"binary"),e=Buffer.from(e,"binary"),n?Ks.pbkdf2Sync.length===4?Ks.pbkdf2(s,e,t,r,function(x,N){if(x)return n(x);n(null,N.toString("binary"))}):Ks.pbkdf2(s,e,t,r,a,function(x,N){if(x)return n(x);n(null,N.toString("binary"))}):Ks.pbkdf2Sync.length===4?Ks.pbkdf2Sync(s,e,t,r).toString("binary"):Ks.pbkdf2Sync(s,e,t,r,a).toString("binary");if((typeof a>"u"||a===null)&&(a="sha1"),typeof a=="string"){if(!(a in dr.md.algorithms))throw new Error("Unknown hash algorithm: "+a);a=dr.md[a].create()}var i=a.digestLength;if(r>4294967295*i){var o=new Error("Derived key is too long.");if(n)return n(o);throw o}var l=Math.ceil(r/i),u=r-(l-1)*i,c=dr.hmac.create();c.start(a,s);var f="",g,v,p;if(!n){for(var h=1;h<=l;++h){c.start(null,null),c.update(e),c.update(dr.util.int32ToBytes(h)),g=p=c.digest().getBytes();for(var d=2;d<=t;++d)c.start(null,null),c.update(p),v=c.digest().getBytes(),g=dr.util.xorBytes(g,v,i),p=v;f+=h<l?g:g.substr(0,u)}return f}var h=1,d;function y(){if(h>l)return n(null,f);c.start(null,null),c.update(e),c.update(dr.util.int32ToBytes(h)),g=p=c.digest().getBytes(),d=2,A()}function A(){if(d<=t)return c.start(null,null),c.update(p),v=c.digest().getBytes(),g=dr.util.xorBytes(g,v,i),p=v,++d,dr.util.setImmediate(A);f+=h<l?g:g.substr(0,u),++h,y()}y()};var Is=Me,Ty=Is.sha256=Is.sha256||{};Is.md.sha256=Is.md.algorithms.sha256=Ty;Ty.create=function(){_y||Dw();var s=null,e=Is.util.createBuffer(),t=new Array(64),r={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8};return r.start=function(){r.messageLength=0,r.fullMessageLength=r.messageLength64=[];for(var a=r.messageLengthSize/4,n=0;n<a;++n)r.fullMessageLength.push(0);return e=Is.util.createBuffer(),s={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},r},r.start(),r.update=function(a,n){n==="utf8"&&(a=Is.util.encodeUtf8(a));var i=a.length;r.messageLength+=i,i=[i/4294967296>>>0,i>>>0];for(var o=r.fullMessageLength.length-1;o>=0;--o)r.fullMessageLength[o]+=i[1],i[1]=i[0]+(r.fullMessageLength[o]/4294967296>>>0),r.fullMessageLength[o]=r.fullMessageLength[o]>>>0,i[0]=i[1]/4294967296>>>0;return e.putBytes(a),up(s,t,e),(e.read>2048||e.length()===0)&&e.compact(),r},r.digest=function(){var a=Is.util.createBuffer();a.putBytes(e.bytes());var n=r.fullMessageLength[r.fullMessageLength.length-1]+r.messageLengthSize,i=n&r.blockLength-1;a.putBytes(Ag.substr(0,r.blockLength-i));for(var o,l,u=r.fullMessageLength[0]*8,c=0;c<r.fullMessageLength.length-1;++c)o=r.fullMessageLength[c+1]*8,l=o/4294967296>>>0,u+=l,a.putInt32(u>>>0),u=o>>>0;a.putInt32(u);var f={h0:s.h0,h1:s.h1,h2:s.h2,h3:s.h3,h4:s.h4,h5:s.h5,h6:s.h6,h7:s.h7};up(f,t,a);var g=Is.util.createBuffer();return g.putInt32(f.h0),g.putInt32(f.h1),g.putInt32(f.h2),g.putInt32(f.h3),g.putInt32(f.h4),g.putInt32(f.h5),g.putInt32(f.h6),g.putInt32(f.h7),g},r};var Ag=null,_y=!1,Ry=null;function Dw(){Ag=String.fromCharCode(128),Ag+=Is.util.fillString(String.fromCharCode(0),64),Ry=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],_y=!0}function up(s,e,t){for(var r,a,n,i,o,l,u,c,f,g,v,p,h,d,y,A=t.length();A>=64;){for(u=0;u<16;++u)e[u]=t.getInt32();for(;u<64;++u)r=e[u-2],r=(r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10,a=e[u-15],a=(a>>>7|a<<25)^(a>>>18|a<<14)^a>>>3,e[u]=r+e[u-7]+a+e[u-16]|0;for(c=s.h0,f=s.h1,g=s.h2,v=s.h3,p=s.h4,h=s.h5,d=s.h6,y=s.h7,u=0;u<64;++u)i=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7),o=d^p&(h^d),n=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),l=c&f|g&(c^f),r=y+i+o+Ry[u]+e[u],a=n+l,y=d,d=h,h=p,p=v+r>>>0,v=g,g=f,f=c,c=r+a>>>0;s.h0=s.h0+c|0,s.h1=s.h1+f|0,s.h2=s.h2+g|0,s.h3=s.h3+v|0,s.h4=s.h4+p|0,s.h5=s.h5+h|0,s.h6=s.h6+d|0,s.h7=s.h7+y|0,A-=64}}var Es=Me,i0=null;Es.util.isNodejs&&!Es.options.usePureJavaScript&&!process.versions["node-webkit"]&&(i0=mm);var Lw=Es.prng=Es.prng||{};Lw.create=function(s){for(var e={plugin:s,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},t=s.md,r=new Array(32),a=0;a<32;++a)r[a]=t.create();e.pools=r,e.pool=0,e.generate=function(u,c){if(!c)return e.generateSync(u);var f=e.plugin.cipher,g=e.plugin.increment,v=e.plugin.formatKey,p=e.plugin.formatSeed,h=Es.util.createBuffer();e.key=null,d();function d(y){if(y)return c(y);if(h.length()>=u)return c(null,h.getBytes(u));if(e.generated>1048575&&(e.key=null),e.key===null)return Es.util.nextTick(function(){n(d)});var A=f(e.key,e.seed);e.generated+=A.length,h.putBytes(A),e.key=v(f(e.key,g(e.seed))),e.seed=p(f(e.key,e.seed)),Es.util.setImmediate(d)}},e.generateSync=function(u){var c=e.plugin.cipher,f=e.plugin.increment,g=e.plugin.formatKey,v=e.plugin.formatSeed;e.key=null;for(var p=Es.util.createBuffer();p.length()<u;){e.generated>1048575&&(e.key=null),e.key===null&&i();var h=c(e.key,e.seed);e.generated+=h.length,p.putBytes(h),e.key=g(c(e.key,f(e.seed))),e.seed=v(c(e.key,e.seed))}return p.getBytes(u)};function n(u){if(e.pools[0].messageLength>=32)return o(),u();var c=32-e.pools[0].messageLength<<5;e.seedFile(c,function(f,g){if(f)return u(f);e.collect(g),o(),u()})}function i(){if(e.pools[0].messageLength>=32)return o();var u=32-e.pools[0].messageLength<<5;e.collect(e.seedFileSync(u)),o()}function o(){e.reseeds=e.reseeds===4294967295?0:e.reseeds+1;var u=e.plugin.md.create();u.update(e.keyBytes);for(var c=1,f=0;f<32;++f)e.reseeds%c===0&&(u.update(e.pools[f].digest().getBytes()),e.pools[f].start()),c=c<<1;e.keyBytes=u.digest().getBytes(),u.start(),u.update(e.keyBytes);var g=u.digest().getBytes();e.key=e.plugin.formatKey(e.keyBytes),e.seed=e.plugin.formatSeed(g),e.generated=0}function l(u){var c=null,f=Es.util.globalScope,g=f.crypto||f.msCrypto;g&&g.getRandomValues&&(c=function(_){return g.getRandomValues(_)});var v=Es.util.createBuffer();if(c)for(;v.length()<u;){var p=Math.max(1,Math.min(u-v.length(),65536)/4),h=new Uint32Array(Math.floor(p));try{c(h);for(var d=0;d<h.length;++d)v.putInt32(h[d])}catch(_){if(!(typeof QuotaExceededError<"u"&&_ instanceof QuotaExceededError))throw _}}if(v.length()<u)for(var y,A,x,N=Math.floor(Math.random()*65536);v.length()<u;){A=16807*(N&65535),y=16807*(N>>16),A+=(y&32767)<<16,A+=y>>15,A=(A&2147483647)+(A>>31),N=A&4294967295;for(var d=0;d<3;++d)x=N>>>(d<<3),x^=Math.floor(Math.random()*256),v.putByte(x&255)}return v.getBytes(u)}return i0?(e.seedFile=function(u,c){i0.randomBytes(u,function(f,g){if(f)return c(f);c(null,g.toString())})},e.seedFileSync=function(u){return i0.randomBytes(u).toString()}):(e.seedFile=function(u,c){try{c(null,l(u))}catch(f){c(f)}},e.seedFileSync=l),e.collect=function(u){for(var c=u.length,f=0;f<c;++f)e.pools[e.pool].update(u.substr(f,1)),e.pool=e.pool===31?0:e.pool+1},e.collectInt=function(u,c){for(var f="",g=0;g<c;g+=8)f+=String.fromCharCode(u>>g&255);e.collect(f)},e.registerWorker=function(u){if(u===self)e.seedFile=function(f,g){function v(p){var h=p.data;h.forge&&h.forge.prng&&(self.removeEventListener("message",v),g(h.forge.prng.err,h.forge.prng.bytes))}self.addEventListener("message",v),self.postMessage({forge:{prng:{needed:f}}})};else{var c=function(f){var g=f.data;g.forge&&g.forge.prng&&e.seedFile(g.forge.prng.needed,function(v,p){u.postMessage({forge:{prng:{err:v,bytes:p}}})})};u.addEventListener("message",c)}},e};var Wt=Me;(function(){if(Wt.random&&Wt.random.getBytes){Wt.random;return}(function(s){var e={},t=new Array(4),r=Wt.util.createBuffer();e.formatKey=function(f){var g=Wt.util.createBuffer(f);return f=new Array(4),f[0]=g.getInt32(),f[1]=g.getInt32(),f[2]=g.getInt32(),f[3]=g.getInt32(),Wt.aes._expandKey(f,!1)},e.formatSeed=function(f){var g=Wt.util.createBuffer(f);return f=new Array(4),f[0]=g.getInt32(),f[1]=g.getInt32(),f[2]=g.getInt32(),f[3]=g.getInt32(),f},e.cipher=function(f,g){return Wt.aes._updateBlock(f,g,t,!1),r.putInt32(t[0]),r.putInt32(t[1]),r.putInt32(t[2]),r.putInt32(t[3]),r.getBytes()},e.increment=function(f){return++f[3],f},e.md=Wt.md.sha256;function a(){var f=Wt.prng.create(e);return f.getBytes=function(g,v){return f.generate(g,v)},f.getBytesSync=function(g){return f.generate(g)},f}var n=a(),i=null,o=Wt.util.globalScope,l=o.crypto||o.msCrypto;if(l&&l.getRandomValues&&(i=function(f){return l.getRandomValues(f)}),Wt.options.usePureJavaScript||!Wt.util.isNodejs&&!i){if(n.collectInt(+new Date,32),typeof navigator<"u"){var u="";for(var c in navigator)try{typeof navigator[c]=="string"&&(u+=navigator[c])}catch{}n.collect(u),u=null}s&&(s().mousemove(function(f){n.collectInt(f.clientX,16),n.collectInt(f.clientY,16)}),s().keypress(function(f){n.collectInt(f.charCode,8)}))}if(!Wt.random)Wt.random=n;else for(var c in n)Wt.random[c]=n[c];Wt.random.createInstance=a,Wt.random})(typeof jQuery<"u"?jQuery:null)})();var kr=Me,Rd=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],cp=[1,2,3,5],Ow=function(s,e){return s<<e&65535|(s&65535)>>16-e},Pw=function(s,e){return(s&65535)>>e|s<<16-e&65535};kr.rc2=kr.rc2||{};kr.rc2.expandKey=function(s,e){typeof s=="string"&&(s=kr.util.createBuffer(s)),e=e||128;var t=s,r=s.length(),a=e,n=Math.ceil(a/8),i=255>>(a&7),o;for(o=r;o<128;o++)t.putByte(Rd[t.at(o-1)+t.at(o-r)&255]);for(t.setAt(128-n,Rd[t.at(128-n)&i]),o=127-n;o>=0;o--)t.setAt(o,Rd[t.at(o+1)^t.at(o+n)]);return t};var Vy=function(s,e,t){var r=!1,a=null,n=null,i=null,o,l,u,c,f=[];for(s=kr.rc2.expandKey(s,e),u=0;u<64;u++)f.push(s.getInt16Le());t?(o=function(p){for(u=0;u<4;u++)p[u]+=f[c]+(p[(u+3)%4]&p[(u+2)%4])+(~p[(u+3)%4]&p[(u+1)%4]),p[u]=Ow(p[u],cp[u]),c++},l=function(p){for(u=0;u<4;u++)p[u]+=f[p[(u+3)%4]&63]}):(o=function(p){for(u=3;u>=0;u--)p[u]=Pw(p[u],cp[u]),p[u]-=f[c]+(p[(u+3)%4]&p[(u+2)%4])+(~p[(u+3)%4]&p[(u+1)%4]),c--},l=function(p){for(u=3;u>=0;u--)p[u]-=f[p[(u+3)%4]&63]});var g=function(p){var h=[];for(u=0;u<4;u++){var d=a.getInt16Le();i!==null&&(t?d^=i.getInt16Le():i.putInt16Le(d)),h.push(d&65535)}c=t?0:63;for(var y=0;y<p.length;y++)for(var A=0;A<p[y][0];A++)p[y][1](h);for(u=0;u<4;u++)i!==null&&(t?i.putInt16Le(h[u]):h[u]^=i.getInt16Le()),n.putInt16Le(h[u])},v=null;return v={start:function(p,h){p&&typeof p=="string"&&(p=kr.util.createBuffer(p)),r=!1,a=kr.util.createBuffer(),n=h||new kr.util.createBuffer,i=p,v.output=n},update:function(p){for(r||a.putBuffer(p);a.length()>=8;)g([[5,o],[1,l],[6,o],[1,l],[5,o]])},finish:function(p){var h=!0;if(t)if(p)h=p(8,a,!t);else{var d=a.length()===8?8:8-a.length();a.fillWithByte(d,d)}if(h&&(r=!0,v.update()),!t&&(h=a.length()===0,h))if(p)h=p(8,n,!t);else{var y=n.length(),A=n.at(y-1);A>y?h=!1:n.truncate(A)}return h}},v};kr.rc2.startEncrypting=function(s,e,t){var r=kr.rc2.createEncryptionCipher(s,128);return r.start(e,t),r};kr.rc2.createEncryptionCipher=function(s,e){return Vy(s,e,!0)};kr.rc2.startDecrypting=function(s,e,t){var r=kr.rc2.createDecryptionCipher(s,128);return r.start(e,t),r};kr.rc2.createDecryptionCipher=function(s,e){return Vy(s,e,!1)};var bg=Me;bg.jsbn=bg.jsbn||{};var sa;function Y(s,e,t){this.data=[],s!=null&&(typeof s=="number"?this.fromNumber(s,e,t):e==null&&typeof s!="string"?this.fromString(s,256):this.fromString(s,e))}bg.jsbn.BigInteger=Y;function Ze(){return new Y(null)}function Uw(s,e,t,r,a,n){for(;--n>=0;){var i=e*this.data[s++]+t.data[r]+a;a=Math.floor(i/67108864),t.data[r++]=i&67108863}return a}function Mw(s,e,t,r,a,n){for(var i=e&32767,o=e>>15;--n>=0;){var l=this.data[s]&32767,u=this.data[s++]>>15,c=o*l+u*i;l=i*l+((c&32767)<<15)+t.data[r]+(a&1073741823),a=(l>>>30)+(c>>>15)+o*u+(a>>>30),t.data[r++]=l&1073741823}return a}function fp(s,e,t,r,a,n){for(var i=e&16383,o=e>>14;--n>=0;){var l=this.data[s]&16383,u=this.data[s++]>>14,c=o*l+u*i;l=i*l+((c&16383)<<14)+t.data[r]+a,a=(l>>28)+(c>>14)+o*u,t.data[r++]=l&268435455}return a}typeof navigator>"u"?(Y.prototype.am=fp,sa=28):navigator.appName=="Microsoft Internet Explorer"?(Y.prototype.am=Mw,sa=30):navigator.appName!="Netscape"?(Y.prototype.am=Uw,sa=26):(Y.prototype.am=fp,sa=28);Y.prototype.DB=sa;Y.prototype.DM=(1<<sa)-1;Y.prototype.DV=1<<sa;var pm=52;Y.prototype.FV=Math.pow(2,pm);Y.prototype.F1=pm-sa;Y.prototype.F2=2*sa-pm;var Hw="0123456789abcdefghijklmnopqrstuvwxyz",wd=new Array,Iu,Zr;Iu="0".charCodeAt(0);for(Zr=0;Zr<=9;++Zr)wd[Iu++]=Zr;Iu="a".charCodeAt(0);for(Zr=10;Zr<36;++Zr)wd[Iu++]=Zr;Iu="A".charCodeAt(0);for(Zr=10;Zr<36;++Zr)wd[Iu++]=Zr;function hp(s){return Hw.charAt(s)}function $y(s,e){var t=wd[s.charCodeAt(e)];return t==null?-1:t}function Kw(s){for(var e=this.t-1;e>=0;--e)s.data[e]=this.data[e];s.t=this.t,s.s=this.s}function Fw(s){this.t=1,this.s=s<0?-1:0,s>0?this.data[0]=s:s<-1?this.data[0]=s+this.DV:this.t=0}function Sn(s){var e=Ze();return e.fromInt(s),e}function qw(s,e){var t;if(e==16)t=4;else if(e==8)t=3;else if(e==256)t=8;else if(e==2)t=1;else if(e==32)t=5;else if(e==4)t=2;else{this.fromRadix(s,e);return}this.t=0,this.s=0;for(var r=s.length,a=!1,n=0;--r>=0;){var i=t==8?s[r]&255:$y(s,r);if(i<0){s.charAt(r)=="-"&&(a=!0);continue}a=!1,n==0?this.data[this.t++]=i:n+t>this.DB?(this.data[this.t-1]|=(i&(1<<this.DB-n)-1)<<n,this.data[this.t++]=i>>this.DB-n):this.data[this.t-1]|=i<<n,n+=t,n>=this.DB&&(n-=this.DB)}t==8&&(s[0]&128)!=0&&(this.s=-1,n>0&&(this.data[this.t-1]|=(1<<this.DB-n)-1<<n)),this.clamp(),a&&Y.ZERO.subTo(this,this)}function Jw(){for(var s=this.s&this.DM;this.t>0&&this.data[this.t-1]==s;)--this.t}function Gw(s){if(this.s<0)return"-"+this.negate().toString(s);var e;if(s==16)e=4;else if(s==8)e=3;else if(s==2)e=1;else if(s==32)e=5;else if(s==4)e=2;else return this.toRadix(s);var t=(1<<e)-1,r,a=!1,n="",i=this.t,o=this.DB-i*this.DB%e;if(i-- >0)for(o<this.DB&&(r=this.data[i]>>o)>0&&(a=!0,n=hp(r));i>=0;)o<e?(r=(this.data[i]&(1<<o)-1)<<e-o,r|=this.data[--i]>>(o+=this.DB-e)):(r=this.data[i]>>(o-=e)&t,o<=0&&(o+=this.DB,--i)),r>0&&(a=!0),a&&(n+=hp(r));return a?n:"0"}function jw(){var s=Ze();return Y.ZERO.subTo(this,s),s}function Ww(){return this.s<0?this.negate():this}function Qw(s){var e=this.s-s.s;if(e!=0)return e;var t=this.t;if(e=t-s.t,e!=0)return this.s<0?-e:e;for(;--t>=0;)if((e=this.data[t]-s.data[t])!=0)return e;return 0}function Sd(s){var e=1,t;return(t=s>>>16)!=0&&(s=t,e+=16),(t=s>>8)!=0&&(s=t,e+=8),(t=s>>4)!=0&&(s=t,e+=4),(t=s>>2)!=0&&(s=t,e+=2),(t=s>>1)!=0&&(s=t,e+=1),e}function Yw(){return this.t<=0?0:this.DB*(this.t-1)+Sd(this.data[this.t-1]^this.s&this.DM)}function zw(s,e){var t;for(t=this.t-1;t>=0;--t)e.data[t+s]=this.data[t];for(t=s-1;t>=0;--t)e.data[t]=0;e.t=this.t+s,e.s=this.s}function Xw(s,e){for(var t=s;t<this.t;++t)e.data[t-s]=this.data[t];e.t=Math.max(this.t-s,0),e.s=this.s}function Zw(s,e){var t=s%this.DB,r=this.DB-t,a=(1<<r)-1,n=Math.floor(s/this.DB),i=this.s<<t&this.DM,o;for(o=this.t-1;o>=0;--o)e.data[o+n+1]=this.data[o]>>r|i,i=(this.data[o]&a)<<t;for(o=n-1;o>=0;--o)e.data[o]=0;e.data[n]=i,e.t=this.t+n+1,e.s=this.s,e.clamp()}function eS(s,e){e.s=this.s;var t=Math.floor(s/this.DB);if(t>=this.t){e.t=0;return}var r=s%this.DB,a=this.DB-r,n=(1<<r)-1;e.data[0]=this.data[t]>>r;for(var i=t+1;i<this.t;++i)e.data[i-t-1]|=(this.data[i]&n)<<a,e.data[i-t]=this.data[i]>>r;r>0&&(e.data[this.t-t-1]|=(this.s&n)<<a),e.t=this.t-t,e.clamp()}function tS(s,e){for(var t=0,r=0,a=Math.min(s.t,this.t);t<a;)r+=this.data[t]-s.data[t],e.data[t++]=r&this.DM,r>>=this.DB;if(s.t<this.t){for(r-=s.s;t<this.t;)r+=this.data[t],e.data[t++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;t<s.t;)r-=s.data[t],e.data[t++]=r&this.DM,r>>=this.DB;r-=s.s}e.s=r<0?-1:0,r<-1?e.data[t++]=this.DV+r:r>0&&(e.data[t++]=r),e.t=t,e.clamp()}function rS(s,e){var t=this.abs(),r=s.abs(),a=t.t;for(e.t=a+r.t;--a>=0;)e.data[a]=0;for(a=0;a<r.t;++a)e.data[a+t.t]=t.am(0,r.data[a],e,a,0,t.t);e.s=0,e.clamp(),this.s!=s.s&&Y.ZERO.subTo(e,e)}function sS(s){for(var e=this.abs(),t=s.t=2*e.t;--t>=0;)s.data[t]=0;for(t=0;t<e.t-1;++t){var r=e.am(t,e.data[t],s,2*t,0,1);(s.data[t+e.t]+=e.am(t+1,2*e.data[t],s,2*t+1,r,e.t-t-1))>=e.DV&&(s.data[t+e.t]-=e.DV,s.data[t+e.t+1]=1)}s.t>0&&(s.data[s.t-1]+=e.am(t,e.data[t],s,2*t,0,1)),s.s=0,s.clamp()}function aS(s,e,t){var r=s.abs();if(!(r.t<=0)){var a=this.abs();if(a.t<r.t){e!=null&&e.fromInt(0),t!=null&&this.copyTo(t);return}t==null&&(t=Ze());var n=Ze(),i=this.s,o=s.s,l=this.DB-Sd(r.data[r.t-1]);l>0?(r.lShiftTo(l,n),a.lShiftTo(l,t)):(r.copyTo(n),a.copyTo(t));var u=n.t,c=n.data[u-1];if(c!=0){var f=c*(1<<this.F1)+(u>1?n.data[u-2]>>this.F2:0),g=this.FV/f,v=(1<<this.F1)/f,p=1<<this.F2,h=t.t,d=h-u,y=e==null?Ze():e;for(n.dlShiftTo(d,y),t.compareTo(y)>=0&&(t.data[t.t++]=1,t.subTo(y,t)),Y.ONE.dlShiftTo(u,y),y.subTo(n,n);n.t<u;)n.data[n.t++]=0;for(;--d>=0;){var A=t.data[--h]==c?this.DM:Math.floor(t.data[h]*g+(t.data[h-1]+p)*v);if((t.data[h]+=n.am(0,A,t,d,0,u))<A)for(n.dlShiftTo(d,y),t.subTo(y,t);t.data[h]<--A;)t.subTo(y,t)}e!=null&&(t.drShiftTo(u,e),i!=o&&Y.ZERO.subTo(e,e)),t.t=u,t.clamp(),l>0&&t.rShiftTo(l,t),i<0&&Y.ZERO.subTo(t,t)}}}function nS(s){var e=Ze();return this.abs().divRemTo(s,null,e),this.s<0&&e.compareTo(Y.ZERO)>0&&s.subTo(e,e),e}function vo(s){this.m=s}function iS(s){return s.s<0||s.compareTo(this.m)>=0?s.mod(this.m):s}function oS(s){return s}function lS(s){s.divRemTo(this.m,null,s)}function uS(s,e,t){s.multiplyTo(e,t),this.reduce(t)}function cS(s,e){s.squareTo(e),this.reduce(e)}vo.prototype.convert=iS;vo.prototype.revert=oS;vo.prototype.reduce=lS;vo.prototype.mulTo=uS;vo.prototype.sqrTo=cS;function fS(){if(this.t<1)return 0;var s=this.data[0];if((s&1)==0)return 0;var e=s&3;return e=e*(2-(s&15)*e)&15,e=e*(2-(s&255)*e)&255,e=e*(2-((s&65535)*e&65535))&65535,e=e*(2-s*e%this.DV)%this.DV,e>0?this.DV-e:-e}function wo(s){this.m=s,this.mp=s.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<s.DB-15)-1,this.mt2=2*s.t}function hS(s){var e=Ze();return s.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),s.s<0&&e.compareTo(Y.ZERO)>0&&this.m.subTo(e,e),e}function dS(s){var e=Ze();return s.copyTo(e),this.reduce(e),e}function gS(s){for(;s.t<=this.mt2;)s.data[s.t++]=0;for(var e=0;e<this.m.t;++e){var t=s.data[e]&32767,r=t*this.mpl+((t*this.mph+(s.data[e]>>15)*this.mpl&this.um)<<15)&s.DM;for(t=e+this.m.t,s.data[t]+=this.m.am(0,r,s,e,0,this.m.t);s.data[t]>=s.DV;)s.data[t]-=s.DV,s.data[++t]++}s.clamp(),s.drShiftTo(this.m.t,s),s.compareTo(this.m)>=0&&s.subTo(this.m,s)}function mS(s,e){s.squareTo(e),this.reduce(e)}function pS(s,e,t){s.multiplyTo(e,t),this.reduce(t)}wo.prototype.convert=hS;wo.prototype.revert=dS;wo.prototype.reduce=gS;wo.prototype.mulTo=pS;wo.prototype.sqrTo=mS;function yS(){return(this.t>0?this.data[0]&1:this.s)==0}function vS(s,e){if(s>4294967295||s<1)return Y.ONE;var t=Ze(),r=Ze(),a=e.convert(this),n=Sd(s)-1;for(a.copyTo(t);--n>=0;)if(e.sqrTo(t,r),(s&1<<n)>0)e.mulTo(r,a,t);else{var i=t;t=r,r=i}return e.revert(t)}function wS(s,e){var t;return s<256||e.isEven()?t=new vo(e):t=new wo(e),this.exp(s,t)}Y.prototype.copyTo=Kw;Y.prototype.fromInt=Fw;Y.prototype.fromString=qw;Y.prototype.clamp=Jw;Y.prototype.dlShiftTo=zw;Y.prototype.drShiftTo=Xw;Y.prototype.lShiftTo=Zw;Y.prototype.rShiftTo=eS;Y.prototype.subTo=tS;Y.prototype.multiplyTo=rS;Y.prototype.squareTo=sS;Y.prototype.divRemTo=aS;Y.prototype.invDigit=fS;Y.prototype.isEven=yS;Y.prototype.exp=vS;Y.prototype.toString=Gw;Y.prototype.negate=jw;Y.prototype.abs=Ww;Y.prototype.compareTo=Qw;Y.prototype.bitLength=Yw;Y.prototype.mod=nS;Y.prototype.modPowInt=wS;Y.ZERO=Sn(0);Y.ONE=Sn(1);function SS(){var s=Ze();return this.copyTo(s),s}function CS(){if(this.s<0){if(this.t==1)return this.data[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this.data[0];if(this.t==0)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function AS(){return this.t==0?this.s:this.data[0]<<24>>24}function bS(){return this.t==0?this.s:this.data[0]<<16>>16}function ES(s){return Math.floor(Math.LN2*this.DB/Math.log(s))}function xS(){return this.s<0?-1:this.t<=0||this.t==1&&this.data[0]<=0?0:1}function BS(s){if(s==null&&(s=10),this.signum()==0||s<2||s>36)return"0";var e=this.chunkSize(s),t=Math.pow(s,e),r=Sn(t),a=Ze(),n=Ze(),i="";for(this.divRemTo(r,a,n);a.signum()>0;)i=(t+n.intValue()).toString(s).substr(1)+i,a.divRemTo(r,a,n);return n.intValue().toString(s)+i}function IS(s,e){this.fromInt(0),e==null&&(e=10);for(var t=this.chunkSize(e),r=Math.pow(e,t),a=!1,n=0,i=0,o=0;o<s.length;++o){var l=$y(s,o);if(l<0){s.charAt(o)=="-"&&this.signum()==0&&(a=!0);continue}i=e*i+l,++n>=t&&(this.dMultiply(r),this.dAddOffset(i,0),n=0,i=0)}n>0&&(this.dMultiply(Math.pow(e,n)),this.dAddOffset(i,0)),a&&Y.ZERO.subTo(this,this)}function kS(s,e,t){if(typeof e=="number")if(s<2)this.fromInt(1);else for(this.fromNumber(s,t),this.testBit(s-1)||this.bitwiseTo(Y.ONE.shiftLeft(s-1),ym,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>s&&this.subTo(Y.ONE.shiftLeft(s-1),this);else{var r=new Array,a=s&7;r.length=(s>>3)+1,e.nextBytes(r),a>0?r[0]&=(1<<a)-1:r[0]=0,this.fromString(r,256)}}function NS(){var s=this.t,e=new Array;e[0]=this.s;var t=this.DB-s*this.DB%8,r,a=0;if(s-- >0)for(t<this.DB&&(r=this.data[s]>>t)!=(this.s&this.DM)>>t&&(e[a++]=r|this.s<<this.DB-t);s>=0;)t<8?(r=(this.data[s]&(1<<t)-1)<<8-t,r|=this.data[--s]>>(t+=this.DB-8)):(r=this.data[s]>>(t-=8)&255,t<=0&&(t+=this.DB,--s)),(r&128)!=0&&(r|=-256),a==0&&(this.s&128)!=(r&128)&&++a,(a>0||r!=this.s)&&(e[a++]=r);return e}function TS(s){return this.compareTo(s)==0}function _S(s){return this.compareTo(s)<0?this:s}function RS(s){return this.compareTo(s)>0?this:s}function VS(s,e,t){var r,a,n=Math.min(s.t,this.t);for(r=0;r<n;++r)t.data[r]=e(this.data[r],s.data[r]);if(s.t<this.t){for(a=s.s&this.DM,r=n;r<this.t;++r)t.data[r]=e(this.data[r],a);t.t=this.t}else{for(a=this.s&this.DM,r=n;r<s.t;++r)t.data[r]=e(a,s.data[r]);t.t=s.t}t.s=e(this.s,s.s),t.clamp()}function $S(s,e){return s&e}function DS(s){var e=Ze();return this.bitwiseTo(s,$S,e),e}function ym(s,e){return s|e}function LS(s){var e=Ze();return this.bitwiseTo(s,ym,e),e}function Dy(s,e){return s^e}function OS(s){var e=Ze();return this.bitwiseTo(s,Dy,e),e}function Ly(s,e){return s&~e}function PS(s){var e=Ze();return this.bitwiseTo(s,Ly,e),e}function US(){for(var s=Ze(),e=0;e<this.t;++e)s.data[e]=this.DM&~this.data[e];return s.t=this.t,s.s=~this.s,s}function MS(s){var e=Ze();return s<0?this.rShiftTo(-s,e):this.lShiftTo(s,e),e}function HS(s){var e=Ze();return s<0?this.lShiftTo(-s,e):this.rShiftTo(s,e),e}function KS(s){if(s==0)return-1;var e=0;return(s&65535)==0&&(s>>=16,e+=16),(s&255)==0&&(s>>=8,e+=8),(s&15)==0&&(s>>=4,e+=4),(s&3)==0&&(s>>=2,e+=2),(s&1)==0&&++e,e}function FS(){for(var s=0;s<this.t;++s)if(this.data[s]!=0)return s*this.DB+KS(this.data[s]);return this.s<0?this.t*this.DB:-1}function qS(s){for(var e=0;s!=0;)s&=s-1,++e;return e}function JS(){for(var s=0,e=this.s&this.DM,t=0;t<this.t;++t)s+=qS(this.data[t]^e);return s}function GS(s){var e=Math.floor(s/this.DB);return e>=this.t?this.s!=0:(this.data[e]&1<<s%this.DB)!=0}function jS(s,e){var t=Y.ONE.shiftLeft(s);return this.bitwiseTo(t,e,t),t}function WS(s){return this.changeBit(s,ym)}function QS(s){return this.changeBit(s,Ly)}function YS(s){return this.changeBit(s,Dy)}function zS(s,e){for(var t=0,r=0,a=Math.min(s.t,this.t);t<a;)r+=this.data[t]+s.data[t],e.data[t++]=r&this.DM,r>>=this.DB;if(s.t<this.t){for(r+=s.s;t<this.t;)r+=this.data[t],e.data[t++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;t<s.t;)r+=s.data[t],e.data[t++]=r&this.DM,r>>=this.DB;r+=s.s}e.s=r<0?-1:0,r>0?e.data[t++]=r:r<-1&&(e.data[t++]=this.DV+r),e.t=t,e.clamp()}function XS(s){var e=Ze();return this.addTo(s,e),e}function ZS(s){var e=Ze();return this.subTo(s,e),e}function eC(s){var e=Ze();return this.multiplyTo(s,e),e}function tC(s){var e=Ze();return this.divRemTo(s,e,null),e}function rC(s){var e=Ze();return this.divRemTo(s,null,e),e}function sC(s){var e=Ze(),t=Ze();return this.divRemTo(s,e,t),new Array(e,t)}function aC(s){this.data[this.t]=this.am(0,s-1,this,0,0,this.t),++this.t,this.clamp()}function nC(s,e){if(s!=0){for(;this.t<=e;)this.data[this.t++]=0;for(this.data[e]+=s;this.data[e]>=this.DV;)this.data[e]-=this.DV,++e>=this.t&&(this.data[this.t++]=0),++this.data[e]}}function wh(){}function Oy(s){return s}function iC(s,e,t){s.multiplyTo(e,t)}function oC(s,e){s.squareTo(e)}wh.prototype.convert=Oy;wh.prototype.revert=Oy;wh.prototype.mulTo=iC;wh.prototype.sqrTo=oC;function lC(s){return this.exp(s,new wh)}function uC(s,e,t){var r=Math.min(this.t+s.t,e);for(t.s=0,t.t=r;r>0;)t.data[--r]=0;var a;for(a=t.t-this.t;r<a;++r)t.data[r+this.t]=this.am(0,s.data[r],t,r,0,this.t);for(a=Math.min(s.t,e);r<a;++r)this.am(0,s.data[r],t,r,0,e-r);t.clamp()}function cC(s,e,t){--e;var r=t.t=this.t+s.t-e;for(t.s=0;--r>=0;)t.data[r]=0;for(r=Math.max(e-this.t,0);r<s.t;++r)t.data[this.t+r-e]=this.am(e-r,s.data[r],t,0,0,this.t+r-e);t.clamp(),t.drShiftTo(1,t)}function ku(s){this.r2=Ze(),this.q3=Ze(),Y.ONE.dlShiftTo(2*s.t,this.r2),this.mu=this.r2.divide(s),this.m=s}function fC(s){if(s.s<0||s.t>2*this.m.t)return s.mod(this.m);if(s.compareTo(this.m)<0)return s;var e=Ze();return s.copyTo(e),this.reduce(e),e}function hC(s){return s}function dC(s){for(s.drShiftTo(this.m.t-1,this.r2),s.t>this.m.t+1&&(s.t=this.m.t+1,s.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);s.compareTo(this.r2)<0;)s.dAddOffset(1,this.m.t+1);for(s.subTo(this.r2,s);s.compareTo(this.m)>=0;)s.subTo(this.m,s)}function gC(s,e){s.squareTo(e),this.reduce(e)}function mC(s,e,t){s.multiplyTo(e,t),this.reduce(t)}ku.prototype.convert=fC;ku.prototype.revert=hC;ku.prototype.reduce=dC;ku.prototype.mulTo=mC;ku.prototype.sqrTo=gC;function pC(s,e){var t=s.bitLength(),r,a=Sn(1),n;if(t<=0)return a;t<18?r=1:t<48?r=3:t<144?r=4:t<768?r=5:r=6,t<8?n=new vo(e):e.isEven()?n=new ku(e):n=new wo(e);var i=new Array,o=3,l=r-1,u=(1<<r)-1;if(i[1]=n.convert(this),r>1){var c=Ze();for(n.sqrTo(i[1],c);o<=u;)i[o]=Ze(),n.mulTo(c,i[o-2],i[o]),o+=2}var f=s.t-1,g,v=!0,p=Ze(),h;for(t=Sd(s.data[f])-1;f>=0;){for(t>=l?g=s.data[f]>>t-l&u:(g=(s.data[f]&(1<<t+1)-1)<<l-t,f>0&&(g|=s.data[f-1]>>this.DB+t-l)),o=r;(g&1)==0;)g>>=1,--o;if((t-=o)<0&&(t+=this.DB,--f),v)i[g].copyTo(a),v=!1;else{for(;o>1;)n.sqrTo(a,p),n.sqrTo(p,a),o-=2;o>0?n.sqrTo(a,p):(h=a,a=p,p=h),n.mulTo(p,i[g],a)}for(;f>=0&&(s.data[f]&1<<t)==0;)n.sqrTo(a,p),h=a,a=p,p=h,--t<0&&(t=this.DB-1,--f)}return n.revert(a)}function yC(s){var e=this.s<0?this.negate():this.clone(),t=s.s<0?s.negate():s.clone();if(e.compareTo(t)<0){var r=e;e=t,t=r}var a=e.getLowestSetBit(),n=t.getLowestSetBit();if(n<0)return e;for(a<n&&(n=a),n>0&&(e.rShiftTo(n,e),t.rShiftTo(n,t));e.signum()>0;)(a=e.getLowestSetBit())>0&&e.rShiftTo(a,e),(a=t.getLowestSetBit())>0&&t.rShiftTo(a,t),e.compareTo(t)>=0?(e.subTo(t,e),e.rShiftTo(1,e)):(t.subTo(e,t),t.rShiftTo(1,t));return n>0&&t.lShiftTo(n,t),t}function vC(s){if(s<=0)return 0;var e=this.DV%s,t=this.s<0?s-1:0;if(this.t>0)if(e==0)t=this.data[0]%s;else for(var r=this.t-1;r>=0;--r)t=(e*t+this.data[r])%s;return t}function wC(s){var e=s.isEven();if(this.isEven()&&e||s.signum()==0)return Y.ZERO;for(var t=s.clone(),r=this.clone(),a=Sn(1),n=Sn(0),i=Sn(0),o=Sn(1);t.signum()!=0;){for(;t.isEven();)t.rShiftTo(1,t),e?((!a.isEven()||!n.isEven())&&(a.addTo(this,a),n.subTo(s,n)),a.rShiftTo(1,a)):n.isEven()||n.subTo(s,n),n.rShiftTo(1,n);for(;r.isEven();)r.rShiftTo(1,r),e?((!i.isEven()||!o.isEven())&&(i.addTo(this,i),o.subTo(s,o)),i.rShiftTo(1,i)):o.isEven()||o.subTo(s,o),o.rShiftTo(1,o);t.compareTo(r)>=0?(t.subTo(r,t),e&&a.subTo(i,a),n.subTo(o,n)):(r.subTo(t,r),e&&i.subTo(a,i),o.subTo(n,o))}if(r.compareTo(Y.ONE)!=0)return Y.ZERO;if(o.compareTo(s)>=0)return o.subtract(s);if(o.signum()<0)o.addTo(s,o);else return o;return o.signum()<0?o.add(s):o}var is=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],SC=(1<<26)/is[is.length-1];function CC(s){var e,t=this.abs();if(t.t==1&&t.data[0]<=is[is.length-1]){for(e=0;e<is.length;++e)if(t.data[0]==is[e])return!0;return!1}if(t.isEven())return!1;for(e=1;e<is.length;){for(var r=is[e],a=e+1;a<is.length&&r<SC;)r*=is[a++];for(r=t.modInt(r);e<a;)if(r%is[e++]==0)return!1}return t.millerRabin(s)}function AC(s){var e=this.subtract(Y.ONE),t=e.getLowestSetBit();if(t<=0)return!1;for(var r=e.shiftRight(t),a=bC(),n,i=0;i<s;++i){do n=new Y(this.bitLength(),a);while(n.compareTo(Y.ONE)<=0||n.compareTo(e)>=0);var o=n.modPow(r,this);if(o.compareTo(Y.ONE)!=0&&o.compareTo(e)!=0){for(var l=1;l++<t&&o.compareTo(e)!=0;)if(o=o.modPowInt(2,this),o.compareTo(Y.ONE)==0)return!1;if(o.compareTo(e)!=0)return!1}}return!0}function bC(){return{nextBytes:function(s){for(var e=0;e<s.length;++e)s[e]=Math.floor(Math.random()*256)}}}Y.prototype.chunkSize=ES;Y.prototype.toRadix=BS;Y.prototype.fromRadix=IS;Y.prototype.fromNumber=kS;Y.prototype.bitwiseTo=VS;Y.prototype.changeBit=jS;Y.prototype.addTo=zS;Y.prototype.dMultiply=aC;Y.prototype.dAddOffset=nC;Y.prototype.multiplyLowerTo=uC;Y.prototype.multiplyUpperTo=cC;Y.prototype.modInt=vC;Y.prototype.millerRabin=AC;Y.prototype.clone=SS;Y.prototype.intValue=CS;Y.prototype.byteValue=AS;Y.prototype.shortValue=bS;Y.prototype.signum=xS;Y.prototype.toByteArray=NS;Y.prototype.equals=TS;Y.prototype.min=_S;Y.prototype.max=RS;Y.prototype.and=DS;Y.prototype.or=LS;Y.prototype.xor=OS;Y.prototype.andNot=PS;Y.prototype.not=US;Y.prototype.shiftLeft=MS;Y.prototype.shiftRight=HS;Y.prototype.getLowestSetBit=FS;Y.prototype.bitCount=JS;Y.prototype.testBit=GS;Y.prototype.setBit=WS;Y.prototype.clearBit=QS;Y.prototype.flipBit=YS;Y.prototype.add=XS;Y.prototype.subtract=ZS;Y.prototype.multiply=eC;Y.prototype.divide=tC;Y.prototype.remainder=rC;Y.prototype.divideAndRemainder=sC;Y.prototype.modPow=pC;Y.prototype.modInverse=wC;Y.prototype.pow=lC;Y.prototype.gcd=yC;Y.prototype.isProbablePrime=CC;var ks=Me,Py=ks.sha1=ks.sha1||{};ks.md.sha1=ks.md.algorithms.sha1=Py;Py.create=function(){Uy||EC();var s=null,e=ks.util.createBuffer(),t=new Array(80),r={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8};return r.start=function(){r.messageLength=0,r.fullMessageLength=r.messageLength64=[];for(var a=r.messageLengthSize/4,n=0;n<a;++n)r.fullMessageLength.push(0);return e=ks.util.createBuffer(),s={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},r},r.start(),r.update=function(a,n){n==="utf8"&&(a=ks.util.encodeUtf8(a));var i=a.length;r.messageLength+=i,i=[i/4294967296>>>0,i>>>0];for(var o=r.fullMessageLength.length-1;o>=0;--o)r.fullMessageLength[o]+=i[1],i[1]=i[0]+(r.fullMessageLength[o]/4294967296>>>0),r.fullMessageLength[o]=r.fullMessageLength[o]>>>0,i[0]=i[1]/4294967296>>>0;return e.putBytes(a),dp(s,t,e),(e.read>2048||e.length()===0)&&e.compact(),r},r.digest=function(){var a=ks.util.createBuffer();a.putBytes(e.bytes());var n=r.fullMessageLength[r.fullMessageLength.length-1]+r.messageLengthSize,i=n&r.blockLength-1;a.putBytes(Eg.substr(0,r.blockLength-i));for(var o,l,u=r.fullMessageLength[0]*8,c=0;c<r.fullMessageLength.length-1;++c)o=r.fullMessageLength[c+1]*8,l=o/4294967296>>>0,u+=l,a.putInt32(u>>>0),u=o>>>0;a.putInt32(u);var f={h0:s.h0,h1:s.h1,h2:s.h2,h3:s.h3,h4:s.h4};dp(f,t,a);var g=ks.util.createBuffer();return g.putInt32(f.h0),g.putInt32(f.h1),g.putInt32(f.h2),g.putInt32(f.h3),g.putInt32(f.h4),g},r};var Eg=null,Uy=!1;function EC(){Eg=String.fromCharCode(128),Eg+=ks.util.fillString(String.fromCharCode(0),64),Uy=!0}function dp(s,e,t){for(var r,a,n,i,o,l,u,c,f=t.length();f>=64;){for(a=s.h0,n=s.h1,i=s.h2,o=s.h3,l=s.h4,c=0;c<16;++c)r=t.getInt32(),e[c]=r,u=o^n&(i^o),r=(a<<5|a>>>27)+u+l+1518500249+r,l=o,o=i,i=(n<<30|n>>>2)>>>0,n=a,a=r;for(;c<20;++c)r=e[c-3]^e[c-8]^e[c-14]^e[c-16],r=r<<1|r>>>31,e[c]=r,u=o^n&(i^o),r=(a<<5|a>>>27)+u+l+1518500249+r,l=o,o=i,i=(n<<30|n>>>2)>>>0,n=a,a=r;for(;c<32;++c)r=e[c-3]^e[c-8]^e[c-14]^e[c-16],r=r<<1|r>>>31,e[c]=r,u=n^i^o,r=(a<<5|a>>>27)+u+l+1859775393+r,l=o,o=i,i=(n<<30|n>>>2)>>>0,n=a,a=r;for(;c<40;++c)r=e[c-6]^e[c-16]^e[c-28]^e[c-32],r=r<<2|r>>>30,e[c]=r,u=n^i^o,r=(a<<5|a>>>27)+u+l+1859775393+r,l=o,o=i,i=(n<<30|n>>>2)>>>0,n=a,a=r;for(;c<60;++c)r=e[c-6]^e[c-16]^e[c-28]^e[c-32],r=r<<2|r>>>30,e[c]=r,u=n&i|o&(n^i),r=(a<<5|a>>>27)+u+l+2400959708+r,l=o,o=i,i=(n<<30|n>>>2)>>>0,n=a,a=r;for(;c<80;++c)r=e[c-6]^e[c-16]^e[c-28]^e[c-32],r=r<<2|r>>>30,e[c]=r,u=n^i^o,r=(a<<5|a>>>27)+u+l+3395469782+r,l=o,o=i,i=(n<<30|n>>>2)>>>0,n=a,a=r;s.h0=s.h0+a|0,s.h1=s.h1+n|0,s.h2=s.h2+i|0,s.h3=s.h3+o|0,s.h4=s.h4+l|0,f-=64}}var Ts=Me,My=Ts.pkcs1=Ts.pkcs1||{};My.encode_rsa_oaep=function(s,e,t){var r,a,n,i;typeof t=="string"?(r=t,a=arguments[3]||void 0,n=arguments[4]||void 0):t&&(r=t.label||void 0,a=t.seed||void 0,n=t.md||void 0,t.mgf1&&t.mgf1.md&&(i=t.mgf1.md)),n?n.start():n=Ts.md.sha1.create(),i||(i=n);var o=Math.ceil(s.n.bitLength()/8),l=o-2*n.digestLength-2;if(e.length>l){var u=new Error("RSAES-OAEP input message length is too long.");throw u.length=e.length,u.maxLength=l,u}r||(r=""),n.update(r,"raw");for(var c=n.digest(),f="",g=l-e.length,v=0;v<g;v++)f+="\0";var p=c.getBytes()+f+""+e;if(!a)a=Ts.random.getBytes(n.digestLength);else if(a.length!==n.digestLength){var u=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw u.seedLength=a.length,u.digestLength=n.digestLength,u}var h=M0(a,o-n.digestLength-1,i),d=Ts.util.xorBytes(p,h,p.length),y=M0(d,n.digestLength,i),A=Ts.util.xorBytes(a,y,a.length);return"\0"+A+d};My.decode_rsa_oaep=function(s,e,t){var r,a,n;typeof t=="string"?(r=t,a=arguments[3]||void 0):t&&(r=t.label||void 0,a=t.md||void 0,t.mgf1&&t.mgf1.md&&(n=t.mgf1.md));var i=Math.ceil(s.n.bitLength()/8);if(e.length!==i){var d=new Error("RSAES-OAEP encoded message length is invalid.");throw d.length=e.length,d.expectedLength=i,d}if(a===void 0?a=Ts.md.sha1.create():a.start(),n||(n=a),i<2*a.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");r||(r=""),a.update(r,"raw");for(var o=a.digest().getBytes(),l=e.charAt(0),u=e.substring(1,a.digestLength+1),c=e.substring(1+a.digestLength),f=M0(c,a.digestLength,n),g=Ts.util.xorBytes(u,f,u.length),v=M0(g,i-a.digestLength-1,n),p=Ts.util.xorBytes(c,v,c.length),h=p.substring(0,a.digestLength),d=l!=="\0",y=0;y<a.digestLength;++y)d|=o.charAt(y)!==h.charAt(y);for(var A=1,x=a.digestLength,N=a.digestLength;N<p.length;N++){var _=p.charCodeAt(N),$=_&1^1,se=A?65534:0;d|=_&se,A=A&$,x+=A}if(d||p.charCodeAt(x)!==1)throw new Error("Invalid RSAES-OAEP padding.");return p.substring(x+1)};function M0(s,e,t){t||(t=Ts.md.sha1.create());for(var r="",a=Math.ceil(e/t.digestLength),n=0;n<a;++n){var i=String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255);t.start(),t.update(s+i),r+=t.digest().getBytes()}return r.substring(0,e)}var Sa=Me;(function(){if(Sa.prime){Sa.prime;return}var s=Sa.prime=Sa.prime||{},e=Sa.jsbn.BigInteger,t=[6,4,2,4,2,4,6,2],r=new e(null);r.fromInt(30);var a=function(f,g){return f|g};s.generateProbablePrime=function(f,g,v){typeof g=="function"&&(v=g,g={}),g=g||{};var p=g.algorithm||"PRIMEINC";typeof p=="string"&&(p={name:p}),p.options=p.options||{};var h=g.prng||Sa.random,d={nextBytes:function(y){for(var A=h.getBytesSync(y.length),x=0;x<y.length;++x)y[x]=A.charCodeAt(x)}};if(p.name==="PRIMEINC")return n(f,d,p.options,v);throw new Error("Invalid prime generation algorithm: "+p.name)};function n(f,g,v,p){return"workers"in v?l(f,g,v,p):i(f,g,v,p)}function i(f,g,v,p){var h=u(f,g),d=0,y=c(h.bitLength());"millerRabinTests"in v&&(y=v.millerRabinTests);var A=10;"maxBlockTime"in v&&(A=v.maxBlockTime),o(h,f,g,d,y,A,p)}function o(f,g,v,p,h,d,y){var A=+new Date;do{if(f.bitLength()>g&&(f=u(g,v)),f.isProbablePrime(h))return y(null,f);f.dAddOffset(t[p++%8],0)}while(d<0||+new Date-A<d);Sa.util.setImmediate(function(){o(f,g,v,p,h,d,y)})}function l(f,g,v,p){if(typeof Worker>"u")return i(f,g,v,p);var h=u(f,g),d=v.workers,y=v.workLoad||100,A=y*30/8,x=v.workerScript||"forge/prime.worker.js";if(d===-1)return Sa.util.estimateCores(function(_,$){_&&($=2),d=$-1,N()});N();function N(){d=Math.max(1,d);for(var _=[],$=0;$<d;++$)_[$]=new Worker(x);for(var $=0;$<d;++$)_[$].addEventListener("message",te);var se=!1;function te(me){if(!se){var Ce=me.data;if(Ce.found){for(var pe=0;pe<_.length;++pe)_[pe].terminate();return se=!0,p(null,new e(Ce.prime,16))}h.bitLength()>f&&(h=u(f,g));var ve=h.toString(16);me.target.postMessage({hex:ve,workLoad:y}),h.dAddOffset(A,0)}}}}function u(f,g){var v=new e(f,g),p=f-1;return v.testBit(p)||v.bitwiseTo(e.ONE.shiftLeft(p),a,v),v.dAddOffset(31-v.mod(r).byteValue(),0),v}function c(f){return f<=100?27:f<=150?18:f<=200?15:f<=250?12:f<=300?9:f<=350?8:f<=400?7:f<=500?6:f<=600?5:f<=800?4:f<=1250?3:2}})();var xe=Me;if(typeof Xe>"u")var Xe=xe.jsbn.BigInteger;var xg=xe.util.isNodejs?mm:null,R=xe.asn1,es=xe.util;xe.pki=xe.pki||{};xe.pki.rsa=xe.rsa=xe.rsa||{};var De=xe.pki,xC=[6,4,2,4,2,4,6,2],BC={name:"PrivateKeyInfo",tagClass:R.Class.UNIVERSAL,type:R.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:R.Class.UNIVERSAL,type:R.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:R.Class.UNIVERSAL,type:R.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:R.Class.UNIVERSAL,type:R.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:R.Class.UNIVERSAL,type:R.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},IC={name:"RSAPrivateKey",tagClass:R.Class.UNIVERSAL,type:R.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:R.Class.UNIVERSAL,type:R.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:R.Class.UNIVERSAL,type:R.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:R.Class.UNIVERSAL,type:R.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:R.Class.UNIVERSAL,type:R.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:R.Class.UNIVERSAL,type:R.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:R.Class.UNIVERSAL,type:R.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:R.Class.UNIVERSAL,type:R.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:R.Class.UNIVERSAL,type:R.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:R.Class.UNIVERSAL,type:R.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},kC={name:"RSAPublicKey",tagClass:R.Class.UNIVERSAL,type:R.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:R.Class.UNIVERSAL,type:R.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:R.Class.UNIVERSAL,type:R.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},NC=xe.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:R.Class.UNIVERSAL,type:R.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:R.Class.UNIVERSAL,type:R.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:R.Class.UNIVERSAL,type:R.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:R.Class.UNIVERSAL,type:R.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:R.Class.UNIVERSAL,type:R.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},TC={name:"DigestInfo",tagClass:R.Class.UNIVERSAL,type:R.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:R.Class.UNIVERSAL,type:R.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:R.Class.UNIVERSAL,type:R.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:R.Class.UNIVERSAL,type:R.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:R.Class.UNIVERSAL,type:R.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},_C=function(s){var e;if(s.algorithm in De.oids)e=De.oids[s.algorithm];else{var t=new Error("Unknown message digest algorithm.");throw t.algorithm=s.algorithm,t}var r=R.oidToDer(e).getBytes(),a=R.create(R.Class.UNIVERSAL,R.Type.SEQUENCE,!0,[]),n=R.create(R.Class.UNIVERSAL,R.Type.SEQUENCE,!0,[]);n.value.push(R.create(R.Class.UNIVERSAL,R.Type.OID,!1,r)),n.value.push(R.create(R.Class.UNIVERSAL,R.Type.NULL,!1,""));var i=R.create(R.Class.UNIVERSAL,R.Type.OCTETSTRING,!1,s.digest().getBytes());return a.value.push(n),a.value.push(i),R.toDer(a).getBytes()},Hy=function(s,e,t){if(t)return s.modPow(e.e,e.n);if(!e.p||!e.q)return s.modPow(e.d,e.n);e.dP||(e.dP=e.d.mod(e.p.subtract(Xe.ONE))),e.dQ||(e.dQ=e.d.mod(e.q.subtract(Xe.ONE))),e.qInv||(e.qInv=e.q.modInverse(e.p));var r;do r=new Xe(xe.util.bytesToHex(xe.random.getBytes(e.n.bitLength()/8)),16);while(r.compareTo(e.n)>=0||!r.gcd(e.n).equals(Xe.ONE));s=s.multiply(r.modPow(e.e,e.n)).mod(e.n);for(var a=s.mod(e.p).modPow(e.dP,e.p),n=s.mod(e.q).modPow(e.dQ,e.q);a.compareTo(n)<0;)a=a.add(e.p);var i=a.subtract(n).multiply(e.qInv).mod(e.p).multiply(e.q).add(n);return i=i.multiply(r.modInverse(e.n)).mod(e.n),i};De.rsa.encrypt=function(s,e,t){var r=t,a,n=Math.ceil(e.n.bitLength()/8);t!==!1&&t!==!0?(r=t===2,a=Ky(s,e,t)):(a=xe.util.createBuffer(),a.putBytes(s));for(var i=new Xe(a.toHex(),16),o=Hy(i,e,r),l=o.toString(16),u=xe.util.createBuffer(),c=n-Math.ceil(l.length/2);c>0;)u.putByte(0),--c;return u.putBytes(xe.util.hexToBytes(l)),u.getBytes()};De.rsa.decrypt=function(s,e,t,r){var a=Math.ceil(e.n.bitLength()/8);if(s.length!==a){var n=new Error("Encrypted message length is invalid.");throw n.length=s.length,n.expected=a,n}var i=new Xe(xe.util.createBuffer(s).toHex(),16);if(i.compareTo(e.n)>=0)throw new Error("Encrypted message is invalid.");for(var o=Hy(i,e,t),l=o.toString(16),u=xe.util.createBuffer(),c=a-Math.ceil(l.length/2);c>0;)u.putByte(0),--c;return u.putBytes(xe.util.hexToBytes(l)),r!==!1?H0(u.getBytes(),e,t):u.getBytes()};De.rsa.createKeyPairGenerationState=function(s,e,t){typeof s=="string"&&(s=parseInt(s,10)),s=s||2048,t=t||{};var r=t.prng||xe.random,a={nextBytes:function(o){for(var l=r.getBytesSync(o.length),u=0;u<o.length;++u)o[u]=l.charCodeAt(u)}},n=t.algorithm||"PRIMEINC",i;if(n==="PRIMEINC")i={algorithm:n,state:0,bits:s,rng:a,eInt:e||65537,e:new Xe(null),p:null,q:null,qBits:s>>1,pBits:s-(s>>1),pqState:0,num:null,keys:null},i.e.fromInt(i.eInt);else throw new Error("Invalid key generation algorithm: "+n);return i};De.rsa.stepKeyPairGenerationState=function(s,e){"algorithm"in s||(s.algorithm="PRIMEINC");var t=new Xe(null);t.fromInt(30);for(var r=0,a=function(f,g){return f|g},n=+new Date,i,o=0;s.keys===null&&(e<=0||o<e);){if(s.state===0){var l=s.p===null?s.pBits:s.qBits,u=l-1;s.pqState===0?(s.num=new Xe(l,s.rng),s.num.testBit(u)||s.num.bitwiseTo(Xe.ONE.shiftLeft(u),a,s.num),s.num.dAddOffset(31-s.num.mod(t).byteValue(),0),r=0,++s.pqState):s.pqState===1?s.num.bitLength()>l?s.pqState=0:s.num.isProbablePrime(VC(s.num.bitLength()))?++s.pqState:s.num.dAddOffset(xC[r++%8],0):s.pqState===2?s.pqState=s.num.subtract(Xe.ONE).gcd(s.e).compareTo(Xe.ONE)===0?3:0:s.pqState===3&&(s.pqState=0,s.p===null?s.p=s.num:s.q=s.num,s.p!==null&&s.q!==null&&++s.state,s.num=null)}else if(s.state===1)s.p.compareTo(s.q)<0&&(s.num=s.p,s.p=s.q,s.q=s.num),++s.state;else if(s.state===2)s.p1=s.p.subtract(Xe.ONE),s.q1=s.q.subtract(Xe.ONE),s.phi=s.p1.multiply(s.q1),++s.state;else if(s.state===3)s.phi.gcd(s.e).compareTo(Xe.ONE)===0?++s.state:(s.p=null,s.q=null,s.state=0);else if(s.state===4)s.n=s.p.multiply(s.q),s.n.bitLength()===s.bits?++s.state:(s.q=null,s.state=0);else if(s.state===5){var c=s.e.modInverse(s.phi);s.keys={privateKey:De.rsa.setPrivateKey(s.n,s.e,c,s.p,s.q,c.mod(s.p1),c.mod(s.q1),s.q.modInverse(s.p)),publicKey:De.rsa.setPublicKey(s.n,s.e)}}i=+new Date,o+=i-n,n=i}return s.keys!==null};De.rsa.generateKeyPair=function(s,e,t,r){if(arguments.length===1?typeof s=="object"?(t=s,s=void 0):typeof s=="function"&&(r=s,s=void 0):arguments.length===2?typeof s=="number"?typeof e=="function"?(r=e,e=void 0):typeof e!="number"&&(t=e,e=void 0):(t=s,r=e,s=void 0,e=void 0):arguments.length===3&&(typeof e=="number"?typeof t=="function"&&(r=t,t=void 0):(r=t,t=e,e=void 0)),t=t||{},s===void 0&&(s=t.bits||2048),e===void 0&&(e=t.e||65537),!xe.options.usePureJavaScript&&!t.prng&&s>=256&&s<=16384&&(e===65537||e===3)){if(r){if(gp("generateKeyPair"))return xg.generateKeyPair("rsa",{modulusLength:s,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},function(o,l,u){if(o)return r(o);r(null,{privateKey:De.privateKeyFromPem(u),publicKey:De.publicKeyFromPem(l)})});if(mp("generateKey")&&mp("exportKey"))return es.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:s,publicExponent:yp(e),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(o){return es.globalScope.crypto.subtle.exportKey("pkcs8",o.privateKey)}).then(void 0,function(o){r(o)}).then(function(o){if(o){var l=De.privateKeyFromAsn1(R.fromDer(xe.util.createBuffer(o)));r(null,{privateKey:l,publicKey:De.setRsaPublicKey(l.n,l.e)})}});if(pp("generateKey")&&pp("exportKey")){var a=es.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:s,publicExponent:yp(e),hash:{name:"SHA-256"}},!0,["sign","verify"]);a.oncomplete=function(o){var l=o.target.result,u=es.globalScope.msCrypto.subtle.exportKey("pkcs8",l.privateKey);u.oncomplete=function(c){var f=c.target.result,g=De.privateKeyFromAsn1(R.fromDer(xe.util.createBuffer(f)));r(null,{privateKey:g,publicKey:De.setRsaPublicKey(g.n,g.e)})},u.onerror=function(c){r(c)}},a.onerror=function(o){r(o)};return}}else if(gp("generateKeyPairSync")){var n=xg.generateKeyPairSync("rsa",{modulusLength:s,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:De.privateKeyFromPem(n.privateKey),publicKey:De.publicKeyFromPem(n.publicKey)}}}var i=De.rsa.createKeyPairGenerationState(s,e,t);if(!r)return De.rsa.stepKeyPairGenerationState(i,0),i.keys;RC(i,t,r)};De.setRsaPublicKey=De.rsa.setPublicKey=function(s,e){var t={n:s,e};return t.encrypt=function(r,a,n){if(typeof a=="string"?a=a.toUpperCase():a===void 0&&(a="RSAES-PKCS1-V1_5"),a==="RSAES-PKCS1-V1_5")a={encode:function(o,l,u){return Ky(o,l,2).getBytes()}};else if(a==="RSA-OAEP"||a==="RSAES-OAEP")a={encode:function(o,l){return xe.pkcs1.encode_rsa_oaep(l,o,n)}};else if(["RAW","NONE","NULL",null].indexOf(a)!==-1)a={encode:function(o){return o}};else if(typeof a=="string")throw new Error('Unsupported encryption scheme: "'+a+'".');var i=a.encode(r,t,!0);return De.rsa.encrypt(i,t,!0)},t.verify=function(r,a,n,i){typeof n=="string"?n=n.toUpperCase():n===void 0&&(n="RSASSA-PKCS1-V1_5"),i===void 0&&(i={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in i||(i._parseAllDigestBytes=!0),n==="RSASSA-PKCS1-V1_5"?n={verify:function(l,u){u=H0(u,t,!0);var c=R.fromDer(u,{parseAllBytes:i._parseAllDigestBytes}),f={},g=[];if(!R.validate(c,TC,f,g)){var v=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.");throw v.errors=g,v}var p=R.derToOid(f.algorithmIdentifier);if(!(p===xe.oids.md2||p===xe.oids.md5||p===xe.oids.sha1||p===xe.oids.sha224||p===xe.oids.sha256||p===xe.oids.sha384||p===xe.oids.sha512||p===xe.oids["sha512-224"]||p===xe.oids["sha512-256"])){var v=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.");throw v.oid=p,v}if((p===xe.oids.md2||p===xe.oids.md5)&&!("parameters"in f))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return l===f.digest}}:(n==="NONE"||n==="NULL"||n===null)&&(n={verify:function(l,u){return u=H0(u,t,!0),l===u}});var o=De.rsa.decrypt(a,t,!0,!1);return n.verify(r,o,t.n.bitLength())},t};De.setRsaPrivateKey=De.rsa.setPrivateKey=function(s,e,t,r,a,n,i,o){var l={n:s,e,d:t,p:r,q:a,dP:n,dQ:i,qInv:o};return l.decrypt=function(u,c,f){typeof c=="string"?c=c.toUpperCase():c===void 0&&(c="RSAES-PKCS1-V1_5");var g=De.rsa.decrypt(u,l,!1,!1);if(c==="RSAES-PKCS1-V1_5")c={decode:H0};else if(c==="RSA-OAEP"||c==="RSAES-OAEP")c={decode:function(v,p){return xe.pkcs1.decode_rsa_oaep(p,v,f)}};else if(["RAW","NONE","NULL",null].indexOf(c)!==-1)c={decode:function(v){return v}};else throw new Error('Unsupported encryption scheme: "'+c+'".');return c.decode(g,l,!1)},l.sign=function(u,c){var f=!1;typeof c=="string"&&(c=c.toUpperCase()),c===void 0||c==="RSASSA-PKCS1-V1_5"?(c={encode:_C},f=1):(c==="NONE"||c==="NULL"||c===null)&&(c={encode:function(){return u}},f=1);var g=c.encode(u,l.n.bitLength());return De.rsa.encrypt(g,l,f)},l};De.wrapRsaPrivateKey=function(s){return R.create(R.Class.UNIVERSAL,R.Type.SEQUENCE,!0,[R.create(R.Class.UNIVERSAL,R.Type.INTEGER,!1,R.integerToDer(0).getBytes()),R.create(R.Class.UNIVERSAL,R.Type.SEQUENCE,!0,[R.create(R.Class.UNIVERSAL,R.Type.OID,!1,R.oidToDer(De.oids.rsaEncryption).getBytes()),R.create(R.Class.UNIVERSAL,R.Type.NULL,!1,"")]),R.create(R.Class.UNIVERSAL,R.Type.OCTETSTRING,!1,R.toDer(s).getBytes())])};De.privateKeyFromAsn1=function(s){var e={},t=[];if(R.validate(s,BC,e,t)&&(s=R.fromDer(xe.util.createBuffer(e.privateKey))),e={},t=[],!R.validate(s,IC,e,t)){var r=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw r.errors=t,r}var a,n,i,o,l,u,c,f;return a=xe.util.createBuffer(e.privateKeyModulus).toHex(),n=xe.util.createBuffer(e.privateKeyPublicExponent).toHex(),i=xe.util.createBuffer(e.privateKeyPrivateExponent).toHex(),o=xe.util.createBuffer(e.privateKeyPrime1).toHex(),l=xe.util.createBuffer(e.privateKeyPrime2).toHex(),u=xe.util.createBuffer(e.privateKeyExponent1).toHex(),c=xe.util.createBuffer(e.privateKeyExponent2).toHex(),f=xe.util.createBuffer(e.privateKeyCoefficient).toHex(),De.setRsaPrivateKey(new Xe(a,16),new Xe(n,16),new Xe(i,16),new Xe(o,16),new Xe(l,16),new Xe(u,16),new Xe(c,16),new Xe(f,16))};De.privateKeyToAsn1=De.privateKeyToRSAPrivateKey=function(s){return R.create(R.Class.UNIVERSAL,R.Type.SEQUENCE,!0,[R.create(R.Class.UNIVERSAL,R.Type.INTEGER,!1,R.integerToDer(0).getBytes()),R.create(R.Class.UNIVERSAL,R.Type.INTEGER,!1,As(s.n)),R.create(R.Class.UNIVERSAL,R.Type.INTEGER,!1,As(s.e)),R.create(R.Class.UNIVERSAL,R.Type.INTEGER,!1,As(s.d)),R.create(R.Class.UNIVERSAL,R.Type.INTEGER,!1,As(s.p)),R.create(R.Class.UNIVERSAL,R.Type.INTEGER,!1,As(s.q)),R.create(R.Class.UNIVERSAL,R.Type.INTEGER,!1,As(s.dP)),R.create(R.Class.UNIVERSAL,R.Type.INTEGER,!1,As(s.dQ)),R.create(R.Class.UNIVERSAL,R.Type.INTEGER,!1,As(s.qInv))])};De.publicKeyFromAsn1=function(s){var e={},t=[];if(R.validate(s,NC,e,t)){var r=R.derToOid(e.publicKeyOid);if(r!==De.oids.rsaEncryption){var a=new Error("Cannot read public key. Unknown OID.");throw a.oid=r,a}s=e.rsaPublicKey}if(t=[],!R.validate(s,kC,e,t)){var a=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw a.errors=t,a}var n=xe.util.createBuffer(e.publicKeyModulus).toHex(),i=xe.util.createBuffer(e.publicKeyExponent).toHex();return De.setRsaPublicKey(new Xe(n,16),new Xe(i,16))};De.publicKeyToAsn1=De.publicKeyToSubjectPublicKeyInfo=function(s){return R.create(R.Class.UNIVERSAL,R.Type.SEQUENCE,!0,[R.create(R.Class.UNIVERSAL,R.Type.SEQUENCE,!0,[R.create(R.Class.UNIVERSAL,R.Type.OID,!1,R.oidToDer(De.oids.rsaEncryption).getBytes()),R.create(R.Class.UNIVERSAL,R.Type.NULL,!1,"")]),R.create(R.Class.UNIVERSAL,R.Type.BITSTRING,!1,[De.publicKeyToRSAPublicKey(s)])])};De.publicKeyToRSAPublicKey=function(s){return R.create(R.Class.UNIVERSAL,R.Type.SEQUENCE,!0,[R.create(R.Class.UNIVERSAL,R.Type.INTEGER,!1,As(s.n)),R.create(R.Class.UNIVERSAL,R.Type.INTEGER,!1,As(s.e))])};function Ky(s,e,t){var r=xe.util.createBuffer(),a=Math.ceil(e.n.bitLength()/8);if(s.length>a-11){var n=new Error("Message is too long for PKCS#1 v1.5 padding.");throw n.length=s.length,n.max=a-11,n}r.putByte(0),r.putByte(t);var i=a-3-s.length,o;if(t===0||t===1){o=t===0?0:255;for(var l=0;l<i;++l)r.putByte(o)}else for(;i>0;){for(var u=0,c=xe.random.getBytes(i),l=0;l<i;++l)o=c.charCodeAt(l),o===0?++u:r.putByte(o);i=u}return r.putByte(0),r.putBytes(s),r}function H0(s,e,t,r){var a=Math.ceil(e.n.bitLength()/8),n=xe.util.createBuffer(s),i=n.getByte(),o=n.getByte();if(i!==0||t&&o!==0&&o!==1||!t&&o!=2||t&&o===0&&typeof r>"u")throw new Error("Encryption block is invalid.");var l=0;if(o===0){l=a-3-r;for(var u=0;u<l;++u)if(n.getByte()!==0)throw new Error("Encryption block is invalid.")}else if(o===1)for(l=0;n.length()>1;){if(n.getByte()!==255){--n.read;break}++l}else if(o===2)for(l=0;n.length()>1;){if(n.getByte()===0){--n.read;break}++l}var c=n.getByte();if(c!==0||l!==a-3-n.length())throw new Error("Encryption block is invalid.");return n.getBytes()}function RC(s,e,t){typeof e=="function"&&(t=e,e={}),e=e||{};var r={algorithm:{name:e.algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(r.prng=e.prng),a();function a(){n(s.pBits,function(o,l){if(o)return t(o);if(s.p=l,s.q!==null)return i(o,s.q);n(s.qBits,i)})}function n(o,l){xe.prime.generateProbablePrime(o,r,l)}function i(o,l){if(o)return t(o);if(s.q=l,s.p.compareTo(s.q)<0){var u=s.p;s.p=s.q,s.q=u}if(s.p.subtract(Xe.ONE).gcd(s.e).compareTo(Xe.ONE)!==0){s.p=null,a();return}if(s.q.subtract(Xe.ONE).gcd(s.e).compareTo(Xe.ONE)!==0){s.q=null,n(s.qBits,i);return}if(s.p1=s.p.subtract(Xe.ONE),s.q1=s.q.subtract(Xe.ONE),s.phi=s.p1.multiply(s.q1),s.phi.gcd(s.e).compareTo(Xe.ONE)!==0){s.p=s.q=null,a();return}if(s.n=s.p.multiply(s.q),s.n.bitLength()!==s.bits){s.q=null,n(s.qBits,i);return}var c=s.e.modInverse(s.phi);s.keys={privateKey:De.rsa.setPrivateKey(s.n,s.e,c,s.p,s.q,c.mod(s.p1),c.mod(s.q1),s.q.modInverse(s.p)),publicKey:De.rsa.setPublicKey(s.n,s.e)},t(null,s.keys)}}function As(s){var e=s.toString(16);e[0]>="8"&&(e="00"+e);var t=xe.util.hexToBytes(e);return t.length>1&&(t.charCodeAt(0)===0&&(t.charCodeAt(1)&128)===0||t.charCodeAt(0)===255&&(t.charCodeAt(1)&128)===128)?t.substr(1):t}function VC(s){return s<=100?27:s<=150?18:s<=200?15:s<=250?12:s<=300?9:s<=350?8:s<=400?7:s<=500?6:s<=600?5:s<=800?4:s<=1250?3:2}function gp(s){return xe.util.isNodejs&&typeof xg[s]=="function"}function mp(s){return typeof es.globalScope<"u"&&typeof es.globalScope.crypto=="object"&&typeof es.globalScope.crypto.subtle=="object"&&typeof es.globalScope.crypto.subtle[s]=="function"}function pp(s){return typeof es.globalScope<"u"&&typeof es.globalScope.msCrypto=="object"&&typeof es.globalScope.msCrypto.subtle=="object"&&typeof es.globalScope.msCrypto.subtle[s]=="function"}function yp(s){for(var e=xe.util.hexToBytes(s.toString(16)),t=new Uint8Array(e.length),r=0;r<e.length;++r)t[r]=e.charCodeAt(r);return t}var he=Me;if(typeof $C>"u")var $C=he.jsbn.BigInteger;var H=he.asn1,Oe=he.pki=he.pki||{};Oe.pbe=he.pbe=he.pbe||{};var Hn=Oe.oids,DC={name:"EncryptedPrivateKeyInfo",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:H.Class.UNIVERSAL,type:H.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:H.Class.UNIVERSAL,type:H.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},LC={name:"PBES2Algorithms",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:H.Class.UNIVERSAL,type:H.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:H.Class.UNIVERSAL,type:H.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:H.Class.UNIVERSAL,type:H.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:H.Class.UNIVERSAL,type:H.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:H.Class.UNIVERSAL,type:H.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:H.Class.UNIVERSAL,type:H.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:H.Class.UNIVERSAL,type:H.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},OC={name:"pkcs-12PbeParams",tagClass:H.Class.UNIVERSAL,type:H.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:H.Class.UNIVERSAL,type:H.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:H.Class.UNIVERSAL,type:H.Type.INTEGER,constructed:!1,capture:"iterations"}]};Oe.encryptPrivateKeyInfo=function(s,e,t){t=t||{},t.saltSize=t.saltSize||8,t.count=t.count||2048,t.algorithm=t.algorithm||"aes128",t.prfAlgorithm=t.prfAlgorithm||"sha1";var r=he.random.getBytesSync(t.saltSize),a=t.count,n=H.integerToDer(a),i,o,l;if(t.algorithm.indexOf("aes")===0||t.algorithm==="des"){var u,c,f;switch(t.algorithm){case"aes128":i=16,u=16,c=Hn["aes128-CBC"],f=he.aes.createEncryptionCipher;break;case"aes192":i=24,u=16,c=Hn["aes192-CBC"],f=he.aes.createEncryptionCipher;break;case"aes256":i=32,u=16,c=Hn["aes256-CBC"],f=he.aes.createEncryptionCipher;break;case"des":i=8,u=8,c=Hn.desCBC,f=he.des.createEncryptionCipher;break;default:var g=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw g.algorithm=t.algorithm,g}var v="hmacWith"+t.prfAlgorithm.toUpperCase(),p=qy(v),h=he.pkcs5.pbkdf2(e,r,a,i,p),d=he.random.getBytesSync(u),y=f(h);y.start(d),y.update(H.toDer(s)),y.finish(),l=y.output.getBytes();var A=PC(r,n,i,v);o=H.create(H.Class.UNIVERSAL,H.Type.SEQUENCE,!0,[H.create(H.Class.UNIVERSAL,H.Type.OID,!1,H.oidToDer(Hn.pkcs5PBES2).getBytes()),H.create(H.Class.UNIVERSAL,H.Type.SEQUENCE,!0,[H.create(H.Class.UNIVERSAL,H.Type.SEQUENCE,!0,[H.create(H.Class.UNIVERSAL,H.Type.OID,!1,H.oidToDer(Hn.pkcs5PBKDF2).getBytes()),A]),H.create(H.Class.UNIVERSAL,H.Type.SEQUENCE,!0,[H.create(H.Class.UNIVERSAL,H.Type.OID,!1,H.oidToDer(c).getBytes()),H.create(H.Class.UNIVERSAL,H.Type.OCTETSTRING,!1,d)])])])}else if(t.algorithm==="3des"){i=24;var x=new he.util.ByteBuffer(r),h=Oe.pbe.generatePkcs12Key(e,x,1,a,i),d=Oe.pbe.generatePkcs12Key(e,x,2,a,i),y=he.des.createEncryptionCipher(h);y.start(d),y.update(H.toDer(s)),y.finish(),l=y.output.getBytes(),o=H.create(H.Class.UNIVERSAL,H.Type.SEQUENCE,!0,[H.create(H.Class.UNIVERSAL,H.Type.OID,!1,H.oidToDer(Hn["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),H.create(H.Class.UNIVERSAL,H.Type.SEQUENCE,!0,[H.create(H.Class.UNIVERSAL,H.Type.OCTETSTRING,!1,r),H.create(H.Class.UNIVERSAL,H.Type.INTEGER,!1,n.getBytes())])])}else{var g=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw g.algorithm=t.algorithm,g}var N=H.create(H.Class.UNIVERSAL,H.Type.SEQUENCE,!0,[o,H.create(H.Class.UNIVERSAL,H.Type.OCTETSTRING,!1,l)]);return N};Oe.decryptPrivateKeyInfo=function(s,e){var t=null,r={},a=[];if(!H.validate(s,DC,r,a)){var n=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw n.errors=a,n}var i=H.derToOid(r.encryptionOid),o=Oe.pbe.getCipher(i,r.encryptionParams,e),l=he.util.createBuffer(r.encryptedData);return o.update(l),o.finish()&&(t=H.fromDer(o.output)),t};Oe.encryptedPrivateKeyToPem=function(s,e){var t={type:"ENCRYPTED PRIVATE KEY",body:H.toDer(s).getBytes()};return he.pem.encode(t,{maxline:e})};Oe.encryptedPrivateKeyFromPem=function(s){var e=he.pem.decode(s)[0];if(e.type!=="ENCRYPTED PRIVATE KEY"){var t=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return H.fromDer(e.body)};Oe.encryptRsaPrivateKey=function(s,e,t){if(t=t||{},!t.legacy){var r=Oe.wrapRsaPrivateKey(Oe.privateKeyToAsn1(s));return r=Oe.encryptPrivateKeyInfo(r,e,t),Oe.encryptedPrivateKeyToPem(r)}var a,n,i,o;switch(t.algorithm){case"aes128":a="AES-128-CBC",i=16,n=he.random.getBytesSync(16),o=he.aes.createEncryptionCipher;break;case"aes192":a="AES-192-CBC",i=24,n=he.random.getBytesSync(16),o=he.aes.createEncryptionCipher;break;case"aes256":a="AES-256-CBC",i=32,n=he.random.getBytesSync(16),o=he.aes.createEncryptionCipher;break;case"3des":a="DES-EDE3-CBC",i=24,n=he.random.getBytesSync(8),o=he.des.createEncryptionCipher;break;case"des":a="DES-CBC",i=8,n=he.random.getBytesSync(8),o=he.des.createEncryptionCipher;break;default:var l=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+t.algorithm+'".');throw l.algorithm=t.algorithm,l}var u=he.pbe.opensslDeriveBytes(e,n.substr(0,8),i),c=o(u);c.start(n),c.update(H.toDer(Oe.privateKeyToAsn1(s))),c.finish();var f={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:a,parameters:he.util.bytesToHex(n).toUpperCase()},body:c.output.getBytes()};return he.pem.encode(f)};Oe.decryptRsaPrivateKey=function(s,e){var t=null,r=he.pem.decode(s)[0];if(r.type!=="ENCRYPTED PRIVATE KEY"&&r.type!=="PRIVATE KEY"&&r.type!=="RSA PRIVATE KEY"){var a=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw a.headerType=a,a}if(r.procType&&r.procType.type==="ENCRYPTED"){var n,i;switch(r.dekInfo.algorithm){case"DES-CBC":n=8,i=he.des.createDecryptionCipher;break;case"DES-EDE3-CBC":n=24,i=he.des.createDecryptionCipher;break;case"AES-128-CBC":n=16,i=he.aes.createDecryptionCipher;break;case"AES-192-CBC":n=24,i=he.aes.createDecryptionCipher;break;case"AES-256-CBC":n=32,i=he.aes.createDecryptionCipher;break;case"RC2-40-CBC":n=5,i=function(f){return he.rc2.createDecryptionCipher(f,40)};break;case"RC2-64-CBC":n=8,i=function(f){return he.rc2.createDecryptionCipher(f,64)};break;case"RC2-128-CBC":n=16,i=function(f){return he.rc2.createDecryptionCipher(f,128)};break;default:var a=new Error('Could not decrypt private key; unsupported encryption algorithm "'+r.dekInfo.algorithm+'".');throw a.algorithm=r.dekInfo.algorithm,a}var o=he.util.hexToBytes(r.dekInfo.parameters),l=he.pbe.opensslDeriveBytes(e,o.substr(0,8),n),u=i(l);if(u.start(o),u.update(he.util.createBuffer(r.body)),u.finish())t=u.output.getBytes();else return t}else t=r.body;return r.type==="ENCRYPTED PRIVATE KEY"?t=Oe.decryptPrivateKeyInfo(H.fromDer(t),e):t=H.fromDer(t),t!==null&&(t=Oe.privateKeyFromAsn1(t)),t};Oe.pbe.generatePkcs12Key=function(s,e,t,r,a,n){var i,o;if(typeof n>"u"||n===null){if(!("sha1"in he.md))throw new Error('"sha1" hash algorithm unavailable.');n=he.md.sha1.create()}var l=n.digestLength,u=n.blockLength,c=new he.util.ByteBuffer,f=new he.util.ByteBuffer;if(s!=null){for(o=0;o<s.length;o++)f.putInt16(s.charCodeAt(o));f.putInt16(0)}var g=f.length(),v=e.length(),p=new he.util.ByteBuffer;p.fillWithByte(t,u);var h=u*Math.ceil(v/u),d=new he.util.ByteBuffer;for(o=0;o<h;o++)d.putByte(e.at(o%v));var y=u*Math.ceil(g/u),A=new he.util.ByteBuffer;for(o=0;o<y;o++)A.putByte(f.at(o%g));var x=d;x.putBuffer(A);for(var N=Math.ceil(a/l),_=1;_<=N;_++){var $=new he.util.ByteBuffer;$.putBytes(p.bytes()),$.putBytes(x.bytes());for(var se=0;se<r;se++)n.start(),n.update($.getBytes()),$=n.digest();var te=new he.util.ByteBuffer;for(o=0;o<u;o++)te.putByte($.at(o%l));var me=Math.ceil(v/u)+Math.ceil(g/u),Ce=new he.util.ByteBuffer;for(i=0;i<me;i++){var pe=new he.util.ByteBuffer(x.getBytes(u)),ve=511;for(o=te.length()-1;o>=0;o--)ve=ve>>8,ve+=te.at(o)+pe.at(o),pe.setAt(o,ve&255);Ce.putBuffer(pe)}x=Ce,c.putBuffer($)}return c.truncate(c.length()-a),c};Oe.pbe.getCipher=function(s,e,t){switch(s){case Oe.oids.pkcs5PBES2:return Oe.pbe.getCipherForPBES2(s,e,t);case Oe.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case Oe.oids["pbewithSHAAnd40BitRC2-CBC"]:return Oe.pbe.getCipherForPKCS12PBE(s,e,t);default:var r=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw r.oid=s,r.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],r}};Oe.pbe.getCipherForPBES2=function(s,e,t){var r={},a=[];if(!H.validate(e,LC,r,a)){var n=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw n.errors=a,n}if(s=H.derToOid(r.kdfOid),s!==Oe.oids.pkcs5PBKDF2){var n=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw n.oid=s,n.supportedOids=["pkcs5PBKDF2"],n}if(s=H.derToOid(r.encOid),s!==Oe.oids["aes128-CBC"]&&s!==Oe.oids["aes192-CBC"]&&s!==Oe.oids["aes256-CBC"]&&s!==Oe.oids["des-EDE3-CBC"]&&s!==Oe.oids.desCBC){var n=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw n.oid=s,n.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],n}var i=r.kdfSalt,o=he.util.createBuffer(r.kdfIterationCount);o=o.getInt(o.length()<<3);var l,u;switch(Oe.oids[s]){case"aes128-CBC":l=16,u=he.aes.createDecryptionCipher;break;case"aes192-CBC":l=24,u=he.aes.createDecryptionCipher;break;case"aes256-CBC":l=32,u=he.aes.createDecryptionCipher;break;case"des-EDE3-CBC":l=24,u=he.des.createDecryptionCipher;break;case"desCBC":l=8,u=he.des.createDecryptionCipher;break}var c=Fy(r.prfOid),f=he.pkcs5.pbkdf2(t,i,o,l,c),g=r.encIv,v=u(f);return v.start(g),v};Oe.pbe.getCipherForPKCS12PBE=function(s,e,t){var r={},a=[];if(!H.validate(e,OC,r,a)){var n=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw n.errors=a,n}var i=he.util.createBuffer(r.salt),o=he.util.createBuffer(r.iterations);o=o.getInt(o.length()<<3);var l,u,c;switch(s){case Oe.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:l=24,u=8,c=he.des.startDecrypting;break;case Oe.oids["pbewithSHAAnd40BitRC2-CBC"]:l=5,u=8,c=function(h,d){var y=he.rc2.createDecryptionCipher(h,40);return y.start(d,null),y};break;default:var n=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw n.oid=s,n}var f=Fy(r.prfOid),g=Oe.pbe.generatePkcs12Key(t,i,1,o,l,f);f.start();var v=Oe.pbe.generatePkcs12Key(t,i,2,o,u,f);return c(g,v)};Oe.pbe.opensslDeriveBytes=function(s,e,t,r){if(typeof r>"u"||r===null){if(!("md5"in he.md))throw new Error('"md5" hash algorithm unavailable.');r=he.md.md5.create()}e===null&&(e="");for(var a=[vp(r,s+e)],n=16,i=1;n<t;++i,n+=16)a.push(vp(r,a[i-1]+s+e));return a.join("").substr(0,t)};function vp(s,e){return s.start().update(e).digest().getBytes()}function Fy(s){var e;if(!s)e="hmacWithSHA1";else if(e=Oe.oids[H.derToOid(s)],!e){var t=new Error("Unsupported PRF OID.");throw t.oid=s,t.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],t}return qy(e)}function qy(s){var e=he.md;switch(s){case"hmacWithSHA224":e=he.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":s=s.substr(8).toLowerCase();break;default:var t=new Error("Unsupported PRF algorithm.");throw t.algorithm=s,t.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],t}if(!e||!(s in e))throw new Error("Unknown hash algorithm: "+s);return e[s].create()}function PC(s,e,t,r){var a=H.create(H.Class.UNIVERSAL,H.Type.SEQUENCE,!0,[H.create(H.Class.UNIVERSAL,H.Type.OCTETSTRING,!1,s),H.create(H.Class.UNIVERSAL,H.Type.INTEGER,!1,e.getBytes())]);return r!=="hmacWithSHA1"&&a.value.push(H.create(H.Class.UNIVERSAL,H.Type.INTEGER,!1,he.util.hexToBytes(t.toString(16))),H.create(H.Class.UNIVERSAL,H.Type.SEQUENCE,!0,[H.create(H.Class.UNIVERSAL,H.Type.OID,!1,H.oidToDer(Oe.oids[r]).getBytes()),H.create(H.Class.UNIVERSAL,H.Type.NULL,!1,"")])),a}var pu=Me,ue=pu.asn1,Nu=pu.pkcs7asn1=pu.pkcs7asn1||{};pu.pkcs7=pu.pkcs7||{};pu.pkcs7.asn1=Nu;var Jy={name:"ContentInfo",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:ue.Class.UNIVERSAL,type:ue.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:ue.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};Nu.contentInfoValidator=Jy;var Gy={name:"EncryptedContentInfo",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:ue.Class.UNIVERSAL,type:ue.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:ue.Class.UNIVERSAL,type:ue.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:ue.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:ue.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};Nu.envelopedDataValidator={name:"EnvelopedData",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:ue.Class.UNIVERSAL,type:ue.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(Gy)};Nu.encryptedDataValidator={name:"EncryptedData",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:ue.Class.UNIVERSAL,type:ue.Type.INTEGER,constructed:!1,capture:"version"}].concat(Gy)};var UC={name:"SignerInfo",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:ue.Class.UNIVERSAL,type:ue.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:ue.Class.UNIVERSAL,type:ue.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:ue.Class.UNIVERSAL,type:ue.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:ue.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:ue.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:ue.Class.UNIVERSAL,type:ue.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:ue.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};Nu.signedDataValidator={name:"SignedData",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:ue.Class.UNIVERSAL,type:ue.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},Jy,{name:"SignedData.Certificates",tagClass:ue.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:ue.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SET,capture:"signerInfos",optional:!0,value:[UC]}]};Nu.recipientInfoValidator={name:"RecipientInfo",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:ue.Class.UNIVERSAL,type:ue.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:ue.Class.UNIVERSAL,type:ue.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:ue.Class.UNIVERSAL,type:ue.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:ue.Class.UNIVERSAL,type:ue.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:ue.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter",optional:!0}]},{name:"RecipientInfo.encryptedKey",tagClass:ue.Class.UNIVERSAL,type:ue.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]};var ro=Me;ro.mgf=ro.mgf||{};var MC=ro.mgf.mgf1=ro.mgf1=ro.mgf1||{};MC.create=function(s){var e={generate:function(t,r){for(var a=new ro.util.ByteBuffer,n=Math.ceil(r/s.digestLength),i=0;i<n;i++){var o=new ro.util.ByteBuffer;o.putInt32(i),s.start(),s.update(t+o.getBytes()),a.putBuffer(s.digest())}return a.truncate(a.length()-r),a.getBytes()}};return e};var K0=Me;K0.mgf=K0.mgf||{};K0.mgf.mgf1=K0.mgf1;var Gi=Me,HC=Gi.pss=Gi.pss||{};HC.create=function(s){arguments.length===3&&(s={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var e=s.md,t=s.mgf,r=e.digestLength,a=s.salt||null;typeof a=="string"&&(a=Gi.util.createBuffer(a));var n;if("saltLength"in s)n=s.saltLength;else if(a!==null)n=a.length();else throw new Error("Salt length not specified or specific salt not given.");if(a!==null&&a.length()!==n)throw new Error("Given salt length does not match length of given salt.");var i=s.prng||Gi.random,o={};return o.encode=function(l,u){var c,f=u-1,g=Math.ceil(f/8),v=l.digest().getBytes();if(g<r+n+2)throw new Error("Message is too long to encrypt.");var p;a===null?p=i.getBytesSync(n):p=a.bytes();var h=new Gi.util.ByteBuffer;h.fillWithByte(0,8),h.putBytes(v),h.putBytes(p),e.start(),e.update(h.getBytes());var d=e.digest().getBytes(),y=new Gi.util.ByteBuffer;y.fillWithByte(0,g-n-r-2),y.putByte(1),y.putBytes(p);var A=y.getBytes(),x=g-r-1,N=t.generate(d,x),_="";for(c=0;c<x;c++)_+=String.fromCharCode(A.charCodeAt(c)^N.charCodeAt(c));var $=65280>>8*g-f&255;return _=String.fromCharCode(_.charCodeAt(0)&~$)+_.substr(1),_+d+String.fromCharCode(188)},o.verify=function(l,u,c){var f,g=c-1,v=Math.ceil(g/8);if(u=u.substr(-v),v<r+n+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(u.charCodeAt(v-1)!==188)throw new Error("Encoded message does not end in 0xBC.");var p=v-r-1,h=u.substr(0,p),d=u.substr(p,r),y=65280>>8*v-g&255;if((h.charCodeAt(0)&y)!==0)throw new Error("Bits beyond keysize not zero as expected.");var A=t.generate(d,p),x="";for(f=0;f<p;f++)x+=String.fromCharCode(h.charCodeAt(f)^A.charCodeAt(f));x=String.fromCharCode(x.charCodeAt(0)&~y)+x.substr(1);var N=v-r-n-2;for(f=0;f<N;f++)if(x.charCodeAt(f)!==0)throw new Error("Leftmost octets not zero as expected");if(x.charCodeAt(N)!==1)throw new Error("Inconsistent PSS signature, 0x01 marker not found");var _=x.substr(-n),$=new Gi.util.ByteBuffer;$.fillWithByte(0,8),$.putBytes(l),$.putBytes(_),e.start(),e.update($.getBytes());var se=e.digest().getBytes();return d===se},o};var Ie=Me,w=Ie.asn1,ae=Ie.pki=Ie.pki||{},We=ae.oids,Tt={};Tt.CN=We.commonName;Tt.commonName="CN";Tt.C=We.countryName;Tt.countryName="C";Tt.L=We.localityName;Tt.localityName="L";Tt.ST=We.stateOrProvinceName;Tt.stateOrProvinceName="ST";Tt.O=We.organizationName;Tt.organizationName="O";Tt.OU=We.organizationalUnitName;Tt.organizationalUnitName="OU";Tt.E=We.emailAddress;Tt.emailAddress="E";var jy=Ie.pki.rsa.publicKeyValidator,KC={name:"Certificate",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:w.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:w.Class.UNIVERSAL,type:w.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:w.Class.UNIVERSAL,type:w.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:w.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:w.Class.UNIVERSAL,type:w.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:w.Class.UNIVERSAL,type:w.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:w.Class.UNIVERSAL,type:w.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:w.Class.UNIVERSAL,type:w.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},jy,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:w.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:w.Class.UNIVERSAL,type:w.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:w.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:w.Class.UNIVERSAL,type:w.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:w.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:w.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:w.Class.UNIVERSAL,type:w.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},FC={name:"rsapss",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:w.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:w.Class.UNIVERSAL,type:w.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:w.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:w.Class.UNIVERSAL,type:w.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:w.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:w.Class.UNIVERSAL,type:w.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:w.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:w.Class.UNIVERSAL,type:w.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},qC={name:"CertificationRequestInfo",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:w.Class.UNIVERSAL,type:w.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},jy,{name:"CertificationRequestInfo.attributes",tagClass:w.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:w.Class.UNIVERSAL,type:w.Type.SET,constructed:!0}]}]}]},JC={name:"CertificationRequest",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[qC,{name:"CertificationRequest.signatureAlgorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:w.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:w.Class.UNIVERSAL,type:w.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};ae.RDNAttributesAsArray=function(s,e){for(var t=[],r,a,n,i=0;i<s.value.length;++i){r=s.value[i];for(var o=0;o<r.value.length;++o)n={},a=r.value[o],n.type=w.derToOid(a.value[0].value),n.value=a.value[1].value,n.valueTagClass=a.value[1].type,n.type in We&&(n.name=We[n.type],n.name in Tt&&(n.shortName=Tt[n.name])),e&&(e.update(n.type),e.update(n.value)),t.push(n)}return t};ae.CRIAttributesAsArray=function(s){for(var e=[],t=0;t<s.length;++t)for(var r=s[t],a=w.derToOid(r.value[0].value),n=r.value[1].value,i=0;i<n.length;++i){var o={};if(o.type=a,o.value=n[i].value,o.valueTagClass=n[i].type,o.type in We&&(o.name=We[o.type],o.name in Tt&&(o.shortName=Tt[o.name])),o.type===We.extensionRequest){o.extensions=[];for(var l=0;l<o.value.length;++l)o.extensions.push(ae.certificateExtensionFromAsn1(o.value[l]))}e.push(o)}return e};function Dn(s,e){typeof e=="string"&&(e={shortName:e});for(var t=null,r,a=0;t===null&&a<s.attributes.length;++a)r=s.attributes[a],(e.type&&e.type===r.type||e.name&&e.name===r.name||e.shortName&&e.shortName===r.shortName)&&(t=r);return t}var F0=function(s,e,t){var r={};if(s!==We["RSASSA-PSS"])return r;t&&(r={hash:{algorithmOid:We.sha1},mgf:{algorithmOid:We.mgf1,hash:{algorithmOid:We.sha1}},saltLength:20});var a={},n=[];if(!w.validate(e,FC,a,n)){var i=new Error("Cannot read RSASSA-PSS parameter block.");throw i.errors=n,i}return a.hashOid!==void 0&&(r.hash=r.hash||{},r.hash.algorithmOid=w.derToOid(a.hashOid)),a.maskGenOid!==void 0&&(r.mgf=r.mgf||{},r.mgf.algorithmOid=w.derToOid(a.maskGenOid),r.mgf.hash=r.mgf.hash||{},r.mgf.hash.algorithmOid=w.derToOid(a.maskGenHashOid)),a.saltLength!==void 0&&(r.saltLength=a.saltLength.charCodeAt(0)),r},Cd=function(s){switch(We[s.signatureOid]){case"sha1WithRSAEncryption":case"sha1WithRSASignature":return Ie.md.sha1.create();case"md5WithRSAEncryption":return Ie.md.md5.create();case"sha256WithRSAEncryption":return Ie.md.sha256.create();case"sha384WithRSAEncryption":return Ie.md.sha384.create();case"sha512WithRSAEncryption":return Ie.md.sha512.create();case"RSASSA-PSS":return Ie.md.sha256.create();default:var e=new Error("Could not compute "+s.type+" digest. Unknown signature OID.");throw e.signatureOid=s.signatureOid,e}},Wy=function(s){var e=s.certificate,t;switch(e.signatureOid){case We.sha1WithRSAEncryption:case We.sha1WithRSASignature:break;case We["RSASSA-PSS"]:var r,a;if(r=We[e.signatureParameters.mgf.hash.algorithmOid],r===void 0||Ie.md[r]===void 0){var n=new Error("Unsupported MGF hash function.");throw n.oid=e.signatureParameters.mgf.hash.algorithmOid,n.name=r,n}if(a=We[e.signatureParameters.mgf.algorithmOid],a===void 0||Ie.mgf[a]===void 0){var n=new Error("Unsupported MGF function.");throw n.oid=e.signatureParameters.mgf.algorithmOid,n.name=a,n}if(a=Ie.mgf[a].create(Ie.md[r].create()),r=We[e.signatureParameters.hash.algorithmOid],r===void 0||Ie.md[r]===void 0){var n=new Error("Unsupported RSASSA-PSS hash function.");throw n.oid=e.signatureParameters.hash.algorithmOid,n.name=r,n}t=Ie.pss.create(Ie.md[r].create(),a,e.signatureParameters.saltLength);break}return e.publicKey.verify(s.md.digest().getBytes(),s.signature,t)};ae.certificateFromPem=function(s,e,t){var r=Ie.pem.decode(s)[0];if(r.type!=="CERTIFICATE"&&r.type!=="X509 CERTIFICATE"&&r.type!=="TRUSTED CERTIFICATE"){var a=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw a.headerType=r.type,a}if(r.procType&&r.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var n=w.fromDer(r.body,t);return ae.certificateFromAsn1(n,e)};ae.certificateToPem=function(s,e){var t={type:"CERTIFICATE",body:w.toDer(ae.certificateToAsn1(s)).getBytes()};return Ie.pem.encode(t,{maxline:e})};ae.publicKeyFromPem=function(s){var e=Ie.pem.decode(s)[0];if(e.type!=="PUBLIC KEY"&&e.type!=="RSA PUBLIC KEY"){var t=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert public key from PEM; PEM is encrypted.");var r=w.fromDer(e.body);return ae.publicKeyFromAsn1(r)};ae.publicKeyToPem=function(s,e){var t={type:"PUBLIC KEY",body:w.toDer(ae.publicKeyToAsn1(s)).getBytes()};return Ie.pem.encode(t,{maxline:e})};ae.publicKeyToRSAPublicKeyPem=function(s,e){var t={type:"RSA PUBLIC KEY",body:w.toDer(ae.publicKeyToRSAPublicKey(s)).getBytes()};return Ie.pem.encode(t,{maxline:e})};ae.getPublicKeyFingerprint=function(s,e){e=e||{};var t=e.md||Ie.md.sha1.create(),r=e.type||"RSAPublicKey",a;switch(r){case"RSAPublicKey":a=w.toDer(ae.publicKeyToRSAPublicKey(s)).getBytes();break;case"SubjectPublicKeyInfo":a=w.toDer(ae.publicKeyToAsn1(s)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+e.type+'".')}t.start(),t.update(a);var n=t.digest();if(e.encoding==="hex"){var i=n.toHex();return e.delimiter?i.match(/.{2}/g).join(e.delimiter):i}else{if(e.encoding==="binary")return n.getBytes();if(e.encoding)throw new Error('Unknown encoding "'+e.encoding+'".')}return n};ae.certificationRequestFromPem=function(s,e,t){var r=Ie.pem.decode(s)[0];if(r.type!=="CERTIFICATE REQUEST"){var a=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw a.headerType=r.type,a}if(r.procType&&r.procType.type==="ENCRYPTED")throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var n=w.fromDer(r.body,t);return ae.certificationRequestFromAsn1(n,e)};ae.certificationRequestToPem=function(s,e){var t={type:"CERTIFICATE REQUEST",body:w.toDer(ae.certificationRequestToAsn1(s)).getBytes()};return Ie.pem.encode(t,{maxline:e})};ae.createCertificate=function(){var s={};return s.version=2,s.serialNumber="00",s.signatureOid=null,s.signature=null,s.siginfo={},s.siginfo.algorithmOid=null,s.validity={},s.validity.notBefore=new Date,s.validity.notAfter=new Date,s.issuer={},s.issuer.getField=function(e){return Dn(s.issuer,e)},s.issuer.addField=function(e){ts([e]),s.issuer.attributes.push(e)},s.issuer.attributes=[],s.issuer.hash=null,s.subject={},s.subject.getField=function(e){return Dn(s.subject,e)},s.subject.addField=function(e){ts([e]),s.subject.attributes.push(e)},s.subject.attributes=[],s.subject.hash=null,s.extensions=[],s.publicKey=null,s.md=null,s.setSubject=function(e,t){ts(e),s.subject.attributes=e,delete s.subject.uniqueId,t&&(s.subject.uniqueId=t),s.subject.hash=null},s.setIssuer=function(e,t){ts(e),s.issuer.attributes=e,delete s.issuer.uniqueId,t&&(s.issuer.uniqueId=t),s.issuer.hash=null},s.setExtensions=function(e){for(var t=0;t<e.length;++t)Qy(e[t],{cert:s});s.extensions=e},s.getExtension=function(e){typeof e=="string"&&(e={name:e});for(var t=null,r,a=0;t===null&&a<s.extensions.length;++a)r=s.extensions[a],(e.id&&r.id===e.id||e.name&&r.name===e.name)&&(t=r);return t},s.sign=function(e,t){s.md=t||Ie.md.sha1.create();var r=We[s.md.algorithm+"WithRSAEncryption"];if(!r){var a=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw a.algorithm=s.md.algorithm,a}s.signatureOid=s.siginfo.algorithmOid=r,s.tbsCertificate=ae.getTBSCertificate(s);var n=w.toDer(s.tbsCertificate);s.md.update(n.getBytes()),s.signature=e.sign(s.md)},s.verify=function(e){var t=!1;if(!s.issued(e)){var r=e.issuer,a=s.subject,n=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw n.expectedIssuer=a.attributes,n.actualIssuer=r.attributes,n}var i=e.md;if(i===null){i=Cd({signatureOid:e.signatureOid,type:"certificate"});var o=e.tbsCertificate||ae.getTBSCertificate(e),l=w.toDer(o);i.update(l.getBytes())}return i!==null&&(t=Wy({certificate:s,md:i,signature:e.signature})),t},s.isIssuer=function(e){var t=!1,r=s.issuer,a=e.subject;if(r.hash&&a.hash)t=r.hash===a.hash;else if(r.attributes.length===a.attributes.length){t=!0;for(var n,i,o=0;t&&o<r.attributes.length;++o)n=r.attributes[o],i=a.attributes[o],(n.type!==i.type||n.value!==i.value)&&(t=!1)}return t},s.issued=function(e){return e.isIssuer(s)},s.generateSubjectKeyIdentifier=function(){return ae.getPublicKeyFingerprint(s.publicKey,{type:"RSAPublicKey"})},s.verifySubjectKeyIdentifier=function(){for(var e=We.subjectKeyIdentifier,t=0;t<s.extensions.length;++t){var r=s.extensions[t];if(r.id===e){var a=s.generateSubjectKeyIdentifier().getBytes();return Ie.util.hexToBytes(r.subjectKeyIdentifier)===a}}return!1},s};ae.certificateFromAsn1=function(s,e){var t={},r=[];if(!w.validate(s,KC,t,r)){var a=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw a.errors=r,a}var n=w.derToOid(t.publicKeyOid);if(n!==ae.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var i=ae.createCertificate();i.version=t.certVersion?t.certVersion.charCodeAt(0):0;var o=Ie.util.createBuffer(t.certSerialNumber);i.serialNumber=o.toHex(),i.signatureOid=Ie.asn1.derToOid(t.certSignatureOid),i.signatureParameters=F0(i.signatureOid,t.certSignatureParams,!0),i.siginfo.algorithmOid=Ie.asn1.derToOid(t.certinfoSignatureOid),i.siginfo.parameters=F0(i.siginfo.algorithmOid,t.certinfoSignatureParams,!1),i.signature=t.certSignature;var l=[];if(t.certValidity1UTCTime!==void 0&&l.push(w.utcTimeToDate(t.certValidity1UTCTime)),t.certValidity2GeneralizedTime!==void 0&&l.push(w.generalizedTimeToDate(t.certValidity2GeneralizedTime)),t.certValidity3UTCTime!==void 0&&l.push(w.utcTimeToDate(t.certValidity3UTCTime)),t.certValidity4GeneralizedTime!==void 0&&l.push(w.generalizedTimeToDate(t.certValidity4GeneralizedTime)),l.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(l.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(i.validity.notBefore=l[0],i.validity.notAfter=l[1],i.tbsCertificate=t.tbsCertificate,e){i.md=Cd({signatureOid:i.signatureOid,type:"certificate"});var u=w.toDer(i.tbsCertificate);i.md.update(u.getBytes())}var c=Ie.md.sha1.create(),f=w.toDer(t.certIssuer);c.update(f.getBytes()),i.issuer.getField=function(p){return Dn(i.issuer,p)},i.issuer.addField=function(p){ts([p]),i.issuer.attributes.push(p)},i.issuer.attributes=ae.RDNAttributesAsArray(t.certIssuer),t.certIssuerUniqueId&&(i.issuer.uniqueId=t.certIssuerUniqueId),i.issuer.hash=c.digest().toHex();var g=Ie.md.sha1.create(),v=w.toDer(t.certSubject);return g.update(v.getBytes()),i.subject.getField=function(p){return Dn(i.subject,p)},i.subject.addField=function(p){ts([p]),i.subject.attributes.push(p)},i.subject.attributes=ae.RDNAttributesAsArray(t.certSubject),t.certSubjectUniqueId&&(i.subject.uniqueId=t.certSubjectUniqueId),i.subject.hash=g.digest().toHex(),t.certExtensions?i.extensions=ae.certificateExtensionsFromAsn1(t.certExtensions):i.extensions=[],i.publicKey=ae.publicKeyFromAsn1(t.subjectPublicKeyInfo),i};ae.certificateExtensionsFromAsn1=function(s){for(var e=[],t=0;t<s.value.length;++t)for(var r=s.value[t],a=0;a<r.value.length;++a)e.push(ae.certificateExtensionFromAsn1(r.value[a]));return e};ae.certificateExtensionFromAsn1=function(s){var e={};if(e.id=w.derToOid(s.value[0].value),e.critical=!1,s.value[1].type===w.Type.BOOLEAN?(e.critical=s.value[1].value.charCodeAt(0)!==0,e.value=s.value[2].value):e.value=s.value[1].value,e.id in We){if(e.name=We[e.id],e.name==="keyUsage"){var t=w.fromDer(e.value),r=0,a=0;t.value.length>1&&(r=t.value.charCodeAt(1),a=t.value.length>2?t.value.charCodeAt(2):0),e.digitalSignature=(r&128)===128,e.nonRepudiation=(r&64)===64,e.keyEncipherment=(r&32)===32,e.dataEncipherment=(r&16)===16,e.keyAgreement=(r&8)===8,e.keyCertSign=(r&4)===4,e.cRLSign=(r&2)===2,e.encipherOnly=(r&1)===1,e.decipherOnly=(a&128)===128}else if(e.name==="basicConstraints"){var t=w.fromDer(e.value);t.value.length>0&&t.value[0].type===w.Type.BOOLEAN?e.cA=t.value[0].value.charCodeAt(0)!==0:e.cA=!1;var n=null;t.value.length>0&&t.value[0].type===w.Type.INTEGER?n=t.value[0].value:t.value.length>1&&(n=t.value[1].value),n!==null&&(e.pathLenConstraint=w.derToInteger(n))}else if(e.name==="extKeyUsage")for(var t=w.fromDer(e.value),i=0;i<t.value.length;++i){var o=w.derToOid(t.value[i].value);o in We?e[We[o]]=!0:e[o]=!0}else if(e.name==="nsCertType"){var t=w.fromDer(e.value),r=0;t.value.length>1&&(r=t.value.charCodeAt(1)),e.client=(r&128)===128,e.server=(r&64)===64,e.email=(r&32)===32,e.objsign=(r&16)===16,e.reserved=(r&8)===8,e.sslCA=(r&4)===4,e.emailCA=(r&2)===2,e.objCA=(r&1)===1}else if(e.name==="subjectAltName"||e.name==="issuerAltName"){e.altNames=[];for(var l,t=w.fromDer(e.value),u=0;u<t.value.length;++u){l=t.value[u];var c={type:l.type,value:l.value};switch(e.altNames.push(c),l.type){case 1:case 2:case 6:break;case 7:c.ip=Ie.util.bytesToIP(l.value);break;case 8:c.oid=w.derToOid(l.value);break}}}else if(e.name==="subjectKeyIdentifier"){var t=w.fromDer(e.value);e.subjectKeyIdentifier=Ie.util.bytesToHex(t.value)}}return e};ae.certificationRequestFromAsn1=function(s,e){var t={},r=[];if(!w.validate(s,JC,t,r)){var a=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw a.errors=r,a}var n=w.derToOid(t.publicKeyOid);if(n!==ae.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var i=ae.createCertificationRequest();if(i.version=t.csrVersion?t.csrVersion.charCodeAt(0):0,i.signatureOid=Ie.asn1.derToOid(t.csrSignatureOid),i.signatureParameters=F0(i.signatureOid,t.csrSignatureParams,!0),i.siginfo.algorithmOid=Ie.asn1.derToOid(t.csrSignatureOid),i.siginfo.parameters=F0(i.siginfo.algorithmOid,t.csrSignatureParams,!1),i.signature=t.csrSignature,i.certificationRequestInfo=t.certificationRequestInfo,e){i.md=Cd({signatureOid:i.signatureOid,type:"certification request"});var o=w.toDer(i.certificationRequestInfo);i.md.update(o.getBytes())}var l=Ie.md.sha1.create();return i.subject.getField=function(u){return Dn(i.subject,u)},i.subject.addField=function(u){ts([u]),i.subject.attributes.push(u)},i.subject.attributes=ae.RDNAttributesAsArray(t.certificationRequestInfoSubject,l),i.subject.hash=l.digest().toHex(),i.publicKey=ae.publicKeyFromAsn1(t.subjectPublicKeyInfo),i.getAttribute=function(u){return Dn(i,u)},i.addAttribute=function(u){ts([u]),i.attributes.push(u)},i.attributes=ae.CRIAttributesAsArray(t.certificationRequestInfoAttributes||[]),i};ae.createCertificationRequest=function(){var s={};return s.version=0,s.signatureOid=null,s.signature=null,s.siginfo={},s.siginfo.algorithmOid=null,s.subject={},s.subject.getField=function(e){return Dn(s.subject,e)},s.subject.addField=function(e){ts([e]),s.subject.attributes.push(e)},s.subject.attributes=[],s.subject.hash=null,s.publicKey=null,s.attributes=[],s.getAttribute=function(e){return Dn(s,e)},s.addAttribute=function(e){ts([e]),s.attributes.push(e)},s.md=null,s.setSubject=function(e){ts(e),s.subject.attributes=e,s.subject.hash=null},s.setAttributes=function(e){ts(e),s.attributes=e},s.sign=function(e,t){s.md=t||Ie.md.sha1.create();var r=We[s.md.algorithm+"WithRSAEncryption"];if(!r){var a=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw a.algorithm=s.md.algorithm,a}s.signatureOid=s.siginfo.algorithmOid=r,s.certificationRequestInfo=ae.getCertificationRequestInfo(s);var n=w.toDer(s.certificationRequestInfo);s.md.update(n.getBytes()),s.signature=e.sign(s.md)},s.verify=function(){var e=!1,t=s.md;if(t===null){t=Cd({signatureOid:s.signatureOid,type:"certification request"});var r=s.certificationRequestInfo||ae.getCertificationRequestInfo(s),a=w.toDer(r);t.update(a.getBytes())}return t!==null&&(e=Wy({certificate:s,md:t,signature:s.signature})),e},s};function yu(s){for(var e=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]),t,r,a=s.attributes,n=0;n<a.length;++n){t=a[n];var i=t.value,o=w.Type.PRINTABLESTRING;"valueTagClass"in t&&(o=t.valueTagClass,o===w.Type.UTF8&&(i=Ie.util.encodeUtf8(i))),r=w.create(w.Class.UNIVERSAL,w.Type.SET,!0,[w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(t.type).getBytes()),w.create(w.Class.UNIVERSAL,o,!1,i)])]),e.value.push(r)}return e}function ts(s){for(var e,t=0;t<s.length;++t){if(e=s[t],typeof e.name>"u"&&(e.type&&e.type in ae.oids?e.name=ae.oids[e.type]:e.shortName&&e.shortName in Tt&&(e.name=ae.oids[Tt[e.shortName]])),typeof e.type>"u")if(e.name&&e.name in ae.oids)e.type=ae.oids[e.name];else{var r=new Error("Attribute type not specified.");throw r.attribute=e,r}if(typeof e.shortName>"u"&&e.name&&e.name in Tt&&(e.shortName=Tt[e.name]),e.type===We.extensionRequest&&(e.valueConstructed=!0,e.valueTagClass=w.Type.SEQUENCE,!e.value&&e.extensions)){e.value=[];for(var a=0;a<e.extensions.length;++a)e.value.push(ae.certificateExtensionToAsn1(Qy(e.extensions[a])))}if(typeof e.value>"u"){var r=new Error("Attribute value not specified.");throw r.attribute=e,r}}}function Qy(s,e){if(e=e||{},typeof s.name>"u"&&s.id&&s.id in ae.oids&&(s.name=ae.oids[s.id]),typeof s.id>"u")if(s.name&&s.name in ae.oids)s.id=ae.oids[s.name];else{var t=new Error("Extension ID not specified.");throw t.extension=s,t}if(typeof s.value<"u")return s;if(s.name==="keyUsage"){var r=0,a=0,n=0;s.digitalSignature&&(a|=128,r=7),s.nonRepudiation&&(a|=64,r=6),s.keyEncipherment&&(a|=32,r=5),s.dataEncipherment&&(a|=16,r=4),s.keyAgreement&&(a|=8,r=3),s.keyCertSign&&(a|=4,r=2),s.cRLSign&&(a|=2,r=1),s.encipherOnly&&(a|=1,r=0),s.decipherOnly&&(n|=128,r=7);var i=String.fromCharCode(r);n!==0?i+=String.fromCharCode(a)+String.fromCharCode(n):a!==0&&(i+=String.fromCharCode(a)),s.value=w.create(w.Class.UNIVERSAL,w.Type.BITSTRING,!1,i)}else if(s.name==="basicConstraints")s.value=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]),s.cA&&s.value.value.push(w.create(w.Class.UNIVERSAL,w.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in s&&s.value.value.push(w.create(w.Class.UNIVERSAL,w.Type.INTEGER,!1,w.integerToDer(s.pathLenConstraint).getBytes()));else if(s.name==="extKeyUsage"){s.value=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]);var o=s.value.value;for(var l in s)s[l]===!0&&(l in We?o.push(w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(We[l]).getBytes())):l.indexOf(".")!==-1&&o.push(w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(l).getBytes())))}else if(s.name==="nsCertType"){var r=0,a=0;s.client&&(a|=128,r=7),s.server&&(a|=64,r=6),s.email&&(a|=32,r=5),s.objsign&&(a|=16,r=4),s.reserved&&(a|=8,r=3),s.sslCA&&(a|=4,r=2),s.emailCA&&(a|=2,r=1),s.objCA&&(a|=1,r=0);var i=String.fromCharCode(r);a!==0&&(i+=String.fromCharCode(a)),s.value=w.create(w.Class.UNIVERSAL,w.Type.BITSTRING,!1,i)}else if(s.name==="subjectAltName"||s.name==="issuerAltName"){s.value=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]);for(var u,c=0;c<s.altNames.length;++c){u=s.altNames[c];var i=u.value;if(u.type===7&&u.ip){if(i=Ie.util.bytesFromIP(u.ip),i===null){var t=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw t.extension=s,t}}else u.type===8&&(u.oid?i=w.oidToDer(w.oidToDer(u.oid)):i=w.oidToDer(i));s.value.value.push(w.create(w.Class.CONTEXT_SPECIFIC,u.type,!1,i))}}else if(s.name==="nsComment"&&e.cert){if(!/^[\x00-\x7F]*$/.test(s.comment)||s.comment.length<1||s.comment.length>128)throw new Error('Invalid "nsComment" content.');s.value=w.create(w.Class.UNIVERSAL,w.Type.IA5STRING,!1,s.comment)}else if(s.name==="subjectKeyIdentifier"&&e.cert){var f=e.cert.generateSubjectKeyIdentifier();s.subjectKeyIdentifier=f.toHex(),s.value=w.create(w.Class.UNIVERSAL,w.Type.OCTETSTRING,!1,f.getBytes())}else if(s.name==="authorityKeyIdentifier"&&e.cert){s.value=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]);var o=s.value.value;if(s.keyIdentifier){var g=s.keyIdentifier===!0?e.cert.generateSubjectKeyIdentifier().getBytes():s.keyIdentifier;o.push(w.create(w.Class.CONTEXT_SPECIFIC,0,!1,g))}if(s.authorityCertIssuer){var v=[w.create(w.Class.CONTEXT_SPECIFIC,4,!0,[yu(s.authorityCertIssuer===!0?e.cert.issuer:s.authorityCertIssuer)])];o.push(w.create(w.Class.CONTEXT_SPECIFIC,1,!0,v))}if(s.serialNumber){var p=Ie.util.hexToBytes(s.serialNumber===!0?e.cert.serialNumber:s.serialNumber);o.push(w.create(w.Class.CONTEXT_SPECIFIC,2,!1,p))}}else if(s.name==="cRLDistributionPoints"){s.value=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]);for(var o=s.value.value,h=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]),d=w.create(w.Class.CONTEXT_SPECIFIC,0,!0,[]),u,c=0;c<s.altNames.length;++c){u=s.altNames[c];var i=u.value;if(u.type===7&&u.ip){if(i=Ie.util.bytesFromIP(u.ip),i===null){var t=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw t.extension=s,t}}else u.type===8&&(u.oid?i=w.oidToDer(w.oidToDer(u.oid)):i=w.oidToDer(i));d.value.push(w.create(w.Class.CONTEXT_SPECIFIC,u.type,!1,i))}h.value.push(w.create(w.Class.CONTEXT_SPECIFIC,0,!0,[d])),o.push(h)}if(typeof s.value>"u"){var t=new Error("Extension value not specified.");throw t.extension=s,t}return s}function vm(s,e){switch(s){case We["RSASSA-PSS"]:var t=[];return e.hash.algorithmOid!==void 0&&t.push(w.create(w.Class.CONTEXT_SPECIFIC,0,!0,[w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(e.hash.algorithmOid).getBytes()),w.create(w.Class.UNIVERSAL,w.Type.NULL,!1,"")])])),e.mgf.algorithmOid!==void 0&&t.push(w.create(w.Class.CONTEXT_SPECIFIC,1,!0,[w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(e.mgf.algorithmOid).getBytes()),w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(e.mgf.hash.algorithmOid).getBytes()),w.create(w.Class.UNIVERSAL,w.Type.NULL,!1,"")])])])),e.saltLength!==void 0&&t.push(w.create(w.Class.CONTEXT_SPECIFIC,2,!0,[w.create(w.Class.UNIVERSAL,w.Type.INTEGER,!1,w.integerToDer(e.saltLength).getBytes())])),w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,t);default:return w.create(w.Class.UNIVERSAL,w.Type.NULL,!1,"")}}function GC(s){var e=w.create(w.Class.CONTEXT_SPECIFIC,0,!0,[]);if(s.attributes.length===0)return e;for(var t=s.attributes,r=0;r<t.length;++r){var a=t[r],n=a.value,i=w.Type.UTF8;"valueTagClass"in a&&(i=a.valueTagClass),i===w.Type.UTF8&&(n=Ie.util.encodeUtf8(n));var o=!1;"valueConstructed"in a&&(o=a.valueConstructed);var l=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(a.type).getBytes()),w.create(w.Class.UNIVERSAL,w.Type.SET,!0,[w.create(w.Class.UNIVERSAL,i,o,n)])]);e.value.push(l)}return e}var jC=new Date("1950-01-01T00:00:00Z"),WC=new Date("2050-01-01T00:00:00Z");function wp(s){return s>=jC&&s<WC?w.create(w.Class.UNIVERSAL,w.Type.UTCTIME,!1,w.dateToUtcTime(s)):w.create(w.Class.UNIVERSAL,w.Type.GENERALIZEDTIME,!1,w.dateToGeneralizedTime(s))}ae.getTBSCertificate=function(s){var e=wp(s.validity.notBefore),t=wp(s.validity.notAfter),r=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.CONTEXT_SPECIFIC,0,!0,[w.create(w.Class.UNIVERSAL,w.Type.INTEGER,!1,w.integerToDer(s.version).getBytes())]),w.create(w.Class.UNIVERSAL,w.Type.INTEGER,!1,Ie.util.hexToBytes(s.serialNumber)),w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(s.siginfo.algorithmOid).getBytes()),vm(s.siginfo.algorithmOid,s.siginfo.parameters)]),yu(s.issuer),w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[e,t]),yu(s.subject),ae.publicKeyToAsn1(s.publicKey)]);return s.issuer.uniqueId&&r.value.push(w.create(w.Class.CONTEXT_SPECIFIC,1,!0,[w.create(w.Class.UNIVERSAL,w.Type.BITSTRING,!1,String.fromCharCode(0)+s.issuer.uniqueId)])),s.subject.uniqueId&&r.value.push(w.create(w.Class.CONTEXT_SPECIFIC,2,!0,[w.create(w.Class.UNIVERSAL,w.Type.BITSTRING,!1,String.fromCharCode(0)+s.subject.uniqueId)])),s.extensions.length>0&&r.value.push(ae.certificateExtensionsToAsn1(s.extensions)),r};ae.getCertificationRequestInfo=function(s){var e=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.INTEGER,!1,w.integerToDer(s.version).getBytes()),yu(s.subject),ae.publicKeyToAsn1(s.publicKey),GC(s)]);return e};ae.distinguishedNameToAsn1=function(s){return yu(s)};ae.certificateToAsn1=function(s){var e=s.tbsCertificate||ae.getTBSCertificate(s);return w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[e,w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(s.signatureOid).getBytes()),vm(s.signatureOid,s.signatureParameters)]),w.create(w.Class.UNIVERSAL,w.Type.BITSTRING,!1,String.fromCharCode(0)+s.signature)])};ae.certificateExtensionsToAsn1=function(s){var e=w.create(w.Class.CONTEXT_SPECIFIC,3,!0,[]),t=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]);e.value.push(t);for(var r=0;r<s.length;++r)t.value.push(ae.certificateExtensionToAsn1(s[r]));return e};ae.certificateExtensionToAsn1=function(s){var e=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[]);e.value.push(w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(s.id).getBytes())),s.critical&&e.value.push(w.create(w.Class.UNIVERSAL,w.Type.BOOLEAN,!1,String.fromCharCode(255)));var t=s.value;return typeof s.value!="string"&&(t=w.toDer(t).getBytes()),e.value.push(w.create(w.Class.UNIVERSAL,w.Type.OCTETSTRING,!1,t)),e};ae.certificationRequestToAsn1=function(s){var e=s.certificationRequestInfo||ae.getCertificationRequestInfo(s);return w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[e,w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(s.signatureOid).getBytes()),vm(s.signatureOid,s.signatureParameters)]),w.create(w.Class.UNIVERSAL,w.Type.BITSTRING,!1,String.fromCharCode(0)+s.signature)])};ae.createCaStore=function(s){var e={certs:{}};e.getIssuer=function(i){var o=t(i.issuer);return o},e.addCertificate=function(i){if(typeof i=="string"&&(i=Ie.pki.certificateFromPem(i)),r(i.subject),!e.hasCertificate(i))if(i.subject.hash in e.certs){var o=e.certs[i.subject.hash];Ie.util.isArray(o)||(o=[o]),o.push(i),e.certs[i.subject.hash]=o}else e.certs[i.subject.hash]=i},e.hasCertificate=function(i){typeof i=="string"&&(i=Ie.pki.certificateFromPem(i));var o=t(i.subject);if(!o)return!1;Ie.util.isArray(o)||(o=[o]);for(var l=w.toDer(ae.certificateToAsn1(i)).getBytes(),u=0;u<o.length;++u){var c=w.toDer(ae.certificateToAsn1(o[u])).getBytes();if(l===c)return!0}return!1},e.listAllCertificates=function(){var i=[];for(var o in e.certs)if(e.certs.hasOwnProperty(o)){var l=e.certs[o];if(!Ie.util.isArray(l))i.push(l);else for(var u=0;u<l.length;++u)i.push(l[u])}return i},e.removeCertificate=function(i){var o;if(typeof i=="string"&&(i=Ie.pki.certificateFromPem(i)),r(i.subject),!e.hasCertificate(i))return null;var l=t(i.subject);if(!Ie.util.isArray(l))return o=e.certs[i.subject.hash],delete e.certs[i.subject.hash],o;for(var u=w.toDer(ae.certificateToAsn1(i)).getBytes(),c=0;c<l.length;++c){var f=w.toDer(ae.certificateToAsn1(l[c])).getBytes();u===f&&(o=l[c],l.splice(c,1))}return l.length===0&&delete e.certs[i.subject.hash],o};function t(i){return r(i),e.certs[i.hash]||null}function r(i){if(!i.hash){var o=Ie.md.sha1.create();i.attributes=ae.RDNAttributesAsArray(yu(i),o),i.hash=o.digest().toHex()}}if(s)for(var a=0;a<s.length;++a){var n=s[a];e.addCertificate(n)}return e};ae.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"};ae.verifyCertificateChain=function(s,e,t){typeof t=="function"&&(t={verify:t}),t=t||{},e=e.slice(0);var r=e.slice(0),a=t.validityCheckDate;typeof a>"u"&&(a=new Date);var n=!0,i=null,o=0;do{var l=e.shift(),u=null,c=!1;if(a&&(a<l.validity.notBefore||a>l.validity.notAfter)&&(i={message:"Certificate is not valid yet or has expired.",error:ae.certificateError.certificate_expired,notBefore:l.validity.notBefore,notAfter:l.validity.notAfter,now:a}),i===null){if(u=e[0]||s.getIssuer(l),u===null&&l.isIssuer(l)&&(c=!0,u=l),u){var f=u;Ie.util.isArray(f)||(f=[f]);for(var g=!1;!g&&f.length>0;){u=f.shift();try{g=u.verify(l)}catch{}}g||(i={message:"Certificate signature is invalid.",error:ae.certificateError.bad_certificate})}i===null&&(!u||c)&&!s.hasCertificate(l)&&(i={message:"Certificate is not trusted.",error:ae.certificateError.unknown_ca})}if(i===null&&u&&!l.isIssuer(u)&&(i={message:"Certificate issuer is invalid.",error:ae.certificateError.bad_certificate}),i===null)for(var v={keyUsage:!0,basicConstraints:!0},p=0;i===null&&p<l.extensions.length;++p){var h=l.extensions[p];h.critical&&!(h.name in v)&&(i={message:"Certificate has an unsupported critical extension.",error:ae.certificateError.unsupported_certificate})}if(i===null&&(!n||e.length===0&&(!u||c))){var d=l.getExtension("basicConstraints"),y=l.getExtension("keyUsage");if(y!==null&&(!y.keyCertSign||d===null)&&(i={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:ae.certificateError.bad_certificate}),i===null&&d!==null&&!d.cA&&(i={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:ae.certificateError.bad_certificate}),i===null&&y!==null&&"pathLenConstraint"in d){var A=o-1;A>d.pathLenConstraint&&(i={message:"Certificate basicConstraints pathLenConstraint violated.",error:ae.certificateError.bad_certificate})}}var x=i===null?!0:i.error,N=t.verify?t.verify(x,o,r):x;if(N===!0)i=null;else throw x===!0&&(i={message:"The application rejected the certificate.",error:ae.certificateError.bad_certificate}),(N||N===0)&&(typeof N=="object"&&!Ie.util.isArray(N)?(N.message&&(i.message=N.message),N.error&&(i.error=N.error)):typeof N=="string"&&(i.error=N)),i;n=!1,++o}while(e.length>0);return!0};var ht=Me,B=ht.asn1,Ke=ht.pki,th=ht.pkcs12=ht.pkcs12||{},Yy={name:"ContentInfo",tagClass:B.Class.UNIVERSAL,type:B.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.contentType",tagClass:B.Class.UNIVERSAL,type:B.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:B.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"content"}]},QC={name:"PFX",tagClass:B.Class.UNIVERSAL,type:B.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.version",tagClass:B.Class.UNIVERSAL,type:B.Type.INTEGER,constructed:!1,capture:"version"},Yy,{name:"PFX.macData",tagClass:B.Class.UNIVERSAL,type:B.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"mac",value:[{name:"PFX.macData.mac",tagClass:B.Class.UNIVERSAL,type:B.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm",tagClass:B.Class.UNIVERSAL,type:B.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm.algorithm",tagClass:B.Class.UNIVERSAL,type:B.Type.OID,constructed:!1,capture:"macAlgorithm"},{name:"PFX.macData.mac.digestAlgorithm.parameters",tagClass:B.Class.UNIVERSAL,captureAsn1:"macAlgorithmParameters"}]},{name:"PFX.macData.mac.digest",tagClass:B.Class.UNIVERSAL,type:B.Type.OCTETSTRING,constructed:!1,capture:"macDigest"}]},{name:"PFX.macData.macSalt",tagClass:B.Class.UNIVERSAL,type:B.Type.OCTETSTRING,constructed:!1,capture:"macSalt"},{name:"PFX.macData.iterations",tagClass:B.Class.UNIVERSAL,type:B.Type.INTEGER,constructed:!1,optional:!0,capture:"macIterations"}]}]},YC={name:"SafeBag",tagClass:B.Class.UNIVERSAL,type:B.Type.SEQUENCE,constructed:!0,value:[{name:"SafeBag.bagId",tagClass:B.Class.UNIVERSAL,type:B.Type.OID,constructed:!1,capture:"bagId"},{name:"SafeBag.bagValue",tagClass:B.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"bagValue"},{name:"SafeBag.bagAttributes",tagClass:B.Class.UNIVERSAL,type:B.Type.SET,constructed:!0,optional:!0,capture:"bagAttributes"}]},zC={name:"Attribute",tagClass:B.Class.UNIVERSAL,type:B.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:B.Class.UNIVERSAL,type:B.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:B.Class.UNIVERSAL,type:B.Type.SET,constructed:!0,capture:"values"}]},XC={name:"CertBag",tagClass:B.Class.UNIVERSAL,type:B.Type.SEQUENCE,constructed:!0,value:[{name:"CertBag.certId",tagClass:B.Class.UNIVERSAL,type:B.Type.OID,constructed:!1,capture:"certId"},{name:"CertBag.certValue",tagClass:B.Class.CONTEXT_SPECIFIC,constructed:!0,value:[{name:"CertBag.certValue[0]",tagClass:B.Class.UNIVERSAL,type:B.Class.OCTETSTRING,constructed:!1,capture:"cert"}]}]};function Vu(s,e,t,r){for(var a=[],n=0;n<s.length;n++)for(var i=0;i<s[n].safeBags.length;i++){var o=s[n].safeBags[i];if(!(r!==void 0&&o.type!==r)){if(e===null){a.push(o);continue}o.attributes[e]!==void 0&&o.attributes[e].indexOf(t)>=0&&a.push(o)}}return a}th.pkcs12FromAsn1=function(s,e,t){typeof e=="string"?(t=e,e=!0):e===void 0&&(e=!0);var r={},a=[];if(!B.validate(s,QC,r,a)){var n=new Error("Cannot read PKCS#12 PFX. ASN.1 object is not an PKCS#12 PFX.");throw n.errors=n,n}var i={version:r.version.charCodeAt(0),safeContents:[],getBags:function(d){var y={},A;return"localKeyId"in d?A=d.localKeyId:"localKeyIdHex"in d&&(A=ht.util.hexToBytes(d.localKeyIdHex)),A===void 0&&!("friendlyName"in d)&&"bagType"in d&&(y[d.bagType]=Vu(i.safeContents,null,null,d.bagType)),A!==void 0&&(y.localKeyId=Vu(i.safeContents,"localKeyId",A,d.bagType)),"friendlyName"in d&&(y.friendlyName=Vu(i.safeContents,"friendlyName",d.friendlyName,d.bagType)),y},getBagsByFriendlyName:function(d,y){return Vu(i.safeContents,"friendlyName",d,y)},getBagsByLocalKeyId:function(d,y){return Vu(i.safeContents,"localKeyId",d,y)}};if(r.version.charCodeAt(0)!==3){var n=new Error("PKCS#12 PFX of version other than 3 not supported.");throw n.version=r.version.charCodeAt(0),n}if(B.derToOid(r.contentType)!==Ke.oids.data){var n=new Error("Only PKCS#12 PFX in password integrity mode supported.");throw n.oid=B.derToOid(r.contentType),n}var o=r.content.value[0];if(o.tagClass!==B.Class.UNIVERSAL||o.type!==B.Type.OCTETSTRING)throw new Error("PKCS#12 authSafe content data is not an OCTET STRING.");if(o=wm(o),r.mac){var l=null,u=0,c=B.derToOid(r.macAlgorithm);switch(c){case Ke.oids.sha1:l=ht.md.sha1.create(),u=20;break;case Ke.oids.sha256:l=ht.md.sha256.create(),u=32;break;case Ke.oids.sha384:l=ht.md.sha384.create(),u=48;break;case Ke.oids.sha512:l=ht.md.sha512.create(),u=64;break;case Ke.oids.md5:l=ht.md.md5.create(),u=16;break}if(l===null)throw new Error("PKCS#12 uses unsupported MAC algorithm: "+c);var f=new ht.util.ByteBuffer(r.macSalt),g="macIterations"in r?parseInt(ht.util.bytesToHex(r.macIterations),16):1,v=th.generateKey(t,f,3,g,u,l),p=ht.hmac.create();p.start(l,v),p.update(o.value);var h=p.getMac();if(h.getBytes()!==r.macDigest)throw new Error("PKCS#12 MAC could not be verified. Invalid password?")}return ZC(i,o.value,e,t),i};function wm(s){if(s.composed||s.constructed){for(var e=ht.util.createBuffer(),t=0;t<s.value.length;++t)e.putBytes(s.value[t].value);s.composed=s.constructed=!1,s.value=e.getBytes()}return s}function ZC(s,e,t,r){if(e=B.fromDer(e,t),e.tagClass!==B.Class.UNIVERSAL||e.type!==B.Type.SEQUENCE||e.constructed!==!0)throw new Error("PKCS#12 AuthenticatedSafe expected to be a SEQUENCE OF ContentInfo");for(var a=0;a<e.value.length;a++){var n=e.value[a],i={},o=[];if(!B.validate(n,Yy,i,o)){var l=new Error("Cannot read ContentInfo.");throw l.errors=o,l}var u={encrypted:!1},c=null,f=i.content.value[0];switch(B.derToOid(i.contentType)){case Ke.oids.data:if(f.tagClass!==B.Class.UNIVERSAL||f.type!==B.Type.OCTETSTRING)throw new Error("PKCS#12 SafeContents Data is not an OCTET STRING.");c=wm(f).value;break;case Ke.oids.encryptedData:c=eA(f,r),u.encrypted=!0;break;default:var l=new Error("Unsupported PKCS#12 contentType.");throw l.contentType=B.derToOid(i.contentType),l}u.safeBags=tA(c,t,r),s.safeContents.push(u)}}function eA(s,e){var t={},r=[];if(!B.validate(s,ht.pkcs7.asn1.encryptedDataValidator,t,r)){var a=new Error("Cannot read EncryptedContentInfo.");throw a.errors=r,a}var n=B.derToOid(t.contentType);if(n!==Ke.oids.data){var a=new Error("PKCS#12 EncryptedContentInfo ContentType is not Data.");throw a.oid=n,a}n=B.derToOid(t.encAlgorithm);var i=Ke.pbe.getCipher(n,t.encParameter,e),o=wm(t.encryptedContentAsn1),l=ht.util.createBuffer(o.value);if(i.update(l),!i.finish())throw new Error("Failed to decrypt PKCS#12 SafeContents.");return i.output.getBytes()}function tA(s,e,t){if(!e&&s.length===0)return[];if(s=B.fromDer(s,e),s.tagClass!==B.Class.UNIVERSAL||s.type!==B.Type.SEQUENCE||s.constructed!==!0)throw new Error("PKCS#12 SafeContents expected to be a SEQUENCE OF SafeBag.");for(var r=[],a=0;a<s.value.length;a++){var n=s.value[a],i={},o=[];if(!B.validate(n,YC,i,o)){var l=new Error("Cannot read SafeBag.");throw l.errors=o,l}var u={type:B.derToOid(i.bagId),attributes:rA(i.bagAttributes)};r.push(u);var c,f,g=i.bagValue.value[0];switch(u.type){case Ke.oids.pkcs8ShroudedKeyBag:if(g=Ke.decryptPrivateKeyInfo(g,t),g===null)throw new Error("Unable to decrypt PKCS#8 ShroudedKeyBag, wrong password?");case Ke.oids.keyBag:try{u.key=Ke.privateKeyFromAsn1(g)}catch{u.key=null,u.asn1=g}continue;case Ke.oids.certBag:c=XC,f=function(){if(B.derToOid(i.certId)!==Ke.oids.x509Certificate){var p=new Error("Unsupported certificate type, only X.509 supported.");throw p.oid=B.derToOid(i.certId),p}var h=B.fromDer(i.cert,e);try{u.cert=Ke.certificateFromAsn1(h,!0)}catch{u.cert=null,u.asn1=h}};break;default:var l=new Error("Unsupported PKCS#12 SafeBag type.");throw l.oid=u.type,l}if(c!==void 0&&!B.validate(g,c,i,o)){var l=new Error("Cannot read PKCS#12 "+c.name);throw l.errors=o,l}f()}return r}function rA(s){var e={};if(s!==void 0)for(var t=0;t<s.length;++t){var r={},a=[];if(!B.validate(s[t],zC,r,a)){var n=new Error("Cannot read PKCS#12 BagAttribute.");throw n.errors=a,n}var i=B.derToOid(r.oid);if(Ke.oids[i]!==void 0){e[Ke.oids[i]]=[];for(var o=0;o<r.values.length;++o)e[Ke.oids[i]].push(r.values[o].value)}}return e}th.toPkcs12Asn1=function(s,e,t,r){r=r||{},r.saltSize=r.saltSize||8,r.count=r.count||2048,r.algorithm=r.algorithm||r.encAlgorithm||"aes128","useMac"in r||(r.useMac=!0),"localKeyId"in r||(r.localKeyId=null),"generateLocalKeyId"in r||(r.generateLocalKeyId=!0);var a=r.localKeyId,n;if(a!==null)a=ht.util.hexToBytes(a);else if(r.generateLocalKeyId)if(e){var i=ht.util.isArray(e)?e[0]:e;typeof i=="string"&&(i=Ke.certificateFromPem(i));var o=ht.md.sha1.create();o.update(B.toDer(Ke.certificateToAsn1(i)).getBytes()),a=o.digest().getBytes()}else a=ht.random.getBytes(20);var l=[];a!==null&&l.push(B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(Ke.oids.localKeyId).getBytes()),B.create(B.Class.UNIVERSAL,B.Type.SET,!0,[B.create(B.Class.UNIVERSAL,B.Type.OCTETSTRING,!1,a)])])),"friendlyName"in r&&l.push(B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(Ke.oids.friendlyName).getBytes()),B.create(B.Class.UNIVERSAL,B.Type.SET,!0,[B.create(B.Class.UNIVERSAL,B.Type.BMPSTRING,!1,r.friendlyName)])])),l.length>0&&(n=B.create(B.Class.UNIVERSAL,B.Type.SET,!0,l));var u=[],c=[];e!==null&&(ht.util.isArray(e)?c=e:c=[e]);for(var f=[],g=0;g<c.length;++g){e=c[g],typeof e=="string"&&(e=Ke.certificateFromPem(e));var v=g===0?n:void 0,p=Ke.certificateToAsn1(e),h=B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(Ke.oids.certBag).getBytes()),B.create(B.Class.CONTEXT_SPECIFIC,0,!0,[B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(Ke.oids.x509Certificate).getBytes()),B.create(B.Class.CONTEXT_SPECIFIC,0,!0,[B.create(B.Class.UNIVERSAL,B.Type.OCTETSTRING,!1,B.toDer(p).getBytes())])])]),v]);f.push(h)}if(f.length>0){var d=B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,f),y=B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(Ke.oids.data).getBytes()),B.create(B.Class.CONTEXT_SPECIFIC,0,!0,[B.create(B.Class.UNIVERSAL,B.Type.OCTETSTRING,!1,B.toDer(d).getBytes())])]);u.push(y)}var A=null;if(s!==null){var x=Ke.wrapRsaPrivateKey(Ke.privateKeyToAsn1(s));t===null?A=B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(Ke.oids.keyBag).getBytes()),B.create(B.Class.CONTEXT_SPECIFIC,0,!0,[x]),n]):A=B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(Ke.oids.pkcs8ShroudedKeyBag).getBytes()),B.create(B.Class.CONTEXT_SPECIFIC,0,!0,[Ke.encryptPrivateKeyInfo(x,t,r)]),n]);var N=B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[A]),_=B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(Ke.oids.data).getBytes()),B.create(B.Class.CONTEXT_SPECIFIC,0,!0,[B.create(B.Class.UNIVERSAL,B.Type.OCTETSTRING,!1,B.toDer(N).getBytes())])]);u.push(_)}var $=B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,u),se;if(r.useMac){var o=ht.md.sha1.create(),te=new ht.util.ByteBuffer(ht.random.getBytes(r.saltSize)),me=r.count,s=th.generateKey(t,te,3,me,20),Ce=ht.hmac.create();Ce.start(o,s),Ce.update(B.toDer($).getBytes());var pe=Ce.getMac();se=B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(Ke.oids.sha1).getBytes()),B.create(B.Class.UNIVERSAL,B.Type.NULL,!1,"")]),B.create(B.Class.UNIVERSAL,B.Type.OCTETSTRING,!1,pe.getBytes())]),B.create(B.Class.UNIVERSAL,B.Type.OCTETSTRING,!1,te.getBytes()),B.create(B.Class.UNIVERSAL,B.Type.INTEGER,!1,B.integerToDer(me).getBytes())])}return B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.INTEGER,!1,B.integerToDer(3).getBytes()),B.create(B.Class.UNIVERSAL,B.Type.SEQUENCE,!0,[B.create(B.Class.UNIVERSAL,B.Type.OID,!1,B.oidToDer(Ke.oids.data).getBytes()),B.create(B.Class.CONTEXT_SPECIFIC,0,!0,[B.create(B.Class.UNIVERSAL,B.Type.OCTETSTRING,!1,B.toDer($).getBytes())])]),se])};th.generateKey=ht.pbe.generatePkcs12Key;var Ln=Me,Sm=Ln.asn1,vu=Ln.pki=Ln.pki||{};vu.pemToDer=function(s){var e=Ln.pem.decode(s)[0];if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert PEM to DER; PEM is encrypted.");return Ln.util.createBuffer(e.body)};vu.privateKeyFromPem=function(s){var e=Ln.pem.decode(s)[0];if(e.type!=="PRIVATE KEY"&&e.type!=="RSA PRIVATE KEY"){var t=new Error('Could not convert private key from PEM; PEM header type is not "PRIVATE KEY" or "RSA PRIVATE KEY".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert private key from PEM; PEM is encrypted.");var r=Sm.fromDer(e.body);return vu.privateKeyFromAsn1(r)};vu.privateKeyToPem=function(s,e){var t={type:"RSA PRIVATE KEY",body:Sm.toDer(vu.privateKeyToAsn1(s)).getBytes()};return Ln.pem.encode(t,{maxline:e})};vu.privateKeyInfoToPem=function(s,e){var t={type:"PRIVATE KEY",body:Sm.toDer(s).getBytes()};return Ln.pem.encode(t,{maxline:e})};var Q=Me,Ad=function(s,e,t,r){var a=Q.util.createBuffer(),n=s.length>>1,i=n+(s.length&1),o=s.substr(0,i),l=s.substr(n,i),u=Q.util.createBuffer(),c=Q.hmac.create();t=e+t;var f=Math.ceil(r/16),g=Math.ceil(r/20);c.start("MD5",o);var v=Q.util.createBuffer();u.putBytes(t);for(var p=0;p<f;++p)c.start(null,null),c.update(u.getBytes()),u.putBuffer(c.digest()),c.start(null,null),c.update(u.bytes()+t),v.putBuffer(c.digest());c.start("SHA1",l);var h=Q.util.createBuffer();u.clear(),u.putBytes(t);for(var p=0;p<g;++p)c.start(null,null),c.update(u.getBytes()),u.putBuffer(c.digest()),c.start(null,null),c.update(u.bytes()+t),h.putBuffer(c.digest());return a.putBytes(Q.util.xorBytes(v.getBytes(),h.getBytes(),r)),a},sA=function(s,e,t){var r=Q.hmac.create();r.start("SHA1",s);var a=Q.util.createBuffer();return a.putInt32(e[0]),a.putInt32(e[1]),a.putByte(t.type),a.putByte(t.version.major),a.putByte(t.version.minor),a.putInt16(t.length),a.putBytes(t.fragment.bytes()),r.update(a.getBytes()),r.digest().getBytes()},aA=function(s,e,t){var r=!1;try{var a=s.deflate(e.fragment.getBytes());e.fragment=Q.util.createBuffer(a),e.length=a.length,r=!0}catch{}return r},nA=function(s,e,t){var r=!1;try{var a=s.inflate(e.fragment.getBytes());e.fragment=Q.util.createBuffer(a),e.length=a.length,r=!0}catch{}return r},Dr=function(s,e){var t=0;switch(e){case 1:t=s.getByte();break;case 2:t=s.getInt16();break;case 3:t=s.getInt24();break;case 4:t=s.getInt32();break}return Q.util.createBuffer(s.getBytes(t))},Gr=function(s,e,t){s.putInt(t.length(),e<<3),s.putBuffer(t)},b={};b.Versions={TLS_1_0:{major:3,minor:1},TLS_1_1:{major:3,minor:2},TLS_1_2:{major:3,minor:3}};b.SupportedVersions=[b.Versions.TLS_1_1,b.Versions.TLS_1_0];b.Version=b.SupportedVersions[0];b.MaxFragment=16384-1024;b.ConnectionEnd={server:0,client:1};b.PRFAlgorithm={tls_prf_sha256:0};b.BulkCipherAlgorithm={none:null,rc4:0,des3:1,aes:2};b.CipherType={stream:0,block:1,aead:2};b.MACAlgorithm={none:null,hmac_md5:0,hmac_sha1:1,hmac_sha256:2,hmac_sha384:3,hmac_sha512:4};b.CompressionMethod={none:0,deflate:1};b.ContentType={change_cipher_spec:20,alert:21,handshake:22,application_data:23,heartbeat:24};b.HandshakeType={hello_request:0,client_hello:1,server_hello:2,certificate:11,server_key_exchange:12,certificate_request:13,server_hello_done:14,certificate_verify:15,client_key_exchange:16,finished:20};b.Alert={};b.Alert.Level={warning:1,fatal:2};b.Alert.Description={close_notify:0,unexpected_message:10,bad_record_mac:20,decryption_failed:21,record_overflow:22,decompression_failure:30,handshake_failure:40,bad_certificate:42,unsupported_certificate:43,certificate_revoked:44,certificate_expired:45,certificate_unknown:46,illegal_parameter:47,unknown_ca:48,access_denied:49,decode_error:50,decrypt_error:51,export_restriction:60,protocol_version:70,insufficient_security:71,internal_error:80,user_canceled:90,no_renegotiation:100};b.HeartbeatMessageType={heartbeat_request:1,heartbeat_response:2};b.CipherSuites={};b.getCipherSuite=function(s){var e=null;for(var t in b.CipherSuites){var r=b.CipherSuites[t];if(r.id[0]===s.charCodeAt(0)&&r.id[1]===s.charCodeAt(1)){e=r;break}}return e};b.handleUnexpected=function(s,e){var t=!s.open&&s.entity===b.ConnectionEnd.client;t||s.error(s,{message:"Unexpected message. Received TLS record out of order.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.unexpected_message}})};b.handleHelloRequest=function(s,e,t){!s.handshaking&&s.handshakes>0&&(b.queue(s,b.createAlert(s,{level:b.Alert.Level.warning,description:b.Alert.Description.no_renegotiation})),b.flush(s)),s.process()};b.parseHelloMessage=function(s,e,t){var r=null,a=s.entity===b.ConnectionEnd.client;if(t<38)s.error(s,{message:a?"Invalid ServerHello message. Message too short.":"Invalid ClientHello message. Message too short.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.illegal_parameter}});else{var n=e.fragment,i=n.length();if(r={version:{major:n.getByte(),minor:n.getByte()},random:Q.util.createBuffer(n.getBytes(32)),session_id:Dr(n,1),extensions:[]},a?(r.cipher_suite=n.getBytes(2),r.compression_method=n.getByte()):(r.cipher_suites=Dr(n,2),r.compression_methods=Dr(n,1)),i=t-(i-n.length()),i>0){for(var o=Dr(n,2);o.length()>0;)r.extensions.push({type:[o.getByte(),o.getByte()],data:Dr(o,2)});if(!a)for(var l=0;l<r.extensions.length;++l){var u=r.extensions[l];if(u.type[0]===0&&u.type[1]===0)for(var c=Dr(u.data,2);c.length()>0;){var f=c.getByte();if(f!==0)break;s.session.extensions.server_name.serverNameList.push(Dr(c,2).getBytes())}}}if(s.session.version&&(r.version.major!==s.session.version.major||r.version.minor!==s.session.version.minor))return s.error(s,{message:"TLS version change is disallowed during renegotiation.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.protocol_version}});if(a)s.session.cipherSuite=b.getCipherSuite(r.cipher_suite);else for(var g=Q.util.createBuffer(r.cipher_suites.bytes());g.length()>0&&(s.session.cipherSuite=b.getCipherSuite(g.getBytes(2)),s.session.cipherSuite===null););if(s.session.cipherSuite===null)return s.error(s,{message:"No cipher suites in common.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.handshake_failure},cipherSuite:Q.util.bytesToHex(r.cipher_suite)});a?s.session.compressionMethod=r.compression_method:s.session.compressionMethod=b.CompressionMethod.none}return r};b.createSecurityParameters=function(s,e){var t=s.entity===b.ConnectionEnd.client,r=e.random.bytes(),a=t?s.session.sp.client_random:r,n=t?r:b.createRandom().getBytes();s.session.sp={entity:s.entity,prf_algorithm:b.PRFAlgorithm.tls_prf_sha256,bulk_cipher_algorithm:null,cipher_type:null,enc_key_length:null,block_length:null,fixed_iv_length:null,record_iv_length:null,mac_algorithm:null,mac_length:null,mac_key_length:null,compression_algorithm:s.session.compressionMethod,pre_master_secret:null,master_secret:null,client_random:a,server_random:n}};b.handleServerHello=function(s,e,t){var r=b.parseHelloMessage(s,e,t);if(!s.fail){if(r.version.minor<=s.version.minor)s.version.minor=r.version.minor;else return s.error(s,{message:"Incompatible TLS version.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.protocol_version}});s.session.version=s.version;var a=r.session_id.bytes();a.length>0&&a===s.session.id?(s.expect=zy,s.session.resuming=!0,s.session.sp.server_random=r.random.bytes()):(s.expect=oA,s.session.resuming=!1,b.createSecurityParameters(s,r)),s.session.id=a,s.process()}};b.handleClientHello=function(s,e,t){var r=b.parseHelloMessage(s,e,t);if(!s.fail){var a=r.session_id.bytes(),n=null;if(s.sessionCache&&(n=s.sessionCache.getSession(a),n===null?a="":(n.version.major!==r.version.major||n.version.minor>r.version.minor)&&(n=null,a="")),a.length===0&&(a=Q.random.getBytes(32)),s.session.id=a,s.session.clientHelloVersion=r.version,s.session.sp={},n)s.version=s.session.version=n.version,s.session.sp=n.sp;else{for(var i,o=1;o<b.SupportedVersions.length&&(i=b.SupportedVersions[o],!(i.minor<=r.version.minor));++o);s.version={major:i.major,minor:i.minor},s.session.version=s.version}n!==null?(s.expect=Cm,s.session.resuming=!0,s.session.sp.client_random=r.random.bytes()):(s.expect=s.verifyClient!==!1?gA:Bg,s.session.resuming=!1,b.createSecurityParameters(s,r)),s.open=!0,b.queue(s,b.createRecord(s,{type:b.ContentType.handshake,data:b.createServerHello(s)})),s.session.resuming?(b.queue(s,b.createRecord(s,{type:b.ContentType.change_cipher_spec,data:b.createChangeCipherSpec()})),s.state.pending=b.createConnectionState(s),s.state.current.write=s.state.pending.write,b.queue(s,b.createRecord(s,{type:b.ContentType.handshake,data:b.createFinished(s)}))):(b.queue(s,b.createRecord(s,{type:b.ContentType.handshake,data:b.createCertificate(s)})),s.fail||(b.queue(s,b.createRecord(s,{type:b.ContentType.handshake,data:b.createServerKeyExchange(s)})),s.verifyClient!==!1&&b.queue(s,b.createRecord(s,{type:b.ContentType.handshake,data:b.createCertificateRequest(s)})),b.queue(s,b.createRecord(s,{type:b.ContentType.handshake,data:b.createServerHelloDone(s)})))),b.flush(s),s.process()}};b.handleCertificate=function(s,e,t){if(t<3)return s.error(s,{message:"Invalid Certificate message. Message too short.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.illegal_parameter}});var r=e.fragment,a={certificate_list:Dr(r,3)},n,i,o=[];try{for(;a.certificate_list.length()>0;)n=Dr(a.certificate_list,3),i=Q.asn1.fromDer(n),n=Q.pki.certificateFromAsn1(i,!0),o.push(n)}catch(u){return s.error(s,{message:"Could not parse certificate list.",cause:u,send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.bad_certificate}})}var l=s.entity===b.ConnectionEnd.client;(l||s.verifyClient===!0)&&o.length===0?s.error(s,{message:l?"No server certificate provided.":"No client certificate provided.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.illegal_parameter}}):o.length===0?s.expect=l?Sp:Bg:(l?s.session.serverCertificate=o[0]:s.session.clientCertificate=o[0],b.verifyCertificateChain(s,o)&&(s.expect=l?Sp:Bg)),s.process()};b.handleServerKeyExchange=function(s,e,t){if(t>0)return s.error(s,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.unsupported_certificate}});s.expect=lA,s.process()};b.handleClientKeyExchange=function(s,e,t){if(t<48)return s.error(s,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.unsupported_certificate}});var r=e.fragment,a={enc_pre_master_secret:Dr(r,2).getBytes()},n=null;if(s.getPrivateKey)try{n=s.getPrivateKey(s,s.session.serverCertificate),n=Q.pki.privateKeyFromPem(n)}catch(l){s.error(s,{message:"Could not get private key.",cause:l,send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.internal_error}})}if(n===null)return s.error(s,{message:"No private key set.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.internal_error}});try{var i=s.session.sp;i.pre_master_secret=n.decrypt(a.enc_pre_master_secret);var o=s.session.clientHelloVersion;if(o.major!==i.pre_master_secret.charCodeAt(0)||o.minor!==i.pre_master_secret.charCodeAt(1))throw new Error("TLS version rollback attack detected.")}catch{i.pre_master_secret=Q.random.getBytes(48)}s.expect=Cm,s.session.clientCertificate!==null&&(s.expect=mA),s.process()};b.handleCertificateRequest=function(s,e,t){if(t<3)return s.error(s,{message:"Invalid CertificateRequest. Message too short.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.illegal_parameter}});var r=e.fragment,a={certificate_types:Dr(r,1),certificate_authorities:Dr(r,2)};s.session.certificateRequest=a,s.expect=uA,s.process()};b.handleCertificateVerify=function(s,e,t){if(t<2)return s.error(s,{message:"Invalid CertificateVerify. Message too short.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.illegal_parameter}});var r=e.fragment;r.read-=4;var a=r.bytes();r.read+=4;var n={signature:Dr(r,2).getBytes()},i=Q.util.createBuffer();i.putBuffer(s.session.md5.digest()),i.putBuffer(s.session.sha1.digest()),i=i.getBytes();try{var o=s.session.clientCertificate;if(!o.publicKey.verify(i,n.signature,"NONE"))throw new Error("CertificateVerify signature does not match.");s.session.md5.update(a),s.session.sha1.update(a)}catch{return s.error(s,{message:"Bad signature in CertificateVerify.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.handshake_failure}})}s.expect=Cm,s.process()};b.handleServerHelloDone=function(s,e,t){if(t>0)return s.error(s,{message:"Invalid ServerHelloDone message. Invalid length.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.record_overflow}});if(s.serverCertificate===null){var r={message:"No server certificate provided. Not enough security.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.insufficient_security}},a=0,n=s.verify(s,r.alert.description,a,[]);if(n!==!0)return(n||n===0)&&(typeof n=="object"&&!Q.util.isArray(n)?(n.message&&(r.message=n.message),n.alert&&(r.alert.description=n.alert)):typeof n=="number"&&(r.alert.description=n)),s.error(s,r)}s.session.certificateRequest!==null&&(e=b.createRecord(s,{type:b.ContentType.handshake,data:b.createCertificate(s)}),b.queue(s,e)),e=b.createRecord(s,{type:b.ContentType.handshake,data:b.createClientKeyExchange(s)}),b.queue(s,e),s.expect=hA;var i=function(o,l){o.session.certificateRequest!==null&&o.session.clientCertificate!==null&&b.queue(o,b.createRecord(o,{type:b.ContentType.handshake,data:b.createCertificateVerify(o,l)})),b.queue(o,b.createRecord(o,{type:b.ContentType.change_cipher_spec,data:b.createChangeCipherSpec()})),o.state.pending=b.createConnectionState(o),o.state.current.write=o.state.pending.write,b.queue(o,b.createRecord(o,{type:b.ContentType.handshake,data:b.createFinished(o)})),o.expect=zy,b.flush(o),o.process()};if(s.session.certificateRequest===null||s.session.clientCertificate===null)return i(s,null);b.getClientSignature(s,i)};b.handleChangeCipherSpec=function(s,e){if(e.fragment.getByte()!==1)return s.error(s,{message:"Invalid ChangeCipherSpec message received.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.illegal_parameter}});var t=s.entity===b.ConnectionEnd.client;(s.session.resuming&&t||!s.session.resuming&&!t)&&(s.state.pending=b.createConnectionState(s)),s.state.current.read=s.state.pending.read,(!s.session.resuming&&t||s.session.resuming&&!t)&&(s.state.pending=null),s.expect=t?cA:pA,s.process()};b.handleFinished=function(s,e,t){var r=e.fragment;r.read-=4;var a=r.bytes();r.read+=4;var n=e.fragment.getBytes();r=Q.util.createBuffer(),r.putBuffer(s.session.md5.digest()),r.putBuffer(s.session.sha1.digest());var i=s.entity===b.ConnectionEnd.client,o=i?"server finished":"client finished",l=s.session.sp,u=12,c=Ad;if(r=c(l.master_secret,o,r.getBytes(),u),r.getBytes()!==n)return s.error(s,{message:"Invalid verify_data in Finished message.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.decrypt_error}});s.session.md5.update(a),s.session.sha1.update(a),(s.session.resuming&&i||!s.session.resuming&&!i)&&(b.queue(s,b.createRecord(s,{type:b.ContentType.change_cipher_spec,data:b.createChangeCipherSpec()})),s.state.current.write=s.state.pending.write,s.state.pending=null,b.queue(s,b.createRecord(s,{type:b.ContentType.handshake,data:b.createFinished(s)}))),s.expect=i?fA:yA,s.handshaking=!1,++s.handshakes,s.peerCertificate=i?s.session.serverCertificate:s.session.clientCertificate,b.flush(s),s.isConnected=!0,s.connected(s),s.process()};b.handleAlert=function(s,e){var t=e.fragment,r={level:t.getByte(),description:t.getByte()},a;switch(r.description){case b.Alert.Description.close_notify:a="Connection closed.";break;case b.Alert.Description.unexpected_message:a="Unexpected message.";break;case b.Alert.Description.bad_record_mac:a="Bad record MAC.";break;case b.Alert.Description.decryption_failed:a="Decryption failed.";break;case b.Alert.Description.record_overflow:a="Record overflow.";break;case b.Alert.Description.decompression_failure:a="Decompression failed.";break;case b.Alert.Description.handshake_failure:a="Handshake failure.";break;case b.Alert.Description.bad_certificate:a="Bad certificate.";break;case b.Alert.Description.unsupported_certificate:a="Unsupported certificate.";break;case b.Alert.Description.certificate_revoked:a="Certificate revoked.";break;case b.Alert.Description.certificate_expired:a="Certificate expired.";break;case b.Alert.Description.certificate_unknown:a="Certificate unknown.";break;case b.Alert.Description.illegal_parameter:a="Illegal parameter.";break;case b.Alert.Description.unknown_ca:a="Unknown certificate authority.";break;case b.Alert.Description.access_denied:a="Access denied.";break;case b.Alert.Description.decode_error:a="Decode error.";break;case b.Alert.Description.decrypt_error:a="Decrypt error.";break;case b.Alert.Description.export_restriction:a="Export restriction.";break;case b.Alert.Description.protocol_version:a="Unsupported protocol version.";break;case b.Alert.Description.insufficient_security:a="Insufficient security.";break;case b.Alert.Description.internal_error:a="Internal error.";break;case b.Alert.Description.user_canceled:a="User canceled.";break;case b.Alert.Description.no_renegotiation:a="Renegotiation not supported.";break;default:a="Unknown error.";break}if(r.description===b.Alert.Description.close_notify)return s.close();s.error(s,{message:a,send:!1,origin:s.entity===b.ConnectionEnd.client?"server":"client",alert:r}),s.process()};b.handleHandshake=function(s,e){var t=e.fragment,r=t.getByte(),a=t.getInt24();if(a>t.length())return s.fragmented=e,e.fragment=Q.util.createBuffer(),t.read-=4,s.process();s.fragmented=null,t.read-=4;var n=t.bytes(a+4);t.read+=4,r in q0[s.entity][s.expect]?(s.entity===b.ConnectionEnd.server&&!s.open&&!s.fail&&(s.handshaking=!0,s.session={version:null,extensions:{server_name:{serverNameList:[]}},cipherSuite:null,compressionMethod:null,serverCertificate:null,clientCertificate:null,md5:Q.md.md5.create(),sha1:Q.md.sha1.create()}),r!==b.HandshakeType.hello_request&&r!==b.HandshakeType.certificate_verify&&r!==b.HandshakeType.finished&&(s.session.md5.update(n),s.session.sha1.update(n)),q0[s.entity][s.expect][r](s,e,a)):b.handleUnexpected(s,e)};b.handleApplicationData=function(s,e){s.data.putBuffer(e.fragment),s.dataReady(s),s.process()};b.handleHeartbeat=function(s,e){var t=e.fragment,r=t.getByte(),a=t.getInt16(),n=t.getBytes(a);if(r===b.HeartbeatMessageType.heartbeat_request){if(s.handshaking||a>n.length)return s.process();b.queue(s,b.createRecord(s,{type:b.ContentType.heartbeat,data:b.createHeartbeat(b.HeartbeatMessageType.heartbeat_response,n)})),b.flush(s)}else if(r===b.HeartbeatMessageType.heartbeat_response){if(n!==s.expectedHeartbeatPayload)return s.process();s.heartbeatReceived&&s.heartbeatReceived(s,Q.util.createBuffer(n))}s.process()};var iA=0,oA=1,Sp=2,lA=3,uA=4,zy=5,cA=6,fA=7,hA=8,dA=0,gA=1,Bg=2,mA=3,Cm=4,pA=5,yA=6,C=b.handleUnexpected,Xy=b.handleChangeCipherSpec,rr=b.handleAlert,yr=b.handleHandshake,Zy=b.handleApplicationData,sr=b.handleHeartbeat,Am=[];Am[b.ConnectionEnd.client]=[[C,rr,yr,C,sr],[C,rr,yr,C,sr],[C,rr,yr,C,sr],[C,rr,yr,C,sr],[C,rr,yr,C,sr],[Xy,rr,C,C,sr],[C,rr,yr,C,sr],[C,rr,yr,Zy,sr],[C,rr,yr,C,sr]];Am[b.ConnectionEnd.server]=[[C,rr,yr,C,sr],[C,rr,yr,C,sr],[C,rr,yr,C,sr],[C,rr,yr,C,sr],[Xy,rr,C,C,sr],[C,rr,yr,C,sr],[C,rr,yr,Zy,sr],[C,rr,yr,C,sr]];var Ca=b.handleHelloRequest,vA=b.handleServerHello,ev=b.handleCertificate,Cp=b.handleServerKeyExchange,Vd=b.handleCertificateRequest,xh=b.handleServerHelloDone,tv=b.handleFinished,q0=[];q0[b.ConnectionEnd.client]=[[C,C,vA,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[Ca,C,C,C,C,C,C,C,C,C,C,ev,Cp,Vd,xh,C,C,C,C,C,C],[Ca,C,C,C,C,C,C,C,C,C,C,C,Cp,Vd,xh,C,C,C,C,C,C],[Ca,C,C,C,C,C,C,C,C,C,C,C,C,Vd,xh,C,C,C,C,C,C],[Ca,C,C,C,C,C,C,C,C,C,C,C,C,C,xh,C,C,C,C,C,C],[Ca,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[Ca,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,tv],[Ca,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[Ca,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C]];var wA=b.handleClientHello,SA=b.handleClientKeyExchange,CA=b.handleCertificateVerify;q0[b.ConnectionEnd.server]=[[C,wA,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,ev,C,C,C,C,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,SA,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,CA,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,tv],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C]];b.generateKeys=function(s,e){var t=Ad,r=e.client_random+e.server_random;s.session.resuming||(e.master_secret=t(e.pre_master_secret,"master secret",r,48).bytes(),e.pre_master_secret=null),r=e.server_random+e.client_random;var a=2*e.mac_key_length+2*e.enc_key_length,n=s.version.major===b.Versions.TLS_1_0.major&&s.version.minor===b.Versions.TLS_1_0.minor;n&&(a+=2*e.fixed_iv_length);var i=t(e.master_secret,"key expansion",r,a),o={client_write_MAC_key:i.getBytes(e.mac_key_length),server_write_MAC_key:i.getBytes(e.mac_key_length),client_write_key:i.getBytes(e.enc_key_length),server_write_key:i.getBytes(e.enc_key_length)};return n&&(o.client_write_IV=i.getBytes(e.fixed_iv_length),o.server_write_IV=i.getBytes(e.fixed_iv_length)),o};b.createConnectionState=function(s){var e=s.entity===b.ConnectionEnd.client,t=function(){var n={sequenceNumber:[0,0],macKey:null,macLength:0,macFunction:null,cipherState:null,cipherFunction:function(i){return!0},compressionState:null,compressFunction:function(i){return!0},updateSequenceNumber:function(){n.sequenceNumber[1]===4294967295?(n.sequenceNumber[1]=0,++n.sequenceNumber[0]):++n.sequenceNumber[1]}};return n},r={read:t(),write:t()};if(r.read.update=function(n,i){return r.read.cipherFunction(i,r.read)?r.read.compressFunction(n,i,r.read)||n.error(n,{message:"Could not decompress record.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.decompression_failure}}):n.error(n,{message:"Could not decrypt record or bad MAC.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.bad_record_mac}}),!n.fail},r.write.update=function(n,i){return r.write.compressFunction(n,i,r.write)?r.write.cipherFunction(i,r.write)||n.error(n,{message:"Could not encrypt record.",send:!1,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.internal_error}}):n.error(n,{message:"Could not compress record.",send:!1,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.internal_error}}),!n.fail},s.session){var a=s.session.sp;switch(s.session.cipherSuite.initSecurityParameters(a),a.keys=b.generateKeys(s,a),r.read.macKey=e?a.keys.server_write_MAC_key:a.keys.client_write_MAC_key,r.write.macKey=e?a.keys.client_write_MAC_key:a.keys.server_write_MAC_key,s.session.cipherSuite.initConnectionState(r,s,a),a.compression_algorithm){case b.CompressionMethod.none:break;case b.CompressionMethod.deflate:r.read.compressFunction=nA,r.write.compressFunction=aA;break;default:throw new Error("Unsupported compression algorithm.")}}return r};b.createRandom=function(){var s=new Date,e=+s+s.getTimezoneOffset()*6e4,t=Q.util.createBuffer();return t.putInt32(e),t.putBytes(Q.random.getBytes(28)),t};b.createRecord=function(s,e){if(!e.data)return null;var t={type:e.type,version:{major:s.version.major,minor:s.version.minor},length:e.data.length(),fragment:e.data};return t};b.createAlert=function(s,e){var t=Q.util.createBuffer();return t.putByte(e.level),t.putByte(e.description),b.createRecord(s,{type:b.ContentType.alert,data:t})};b.createClientHello=function(s){s.session.clientHelloVersion={major:s.version.major,minor:s.version.minor};for(var e=Q.util.createBuffer(),t=0;t<s.cipherSuites.length;++t){var r=s.cipherSuites[t];e.putByte(r.id[0]),e.putByte(r.id[1])}var a=e.length(),n=Q.util.createBuffer();n.putByte(b.CompressionMethod.none);var i=n.length(),o=Q.util.createBuffer();if(s.virtualHost){var l=Q.util.createBuffer();l.putByte(0),l.putByte(0);var u=Q.util.createBuffer();u.putByte(0),Gr(u,2,Q.util.createBuffer(s.virtualHost));var c=Q.util.createBuffer();Gr(c,2,u),Gr(l,2,c),o.putBuffer(l)}var f=o.length();f>0&&(f+=2);var g=s.session.id,v=g.length+1+2+4+28+2+a+1+i+f,p=Q.util.createBuffer();return p.putByte(b.HandshakeType.client_hello),p.putInt24(v),p.putByte(s.version.major),p.putByte(s.version.minor),p.putBytes(s.session.sp.client_random),Gr(p,1,Q.util.createBuffer(g)),Gr(p,2,e),Gr(p,1,n),f>0&&Gr(p,2,o),p};b.createServerHello=function(s){var e=s.session.id,t=e.length+1+2+4+28+2+1,r=Q.util.createBuffer();return r.putByte(b.HandshakeType.server_hello),r.putInt24(t),r.putByte(s.version.major),r.putByte(s.version.minor),r.putBytes(s.session.sp.server_random),Gr(r,1,Q.util.createBuffer(e)),r.putByte(s.session.cipherSuite.id[0]),r.putByte(s.session.cipherSuite.id[1]),r.putByte(s.session.compressionMethod),r};b.createCertificate=function(s){var e=s.entity===b.ConnectionEnd.client,t=null;if(s.getCertificate){var r;e?r=s.session.certificateRequest:r=s.session.extensions.server_name.serverNameList,t=s.getCertificate(s,r)}var a=Q.util.createBuffer();if(t!==null)try{Q.util.isArray(t)||(t=[t]);for(var n=null,i=0;i<t.length;++i){var o=Q.pem.decode(t[i])[0];if(o.type!=="CERTIFICATE"&&o.type!=="X509 CERTIFICATE"&&o.type!=="TRUSTED CERTIFICATE"){var l=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw l.headerType=o.type,l}if(o.procType&&o.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var u=Q.util.createBuffer(o.body);n===null&&(n=Q.asn1.fromDer(u.bytes(),!1));var c=Q.util.createBuffer();Gr(c,3,u),a.putBuffer(c)}t=Q.pki.certificateFromAsn1(n),e?s.session.clientCertificate=t:s.session.serverCertificate=t}catch(v){return s.error(s,{message:"Could not send certificate list.",cause:v,send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.bad_certificate}})}var f=3+a.length(),g=Q.util.createBuffer();return g.putByte(b.HandshakeType.certificate),g.putInt24(f),Gr(g,3,a),g};b.createClientKeyExchange=function(s){var e=Q.util.createBuffer();e.putByte(s.session.clientHelloVersion.major),e.putByte(s.session.clientHelloVersion.minor),e.putBytes(Q.random.getBytes(46));var t=s.session.sp;t.pre_master_secret=e.getBytes();var r=s.session.serverCertificate.publicKey;e=r.encrypt(t.pre_master_secret);var a=e.length+2,n=Q.util.createBuffer();return n.putByte(b.HandshakeType.client_key_exchange),n.putInt24(a),n.putInt16(e.length),n.putBytes(e),n};b.createServerKeyExchange=function(s){var e=Q.util.createBuffer();return e};b.getClientSignature=function(s,e){var t=Q.util.createBuffer();t.putBuffer(s.session.md5.digest()),t.putBuffer(s.session.sha1.digest()),t=t.getBytes(),s.getSignature=s.getSignature||function(r,a,n){var i=null;if(r.getPrivateKey)try{i=r.getPrivateKey(r,r.session.clientCertificate),i=Q.pki.privateKeyFromPem(i)}catch(o){r.error(r,{message:"Could not get private key.",cause:o,send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.internal_error}})}i===null?r.error(r,{message:"No private key set.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.internal_error}}):a=i.sign(a,null),n(r,a)},s.getSignature(s,t,e)};b.createCertificateVerify=function(s,e){var t=e.length+2,r=Q.util.createBuffer();return r.putByte(b.HandshakeType.certificate_verify),r.putInt24(t),r.putInt16(e.length),r.putBytes(e),r};b.createCertificateRequest=function(s){var e=Q.util.createBuffer();e.putByte(1);var t=Q.util.createBuffer();for(var r in s.caStore.certs){var a=s.caStore.certs[r],n=Q.pki.distinguishedNameToAsn1(a.subject),i=Q.asn1.toDer(n);t.putInt16(i.length()),t.putBuffer(i)}var o=1+e.length()+2+t.length(),l=Q.util.createBuffer();return l.putByte(b.HandshakeType.certificate_request),l.putInt24(o),Gr(l,1,e),Gr(l,2,t),l};b.createServerHelloDone=function(s){var e=Q.util.createBuffer();return e.putByte(b.HandshakeType.server_hello_done),e.putInt24(0),e};b.createChangeCipherSpec=function(){var s=Q.util.createBuffer();return s.putByte(1),s};b.createFinished=function(s){var e=Q.util.createBuffer();e.putBuffer(s.session.md5.digest()),e.putBuffer(s.session.sha1.digest());var t=s.entity===b.ConnectionEnd.client,r=s.session.sp,a=12,n=Ad,i=t?"client finished":"server finished";e=n(r.master_secret,i,e.getBytes(),a);var o=Q.util.createBuffer();return o.putByte(b.HandshakeType.finished),o.putInt24(e.length()),o.putBuffer(e),o};b.createHeartbeat=function(s,e,t){typeof t>"u"&&(t=e.length);var r=Q.util.createBuffer();r.putByte(s),r.putInt16(t),r.putBytes(e);var a=r.length(),n=Math.max(16,a-t-3);return r.putBytes(Q.random.getBytes(n)),r};b.queue=function(s,e){if(!!e&&!(e.fragment.length()===0&&(e.type===b.ContentType.handshake||e.type===b.ContentType.alert||e.type===b.ContentType.change_cipher_spec))){if(e.type===b.ContentType.handshake){var t=e.fragment.bytes();s.session.md5.update(t),s.session.sha1.update(t),t=null}var r;if(e.fragment.length()<=b.MaxFragment)r=[e];else{r=[];for(var a=e.fragment.bytes();a.length>b.MaxFragment;)r.push(b.createRecord(s,{type:e.type,data:Q.util.createBuffer(a.slice(0,b.MaxFragment))})),a=a.slice(b.MaxFragment);a.length>0&&r.push(b.createRecord(s,{type:e.type,data:Q.util.createBuffer(a)}))}for(var n=0;n<r.length&&!s.fail;++n){var i=r[n],o=s.state.current.write;o.update(s,i)&&s.records.push(i)}}};b.flush=function(s){for(var e=0;e<s.records.length;++e){var t=s.records[e];s.tlsData.putByte(t.type),s.tlsData.putByte(t.version.major),s.tlsData.putByte(t.version.minor),s.tlsData.putInt16(t.fragment.length()),s.tlsData.putBuffer(s.records[e].fragment)}return s.records=[],s.tlsDataReady(s)};var $d=function(s){switch(s){case!0:return!0;case Q.pki.certificateError.bad_certificate:return b.Alert.Description.bad_certificate;case Q.pki.certificateError.unsupported_certificate:return b.Alert.Description.unsupported_certificate;case Q.pki.certificateError.certificate_revoked:return b.Alert.Description.certificate_revoked;case Q.pki.certificateError.certificate_expired:return b.Alert.Description.certificate_expired;case Q.pki.certificateError.certificate_unknown:return b.Alert.Description.certificate_unknown;case Q.pki.certificateError.unknown_ca:return b.Alert.Description.unknown_ca;default:return b.Alert.Description.bad_certificate}},AA=function(s){switch(s){case!0:return!0;case b.Alert.Description.bad_certificate:return Q.pki.certificateError.bad_certificate;case b.Alert.Description.unsupported_certificate:return Q.pki.certificateError.unsupported_certificate;case b.Alert.Description.certificate_revoked:return Q.pki.certificateError.certificate_revoked;case b.Alert.Description.certificate_expired:return Q.pki.certificateError.certificate_expired;case b.Alert.Description.certificate_unknown:return Q.pki.certificateError.certificate_unknown;case b.Alert.Description.unknown_ca:return Q.pki.certificateError.unknown_ca;default:return Q.pki.certificateError.bad_certificate}};b.verifyCertificateChain=function(s,e){try{var t={};for(var r in s.verifyOptions)t[r]=s.verifyOptions[r];t.verify=function(n,i,o){var l=$d(n),u=s.verify(s,n,i,o);if(u!==!0){if(typeof u=="object"&&!Q.util.isArray(u)){var c=new Error("The application rejected the certificate.");throw c.send=!0,c.alert={level:b.Alert.Level.fatal,description:b.Alert.Description.bad_certificate},u.message&&(c.message=u.message),u.alert&&(c.alert.description=u.alert),c}u!==n&&(u=AA(u))}return u},Q.pki.verifyCertificateChain(s.caStore,e,t)}catch(n){var a=n;(typeof a!="object"||Q.util.isArray(a))&&(a={send:!0,alert:{level:b.Alert.Level.fatal,description:$d(n)}}),"send"in a||(a.send=!0),"alert"in a||(a.alert={level:b.Alert.Level.fatal,description:$d(a.error)}),s.error(s,a)}return!s.fail};b.createSessionCache=function(s,e){var t=null;if(s&&s.getSession&&s.setSession&&s.order)t=s;else{t={},t.cache=s||{},t.capacity=Math.max(e||100,1),t.order=[];for(var r in s)t.order.length<=e?t.order.push(r):delete s[r];t.getSession=function(a){var n=null,i=null;if(a?i=Q.util.bytesToHex(a):t.order.length>0&&(i=t.order[0]),i!==null&&i in t.cache){n=t.cache[i],delete t.cache[i];for(var o in t.order)if(t.order[o]===i){t.order.splice(o,1);break}}return n},t.setSession=function(a,n){if(t.order.length===t.capacity){var i=t.order.shift();delete t.cache[i]}var i=Q.util.bytesToHex(a);t.order.push(i),t.cache[i]=n}}return t};b.createConnection=function(s){var e=null;s.caStore?Q.util.isArray(s.caStore)?e=Q.pki.createCaStore(s.caStore):e=s.caStore:e=Q.pki.createCaStore();var t=s.cipherSuites||null;if(t===null){t=[];for(var r in b.CipherSuites)t.push(b.CipherSuites[r])}var a=s.server?b.ConnectionEnd.server:b.ConnectionEnd.client,n=s.sessionCache?b.createSessionCache(s.sessionCache):null,i={version:{major:b.Version.major,minor:b.Version.minor},entity:a,sessionId:s.sessionId,caStore:e,sessionCache:n,cipherSuites:t,connected:s.connected,virtualHost:s.virtualHost||null,verifyClient:s.verifyClient||!1,verify:s.verify||function(c,f,g,v){return f},verifyOptions:s.verifyOptions||{},getCertificate:s.getCertificate||null,getPrivateKey:s.getPrivateKey||null,getSignature:s.getSignature||null,input:Q.util.createBuffer(),tlsData:Q.util.createBuffer(),data:Q.util.createBuffer(),tlsDataReady:s.tlsDataReady,dataReady:s.dataReady,heartbeatReceived:s.heartbeatReceived,closed:s.closed,error:function(c,f){f.origin=f.origin||(c.entity===b.ConnectionEnd.client?"client":"server"),f.send&&(b.queue(c,b.createAlert(c,f.alert)),b.flush(c));var g=f.fatal!==!1;g&&(c.fail=!0),s.error(c,f),g&&c.close(!1)},deflate:s.deflate||null,inflate:s.inflate||null};i.reset=function(c){i.version={major:b.Version.major,minor:b.Version.minor},i.record=null,i.session=null,i.peerCertificate=null,i.state={pending:null,current:null},i.expect=i.entity===b.ConnectionEnd.client?iA:dA,i.fragmented=null,i.records=[],i.open=!1,i.handshakes=0,i.handshaking=!1,i.isConnected=!1,i.fail=!(c||typeof c>"u"),i.input.clear(),i.tlsData.clear(),i.data.clear(),i.state.current=b.createConnectionState(i)},i.reset();var o=function(c,f){var g=f.type-b.ContentType.change_cipher_spec,v=Am[c.entity][c.expect];g in v?v[g](c,f):b.handleUnexpected(c,f)},l=function(c){var f=0,g=c.input,v=g.length();if(v<5)f=5-v;else{c.record={type:g.getByte(),version:{major:g.getByte(),minor:g.getByte()},length:g.getInt16(),fragment:Q.util.createBuffer(),ready:!1};var p=c.record.version.major===c.version.major;p&&c.session&&c.session.version&&(p=c.record.version.minor===c.version.minor),p||c.error(c,{message:"Incompatible TLS version.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.protocol_version}})}return f},u=function(c){var f=0,g=c.input,v=g.length();if(v<c.record.length)f=c.record.length-v;else{c.record.fragment.putBytes(g.getBytes(c.record.length)),g.compact();var p=c.state.current.read;p.update(c,c.record)&&(c.fragmented!==null&&(c.fragmented.type===c.record.type?(c.fragmented.fragment.putBuffer(c.record.fragment),c.record=c.fragmented):c.error(c,{message:"Invalid fragmented record.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.unexpected_message}})),c.record.ready=!0)}return f};return i.handshake=function(c){if(i.entity!==b.ConnectionEnd.client)i.error(i,{message:"Cannot initiate handshake as a server.",fatal:!1});else if(i.handshaking)i.error(i,{message:"Handshake already in progress.",fatal:!1});else{i.fail&&!i.open&&i.handshakes===0&&(i.fail=!1),i.handshaking=!0,c=c||"";var f=null;c.length>0&&(i.sessionCache&&(f=i.sessionCache.getSession(c)),f===null&&(c="")),c.length===0&&i.sessionCache&&(f=i.sessionCache.getSession(),f!==null&&(c=f.id)),i.session={id:c,version:null,cipherSuite:null,compressionMethod:null,serverCertificate:null,certificateRequest:null,clientCertificate:null,sp:{},md5:Q.md.md5.create(),sha1:Q.md.sha1.create()},f&&(i.version=f.version,i.session.sp=f.sp),i.session.sp.client_random=b.createRandom().getBytes(),i.open=!0,b.queue(i,b.createRecord(i,{type:b.ContentType.handshake,data:b.createClientHello(i)})),b.flush(i)}},i.process=function(c){var f=0;return c&&i.input.putBytes(c),i.fail||(i.record!==null&&i.record.ready&&i.record.fragment.isEmpty()&&(i.record=null),i.record===null&&(f=l(i)),!i.fail&&i.record!==null&&!i.record.ready&&(f=u(i)),!i.fail&&i.record!==null&&i.record.ready&&o(i,i.record)),f},i.prepare=function(c){return b.queue(i,b.createRecord(i,{type:b.ContentType.application_data,data:Q.util.createBuffer(c)})),b.flush(i)},i.prepareHeartbeatRequest=function(c,f){return c instanceof Q.util.ByteBuffer&&(c=c.bytes()),typeof f>"u"&&(f=c.length),i.expectedHeartbeatPayload=c,b.queue(i,b.createRecord(i,{type:b.ContentType.heartbeat,data:b.createHeartbeat(b.HeartbeatMessageType.heartbeat_request,c,f)})),b.flush(i)},i.close=function(c){if(!i.fail&&i.sessionCache&&i.session){var f={id:i.session.id,version:i.session.version,sp:i.session.sp};f.sp.keys=null,i.sessionCache.setSession(f.id,f)}i.open&&(i.open=!1,i.input.clear(),(i.isConnected||i.handshaking)&&(i.isConnected=i.handshaking=!1,b.queue(i,b.createAlert(i,{level:b.Alert.Level.warning,description:b.Alert.Description.close_notify})),b.flush(i)),i.closed(i)),i.reset(c)},i};Q.tls=Q.tls||{};for(var Dd in b)typeof b[Dd]!="function"&&(Q.tls[Dd]=b[Dd]);Q.tls.prf_tls1=Ad;Q.tls.hmac_sha1=sA;Q.tls.createSessionCache=b.createSessionCache;Q.tls.createConnection=b.createConnection;var Nn=Me,rs=Nn.tls;rs.CipherSuites.TLS_RSA_WITH_AES_128_CBC_SHA={id:[0,47],name:"TLS_RSA_WITH_AES_128_CBC_SHA",initSecurityParameters:function(s){s.bulk_cipher_algorithm=rs.BulkCipherAlgorithm.aes,s.cipher_type=rs.CipherType.block,s.enc_key_length=16,s.block_length=16,s.fixed_iv_length=16,s.record_iv_length=16,s.mac_algorithm=rs.MACAlgorithm.hmac_sha1,s.mac_length=20,s.mac_key_length=20},initConnectionState:rv};rs.CipherSuites.TLS_RSA_WITH_AES_256_CBC_SHA={id:[0,53],name:"TLS_RSA_WITH_AES_256_CBC_SHA",initSecurityParameters:function(s){s.bulk_cipher_algorithm=rs.BulkCipherAlgorithm.aes,s.cipher_type=rs.CipherType.block,s.enc_key_length=32,s.block_length=16,s.fixed_iv_length=16,s.record_iv_length=16,s.mac_algorithm=rs.MACAlgorithm.hmac_sha1,s.mac_length=20,s.mac_key_length=20},initConnectionState:rv};function rv(s,e,t){var r=e.entity===Nn.tls.ConnectionEnd.client;s.read.cipherState={init:!1,cipher:Nn.cipher.createDecipher("AES-CBC",r?t.keys.server_write_key:t.keys.client_write_key),iv:r?t.keys.server_write_IV:t.keys.client_write_IV},s.write.cipherState={init:!1,cipher:Nn.cipher.createCipher("AES-CBC",r?t.keys.client_write_key:t.keys.server_write_key),iv:r?t.keys.client_write_IV:t.keys.server_write_IV},s.read.cipherFunction=BA,s.write.cipherFunction=bA,s.read.macLength=s.write.macLength=t.mac_length,s.read.macFunction=s.write.macFunction=rs.hmac_sha1}function bA(s,e){var t=!1,r=e.macFunction(e.macKey,e.sequenceNumber,s);s.fragment.putBytes(r),e.updateSequenceNumber();var a;s.version.minor===rs.Versions.TLS_1_0.minor?a=e.cipherState.init?null:e.cipherState.iv:a=Nn.random.getBytesSync(16),e.cipherState.init=!0;var n=e.cipherState.cipher;return n.start({iv:a}),s.version.minor>=rs.Versions.TLS_1_1.minor&&n.output.putBytes(a),n.update(s.fragment),n.finish(EA)&&(s.fragment=n.output,s.length=s.fragment.length(),t=!0),t}function EA(s,e,t){if(!t){var r=s-e.length()%s;e.fillWithByte(r-1,r)}return!0}function xA(s,e,t){var r=!0;if(t){for(var a=e.length(),n=e.last(),i=a-1-n;i<a-1;++i)r=r&&e.at(i)==n;r&&e.truncate(n+1)}return r}function BA(s,e){var t=!1,r;s.version.minor===rs.Versions.TLS_1_0.minor?r=e.cipherState.init?null:e.cipherState.iv:r=s.fragment.getBytes(16),e.cipherState.init=!0;var a=e.cipherState.cipher;a.start({iv:r}),a.update(s.fragment),t=a.finish(xA);var n=e.macLength,i=Nn.random.getBytesSync(n),o=a.output.length();o>=n?(s.fragment=a.output.getBytes(o-n),i=a.output.getBytes(n)):s.fragment=a.output.getBytes(),s.fragment=Nn.util.createBuffer(s.fragment),s.length=s.fragment.length();var l=e.macFunction(e.macKey,e.sequenceNumber,s);return e.updateSequenceNumber(),t=IA(e.macKey,i,l)&&t,t}function IA(s,e,t){var r=Nn.hmac.create();return r.start("SHA1",s),r.update(e),e=r.digest().getBytes(),r.start(null,null),r.update(t),t=r.digest().getBytes(),e===t}var vt=Me,Sh=vt.sha512=vt.sha512||{};vt.md.sha512=vt.md.algorithms.sha512=Sh;var sv=vt.sha384=vt.sha512.sha384=vt.sha512.sha384||{};sv.create=function(){return Sh.create("SHA-384")};vt.md.sha384=vt.md.algorithms.sha384=sv;vt.sha512.sha256=vt.sha512.sha256||{create:function(){return Sh.create("SHA-512/256")}};vt.md["sha512/256"]=vt.md.algorithms["sha512/256"]=vt.sha512.sha256;vt.sha512.sha224=vt.sha512.sha224||{create:function(){return Sh.create("SHA-512/224")}};vt.md["sha512/224"]=vt.md.algorithms["sha512/224"]=vt.sha512.sha224;Sh.create=function(s){if(av||kA(),typeof s>"u"&&(s="SHA-512"),!(s in ji))throw new Error("Invalid SHA-512 algorithm: "+s);for(var e=ji[s],t=null,r=vt.util.createBuffer(),a=new Array(80),n=0;n<80;++n)a[n]=new Array(2);var i=64;switch(s){case"SHA-384":i=48;break;case"SHA-512/256":i=32;break;case"SHA-512/224":i=28;break}var o={algorithm:s.replace("-","").toLowerCase(),blockLength:128,digestLength:i,messageLength:0,fullMessageLength:null,messageLengthSize:16};return o.start=function(){o.messageLength=0,o.fullMessageLength=o.messageLength128=[];for(var l=o.messageLengthSize/4,u=0;u<l;++u)o.fullMessageLength.push(0);r=vt.util.createBuffer(),t=new Array(e.length);for(var u=0;u<e.length;++u)t[u]=e[u].slice(0);return o},o.start(),o.update=function(l,u){u==="utf8"&&(l=vt.util.encodeUtf8(l));var c=l.length;o.messageLength+=c,c=[c/4294967296>>>0,c>>>0];for(var f=o.fullMessageLength.length-1;f>=0;--f)o.fullMessageLength[f]+=c[1],c[1]=c[0]+(o.fullMessageLength[f]/4294967296>>>0),o.fullMessageLength[f]=o.fullMessageLength[f]>>>0,c[0]=c[1]/4294967296>>>0;return r.putBytes(l),Ap(t,a,r),(r.read>2048||r.length()===0)&&r.compact(),o},o.digest=function(){var l=vt.util.createBuffer();l.putBytes(r.bytes());var u=o.fullMessageLength[o.fullMessageLength.length-1]+o.messageLengthSize,c=u&o.blockLength-1;l.putBytes(Ig.substr(0,o.blockLength-c));for(var f,g,v=o.fullMessageLength[0]*8,p=0;p<o.fullMessageLength.length-1;++p)f=o.fullMessageLength[p+1]*8,g=f/4294967296>>>0,v+=g,l.putInt32(v>>>0),v=f>>>0;l.putInt32(v);for(var h=new Array(t.length),p=0;p<t.length;++p)h[p]=t[p].slice(0);Ap(h,a,l);var d=vt.util.createBuffer(),y;s==="SHA-512"?y=h.length:s==="SHA-384"?y=h.length-2:y=h.length-4;for(var p=0;p<y;++p)d.putInt32(h[p][0]),(p!==y-1||s!=="SHA-512/224")&&d.putInt32(h[p][1]);return d},o};var Ig=null,av=!1,kg=null,ji=null;function kA(){Ig=String.fromCharCode(128),Ig+=vt.util.fillString(String.fromCharCode(0),128),kg=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],ji={},ji["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],ji["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],ji["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],ji["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],av=!0}function Ap(s,e,t){for(var r,a,n,i,o,l,u,c,f,g,v,p,h,d,y,A,x,N,_,$,se,te,me,Ce,pe,ve,it,Ye,Ae,Ue,oe,xt,je,re,de,ne=t.length();ne>=128;){for(Ae=0;Ae<16;++Ae)e[Ae][0]=t.getInt32()>>>0,e[Ae][1]=t.getInt32()>>>0;for(;Ae<80;++Ae)xt=e[Ae-2],Ue=xt[0],oe=xt[1],r=((Ue>>>19|oe<<13)^(oe>>>29|Ue<<3)^Ue>>>6)>>>0,a=((Ue<<13|oe>>>19)^(oe<<3|Ue>>>29)^(Ue<<26|oe>>>6))>>>0,re=e[Ae-15],Ue=re[0],oe=re[1],n=((Ue>>>1|oe<<31)^(Ue>>>8|oe<<24)^Ue>>>7)>>>0,i=((Ue<<31|oe>>>1)^(Ue<<24|oe>>>8)^(Ue<<25|oe>>>7))>>>0,je=e[Ae-7],de=e[Ae-16],oe=a+je[1]+i+de[1],e[Ae][0]=r+je[0]+n+de[0]+(oe/4294967296>>>0)>>>0,e[Ae][1]=oe>>>0;for(h=s[0][0],d=s[0][1],y=s[1][0],A=s[1][1],x=s[2][0],N=s[2][1],_=s[3][0],$=s[3][1],se=s[4][0],te=s[4][1],me=s[5][0],Ce=s[5][1],pe=s[6][0],ve=s[6][1],it=s[7][0],Ye=s[7][1],Ae=0;Ae<80;++Ae)u=((se>>>14|te<<18)^(se>>>18|te<<14)^(te>>>9|se<<23))>>>0,c=((se<<18|te>>>14)^(se<<14|te>>>18)^(te<<23|se>>>9))>>>0,f=(pe^se&(me^pe))>>>0,g=(ve^te&(Ce^ve))>>>0,o=((h>>>28|d<<4)^(d>>>2|h<<30)^(d>>>7|h<<25))>>>0,l=((h<<4|d>>>28)^(d<<30|h>>>2)^(d<<25|h>>>7))>>>0,v=(h&y|x&(h^y))>>>0,p=(d&A|N&(d^A))>>>0,oe=Ye+c+g+kg[Ae][1]+e[Ae][1],r=it+u+f+kg[Ae][0]+e[Ae][0]+(oe/4294967296>>>0)>>>0,a=oe>>>0,oe=l+p,n=o+v+(oe/4294967296>>>0)>>>0,i=oe>>>0,it=pe,Ye=ve,pe=me,ve=Ce,me=se,Ce=te,oe=$+a,se=_+r+(oe/4294967296>>>0)>>>0,te=oe>>>0,_=x,$=N,x=y,N=A,y=h,A=d,oe=a+i,h=r+n+(oe/4294967296>>>0)>>>0,d=oe>>>0;oe=s[0][1]+d,s[0][0]=s[0][0]+h+(oe/4294967296>>>0)>>>0,s[0][1]=oe>>>0,oe=s[1][1]+A,s[1][0]=s[1][0]+y+(oe/4294967296>>>0)>>>0,s[1][1]=oe>>>0,oe=s[2][1]+N,s[2][0]=s[2][0]+x+(oe/4294967296>>>0)>>>0,s[2][1]=oe>>>0,oe=s[3][1]+$,s[3][0]=s[3][0]+_+(oe/4294967296>>>0)>>>0,s[3][1]=oe>>>0,oe=s[4][1]+te,s[4][0]=s[4][0]+se+(oe/4294967296>>>0)>>>0,s[4][1]=oe>>>0,oe=s[5][1]+Ce,s[5][0]=s[5][0]+me+(oe/4294967296>>>0)>>>0,s[5][1]=oe>>>0,oe=s[6][1]+ve,s[6][0]=s[6][0]+pe+(oe/4294967296>>>0)>>>0,s[6][1]=oe>>>0,oe=s[7][1]+Ye,s[7][0]=s[7][0]+it+(oe/4294967296>>>0)>>>0,s[7][1]=oe>>>0,ne-=128}}var bm={},NA=Me,zt=NA.asn1;bm.privateKeyValidator={name:"PrivateKeyInfo",tagClass:zt.Class.UNIVERSAL,type:zt.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:zt.Class.UNIVERSAL,type:zt.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:zt.Class.UNIVERSAL,type:zt.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:zt.Class.UNIVERSAL,type:zt.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:zt.Class.UNIVERSAL,type:zt.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]};bm.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:zt.Class.UNIVERSAL,type:zt.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:zt.Class.UNIVERSAL,type:zt.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:zt.Class.UNIVERSAL,type:zt.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{tagClass:zt.Class.UNIVERSAL,type:zt.Type.BITSTRING,constructed:!1,composed:!0,captureBitStringValue:"ed25519PublicKey"}]};var nr=Me,nv=bm,TA=nv.publicKeyValidator,_A=nv.privateKeyValidator;if(typeof RA>"u")var RA=nr.jsbn.BigInteger;var Ng=nr.util.ByteBuffer,Nr=typeof Buffer>"u"?Uint8Array:Buffer;nr.pki=nr.pki||{};nr.pki.ed25519=nr.ed25519=nr.ed25519||{};var qe=nr.ed25519;qe.constants={};qe.constants.PUBLIC_KEY_BYTE_LENGTH=32;qe.constants.PRIVATE_KEY_BYTE_LENGTH=64;qe.constants.SEED_BYTE_LENGTH=32;qe.constants.SIGN_BYTE_LENGTH=64;qe.constants.HASH_BYTE_LENGTH=64;qe.generateKeyPair=function(s){s=s||{};var e=s.seed;if(e===void 0)e=nr.random.getBytesSync(qe.constants.SEED_BYTE_LENGTH);else if(typeof e=="string"){if(e.length!==qe.constants.SEED_BYTE_LENGTH)throw new TypeError('"seed" must be '+qe.constants.SEED_BYTE_LENGTH+" bytes in length.")}else if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, Uint8Array, or a binary string.');e=fa({message:e,encoding:"binary"});for(var t=new Nr(qe.constants.PUBLIC_KEY_BYTE_LENGTH),r=new Nr(qe.constants.PRIVATE_KEY_BYTE_LENGTH),a=0;a<32;++a)r[a]=e[a];return LA(t,r),{publicKey:t,privateKey:r}};qe.privateKeyFromAsn1=function(s){var e={},t=[],r=nr.asn1.validate(s,_A,e,t);if(!r){var a=new Error("Invalid Key.");throw a.errors=t,a}var n=nr.asn1.derToOid(e.privateKeyOid),i=nr.oids.EdDSA25519;if(n!==i)throw new Error('Invalid OID "'+n+'"; OID must be "'+i+'".');var o=e.privateKey,l=fa({message:nr.asn1.fromDer(o).value,encoding:"binary"});return{privateKeyBytes:l}};qe.publicKeyFromAsn1=function(s){var e={},t=[],r=nr.asn1.validate(s,TA,e,t);if(!r){var a=new Error("Invalid Key.");throw a.errors=t,a}var n=nr.asn1.derToOid(e.publicKeyOid),i=nr.oids.EdDSA25519;if(n!==i)throw new Error('Invalid OID "'+n+'"; OID must be "'+i+'".');var o=e.ed25519PublicKey;if(o.length!==qe.constants.PUBLIC_KEY_BYTE_LENGTH)throw new Error("Key length is invalid.");return fa({message:o,encoding:"binary"})};qe.publicKeyFromPrivateKey=function(s){s=s||{};var e=fa({message:s.privateKey,encoding:"binary"});if(e.length!==qe.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+qe.constants.PRIVATE_KEY_BYTE_LENGTH);for(var t=new Nr(qe.constants.PUBLIC_KEY_BYTE_LENGTH),r=0;r<t.length;++r)t[r]=e[32+r];return t};qe.sign=function(s){s=s||{};var e=fa(s),t=fa({message:s.privateKey,encoding:"binary"});if(t.length===qe.constants.SEED_BYTE_LENGTH){var r=qe.generateKeyPair({seed:t});t=r.privateKey}else if(t.length!==qe.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+qe.constants.SEED_BYTE_LENGTH+" or "+qe.constants.PRIVATE_KEY_BYTE_LENGTH);var a=new Nr(qe.constants.SIGN_BYTE_LENGTH+e.length);OA(a,e,e.length,t);for(var n=new Nr(qe.constants.SIGN_BYTE_LENGTH),i=0;i<n.length;++i)n[i]=a[i];return n};qe.verify=function(s){s=s||{};var e=fa(s);if(s.signature===void 0)throw new TypeError('"options.signature" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a binary string.');var t=fa({message:s.signature,encoding:"binary"});if(t.length!==qe.constants.SIGN_BYTE_LENGTH)throw new TypeError('"options.signature" must have a byte length of '+qe.constants.SIGN_BYTE_LENGTH);var r=fa({message:s.publicKey,encoding:"binary"});if(r.length!==qe.constants.PUBLIC_KEY_BYTE_LENGTH)throw new TypeError('"options.publicKey" must have a byte length of '+qe.constants.PUBLIC_KEY_BYTE_LENGTH);var a=new Nr(qe.constants.SIGN_BYTE_LENGTH+e.length),n=new Nr(qe.constants.SIGN_BYTE_LENGTH+e.length),i;for(i=0;i<qe.constants.SIGN_BYTE_LENGTH;++i)a[i]=t[i];for(i=0;i<e.length;++i)a[i+qe.constants.SIGN_BYTE_LENGTH]=e[i];return PA(n,a,a.length,r)>=0};function fa(s){var e=s.message;if(e instanceof Uint8Array||e instanceof Nr)return e;var t=s.encoding;if(e===void 0)if(s.md)e=s.md.digest().getBytes(),t="binary";else throw new TypeError('"options.message" or "options.md" not specified.');if(typeof e=="string"&&!t)throw new TypeError('"options.encoding" must be "binary" or "utf8".');if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.from(e,t);e=new Ng(e,t)}else if(!(e instanceof Ng))throw new TypeError('"options.message" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a string with "options.encoding" specifying its encoding.');for(var r=new Nr(e.length()),a=0;a<r.length;++a)r[a]=e.at(a);return r}var Tg=_e(),J0=_e([1]),VA=_e([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),$A=_e([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),bp=_e([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),Ep=_e([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),Ld=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]),DA=_e([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function Qf(s,e){var t=nr.md.sha512.create(),r=new Ng(s);t.update(r.getBytes(e),"binary");var a=t.digest().getBytes();if(typeof Buffer<"u")return Buffer.from(a,"binary");for(var n=new Nr(qe.constants.HASH_BYTE_LENGTH),i=0;i<64;++i)n[i]=a.charCodeAt(i);return n}function LA(s,e){var t=[_e(),_e(),_e(),_e()],r,a=Qf(e,32);for(a[0]&=248,a[31]&=127,a[31]|=64,xm(t,a),Em(s,t),r=0;r<32;++r)e[r+32]=s[r];return 0}function OA(s,e,t,r){var a,n,i=new Float64Array(64),o=[_e(),_e(),_e(),_e()],l=Qf(r,32);l[0]&=248,l[31]&=127,l[31]|=64;var u=t+64;for(a=0;a<t;++a)s[64+a]=e[a];for(a=0;a<32;++a)s[32+a]=l[32+a];var c=Qf(s.subarray(32),t+32);for(_g(c),xm(o,c),Em(s,o),a=32;a<64;++a)s[a]=r[a];var f=Qf(s,t+64);for(_g(f),a=32;a<64;++a)i[a]=0;for(a=0;a<32;++a)i[a]=c[a];for(a=0;a<32;++a)for(n=0;n<32;n++)i[a+n]+=f[a]*l[n];return iv(s.subarray(32),i),u}function PA(s,e,t,r){var a,n,i=new Nr(32),o=[_e(),_e(),_e(),_e()],l=[_e(),_e(),_e(),_e()];if(n=-1,t<64||UA(l,r))return-1;for(a=0;a<t;++a)s[a]=e[a];for(a=0;a<32;++a)s[a+32]=r[a];var u=Qf(s,t);if(_g(u),uv(o,l,u),xm(l,e.subarray(32)),Rg(o,l),Em(i,o),t-=64,ov(e,0,i,0)){for(a=0;a<t;++a)s[a]=0;return-1}for(a=0;a<t;++a)s[a]=e[a+64];return n=t,n}function iv(s,e){var t,r,a,n;for(r=63;r>=32;--r){for(t=0,a=r-32,n=r-12;a<n;++a)e[a]+=t-16*e[r]*Ld[a-(r-32)],t=e[a]+128>>8,e[a]-=t*256;e[a]+=t,e[r]=0}for(t=0,a=0;a<32;++a)e[a]+=t-(e[31]>>4)*Ld[a],t=e[a]>>8,e[a]&=255;for(a=0;a<32;++a)e[a]-=t*Ld[a];for(r=0;r<32;++r)e[r+1]+=e[r]>>8,s[r]=e[r]&255}function _g(s){for(var e=new Float64Array(64),t=0;t<64;++t)e[t]=s[t],s[t]=0;iv(s,e)}function Rg(s,e){var t=_e(),r=_e(),a=_e(),n=_e(),i=_e(),o=_e(),l=_e(),u=_e(),c=_e();su(t,s[1],s[0]),su(c,e[1],e[0]),ut(t,t,c),Do(r,s[0],s[1]),Do(c,e[0],e[1]),ut(r,r,c),ut(a,s[3],e[3]),ut(a,a,$A),ut(n,s[2],e[2]),Do(n,n,n),su(i,r,t),su(o,n,a),Do(l,n,a),Do(u,r,t),ut(s[0],i,o),ut(s[1],u,l),ut(s[2],l,o),ut(s[3],i,u)}function xp(s,e,t){for(var r=0;r<4;++r)cv(s[r],e[r],t)}function Em(s,e){var t=_e(),r=_e(),a=_e();FA(a,e[2]),ut(t,e[0],a),ut(r,e[1],a),G0(s,r),s[31]^=lv(t)<<7}function G0(s,e){var t,r,a,n=_e(),i=_e();for(t=0;t<16;++t)i[t]=e[t];for(Od(i),Od(i),Od(i),r=0;r<2;++r){for(n[0]=i[0]-65517,t=1;t<15;++t)n[t]=i[t]-65535-(n[t-1]>>16&1),n[t-1]&=65535;n[15]=i[15]-32767-(n[14]>>16&1),a=n[15]>>16&1,n[14]&=65535,cv(i,n,1-a)}for(t=0;t<16;t++)s[2*t]=i[t]&255,s[2*t+1]=i[t]>>8}function UA(s,e){var t=_e(),r=_e(),a=_e(),n=_e(),i=_e(),o=_e(),l=_e();return Cn(s[2],J0),MA(s[1],e),Wi(a,s[1]),ut(n,a,VA),su(a,a,s[2]),Do(n,s[2],n),Wi(i,n),Wi(o,i),ut(l,o,i),ut(t,l,a),ut(t,t,n),HA(t,t),ut(t,t,a),ut(t,t,n),ut(t,t,n),ut(s[0],t,n),Wi(r,s[0]),ut(r,r,n),Bp(r,a)&&ut(s[0],s[0],DA),Wi(r,s[0]),ut(r,r,n),Bp(r,a)?-1:(lv(s[0])===e[31]>>7&&su(s[0],Tg,s[0]),ut(s[3],s[0],s[1]),0)}function MA(s,e){var t;for(t=0;t<16;++t)s[t]=e[2*t]+(e[2*t+1]<<8);s[15]&=32767}function HA(s,e){var t=_e(),r;for(r=0;r<16;++r)t[r]=e[r];for(r=250;r>=0;--r)Wi(t,t),r!==1&&ut(t,t,e);for(r=0;r<16;++r)s[r]=t[r]}function Bp(s,e){var t=new Nr(32),r=new Nr(32);return G0(t,s),G0(r,e),ov(t,0,r,0)}function ov(s,e,t,r){return KA(s,e,t,r,32)}function KA(s,e,t,r,a){var n,i=0;for(n=0;n<a;++n)i|=s[e+n]^t[r+n];return(1&i-1>>>8)-1}function lv(s){var e=new Nr(32);return G0(e,s),e[0]&1}function uv(s,e,t){var r,a;for(Cn(s[0],Tg),Cn(s[1],J0),Cn(s[2],J0),Cn(s[3],Tg),a=255;a>=0;--a)r=t[a/8|0]>>(a&7)&1,xp(s,e,r),Rg(e,s),Rg(s,s),xp(s,e,r)}function xm(s,e){var t=[_e(),_e(),_e(),_e()];Cn(t[0],bp),Cn(t[1],Ep),Cn(t[2],J0),ut(t[3],bp,Ep),uv(s,t,e)}function Cn(s,e){var t;for(t=0;t<16;t++)s[t]=e[t]|0}function FA(s,e){var t=_e(),r;for(r=0;r<16;++r)t[r]=e[r];for(r=253;r>=0;--r)Wi(t,t),r!==2&&r!==4&&ut(t,t,e);for(r=0;r<16;++r)s[r]=t[r]}function Od(s){var e,t,r=1;for(e=0;e<16;++e)t=s[e]+r+65535,r=Math.floor(t/65536),s[e]=t-r*65536;s[0]+=r-1+37*(r-1)}function cv(s,e,t){for(var r,a=~(t-1),n=0;n<16;++n)r=a&(s[n]^e[n]),s[n]^=r,e[n]^=r}function _e(s){var e,t=new Float64Array(16);if(s)for(e=0;e<s.length;++e)t[e]=s[e];return t}function Do(s,e,t){for(var r=0;r<16;++r)s[r]=e[r]+t[r]}function su(s,e,t){for(var r=0;r<16;++r)s[r]=e[r]-t[r]}function Wi(s,e){ut(s,e,e)}function ut(s,e,t){var r,a,n=0,i=0,o=0,l=0,u=0,c=0,f=0,g=0,v=0,p=0,h=0,d=0,y=0,A=0,x=0,N=0,_=0,$=0,se=0,te=0,me=0,Ce=0,pe=0,ve=0,it=0,Ye=0,Ae=0,Ue=0,oe=0,xt=0,je=0,re=t[0],de=t[1],ne=t[2],ye=t[3],Te=t[4],He=t[5],nt=t[6],Le=t[7],Ne=t[8],ce=t[9],ft=t[10],ot=t[11],lt=t[12],$e=t[13],Jt=t[14],Gt=t[15];r=e[0],n+=r*re,i+=r*de,o+=r*ne,l+=r*ye,u+=r*Te,c+=r*He,f+=r*nt,g+=r*Le,v+=r*Ne,p+=r*ce,h+=r*ft,d+=r*ot,y+=r*lt,A+=r*$e,x+=r*Jt,N+=r*Gt,r=e[1],i+=r*re,o+=r*de,l+=r*ne,u+=r*ye,c+=r*Te,f+=r*He,g+=r*nt,v+=r*Le,p+=r*Ne,h+=r*ce,d+=r*ft,y+=r*ot,A+=r*lt,x+=r*$e,N+=r*Jt,_+=r*Gt,r=e[2],o+=r*re,l+=r*de,u+=r*ne,c+=r*ye,f+=r*Te,g+=r*He,v+=r*nt,p+=r*Le,h+=r*Ne,d+=r*ce,y+=r*ft,A+=r*ot,x+=r*lt,N+=r*$e,_+=r*Jt,$+=r*Gt,r=e[3],l+=r*re,u+=r*de,c+=r*ne,f+=r*ye,g+=r*Te,v+=r*He,p+=r*nt,h+=r*Le,d+=r*Ne,y+=r*ce,A+=r*ft,x+=r*ot,N+=r*lt,_+=r*$e,$+=r*Jt,se+=r*Gt,r=e[4],u+=r*re,c+=r*de,f+=r*ne,g+=r*ye,v+=r*Te,p+=r*He,h+=r*nt,d+=r*Le,y+=r*Ne,A+=r*ce,x+=r*ft,N+=r*ot,_+=r*lt,$+=r*$e,se+=r*Jt,te+=r*Gt,r=e[5],c+=r*re,f+=r*de,g+=r*ne,v+=r*ye,p+=r*Te,h+=r*He,d+=r*nt,y+=r*Le,A+=r*Ne,x+=r*ce,N+=r*ft,_+=r*ot,$+=r*lt,se+=r*$e,te+=r*Jt,me+=r*Gt,r=e[6],f+=r*re,g+=r*de,v+=r*ne,p+=r*ye,h+=r*Te,d+=r*He,y+=r*nt,A+=r*Le,x+=r*Ne,N+=r*ce,_+=r*ft,$+=r*ot,se+=r*lt,te+=r*$e,me+=r*Jt,Ce+=r*Gt,r=e[7],g+=r*re,v+=r*de,p+=r*ne,h+=r*ye,d+=r*Te,y+=r*He,A+=r*nt,x+=r*Le,N+=r*Ne,_+=r*ce,$+=r*ft,se+=r*ot,te+=r*lt,me+=r*$e,Ce+=r*Jt,pe+=r*Gt,r=e[8],v+=r*re,p+=r*de,h+=r*ne,d+=r*ye,y+=r*Te,A+=r*He,x+=r*nt,N+=r*Le,_+=r*Ne,$+=r*ce,se+=r*ft,te+=r*ot,me+=r*lt,Ce+=r*$e,pe+=r*Jt,ve+=r*Gt,r=e[9],p+=r*re,h+=r*de,d+=r*ne,y+=r*ye,A+=r*Te,x+=r*He,N+=r*nt,_+=r*Le,$+=r*Ne,se+=r*ce,te+=r*ft,me+=r*ot,Ce+=r*lt,pe+=r*$e,ve+=r*Jt,it+=r*Gt,r=e[10],h+=r*re,d+=r*de,y+=r*ne,A+=r*ye,x+=r*Te,N+=r*He,_+=r*nt,$+=r*Le,se+=r*Ne,te+=r*ce,me+=r*ft,Ce+=r*ot,pe+=r*lt,ve+=r*$e,it+=r*Jt,Ye+=r*Gt,r=e[11],d+=r*re,y+=r*de,A+=r*ne,x+=r*ye,N+=r*Te,_+=r*He,$+=r*nt,se+=r*Le,te+=r*Ne,me+=r*ce,Ce+=r*ft,pe+=r*ot,ve+=r*lt,it+=r*$e,Ye+=r*Jt,Ae+=r*Gt,r=e[12],y+=r*re,A+=r*de,x+=r*ne,N+=r*ye,_+=r*Te,$+=r*He,se+=r*nt,te+=r*Le,me+=r*Ne,Ce+=r*ce,pe+=r*ft,ve+=r*ot,it+=r*lt,Ye+=r*$e,Ae+=r*Jt,Ue+=r*Gt,r=e[13],A+=r*re,x+=r*de,N+=r*ne,_+=r*ye,$+=r*Te,se+=r*He,te+=r*nt,me+=r*Le,Ce+=r*Ne,pe+=r*ce,ve+=r*ft,it+=r*ot,Ye+=r*lt,Ae+=r*$e,Ue+=r*Jt,oe+=r*Gt,r=e[14],x+=r*re,N+=r*de,_+=r*ne,$+=r*ye,se+=r*Te,te+=r*He,me+=r*nt,Ce+=r*Le,pe+=r*Ne,ve+=r*ce,it+=r*ft,Ye+=r*ot,Ae+=r*lt,Ue+=r*$e,oe+=r*Jt,xt+=r*Gt,r=e[15],N+=r*re,_+=r*de,$+=r*ne,se+=r*ye,te+=r*Te,me+=r*He,Ce+=r*nt,pe+=r*Le,ve+=r*Ne,it+=r*ce,Ye+=r*ft,Ae+=r*ot,Ue+=r*lt,oe+=r*$e,xt+=r*Jt,je+=r*Gt,n+=38*_,i+=38*$,o+=38*se,l+=38*te,u+=38*me,c+=38*Ce,f+=38*pe,g+=38*ve,v+=38*it,p+=38*Ye,h+=38*Ae,d+=38*Ue,y+=38*oe,A+=38*xt,x+=38*je,a=1,r=n+a+65535,a=Math.floor(r/65536),n=r-a*65536,r=i+a+65535,a=Math.floor(r/65536),i=r-a*65536,r=o+a+65535,a=Math.floor(r/65536),o=r-a*65536,r=l+a+65535,a=Math.floor(r/65536),l=r-a*65536,r=u+a+65535,a=Math.floor(r/65536),u=r-a*65536,r=c+a+65535,a=Math.floor(r/65536),c=r-a*65536,r=f+a+65535,a=Math.floor(r/65536),f=r-a*65536,r=g+a+65535,a=Math.floor(r/65536),g=r-a*65536,r=v+a+65535,a=Math.floor(r/65536),v=r-a*65536,r=p+a+65535,a=Math.floor(r/65536),p=r-a*65536,r=h+a+65535,a=Math.floor(r/65536),h=r-a*65536,r=d+a+65535,a=Math.floor(r/65536),d=r-a*65536,r=y+a+65535,a=Math.floor(r/65536),y=r-a*65536,r=A+a+65535,a=Math.floor(r/65536),A=r-a*65536,r=x+a+65535,a=Math.floor(r/65536),x=r-a*65536,r=N+a+65535,a=Math.floor(r/65536),N=r-a*65536,n+=a-1+37*(a-1),a=1,r=n+a+65535,a=Math.floor(r/65536),n=r-a*65536,r=i+a+65535,a=Math.floor(r/65536),i=r-a*65536,r=o+a+65535,a=Math.floor(r/65536),o=r-a*65536,r=l+a+65535,a=Math.floor(r/65536),l=r-a*65536,r=u+a+65535,a=Math.floor(r/65536),u=r-a*65536,r=c+a+65535,a=Math.floor(r/65536),c=r-a*65536,r=f+a+65535,a=Math.floor(r/65536),f=r-a*65536,r=g+a+65535,a=Math.floor(r/65536),g=r-a*65536,r=v+a+65535,a=Math.floor(r/65536),v=r-a*65536,r=p+a+65535,a=Math.floor(r/65536),p=r-a*65536,r=h+a+65535,a=Math.floor(r/65536),h=r-a*65536,r=d+a+65535,a=Math.floor(r/65536),d=r-a*65536,r=y+a+65535,a=Math.floor(r/65536),y=r-a*65536,r=A+a+65535,a=Math.floor(r/65536),A=r-a*65536,r=x+a+65535,a=Math.floor(r/65536),x=r-a*65536,r=N+a+65535,a=Math.floor(r/65536),N=r-a*65536,n+=a-1+37*(a-1),s[0]=n,s[1]=i,s[2]=o,s[3]=l,s[4]=u,s[5]=c,s[6]=f,s[7]=g,s[8]=v,s[9]=p,s[10]=h,s[11]=d,s[12]=y,s[13]=A,s[14]=x,s[15]=N}var Ur=Me;Ur.kem=Ur.kem||{};var Ip=Ur.jsbn.BigInteger;Ur.kem.rsa={};Ur.kem.rsa.create=function(s,e){e=e||{};var t=e.prng||Ur.random,r={};return r.encrypt=function(a,n){var i=Math.ceil(a.n.bitLength()/8),o;do o=new Ip(Ur.util.bytesToHex(t.getBytesSync(i)),16).mod(a.n);while(o.compareTo(Ip.ONE)<=0);o=Ur.util.hexToBytes(o.toString(16));var l=i-o.length;l>0&&(o=Ur.util.fillString(String.fromCharCode(0),l)+o);var u=a.encrypt(o,"NONE"),c=s.generate(o,n);return{encapsulation:u,key:c}},r.decrypt=function(a,n,i){var o=a.decrypt(n,"NONE");return s.generate(o,i)},r};Ur.kem.kdf1=function(s,e){fv(this,s,0,e||s.digestLength)};Ur.kem.kdf2=function(s,e){fv(this,s,1,e||s.digestLength)};function fv(s,e,t,r){s.generate=function(a,n){for(var i=new Ur.util.ByteBuffer,o=Math.ceil(n/r)+t,l=new Ur.util.ByteBuffer,u=t;u<o;++u){l.putInt32(u),e.start(),e.update(a+l.getBytes());var c=e.digest();i.putBytes(c.getBytes(r))}return i.truncate(i.length()-n),i.getBytes()}}var Ge=Me;Ge.log=Ge.log||{};Ge.log.levels=["none","error","warning","info","debug","verbose","max"];var j0={},Vg=[],Yf=null;Ge.log.LEVEL_LOCKED=1<<1;Ge.log.NO_LEVEL_CHECK=1<<2;Ge.log.INTERPOLATE=1<<3;for(var An=0;An<Ge.log.levels.length;++An){var kp=Ge.log.levels[An];j0[kp]={index:An,name:kp.toUpperCase()}}Ge.log.logMessage=function(s){for(var e=j0[s.level].index,t=0;t<Vg.length;++t){var r=Vg[t];if(r.flags&Ge.log.NO_LEVEL_CHECK)r.f(s);else{var a=j0[r.level].index;e<=a&&r.f(r,s)}}};Ge.log.prepareStandard=function(s){"standard"in s||(s.standard=j0[s.level].name+" ["+s.category+"] "+s.message)};Ge.log.prepareFull=function(s){if(!("full"in s)){var e=[s.message];e=e.concat([]),s.full=Ge.util.format.apply(this,e)}};Ge.log.prepareStandardFull=function(s){"standardFull"in s||(Ge.log.prepareStandard(s),s.standardFull=s.standard)};for(var Np=["error","warning","info","debug","verbose"],An=0;An<Np.length;++An)(function(e){Ge.log[e]=function(t,r){var a=Array.prototype.slice.call(arguments).slice(2),n={timestamp:new Date,level:e,category:t,message:r,arguments:a};Ge.log.logMessage(n)}})(Np[An]);Ge.log.makeLogger=function(s){var e={flags:0,f:s};return Ge.log.setLevel(e,"none"),e};Ge.log.setLevel=function(s,e){var t=!1;if(s&&!(s.flags&Ge.log.LEVEL_LOCKED))for(var r=0;r<Ge.log.levels.length;++r){var a=Ge.log.levels[r];if(e==a){s.level=e,t=!0;break}}return t};Ge.log.lock=function(s,e){typeof e>"u"||e?s.flags|=Ge.log.LEVEL_LOCKED:s.flags&=~Ge.log.LEVEL_LOCKED};Ge.log.addLogger=function(s){Vg.push(s)};if(typeof console<"u"&&"log"in console){var $u;if(console.error&&console.warn&&console.info&&console.debug){var qA={error:console.error,warning:console.warn,info:console.info,debug:console.debug,verbose:console.debug},Bm=function(s,e){Ge.log.prepareStandard(e);var t=qA[e.level],r=[e.standard];r=r.concat(e.arguments.slice()),t.apply(console,r)};$u=Ge.log.makeLogger(Bm)}else{var Bm=function(e,t){Ge.log.prepareStandardFull(t),console.log(t.standardFull)};$u=Ge.log.makeLogger(Bm)}Ge.log.setLevel($u,"debug"),Ge.log.addLogger($u),Yf=$u}else console={log:function(){}};if(Yf!==null&&typeof window<"u"&&window.location){var Bh=new URL(window.location.href).searchParams;if(Bh.has("console.level")&&Ge.log.setLevel(Yf,Bh.get("console.level").slice(-1)[0]),Bh.has("console.lock")){var JA=Bh.get("console.lock").slice(-1)[0];JA=="true"&&Ge.log.lock(Yf)}}Ge.log.consoleLogger=Yf;var GA={exports:{}};(function(s){s.exports=ww})(GA);var ie=Me,I=ie.asn1,Sr=ie.pkcs7=ie.pkcs7||{};Sr.messageFromPem=function(s){var e=ie.pem.decode(s)[0];if(e.type!=="PKCS7"){var t=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var r=I.fromDer(e.body);return Sr.messageFromAsn1(r)};Sr.messageToPem=function(s,e){var t={type:"PKCS7",body:I.toDer(s.toAsn1()).getBytes()};return ie.pem.encode(t,{maxline:e})};Sr.messageFromAsn1=function(s){var e={},t=[];if(!I.validate(s,Sr.asn1.contentInfoValidator,e,t)){var r=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw r.errors=t,r}var a=I.derToOid(e.contentType),n;switch(a){case ie.pki.oids.envelopedData:n=Sr.createEnvelopedData();break;case ie.pki.oids.encryptedData:n=Sr.createEncryptedData();break;case ie.pki.oids.signedData:n=Sr.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+a+" is not (yet) supported.")}return n.fromAsn1(e.content.value[0]),n};Sr.createSignedData=function(){var s=null;return s={type:ie.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(r){if(Im(s,r,Sr.asn1.signedDataValidator),s.certificates=[],s.crls=[],s.digestAlgorithmIdentifiers=[],s.contentInfo=null,s.signerInfos=[],s.rawCapture.certificates)for(var a=s.rawCapture.certificates.value,n=0;n<a.length;++n)s.certificates.push(ie.pki.certificateFromAsn1(a[n]))},toAsn1:function(){s.contentInfo||s.sign();for(var r=[],a=0;a<s.certificates.length;++a)r.push(ie.pki.certificateToAsn1(s.certificates[a]));var n=[],i=I.create(I.Class.CONTEXT_SPECIFIC,0,!0,[I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.INTEGER,!1,I.integerToDer(s.version).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.SET,!0,s.digestAlgorithmIdentifiers),s.contentInfo])]);return r.length>0&&i.value[0].value.push(I.create(I.Class.CONTEXT_SPECIFIC,0,!0,r)),n.length>0&&i.value[0].value.push(I.create(I.Class.CONTEXT_SPECIFIC,1,!0,n)),i.value[0].value.push(I.create(I.Class.UNIVERSAL,I.Type.SET,!0,s.signerInfos)),I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(s.type).getBytes()),i])},addSigner:function(r){var a=r.issuer,n=r.serialNumber;if(r.certificate){var i=r.certificate;typeof i=="string"&&(i=ie.pki.certificateFromPem(i)),a=i.issuer.attributes,n=i.serialNumber}var o=r.key;if(!o)throw new Error("Could not add PKCS#7 signer; no private key specified.");typeof o=="string"&&(o=ie.pki.privateKeyFromPem(o));var l=r.digestAlgorithm||ie.pki.oids.sha1;switch(l){case ie.pki.oids.sha1:case ie.pki.oids.sha256:case ie.pki.oids.sha384:case ie.pki.oids.sha512:case ie.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+l)}var u=r.authenticatedAttributes||[];if(u.length>0){for(var c=!1,f=!1,g=0;g<u.length;++g){var v=u[g];if(!c&&v.type===ie.pki.oids.contentType){if(c=!0,f)break;continue}if(!f&&v.type===ie.pki.oids.messageDigest){if(f=!0,c)break;continue}}if(!c||!f)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}s.signers.push({key:o,version:1,issuer:a,serialNumber:n,digestAlgorithm:l,signatureAlgorithm:ie.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:u,unauthenticatedAttributes:[]})},sign:function(r){if(r=r||{},(typeof s.content!="object"||s.contentInfo===null)&&(s.contentInfo=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(ie.pki.oids.data).getBytes())]),"content"in s)){var a;s.content instanceof ie.util.ByteBuffer?a=s.content.bytes():typeof s.content=="string"&&(a=ie.util.encodeUtf8(s.content)),r.detached?s.detachedContent=I.create(I.Class.UNIVERSAL,I.Type.OCTETSTRING,!1,a):s.contentInfo.value.push(I.create(I.Class.CONTEXT_SPECIFIC,0,!0,[I.create(I.Class.UNIVERSAL,I.Type.OCTETSTRING,!1,a)]))}if(s.signers.length!==0){var n=e();t(n)}},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(r){typeof r=="string"&&(r=ie.pki.certificateFromPem(r)),s.certificates.push(r)},addCertificateRevokationList:function(r){throw new Error("PKCS#7 CRL support not yet implemented.")}},s;function e(){for(var r={},a=0;a<s.signers.length;++a){var n=s.signers[a],i=n.digestAlgorithm;i in r||(r[i]=ie.md[ie.pki.oids[i]].create()),n.authenticatedAttributes.length===0?n.md=r[i]:n.md=ie.md[ie.pki.oids[i]].create()}s.digestAlgorithmIdentifiers=[];for(var i in r)s.digestAlgorithmIdentifiers.push(I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(i).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.NULL,!1,"")]));return r}function t(r){var a;if(s.detachedContent?a=s.detachedContent:(a=s.contentInfo.value[1],a=a.value[0]),!a)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var n=I.derToOid(s.contentInfo.value[0].value),i=I.toDer(a);i.getByte(),I.getBerValueLength(i),i=i.getBytes();for(var o in r)r[o].start().update(i);for(var l=new Date,u=0;u<s.signers.length;++u){var c=s.signers[u];if(c.authenticatedAttributes.length===0){if(n!==ie.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{c.authenticatedAttributesAsn1=I.create(I.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var f=I.create(I.Class.UNIVERSAL,I.Type.SET,!0,[]),g=0;g<c.authenticatedAttributes.length;++g){var v=c.authenticatedAttributes[g];v.type===ie.pki.oids.messageDigest?v.value=r[c.digestAlgorithm].digest():v.type===ie.pki.oids.signingTime&&(v.value||(v.value=l)),f.value.push($g(v)),c.authenticatedAttributesAsn1.value.push($g(v))}i=I.toDer(f).getBytes(),c.md.start().update(i)}c.signature=c.key.sign(c.md,"RSASSA-PKCS1-V1_5")}s.signerInfos=XA(s.signers)}};Sr.createEncryptedData=function(){var s=null;return s={type:ie.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:ie.pki.oids["aes256-CBC"]},fromAsn1:function(e){Im(s,e,Sr.asn1.encryptedDataValidator)},decrypt:function(e){e!==void 0&&(s.encryptedContent.key=e),hv(s)}},s};Sr.createEnvelopedData=function(){var s=null;return s={type:ie.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:ie.pki.oids["aes256-CBC"]},fromAsn1:function(e){var t=Im(s,e,Sr.asn1.envelopedDataValidator);s.recipients=QA(t.recipientInfos.value)},toAsn1:function(){return I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(s.type).getBytes()),I.create(I.Class.CONTEXT_SPECIFIC,0,!0,[I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.INTEGER,!1,I.integerToDer(s.version).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.SET,!0,YA(s.recipients)),I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,ZA(s.encryptedContent))])])])},findRecipient:function(e){for(var t=e.issuer.attributes,r=0;r<s.recipients.length;++r){var a=s.recipients[r],n=a.issuer;if(a.serialNumber===e.serialNumber&&n.length===t.length){for(var i=!0,o=0;o<t.length;++o)if(n[o].type!==t[o].type||n[o].value!==t[o].value){i=!1;break}if(i)return a}}return null},decrypt:function(e,t){if(s.encryptedContent.key===void 0&&e!==void 0&&t!==void 0)switch(e.encryptedContent.algorithm){case ie.pki.oids.rsaEncryption:case ie.pki.oids.desCBC:var r=t.decrypt(e.encryptedContent.content);s.encryptedContent.key=ie.util.createBuffer(r);break;default:throw new Error("Unsupported asymmetric cipher, OID "+e.encryptedContent.algorithm)}hv(s)},addRecipient:function(e){s.recipients.push({version:0,issuer:e.issuer.attributes,serialNumber:e.serialNumber,encryptedContent:{algorithm:ie.pki.oids.rsaEncryption,key:e.publicKey}})},encrypt:function(e,t){if(s.encryptedContent.content===void 0){t=t||s.encryptedContent.algorithm,e=e||s.encryptedContent.key;var r,a,n;switch(t){case ie.pki.oids["aes128-CBC"]:r=16,a=16,n=ie.aes.createEncryptionCipher;break;case ie.pki.oids["aes192-CBC"]:r=24,a=16,n=ie.aes.createEncryptionCipher;break;case ie.pki.oids["aes256-CBC"]:r=32,a=16,n=ie.aes.createEncryptionCipher;break;case ie.pki.oids["des-EDE3-CBC"]:r=24,a=8,n=ie.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+t)}if(e===void 0)e=ie.util.createBuffer(ie.random.getBytes(r));else if(e.length()!=r)throw new Error("Symmetric key has wrong length; got "+e.length()+" bytes, expected "+r+".");s.encryptedContent.algorithm=t,s.encryptedContent.key=e,s.encryptedContent.parameter=ie.util.createBuffer(ie.random.getBytes(a));var i=n(e);if(i.start(s.encryptedContent.parameter.copy()),i.update(s.content),!i.finish())throw new Error("Symmetric encryption failed.");s.encryptedContent.content=i.output}for(var o=0;o<s.recipients.length;++o){var l=s.recipients[o];if(l.encryptedContent.content===void 0)switch(l.encryptedContent.algorithm){case ie.pki.oids.rsaEncryption:l.encryptedContent.content=l.encryptedContent.key.encrypt(s.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+l.encryptedContent.algorithm)}}}},s};function jA(s){var e={},t=[];if(!I.validate(s,Sr.asn1.recipientInfoValidator,e,t)){var r=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw r.errors=t,r}return{version:e.version.charCodeAt(0),issuer:ie.pki.RDNAttributesAsArray(e.issuer),serialNumber:ie.util.createBuffer(e.serial).toHex(),encryptedContent:{algorithm:I.derToOid(e.encAlgorithm),parameter:e.encParameter?e.encParameter.value:void 0,content:e.encKey}}}function WA(s){return I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.INTEGER,!1,I.integerToDer(s.version).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[ie.pki.distinguishedNameToAsn1({attributes:s.issuer}),I.create(I.Class.UNIVERSAL,I.Type.INTEGER,!1,ie.util.hexToBytes(s.serialNumber))]),I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(s.encryptedContent.algorithm).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.NULL,!1,"")]),I.create(I.Class.UNIVERSAL,I.Type.OCTETSTRING,!1,s.encryptedContent.content)])}function QA(s){for(var e=[],t=0;t<s.length;++t)e.push(jA(s[t]));return e}function YA(s){for(var e=[],t=0;t<s.length;++t)e.push(WA(s[t]));return e}function zA(s){var e=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.INTEGER,!1,I.integerToDer(s.version).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[ie.pki.distinguishedNameToAsn1({attributes:s.issuer}),I.create(I.Class.UNIVERSAL,I.Type.INTEGER,!1,ie.util.hexToBytes(s.serialNumber))]),I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(s.digestAlgorithm).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.NULL,!1,"")])]);if(s.authenticatedAttributesAsn1&&e.value.push(s.authenticatedAttributesAsn1),e.value.push(I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(s.signatureAlgorithm).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.NULL,!1,"")])),e.value.push(I.create(I.Class.UNIVERSAL,I.Type.OCTETSTRING,!1,s.signature)),s.unauthenticatedAttributes.length>0){for(var t=I.create(I.Class.CONTEXT_SPECIFIC,1,!0,[]),r=0;r<s.unauthenticatedAttributes.length;++r){var a=s.unauthenticatedAttributes[r];t.values.push($g(a))}e.value.push(t)}return e}function XA(s){for(var e=[],t=0;t<s.length;++t)e.push(zA(s[t]));return e}function $g(s){var e;if(s.type===ie.pki.oids.contentType)e=I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(s.value).getBytes());else if(s.type===ie.pki.oids.messageDigest)e=I.create(I.Class.UNIVERSAL,I.Type.OCTETSTRING,!1,s.value.bytes());else if(s.type===ie.pki.oids.signingTime){var t=new Date("1950-01-01T00:00:00Z"),r=new Date("2050-01-01T00:00:00Z"),a=s.value;if(typeof a=="string"){var n=Date.parse(a);isNaN(n)?a.length===13?a=I.utcTimeToDate(a):a=I.generalizedTimeToDate(a):a=new Date(n)}a>=t&&a<r?e=I.create(I.Class.UNIVERSAL,I.Type.UTCTIME,!1,I.dateToUtcTime(a)):e=I.create(I.Class.UNIVERSAL,I.Type.GENERALIZEDTIME,!1,I.dateToGeneralizedTime(a))}return I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(s.type).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.SET,!0,[e])])}function ZA(s){return[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(ie.pki.oids.data).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(s.algorithm).getBytes()),s.parameter?I.create(I.Class.UNIVERSAL,I.Type.OCTETSTRING,!1,s.parameter.getBytes()):void 0]),I.create(I.Class.CONTEXT_SPECIFIC,0,!0,[I.create(I.Class.UNIVERSAL,I.Type.OCTETSTRING,!1,s.content.getBytes())])]}function Im(s,e,t){var r={},a=[];if(!I.validate(e,t,r,a)){var n=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw n.errors=n,n}var i=I.derToOid(r.contentType);if(i!==ie.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(r.encryptedContent){var o="";if(ie.util.isArray(r.encryptedContent))for(var l=0;l<r.encryptedContent.length;++l){if(r.encryptedContent[l].type!==I.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");o+=r.encryptedContent[l].value}else o=r.encryptedContent;s.encryptedContent={algorithm:I.derToOid(r.encAlgorithm),parameter:ie.util.createBuffer(r.encParameter.value),content:ie.util.createBuffer(o)}}if(r.content){var o="";if(ie.util.isArray(r.content))for(var l=0;l<r.content.length;++l){if(r.content[l].type!==I.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");o+=r.content[l].value}else o=r.content;s.content=ie.util.createBuffer(o)}return s.version=r.version.charCodeAt(0),s.rawCapture=r,r}function hv(s){if(s.encryptedContent.key===void 0)throw new Error("Symmetric key not available.");if(s.content===void 0){var e;switch(s.encryptedContent.algorithm){case ie.pki.oids["aes128-CBC"]:case ie.pki.oids["aes192-CBC"]:case ie.pki.oids["aes256-CBC"]:e=ie.aes.createDecryptionCipher(s.encryptedContent.key);break;case ie.pki.oids.desCBC:case ie.pki.oids["des-EDE3-CBC"]:e=ie.des.createDecryptionCipher(s.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+s.encryptedContent.algorithm)}if(e.start(s.encryptedContent.parameter),e.update(s.encryptedContent.content),!e.finish())throw new Error("Symmetric decryption failed.");s.content=e.output}}var Ht=Me,bd=Ht.ssh=Ht.ssh||{};bd.privateKeyToPutty=function(s,e,t){t=t||"",e=e||"";var r="ssh-rsa",a=e===""?"none":"aes256-cbc",n="PuTTY-User-Key-File-2: "+r+`\r
`;n+="Encryption: "+a+`\r
`,n+="Comment: "+t+`\r
`;var i=Ht.util.createBuffer();au(i,r),xs(i,s.e),xs(i,s.n);var o=Ht.util.encode64(i.bytes(),64),l=Math.floor(o.length/66)+1;n+="Public-Lines: "+l+`\r
`,n+=o;var u=Ht.util.createBuffer();xs(u,s.d),xs(u,s.p),xs(u,s.q),xs(u,s.qInv);var c;if(!e)c=Ht.util.encode64(u.bytes(),64);else{var f=u.length()+16-1;f-=f%16;var g=Ih(u.bytes());g.truncate(g.length()-f+u.length()),u.putBuffer(g);var v=Ht.util.createBuffer();v.putBuffer(Ih("\0\0\0\0",e)),v.putBuffer(Ih("\0\0\0",e));var p=Ht.aes.createEncryptionCipher(v.truncate(8),"CBC");p.start(Ht.util.createBuffer().fillWithByte(0,16)),p.update(u.copy()),p.finish();var h=p.output;h.truncate(16),c=Ht.util.encode64(h.bytes(),64)}l=Math.floor(c.length/66)+1,n+=`\r
Private-Lines: `+l+`\r
`,n+=c;var d=Ih("putty-private-key-file-mac-key",e),y=Ht.util.createBuffer();au(y,r),au(y,a),au(y,t),y.putInt32(i.length()),y.putBuffer(i),y.putInt32(u.length()),y.putBuffer(u);var A=Ht.hmac.create();return A.start("sha1",d),A.update(y.bytes()),n+=`\r
Private-MAC: `+A.digest().toHex()+`\r
`,n};bd.publicKeyToOpenSSH=function(s,e){var t="ssh-rsa";e=e||"";var r=Ht.util.createBuffer();return au(r,t),xs(r,s.e),xs(r,s.n),t+" "+Ht.util.encode64(r.bytes())+" "+e};bd.privateKeyToOpenSSH=function(s,e){return e?Ht.pki.encryptRsaPrivateKey(s,e,{legacy:!0,algorithm:"aes128"}):Ht.pki.privateKeyToPem(s)};bd.getPublicKeyFingerprint=function(s,e){e=e||{};var t=e.md||Ht.md.md5.create(),r="ssh-rsa",a=Ht.util.createBuffer();au(a,r),xs(a,s.e),xs(a,s.n),t.start(),t.update(a.getBytes());var n=t.digest();if(e.encoding==="hex"){var i=n.toHex();return e.delimiter?i.match(/.{2}/g).join(e.delimiter):i}else{if(e.encoding==="binary")return n.getBytes();if(e.encoding)throw new Error('Unknown encoding "'+e.encoding+'".')}return n};function xs(s,e){var t=e.toString(16);t[0]>="8"&&(t="00"+t);var r=Ht.util.hexToBytes(t);s.putInt32(r.length),s.putBytes(r)}function au(s,e){s.putInt32(e.length),s.putString(e)}function Ih(){for(var s=Ht.md.sha1.create(),e=arguments.length,t=0;t<e;++t)s.update(arguments[t]);return s.digest()}(function(s){s.exports=Me})(Ay);const Er=lw(Ay.exports);/*!
 * MIT License
 * 
 * Copyright (c) 2017-2024 Peculiar Ventures, LLC
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const eb="[object ArrayBuffer]";class Se{static isArrayBuffer(e){return Object.prototype.toString.call(e)===eb}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const r=Se.toUint8Array(e),a=Se.toUint8Array(t);if(r.length!==a.byteLength)return!1;for(let n=0;n<r.length;n++)if(r[n]!==a[n])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let r=0;for(const i of t)r+=i.byteLength;const a=new Uint8Array(r);let n=0;for(const i of t){const o=this.toUint8Array(i);a.set(o,n),n+=o.length}return e[e.length-1]instanceof Function?this.toView(a,e[e.length-1]):a.buffer}}const Pd="string",tb=/^[0-9a-f\s]+$/i,rb=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,sb=/^[a-zA-Z0-9-_]+$/;class Tp{static fromString(e){const t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length);for(let a=0;a<t.length;a++)r[a]=t.charCodeAt(a);return r.buffer}static toString(e){const t=Se.toUint8Array(e);let r="";for(let n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return decodeURIComponent(escape(r))}}class ws{static toString(e,t=!1){const r=Se.toArrayBuffer(e),a=new DataView(r);let n="";for(let i=0;i<r.byteLength;i+=2){const o=a.getUint16(i,t);n+=String.fromCharCode(o)}return n}static fromString(e,t=!1){const r=new ArrayBuffer(e.length*2),a=new DataView(r);for(let n=0;n<e.length;n++)a.setUint16(n*2,e.charCodeAt(n),t);return r}}class Ee{static isHex(e){return typeof e===Pd&&tb.test(e)}static isBase64(e){return typeof e===Pd&&rb.test(e)}static isBase64Url(e){return typeof e===Pd&&sb.test(e)}static ToString(e,t="utf8"){const r=Se.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return ws.toString(r,!0);case"utf16":case"utf16be":return ws.toString(r);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return ws.fromString(e,!0);case"utf16":case"utf16be":return ws.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=Se.toUint8Array(e);if(typeof btoa<"u"){const r=this.ToString(t,"binary");return btoa(r)}else return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ee.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ee.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=Ee.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return Tp.fromString(e);case"utf16":case"utf16be":return ws.fromString(e);case"utf16le":case"usc2":return ws.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=Ee.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return Tp.toString(e);case"utf16":case"utf16be":return ws.toString(e);case"utf16le":case"usc2":return ws.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,r=new Uint8Array(t);for(let a=0;a<t;a++)r[a]=e.charCodeAt(a);return r.buffer}static ToBinary(e){const t=Se.toUint8Array(e);let r="";for(let a=0;a<t.length;a++)r+=String.fromCharCode(t[a]);return r}static ToHex(e){const t=Se.toUint8Array(e);let r="";const a=t.length;for(let n=0;n<a;n++){const i=t[n];i<16&&(r+="0"),r+=i.toString(16)}return r}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ee.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const r=new Uint8Array(t.length/2);for(let a=0;a<t.length;a=a+2){const n=t.slice(a,a+2);r[a/2]=parseInt(n,16)}return r.buffer}static ToUtf16String(e,t=!1){return ws.toString(e,t)}static FromUtf16String(e,t=!1){return ws.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let r=0;r<t;r++)e+="=";return e}static formatString(e){return(e==null?void 0:e.replace(/[\n\r\t ]/g,""))||""}}Ee.DEFAULT_UTF8_ENCODING="utf8";/*!
 Copyright (c) Peculiar Ventures, LLC
*/function m(s,e,t){var r;return s instanceof Object&&(r=s[e])!==null&&r!==void 0?r:t}function _p(s,e=0,t=s.byteLength-e,r=!1){let a="";for(const n of new Uint8Array(s,e,t)){const i=n.toString(16).toUpperCase();i.length===1&&(a+="0"),a+=i,r&&(a+=" ")}return a.trim()}function go(s,e){let t=0;if(s.length===1)return s[0];for(let r=s.length-1;r>=0;r--)t+=s[s.length-1-r]*Math.pow(2,e*r);return t}function ma(s,e,t=-1){const r=t;let a=s,n=0,i=Math.pow(2,e);for(let o=1;o<8;o++){if(s<i){let l;if(r<0)l=new ArrayBuffer(o),n=o;else{if(r<o)return new ArrayBuffer(0);l=new ArrayBuffer(r),n=r}const u=new Uint8Array(l);for(let c=o-1;c>=0;c--){const f=Math.pow(2,c*e);u[n-c-1]=Math.floor(a/f),a-=u[n-c-1]*f}return l}i*=Math.pow(2,e)}return new ArrayBuffer(0)}function ou(...s){let e=0,t=0;for(const n of s)e+=n.byteLength;const r=new ArrayBuffer(e),a=new Uint8Array(r);for(const n of s)a.set(new Uint8Array(n),t),t+=n.byteLength;return r}function Dg(...s){let e=0,t=0;for(const n of s)e+=n.length;const r=new ArrayBuffer(e),a=new Uint8Array(r);for(const n of s)a.set(n,t),t+=n.length;return a}function dv(){const s=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const o=s[0]===255&&s[1]&128,l=s[0]===0&&(s[1]&128)===0;(o||l)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let o=0;o<this.valueHex.byteLength;o++)t[o]=0;t[0]=s[0]&128;const r=go(t,8),a=new ArrayBuffer(this.valueHex.byteLength),n=new Uint8Array(a);for(let o=0;o<this.valueHex.byteLength;o++)n[o]=s[o];return n[0]&=127,go(n,8)-r}function ab(s){const e=s<0?s*-1:s;let t=128;for(let r=1;r<8;r++){if(e<=t){if(s<0){const i=t-e,o=ma(i,8,r),l=new Uint8Array(o);return l[0]|=128,o}let a=ma(e,8,r),n=new Uint8Array(a);if(n[0]&128){const i=a.slice(0),o=new Uint8Array(i);a=new ArrayBuffer(a.byteLength+1),n=new Uint8Array(a);for(let l=0;l<i.byteLength;l++)n[l+1]=o[l];n[0]=0}return a}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function wu(s,e){if(s.byteLength!==e.byteLength)return!1;const t=new Uint8Array(s),r=new Uint8Array(e);for(let a=0;a<t.length;a++)if(t[a]!==r[a])return!1;return!0}function Lr(s,e){const t=s.toString(10);if(e<t.length)return"";const r=e-t.length,a=new Array(r);for(let i=0;i<r;i++)a[i]="0";return a.join("").concat(t)}const gv="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",mv="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function Lg(s,e=!1,t=!1,r=!1){let a=0,n=0,i=0,o="";const l=e?mv:gv;if(r){let u=0;for(let c=0;c<s.length;c++)if(s.charCodeAt(c)!==0){u=c;break}s=s.slice(u)}for(;a<s.length;){const u=s.charCodeAt(a++);a>=s.length&&(n=1);const c=s.charCodeAt(a++);a>=s.length&&(i=1);const f=s.charCodeAt(a++),g=u>>2,v=(u&3)<<4|c>>4;let p=(c&15)<<2|f>>6,h=f&63;n===1?p=h=64:i===1&&(h=64),t?p===64?o+=`${l.charAt(g)}${l.charAt(v)}`:h===64?o+=`${l.charAt(g)}${l.charAt(v)}${l.charAt(p)}`:o+=`${l.charAt(g)}${l.charAt(v)}${l.charAt(p)}${l.charAt(h)}`:o+=`${l.charAt(g)}${l.charAt(v)}${l.charAt(p)}${l.charAt(h)}`}return o}function rh(s,e=!1,t=!1){const r=e?mv:gv;function a(l){for(let u=0;u<64;u++)if(r.charAt(u)===l)return u;return 64}function n(l){return l===64?0:l}let i=0,o="";for(;i<s.length;){const l=a(s.charAt(i++)),u=i>=s.length?0:a(s.charAt(i++)),c=i>=s.length?0:a(s.charAt(i++)),f=i>=s.length?0:a(s.charAt(i++)),g=n(l)<<2|n(u)>>4,v=(n(u)&15)<<4|n(c)>>2,p=(n(c)&3)<<6|n(f);o+=String.fromCharCode(g),c!==64&&(o+=String.fromCharCode(v)),f!==64&&(o+=String.fromCharCode(p))}if(t){const l=o.length;let u=-1;for(let c=l-1;c>=0;c--)if(o.charCodeAt(c)!==0){u=c;break}u!==-1?o=o.slice(0,u+1):o=""}return o}function W0(s){let e="";const t=new Uint8Array(s);for(const r of t)e+=String.fromCharCode(r);return e}function Su(s){const e=s.length,t=new ArrayBuffer(e),r=new Uint8Array(t);for(let a=0;a<e;a++)r[a]=s.charCodeAt(a);return t}const nb=Math.log(2);function ib(s){const e=Math.log(s)/nb,t=Math.floor(e),r=Math.round(e);return t===r?t:r}function W(s,e){for(const t of e)delete s[t]}/*!
 * Copyright (c) 2014, GMO GlobalSign
 * Copyright (c) 2015-2022, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */function Q0(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function km(s){let e=0,t=0;for(let a=0;a<s.length;a++){const n=s[a];e+=n.byteLength}const r=new Uint8Array(e);for(let a=0;a<s.length;a++){const n=s[a];r.set(new Uint8Array(n),t),t+=n.byteLength}return r.buffer}function pa(s,e,t,r){return e instanceof Uint8Array?e.byteLength?t<0?(s.error="Wrong parameter: inputOffset less than zero",!1):r<0?(s.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-r<0?(s.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(s.error="Wrong parameter: inputBuffer has zero length",!1):(s.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class Nm{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return km(this.items)}}const Du=[new Uint8Array([1])],Rp="0123456789",Ud="name",Vp="valueHexView",ob="isHexOnly",lb="idBlock",ub="tagClass",cb="tagNumber",fb="isConstructed",hb="fromBER",db="toBER",gb="local",Br="",ys=new ArrayBuffer(0),Ed=new Uint8Array(0),sh="EndOfContent",pv="OCTET STRING",yv="BIT STRING";function ya(s){var e;return e=class extends s{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(r){this.valueHexView=new Uint8Array(r)}constructor(...r){var a;super(...r);const n=r[0]||{};this.isHexOnly=(a=n.isHexOnly)!==null&&a!==void 0?a:!1,this.valueHexView=n.valueHex?Se.toUint8Array(n.valueHex):Ed}fromBER(r,a,n){const i=r instanceof ArrayBuffer?new Uint8Array(r):r;if(!pa(this,i,a,n))return-1;const o=a+n;return this.valueHexView=i.subarray(a,o),this.valueHexView.length?(this.blockLength=n,o):(this.warnings.push("Zero buffer length"),a)}toBER(r=!1){return this.isHexOnly?r?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",ys)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:Ee.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}class So{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=Br,warnings:r=[],valueBeforeDecode:a=Ed}={}){this.blockLength=e,this.error=t,this.warnings=r,this.valueBeforeDecodeView=Se.toUint8Array(a)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Ee.ToHex(this.valueBeforeDecodeView)}}}So.NAME="baseBlock";class Tr extends So{fromBER(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}Tr.NAME="valueBlock";class vv extends ya(So){constructor({idBlock:e={}}={}){var t,r,a,n;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?Se.toUint8Array(e.valueHex):Ed,this.tagClass=(r=e.tagClass)!==null&&r!==void 0?r:-1,this.tagNumber=(a=e.tagNumber)!==null&&a!==void 0?a:-1,this.isConstructed=(n=e.isConstructed)!==null&&n!==void 0?n:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",ys}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const a=new Uint8Array(1);if(!e){let n=this.tagNumber;n&=31,t|=n,a[0]=t}return a.buffer}if(!this.isHexOnly){const a=ma(this.tagNumber,7),n=new Uint8Array(a),i=a.byteLength,o=new Uint8Array(i+1);if(o[0]=t|31,!e){for(let l=0;l<i-1;l++)o[l+1]=n[l]|128;o[i]=n[i-1]}return o.buffer}const r=new Uint8Array(this.valueHexView.byteLength+1);if(r[0]=t|31,!e){const a=this.valueHexView;for(let n=0;n<a.length-1;n++)r[n+1]=a[n]|128;r[this.valueHexView.byteLength]=a[a.length-1]}return r.buffer}fromBER(e,t,r){const a=Se.toUint8Array(e);if(!pa(this,a,t,r))return-1;const n=a.subarray(t,t+r);if(n.length===0)return this.error="Zero buffer length",-1;switch(n[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(n[0]&32)===32,this.isHexOnly=!1;const o=n[0]&31;if(o!==31)this.tagNumber=o,this.blockLength=1;else{let l=1,u=this.valueHexView=new Uint8Array(255),c=255;for(;n[l]&128;){if(u[l-1]=n[l]&127,l++,l>=n.length)return this.error="End of input reached before message was fully decoded",-1;if(l===c){c+=255;const g=new Uint8Array(c);for(let v=0;v<u.length;v++)g[v]=u[v];u=this.valueHexView=new Uint8Array(c)}}this.blockLength=l+1,u[l-1]=n[l]&127;const f=new Uint8Array(l);for(let g=0;g<l;g++)f[g]=u[g];u=this.valueHexView=new Uint8Array(l),u.set(f),this.blockLength<=9?this.tagNumber=go(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}vv.NAME="identificationBlock";class wv extends So{constructor({lenBlock:e={}}={}){var t,r,a;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(r=e.longFormUsed)!==null&&r!==void 0?r:!1,this.length=(a=e.length)!==null&&a!==void 0?a:0}fromBER(e,t,r){const a=Se.toUint8Array(e);if(!pa(this,a,t,r))return-1;const n=a.subarray(t,t+r);if(n.length===0)return this.error="Zero buffer length",-1;if(n[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=n[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(n[0]&128),this.longFormUsed===!1)return this.length=n[0],this.blockLength=1,t+this.blockLength;const i=n[0]&127;if(i>8)return this.error="Too big integer",-1;if(i+1>n.length)return this.error="End of input reached before message was fully decoded",-1;const o=t+1,l=a.subarray(o,o+i);return l[i-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=go(l,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=i+1,t+this.blockLength}toBER(e=!1){let t,r;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(r=new Uint8Array(t),r[0]=128),t;if(this.longFormUsed){const a=ma(this.length,8);if(a.byteLength>127)return this.error="Too big length",ys;if(t=new ArrayBuffer(a.byteLength+1),e)return t;const n=new Uint8Array(a);r=new Uint8Array(t),r[0]=a.byteLength|128;for(let i=0;i<a.byteLength;i++)r[i+1]=n[i];return t}return t=new ArrayBuffer(1),e===!1&&(r=new Uint8Array(t),r[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}wv.NAME="lengthBlock";const ge={};class br extends So{constructor({name:e=Br,optional:t=!1,primitiveSchema:r,...a}={},n){super(a),this.name=e,this.optional=t,r&&(this.primitiveSchema=r),this.idBlock=new vv(a),this.lenBlock=new wv(a),this.valueBlock=n?new n(a):new Tr(a)}fromBER(e,t,r){const a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return a===-1?(this.error=this.valueBlock.error,a):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}toBER(e,t){const r=t||new Nm;t||Sv(this);const a=this.idBlock.toBER(e);if(r.write(a),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{const n=this.valueBlock.toBER(e);this.lenBlock.length=n.byteLength;const i=this.lenBlock.toBER(e);r.write(i),r.write(n)}return t?ys:r.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():Ee.ToHex(this.toBER())}onAsciiEncoding(){const e=this.constructor.NAME,t=Ee.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;const t=this.toBER(),r=e.toBER();return wu(t,r)}}br.NAME="BaseBlock";function Sv(s){var e;if(s instanceof ge.Constructed)for(const t of s.valueBlock.value)Sv(t)&&(s.lenBlock.isIndefiniteForm=!0);return!!(!((e=s.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}class Cv extends br{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=Br,...t}={},r){super(t,r),e&&this.fromString(e)}fromBER(e,t,r){const a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return a===-1?(this.error=this.valueBlock.error,a):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}Cv.NAME="BaseStringBlock";class Av extends ya(Tr){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}Av.NAME="PrimitiveValueBlock";var bv;class Be extends br{constructor(e={}){super(e,Av),this.idBlock.isConstructed=!1}}bv=Be;ge.Primitive=bv;Be.NAME="PRIMITIVE";function mb(s,e){if(s instanceof e)return s;const t=new e;return t.idBlock=s.idBlock,t.lenBlock=s.lenBlock,t.warnings=s.warnings,t.valueBeforeDecodeView=s.valueBeforeDecodeView,t}function Ch(s,e=0,t=s.length){const r=e;let a=new br({},Tr);const n=new So;if(!pa(n,s,e,t))return a.error=n.error,{offset:-1,result:a};if(!s.subarray(e,e+t).length)return a.error="Zero buffer length",{offset:-1,result:a};let o=a.idBlock.fromBER(s,e,t);if(a.idBlock.warnings.length&&a.warnings.concat(a.idBlock.warnings),o===-1)return a.error=a.idBlock.error,{offset:-1,result:a};if(e=o,t-=a.idBlock.blockLength,o=a.lenBlock.fromBER(s,e,t),a.lenBlock.warnings.length&&a.warnings.concat(a.lenBlock.warnings),o===-1)return a.error=a.lenBlock.error,{offset:-1,result:a};if(e=o,t-=a.lenBlock.blockLength,!a.idBlock.isConstructed&&a.lenBlock.isIndefiniteForm)return a.error="Indefinite length form used for primitive encoding form",{offset:-1,result:a};let l=br;switch(a.idBlock.tagClass){case 1:if(a.idBlock.tagNumber>=37&&a.idBlock.isHexOnly===!1)return a.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:a};switch(a.idBlock.tagNumber){case 0:if(a.idBlock.isConstructed&&a.lenBlock.length>0)return a.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:a};l=ge.EndOfContent;break;case 1:l=ge.Boolean;break;case 2:l=ge.Integer;break;case 3:l=ge.BitString;break;case 4:l=ge.OctetString;break;case 5:l=ge.Null;break;case 6:l=ge.ObjectIdentifier;break;case 10:l=ge.Enumerated;break;case 12:l=ge.Utf8String;break;case 13:l=ge.RelativeObjectIdentifier;break;case 14:l=ge.TIME;break;case 15:return a.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:a};case 16:l=ge.Sequence;break;case 17:l=ge.Set;break;case 18:l=ge.NumericString;break;case 19:l=ge.PrintableString;break;case 20:l=ge.TeletexString;break;case 21:l=ge.VideotexString;break;case 22:l=ge.IA5String;break;case 23:l=ge.UTCTime;break;case 24:l=ge.GeneralizedTime;break;case 25:l=ge.GraphicString;break;case 26:l=ge.VisibleString;break;case 27:l=ge.GeneralString;break;case 28:l=ge.UniversalString;break;case 29:l=ge.CharacterString;break;case 30:l=ge.BmpString;break;case 31:l=ge.DATE;break;case 32:l=ge.TimeOfDay;break;case 33:l=ge.DateTime;break;case 34:l=ge.Duration;break;default:{const u=a.idBlock.isConstructed?new ge.Constructed:new ge.Primitive;u.idBlock=a.idBlock,u.lenBlock=a.lenBlock,u.warnings=a.warnings,a=u}}break;case 2:case 3:case 4:default:l=a.idBlock.isConstructed?ge.Constructed:ge.Primitive}return a=mb(a,l),o=a.fromBER(s,e,a.lenBlock.isIndefiniteForm?t:a.lenBlock.length),a.valueBeforeDecodeView=s.subarray(r,r+a.blockLength),{offset:o,result:a}}function Lt(s){if(!s.byteLength){const e=new br({},Tr);return e.error="Input buffer has zero length",{offset:-1,result:e}}return Ch(Se.toUint8Array(s).slice(),0,s.byteLength)}function pb(s,e){return s?1:e}class Tn extends Tr{constructor({value:e=[],isIndefiniteForm:t=!1,...r}={}){super(r),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,r){const a=Se.toUint8Array(e);if(!pa(this,a,t,r))return-1;if(this.valueBeforeDecodeView=a.subarray(t,t+r),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let n=t;for(;pb(this.isIndefiniteForm,r)>0;){const i=Ch(a,n,r);if(i.offset===-1)return this.error=i.result.error,this.warnings.concat(i.result.warnings),-1;if(n=i.offset,this.blockLength+=i.result.blockLength,r-=i.result.blockLength,this.value.push(i.result),this.isIndefiniteForm&&i.result.constructor.NAME===sh)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===sh?this.value.pop():this.warnings.push("No EndOfContent block encoded")),n}toBER(e,t){const r=t||new Nm;for(let a=0;a<this.value.length;a++)this.value[a].toBER(e,r);return t?ys:r.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}Tn.NAME="ConstructedValueBlock";var Ev;class T extends br{constructor(e={}){super(e,Tn),this.idBlock.isConstructed=!0}fromBER(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return a===-1?(this.error=this.valueBlock.error,a):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}onAsciiEncoding(){const e=[];for(const r of this.valueBlock.value)e.push(r.toString("ascii").split(`
`).map(a=>`  ${a}`).join(`
`));const t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}}Ev=T;ge.Constructed=Ev;T.NAME="CONSTRUCTED";class xv extends Tr{fromBER(e,t,r){return t}toBER(e){return ys}}xv.override="EndOfContentValueBlock";var Bv;class Iv extends br{constructor(e={}){super(e,xv),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}Bv=Iv;ge.EndOfContent=Bv;Iv.NAME=sh;var kv;class kt extends br{constructor(e={}){super(e,Tr),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}toBER(e,t){const r=new ArrayBuffer(2);if(!e){const a=new Uint8Array(r);a[0]=5,a[1]=0}return t&&t.write(r),r}onAsciiEncoding(){return`${this.constructor.NAME}`}}kv=kt;ge.Null=kv;kt.NAME="NULL";class Nv extends ya(Tr){get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=Se.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,r){const a=Se.toUint8Array(e);return pa(this,a,t,r)?(this.valueHexView=a.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,dv.call(this),this.blockLength=r,t+r):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}Nv.NAME="BooleanValueBlock";var Tv;class Ps extends br{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,Nv),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}}Tv=Ps;ge.Boolean=Tv;Ps.NAME="BOOLEAN";class _v extends ya(Tn){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,r){let a=0;if(this.isConstructed){if(this.isHexOnly=!1,a=Tn.prototype.fromBER.call(this,e,t,r),a===-1)return a;for(let n=0;n<this.value.length;n++){const i=this.value[n].constructor.NAME;if(i===sh){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(i!==pv)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,a=super.fromBER(e,t,r),this.blockLength=r;return a}toBER(e,t){return this.isConstructed?Tn.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}_v.NAME="OctetStringValueBlock";var Tm;class z extends br{constructor({idBlock:e={},lenBlock:t={},...r}={}){var a,n;(a=r.isConstructed)!==null&&a!==void 0||(r.isConstructed=!!(!((n=r.value)===null||n===void 0)&&n.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},_v),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,r===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const n=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+r);try{if(n.byteLength){const i=Ch(n,0,n.byteLength);i.offset!==-1&&i.offset===r&&(this.valueBlock.value=[i.result])}}catch{}}return super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return T.prototype.onAsciiEncoding.call(this);const e=this.constructor.NAME,t=Ee.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof Tm&&e.push(t.valueBlock.valueHexView);return Se.concat(e)}}Tm=z;ge.OctetString=Tm;z.NAME=pv;class Rv extends ya(Tn){constructor({unusedBits:e=0,isConstructed:t=!1,...r}={}){super(r),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,r){if(!r)return t;let a=-1;if(this.isConstructed){if(a=Tn.prototype.fromBER.call(this,e,t,r),a===-1)return a;for(const o of this.value){const l=o.constructor.NAME;if(l===sh){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(l!==yv)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const u=o.valueBlock;if(this.unusedBits>0&&u.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=u.unusedBits}return a}const n=Se.toUint8Array(e);if(!pa(this,n,t,r))return-1;const i=n.subarray(t,t+r);if(this.unusedBits=i[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const o=i.subarray(1);try{if(o.byteLength){const l=Ch(o,0,o.byteLength);l.offset!==-1&&l.offset===r-1&&(this.value=[l.result])}}catch{}}return this.valueHexView=i.subarray(1),this.blockLength=i.length,t+r}toBER(e,t){if(this.isConstructed)return Tn.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return ys;const r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}Rv.NAME="BitStringValueBlock";var Vv;class Pe extends br{constructor({idBlock:e={},lenBlock:t={},...r}={}){var a,n;(a=r.isConstructed)!==null&&a!==void 0||(r.isConstructed=!!(!((n=r.value)===null||n===void 0)&&n.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},Rv),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return T.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const i of t)e.push(i.toString(2).padStart(8,"0"));const r=e.join(""),a=this.constructor.NAME,n=r.substring(0,r.length-this.valueBlock.unusedBits);return`${a} : ${n}`}}}Vv=Pe;ge.BitString=Vv;Pe.NAME=yv;var $v;function yb(s,e){const t=new Uint8Array([0]),r=new Uint8Array(s),a=new Uint8Array(e);let n=r.slice(0);const i=n.length-1,o=a.slice(0),l=o.length-1;let u=0;const c=l<i?i:l;let f=0;for(let g=c;g>=0;g--,f++){switch(!0){case f<o.length:u=n[i-f]+o[l-f]+t[0];break;default:u=n[i-f]+t[0]}switch(t[0]=u/10,!0){case f>=n.length:n=Dg(new Uint8Array([u%10]),n);break;default:n[i-f]=u%10}}return t[0]>0&&(n=Dg(t,n)),n}function $p(s){if(s>=Du.length)for(let e=Du.length;e<=s;e++){const t=new Uint8Array([0]);let r=Du[e-1].slice(0);for(let a=r.length-1;a>=0;a--){const n=new Uint8Array([(r[a]<<1)+t[0]]);t[0]=n[0]/10,r[a]=n[0]%10}t[0]>0&&(r=Dg(t,r)),Du.push(r)}return Du[s]}function vb(s,e){let t=0;const r=new Uint8Array(s),a=new Uint8Array(e),n=r.slice(0),i=n.length-1,o=a.slice(0),l=o.length-1;let u,c=0;for(let f=l;f>=0;f--,c++)switch(u=n[i-c]-o[l-c]-t,!0){case u<0:t=1,n[i-c]=u+10;break;default:t=0,n[i-c]=u}if(t>0)for(let f=i-l+1;f>=0;f--,c++)if(u=n[i-c]-t,u<0)t=1,n[i-c]=u+10;else{t=0,n[i-c]=u;break}return n.slice()}class _m extends ya(Tr){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=dv.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(ab(e))}get valueDec(){return this._valueDec}fromDER(e,t,r,a=0){const n=this.fromBER(e,t,r);if(n===-1)return n;const i=this.valueHexView;return i[0]===0&&(i[1]&128)!==0?this.valueHexView=i.subarray(1):a!==0&&i.length<a&&(a-i.length>1&&(a=i.length+1),this.valueHexView=i.subarray(a-i.length)),n}toDER(e=!1){const t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{const r=new Uint8Array(this.valueHexView.length+1);r[0]=0,r.set(t,1),this.valueHexView=r}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,r){const a=super.fromBER(e,t,r);return a===-1||this.setValueHex(),a}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=this.valueHexView.length*8-1;let t=new Uint8Array(this.valueHexView.length*8/3),r=0,a;const n=this.valueHexView;let i="",o=!1;for(let l=n.byteLength-1;l>=0;l--){a=n[l];for(let u=0;u<8;u++){if((a&1)===1)switch(r){case e:t=vb($p(r),t),i="-";break;default:t=yb(t,$p(r))}r++,a>>=1}}for(let l=0;l<t.length;l++)t[l]&&(o=!0),o&&(i+=Rp.charAt(t[l]));return o===!1&&(i+=Rp.charAt(0)),i}}$v=_m;_m.NAME="IntegerValueBlock";Object.defineProperty($v.prototype,"valueHex",{set:function(s){this.valueHexView=new Uint8Array(s),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var zf;class D extends br{constructor(e={}){super(e,_m),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return Q0(),BigInt(this.valueBlock.toString())}static fromBigInt(e){Q0();const t=BigInt(e),r=new Nm,a=t.toString(16).replace(/^-/,""),n=new Uint8Array(Ee.FromHex(a));if(t<0){const o=new Uint8Array(n.length+(n[0]&128?1:0));o[0]|=128;const u=BigInt(`0x${Ee.ToHex(o)}`)+t,c=Se.toUint8Array(Ee.FromHex(u.toString(16)));c[0]|=128,r.write(c)}else n[0]&128&&r.write(new Uint8Array([0])),r.write(n);return new zf({valueHex:r.final()})}convertToDER(){const e=new zf({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new zf({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}zf=D;ge.Integer=zf;D.NAME="INTEGER";var Dv;class mo extends D{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}Dv=mo;ge.Enumerated=Dv;mo.NAME="ENUMERATED";class Og extends ya(Tr){constructor({valueDec:e=-1,isFirstSid:t=!1,...r}={}){super(r),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,r){if(!r)return t;const a=Se.toUint8Array(e);if(!pa(this,a,t,r))return-1;const n=a.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let o=0;o<r&&(this.valueHexView[o]=n[o]&127,this.blockLength++,(n[o]&128)!==0);o++);const i=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength;o++)i[o]=this.valueHexView[o];return this.valueHexView=i,(n[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=go(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){Q0();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const r=new Uint8Array(t.length/7);for(let a=0;a<r.length;a++)r[a]=parseInt(t.slice(a*7,a*7+7),2)+(a+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const a=this.valueHexView,n=new Uint8Array(this.blockLength);for(let i=0;i<this.blockLength-1;i++)n[i]=a[i]|128;return n[this.blockLength-1]=a[this.blockLength-1],n.buffer}const t=ma(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",ys;const r=new Uint8Array(t.byteLength);if(!e){const a=new Uint8Array(t),n=t.byteLength-1;for(let i=0;i<n;i++)r[i]=a[i]|128;r[n]=a[n]}return r}toString(){let e="";if(this.isHexOnly)e=Ee.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}Og.NAME="sidBlock";class Lv extends Tr{constructor({value:e=Br,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let a=t;for(;r>0;){const n=new Og;if(a=n.fromBER(e,a,r),a===-1)return this.blockLength=0,this.error=n.error,a;this.value.length===0&&(n.isFirstSid=!0),this.blockLength+=n.blockLength,r-=n.blockLength,this.value.push(n)}return a}toBER(e){const t=[];for(let r=0;r<this.value.length;r++){const a=this.value[r].toBER(e);if(a.byteLength===0)return this.error=this.value[r].error,ys;t.push(a)}return km(t)}fromString(e){this.value=[];let t=0,r=0,a="",n=!1;do if(r=e.indexOf(".",t),r===-1?a=e.substring(t):a=e.substring(t,r),t=r+1,n){const i=this.value[0];let o=0;switch(i.valueDec){case 0:break;case 1:o=40;break;case 2:o=80;break;default:this.value=[];return}const l=parseInt(a,10);if(isNaN(l))return;i.valueDec=l+o,n=!1}else{const i=new Og;if(a>Number.MAX_SAFE_INTEGER){Q0();const o=BigInt(a);i.valueBigInt=o}else if(i.valueDec=parseInt(a,10),isNaN(i.valueDec))return;this.value.length||(i.isFirstSid=!0,n=!0),this.value.push(i)}while(r!==-1)}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let a=this.value[r].toString();r!==0&&(e=`${e}.`),t?(a=`{${a}}`,this.value[r].isFirstSid?e=`2.{${a} - 80}`:e+=a):e+=a}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}Lv.NAME="ObjectIdentifierValueBlock";var Ov;class fe extends br{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,Lv),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}Ov=fe;ge.ObjectIdentifier=Ov;fe.NAME="OBJECT IDENTIFIER";class Pg extends ya(So){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,r){if(r===0)return t;const a=Se.toUint8Array(e);if(!pa(this,a,t,r))return-1;const n=a.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let o=0;o<r&&(this.valueHexView[o]=n[o]&127,this.blockLength++,(n[o]&128)!==0);o++);const i=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength;o++)i[o]=this.valueHexView[o];return this.valueHexView=i,(n[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=go(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const a=this.valueHexView,n=new Uint8Array(this.blockLength);for(let i=0;i<this.blockLength-1;i++)n[i]=a[i]|128;return n[this.blockLength-1]=a[this.blockLength-1],n.buffer}const t=ma(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",ys;const r=new Uint8Array(t.byteLength);if(!e){const a=new Uint8Array(t),n=t.byteLength-1;for(let i=0;i<n;i++)r[i]=a[i]|128;r[n]=a[n]}return r.buffer}toString(){let e="";return this.isHexOnly?e=Ee.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}Pg.NAME="relativeSidBlock";class Pv extends Tr{constructor({value:e=Br,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let a=t;for(;r>0;){const n=new Pg;if(a=n.fromBER(e,a,r),a===-1)return this.blockLength=0,this.error=n.error,a;this.blockLength+=n.blockLength,r-=n.blockLength,this.value.push(n)}return a}toBER(e,t){const r=[];for(let a=0;a<this.value.length;a++){const n=this.value[a].toBER(e);if(n.byteLength===0)return this.error=this.value[a].error,ys;r.push(n)}return km(r)}fromString(e){this.value=[];let t=0,r=0,a="";do{r=e.indexOf(".",t),r===-1?a=e.substring(t):a=e.substring(t,r),t=r+1;const n=new Pg;if(n.valueDec=parseInt(a,10),isNaN(n.valueDec))return!0;this.value.push(n)}while(r!==-1);return!0}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let a=this.value[r].toString();r!==0&&(e=`${e}.`),t&&(a=`{${a}}`),e+=a}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}Pv.NAME="RelativeObjectIdentifierValueBlock";var Uv;class Mv extends br{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,Pv),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}Uv=Mv;ge.RelativeObjectIdentifier=Uv;Mv.NAME="RelativeObjectIdentifier";var Hv;class E extends T{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}Hv=E;ge.Sequence=Hv;E.NAME="SEQUENCE";var Kv;class Nt extends T{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}Kv=Nt;ge.Set=Kv;Nt.NAME="SET";class Fv extends ya(Tr){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=Br}toJSON(){return{...super.toJSON(),value:this.value}}}Fv.NAME="StringValueBlock";class qv extends Fv{}qv.NAME="SimpleStringValueBlock";class Kr extends Cv{constructor({...e}={}){super(e,qv)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,Se.toUint8Array(e))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t);for(let a=0;a<t;a++)r[a]=e.charCodeAt(a);this.valueBlock.value=e}}Kr.NAME="SIMPLE STRING";class Jv extends Kr{fromBuffer(e){this.valueBlock.valueHexView=Se.toUint8Array(e);try{this.valueBlock.value=Ee.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=Ee.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(Ee.FromUtf8String(e)),this.valueBlock.value=e}}Jv.NAME="Utf8StringValueBlock";var Gv;class ps extends Jv{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}Gv=ps;ge.Utf8String=Gv;ps.NAME="UTF8String";class jv extends Kr{fromBuffer(e){this.valueBlock.value=Ee.ToUtf16String(e),this.valueBlock.valueHexView=Se.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(Ee.FromUtf16String(e))}}jv.NAME="BmpStringValueBlock";var Wv;class ah extends jv{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}Wv=ah;ge.BmpString=Wv;ah.NAME="BMPString";class Qv extends Kr{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t);for(let a=0;a<r.length;a+=4)r[a]=r[a+3],r[a+1]=r[a+2],r[a+2]=0,r[a+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let a=0;a<t;a++){const n=ma(e.charCodeAt(a),8),i=new Uint8Array(n);if(i.length>4)continue;const o=4-i.length;for(let l=i.length-1;l>=0;l--)r[a*4+l+o]=i[l]}this.valueBlock.value=e}}Qv.NAME="UniversalStringValueBlock";var Yv;class nh extends Qv{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}Yv=nh;ge.UniversalString=Yv;nh.NAME="UniversalString";var zv;class lu extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}zv=lu;ge.NumericString=zv;lu.NAME="NumericString";var Xv;class ds extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}Xv=ds;ge.PrintableString=Xv;ds.NAME="PrintableString";var Zv;class ih extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}Zv=ih;ge.TeletexString=Zv;ih.NAME="TeletexString";var e1;class Rm extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}e1=Rm;ge.VideotexString=e1;Rm.NAME="VideotexString";var t1;class xd extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}t1=xd;ge.IA5String=t1;xd.NAME="IA5String";var r1;class Vm extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}r1=Vm;ge.GraphicString=r1;Vm.NAME="GraphicString";var s1;class Bd extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}s1=Bd;ge.VisibleString=s1;Bd.NAME="VisibleString";var a1;class $m extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}a1=$m;ge.GeneralString=a1;$m.NAME="GeneralString";var n1;class Dm extends Kr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}n1=Dm;ge.CharacterString=n1;Dm.NAME="CharacterString";var i1;class Cu extends Bd{constructor({value:e,valueDate:t,...r}={}){if(super(r),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let a=0;a<e.length;a++)this.valueBlock.valueHexView[a]=e.charCodeAt(a)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,Se.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let a=0;a<e.length;a++)r[a]=e.charCodeAt(a);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const r=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(r===null){this.error="Wrong input string for conversion";return}const a=parseInt(r[1],10);a>=50?this.year=1900+a:this.year=2e3+a,this.month=parseInt(r[2],10),this.day=parseInt(r[3],10),this.hour=parseInt(r[4],10),this.minute=parseInt(r[5],10),this.second=parseInt(r[6],10)}toString(e="iso"){if(e==="iso"){const t=new Array(7);return t[0]=Lr(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=Lr(this.month,2),t[2]=Lr(this.day,2),t[3]=Lr(this.hour,2),t[4]=Lr(this.minute,2),t[5]=Lr(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}i1=Cu;ge.UTCTime=i1;Cu.NAME="UTCTime";var o1;class wt extends Cu{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){const e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,r="",a="",n=0,i,o=0,l=0;if(e[e.length-1]==="Z")r=e.substring(0,e.length-1),t=!0;else{const f=new Number(e[e.length-1]);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");r=e}if(t){if(r.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(r.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let f=1,g=r.indexOf("+"),v="";if(g===-1&&(g=r.indexOf("-"),f=-1),g!==-1){if(v=r.substring(g+1),r=r.substring(0,g),v.length!==2&&v.length!==4)throw new Error("Wrong input string for conversion");let p=parseInt(v.substring(0,2),10);if(isNaN(p.valueOf()))throw new Error("Wrong input string for conversion");if(o=f*p,v.length===4){if(p=parseInt(v.substring(2,4),10),isNaN(p.valueOf()))throw new Error("Wrong input string for conversion");l=f*p}}}let u=r.indexOf(".");if(u===-1&&(u=r.indexOf(",")),u!==-1){const f=new Number(`0${r.substring(u)}`);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");n=f.valueOf(),a=r.substring(0,u)}else a=r;switch(!0){case a.length===8:if(i=/(\d{4})(\d{2})(\d{2})/ig,u!==-1)throw new Error("Wrong input string for conversion");break;case a.length===10:if(i=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,u!==-1){let f=60*n;this.minute=Math.floor(f),f=60*(f-this.minute),this.second=Math.floor(f),f=1e3*(f-this.second),this.millisecond=Math.floor(f)}break;case a.length===12:if(i=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,u!==-1){let f=60*n;this.second=Math.floor(f),f=1e3*(f-this.second),this.millisecond=Math.floor(f)}break;case a.length===14:if(i=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,u!==-1){const f=1e3*n;this.millisecond=Math.floor(f)}break;default:throw new Error("Wrong input string for conversion")}const c=i.exec(a);if(c===null)throw new Error("Wrong input string for conversion");for(let f=1;f<c.length;f++)switch(f){case 1:this.year=parseInt(c[f],10);break;case 2:this.month=parseInt(c[f],10);break;case 3:this.day=parseInt(c[f],10);break;case 4:this.hour=parseInt(c[f],10)+o;break;case 5:this.minute=parseInt(c[f],10)+l;break;case 6:this.second=parseInt(c[f],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){const f=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=f.getUTCFullYear(),this.month=f.getUTCMonth(),this.day=f.getUTCDay(),this.hour=f.getUTCHours(),this.minute=f.getUTCMinutes(),this.second=f.getUTCSeconds(),this.millisecond=f.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){const t=[];return t.push(Lr(this.year,4)),t.push(Lr(this.month,2)),t.push(Lr(this.day,2)),t.push(Lr(this.hour,2)),t.push(Lr(this.minute,2)),t.push(Lr(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(Lr(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}o1=wt;ge.GeneralizedTime=o1;wt.NAME="GeneralizedTime";var l1;class u1 extends ps{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}l1=u1;ge.DATE=l1;u1.NAME="DATE";var c1;class f1 extends ps{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}c1=f1;ge.TimeOfDay=c1;f1.NAME="TimeOfDay";var h1;class d1 extends ps{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}h1=d1;ge.DateTime=h1;d1.NAME="DateTime";var g1;class m1 extends ps{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}g1=m1;ge.Duration=g1;m1.NAME="Duration";var p1;class y1 extends ps{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}p1=y1;ge.TIME=p1;y1.NAME="TIME";class ke{constructor({name:e=Br,optional:t=!1}={}){this.name=e,this.optional=t}}class St extends ke{constructor({value:e=[],...t}={}){super(t),this.value=e}}class Re extends ke{constructor({value:e=new ke,local:t=!1,...r}={}){super(r),this.value=e,this.local=t}}class Y0{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=Se.toUint8Array(e)}constructor({data:e=Ed}={}){this.dataView=Se.toUint8Array(e)}fromBER(e,t,r){const a=t+r;return this.dataView=Se.toUint8Array(e).subarray(t,a),a}toBER(e){return this.dataView.slice().buffer}}function j(s,e,t){if(t instanceof St){for(const n of t.value)if(j(s,e,n).verified)return{verified:!0,result:s};{const n={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(Ud)&&(n.name=t.name),n}}if(t instanceof ke)return t.hasOwnProperty(Ud)&&(s[t.name]=e),{verified:!0,result:s};if(!(s instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(lb in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(hb in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(db in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const r=t.idBlock.toBER(!1);if(r.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(r,0,r.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(ub)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:s};if(t.idBlock.hasOwnProperty(cb)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:s};if(t.idBlock.hasOwnProperty(fb)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:s};if(!(ob in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:s};if(t.idBlock.isHexOnly){if(!(Vp in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const n=t.idBlock.valueHexView,i=e.idBlock.valueHexView;if(n.length!==i.length)return{verified:!1,result:s};for(let o=0;o<n.length;o++)if(n[o]!==i[1])return{verified:!1,result:s}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Br),t.name&&(s[t.name]=e)),t instanceof ge.Constructed){let n=0,i={verified:!1,result:{error:"Unknown error"}},o=t.valueBlock.value.length;if(o>0&&t.valueBlock.value[0]instanceof Re&&(o=e.valueBlock.value.length),o===0)return{verified:!0,result:s};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let l=!0;for(let u=0;u<t.valueBlock.value.length;u++)l=l&&(t.valueBlock.value[u].optional||!1);return l?{verified:!0,result:s}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Br),t.name&&delete s[t.name]),s.error="Inconsistent object length",{verified:!1,result:s})}for(let l=0;l<o;l++)if(l-n>=e.valueBlock.value.length){if(t.valueBlock.value[l].optional===!1){const u={verified:!1,result:s};return s.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Br),t.name&&(delete s[t.name],u.name=t.name)),u}}else if(t.valueBlock.value[0]instanceof Re){if(i=j(s,e.valueBlock.value[l],t.valueBlock.value[0].value),i.verified===!1)if(t.valueBlock.value[0].optional)n++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Br),t.name&&delete s[t.name]),i;if(Ud in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let u={};gb in t.valueBlock.value[0]&&t.valueBlock.value[0].local?u=e:u=s,typeof u[t.valueBlock.value[0].name]>"u"&&(u[t.valueBlock.value[0].name]=[]),u[t.valueBlock.value[0].name].push(e.valueBlock.value[l])}}else if(i=j(s,e.valueBlock.value[l-n],t.valueBlock.value[l]),i.verified===!1)if(t.valueBlock.value[l].optional)n++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Br),t.name&&delete s[t.name]),i;if(i.verified===!1){const l={verified:!1,result:s};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Br),t.name&&(delete s[t.name],l.name=t.name)),l}return{verified:!0,result:s}}if(t.primitiveSchema&&Vp in e.valueBlock){const n=Ch(e.valueBlock.valueHexView);if(n.offset===-1){const i={verified:!1,result:n.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Br),t.name&&(delete s[t.name],i.name=t.name)),i}return j(s,n.result,t.primitiveSchema)}return{verified:!0,result:s}}class bt{constructor(e={}){if("view"in e)this.fromUint8Array(e.view);else if("buffer"in e)this.fromArrayBuffer(e.buffer);else if("string"in e)this.fromString(e.string);else if("hexstring"in e)this.fromHexString(e.hexstring);else if("length"in e&&e.length>0){if(this.length=e.length,e.stub)for(let t=0;t<this._view.length;t++)this._view[t]=e.stub}else this.length=0}set buffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}get buffer(){return this._buffer}set view(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}get view(){return this._view}get length(){return this.view.byteLength}set length(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}clear(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}fromArrayBuffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}fromUint8Array(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}fromString(e){const t=e.length;this.length=t;for(let r=0;r<t;r++)this.view[r]=e.charCodeAt(r)}toString(e=0,t=this.view.length-e){let r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++)r+=String.fromCharCode(this.view[a]);return r}fromHexString(e){const t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);const r=new Map;r.set("0",0),r.set("1",1),r.set("2",2),r.set("3",3),r.set("4",4),r.set("5",5),r.set("6",6),r.set("7",7),r.set("8",8),r.set("9",9),r.set("A",10),r.set("a",10),r.set("B",11),r.set("b",11),r.set("C",12),r.set("c",12),r.set("D",13),r.set("d",13),r.set("E",14),r.set("e",14),r.set("F",15),r.set("f",15);let a=0,n=0;for(let i=0;i<t;i++)i%2?(n|=r.get(e.charAt(i)),this.view[a]=n,a++):n=r.get(e.charAt(i))<<4}toHexString(e=0,t=this.view.length-e){let r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++){const n=this.view[a].toString(16).toUpperCase();r=r+(n.length==1?"0":"")+n}return r}copy(e=0,t=this.length-e){if(!e&&!this.length)return new bt;if(e<0||e>this.length-1)throw new Error(`Wrong start position: ${e}`);return new bt({buffer:this._buffer.slice(e,e+t)})}slice(e=0,t=this.length){if(!e&&!this.length)return new bt;if(e<0||e>this.length-1)throw new Error(`Wrong start position: ${e}`);return new bt({buffer:this._buffer.slice(e,t)})}realloc(e){const t=new ArrayBuffer(e),r=new Uint8Array(t);e>this._view.length?r.set(this._view):r.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}append(e){const t=this.length,r=e.length,a=e._view.subarray();this.realloc(t+r),this._view.set(a,t)}insert(e,t=0,r=this.length-t){return t>this.length-1?!1:(r>this.length-t&&(r=this.length-t),r>e.length&&(r=e.length),r==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,r),t),!0)}isEqual(e){if(this.length!=e.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}isEqualView(e){if(e.length!=this.view.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}findPattern(e,t,r,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a),l=e.length;if(l>i)return-1;const u=[];for(let c=0;c<l;c++)u.push(e.view[c]);for(let c=0;c<=i-l;c++){let f=!0;const g=o?n-l-c:n+c;for(let v=0;v<l;v++)if(this.view[v+g]!=u[v]){f=!1;break}if(f)return o?n-l-c:n+l+c}return-1}findFirstIn(e,t,r,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a),l={id:-1,position:o?0:n+i,length:0};for(let u=0;u<e.length;u++){const c=this.findPattern(e[u],n,i,o);if(c!=-1){let f=!1;const g=e[u].length;o?c-g>=l.position-l.length&&(f=!0):c-g<=l.position-l.length&&(f=!0),f&&(l.position=c,l.id=u,l.length=g)}}return l}findAllIn(e,t,r){let{start:a,length:n}=this.prepareFindParameters(t,r);const i=[];let o={id:-1,position:a};do{const l=o.position;if(o=this.findFirstIn(e,o.position,n),o.id==-1)break;n-=o.position-l,i.push({id:o.id,position:o.position})}while(!0);return i}findAllPatternIn(e,t,r){const{start:a,length:n}=this.prepareFindParameters(t,r),i=[],o=e.length;if(o>n)return-1;const l=Array.from(e.view);for(let u=0;u<=n-o;u++){let c=!0;const f=a+u;for(let g=0;g<o;g++)if(this.view[g+f]!=l[g]){c=!1;break}c&&(i.push(a+o+u),u+=o-1)}return i}findFirstNotIn(e,t,r,a){let{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a);const l={left:{id:-1,position:n},right:{id:-1,position:0},value:new bt};let u=i;for(;u>0;){if(l.right=this.findFirstIn(e,o?n-i+u:n+i-u,u,o),l.right.id==-1){i=u,o?n-=i:n=l.left.position,l.value=new bt({buffer:this._buffer.slice(n,n+i)});break}if(l.right.position!=(o?l.left.position-e[l.right.id].length:l.left.position+e[l.right.id].length)){o?(n=l.right.position+e[l.right.id].length,i=l.left.position-l.right.position-e[l.right.id].length):(n=l.left.position,i=l.right.position-l.left.position-e[l.right.id].length),l.value=new bt({buffer:this._buffer.slice(n,n+i)});break}l.left=l.right,u-=e[l.right.id].length}if(o){const c=l.right;l.right=l.left,l.left=c}return l}findAllNotIn(e,t,r){let{start:a,length:n}=this.prepareFindParameters(t,r);const i=[];let o={left:{id:-1,position:a},right:{id:-1,position:a},value:new bt};do{const l=o.right.position;o=this.findFirstNotIn(e,o.right.position,n),n-=o.right.position-l,i.push({left:{id:o.left.id,position:o.left.position},right:{id:o.right.id,position:o.right.position},value:o.value})}while(o.right.id!=-1);return i}findFirstSequence(e,t,r,a){let{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a);const l=this.skipNotPatterns(e,n,i,o);if(l==-1)return{position:-1,value:new bt};const u=this.skipPatterns(e,l,i-(o?n-l:l-n),o);o?(n=u,i=l-u):(n=l,i=u-l);const c=new bt({buffer:this._buffer.slice(n,n+i)});return{position:u,value:c}}findAllSequences(e,t,r){let{start:a,length:n}=this.prepareFindParameters(t,r);const i=[];let o={position:a,value:new bt};do{const l=o.position;o=this.findFirstSequence(e,o.position,n),o.position!=-1&&(n-=o.position-l,i.push({position:o.position,value:o.value}))}while(o.position!=-1);return i}findPairedPatterns(e,t,r,a){const n=[];if(e.isEqual(t))return n;const{start:i,length:o}=this.prepareFindParameters(r,a);let l=0;const u=this.findAllPatternIn(e,i,o);if(!Array.isArray(u)||u.length==0)return n;const c=this.findAllPatternIn(t,i,o);if(!Array.isArray(c)||c.length==0)return n;for(;l<u.length&&c.length!=0;){if(u[0]==c[0]){n.push({left:u[0],right:c[0]}),u.splice(0,1),c.splice(0,1);continue}if(u[l]>c[0])break;for(;u[l]<c[0]&&(l++,!(l>=u.length)););n.push({left:u[l-1],right:c[0]}),u.splice(l-1,1),c.splice(0,1),l=0}return n.sort((f,g)=>f.left-g.left),n}findPairedArrays(e,t,r,a){const{start:n,length:i}=this.prepareFindParameters(r,a),o=[];let l=0;const u=this.findAllIn(e,n,i);if(u.length==0)return o;const c=this.findAllIn(t,n,i);if(c.length==0)return o;for(;l<u.length&&c.length!=0;){if(u[0].position==c[0].position){o.push({left:u[0],right:c[0]}),u.splice(0,1),c.splice(0,1);continue}if(u[l].position>c[0].position)break;for(;u[l].position<c[0].position&&(l++,!(l>=u.length)););o.push({left:u[l-1],right:c[0]}),u.splice(l-1,1),c.splice(0,1),l=0}return o.sort((f,g)=>f.left.position-g.left.position),o}replacePattern(e,t,r,a,n=null){let i=[],o;const l={status:-1,searchPatternPositions:[],replacePatternPositions:[]},{start:u,length:c}=this.prepareFindParameters(r,a);if(n==null){if(i=this.findAllIn([e],u,c),i.length==0)return l}else i=n;l.searchPatternPositions.push(...Array.from(i,p=>p.position));const f=e.length-t.length,g=new ArrayBuffer(this.view.length-i.length*f),v=new Uint8Array(g);for(v.set(new Uint8Array(this.buffer,0,u)),o=0;o<i.length;o++){const p=o==0?u:i[o-1].position;v.set(new Uint8Array(this.buffer,p,i[o].position-e.length-p),p-o*f),v.set(t.view,i[o].position-e.length-o*f),l.replacePatternPositions.push(i[o].position-e.length-o*f)}return o--,v.set(new Uint8Array(this.buffer,i[o].position,this.length-i[o].position),i[o].position-e.length+t.length-o*f),this.buffer=g,this.view=new Uint8Array(this.buffer),l.status=1,l}skipPatterns(e,t,r,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a);let l=n;for(let u=0;u<e.length;u++){const c=e[u].length,f=o?l-c:l;let g=!0;for(let v=0;v<c;v++)if(this.view[v+f]!=e[u].view[v]){g=!1;break}if(g){if(u=-1,o){if(l-=c,l<=0)return l}else if(l+=c,l>=n+i)return l}}return l}skipNotPatterns(e,t,r,a){const{start:n,length:i,backward:o}=this.prepareFindParameters(t,r,a);let l=-1;for(let u=0;u<i;u++){for(let c=0;c<e.length;c++){const f=e[c].length,g=o?n-u-f:n+u;let v=!0;for(let p=0;p<f;p++)if(this.view[p+g]!=e[c].view[p]){v=!1;break}if(v){l=o?n-u:n+u;break}}if(l!=-1)break}return l}prepareFindParameters(e=null,t=null,r=!1){return e===null&&(e=r?this.length:0),e>this.length&&(e=this.length),r?(t===null&&(t=e),t>e&&(t=e)):(t===null&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:r}}}const wb=16777216;class _n{constructor(e={}){this._stream=new bt,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,"view"in e?this.stream=new bt({view:e.view}):"buffer"in e?this.stream=new bt({buffer:e.buffer}):"string"in e?this.stream=new bt({string:e.string}):"hexstring"in e?this.stream=new bt({hexstring:e.hexstring}):"stream"in e?this.stream=e.stream.slice():this.stream=new bt,"backward"in e&&e.backward&&(this.backward=e.backward,this._start=this.stream.length),"length"in e&&e.length>0&&(this._length=e.length),"start"in e&&e.start&&e.start>0&&(this._start=e.start),"appendBlock"in e&&e.appendBlock&&e.appendBlock>0&&(this.appendBlock=e.appendBlock)}set stream(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}get stream(){return this._stream}set length(e){this.prevLength=this._length,this._length=e}get length(){return this.appendBlock?this.start:this._length}set start(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}get start(){return this._start}get buffer(){return this._stream.buffer.slice(0,this._length)}resetPosition(){this._start=this.prevStart,this._length=this.prevLength}findPattern(e,t=null){(t==null||t>this.length)&&(t=this.length);const r=this.stream.findPattern(e,this.start,this.length,this.backward);if(r==-1)return r;if(this.backward){if(r<this.start-e.length-t)return-1}else if(r>this.start+e.length+t)return-1;return this.start=r,r}findFirstIn(e,t=null){(t==null||t>this.length)&&(t=this.length);const r=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(r.id==-1)return r;if(this.backward){if(r.position<this.start-e[r.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(r.position>this.start+e[r.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=r.position,r}findAllIn(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}findFirstNotIn(e,t=null){(t==null||t>this._length)&&(t=this._length);const r=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(r.left.id==-1&&r.right.id==-1)return r;if(this.backward){if(r.right.id!=-1&&r.right.position<this._start-e[r.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new bt}}else if(r.left.id!=-1&&r.left.position>this._start+e[r.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new bt};return this.backward?r.left.id==-1?this.start=0:this.start=r.left.position:r.right.id==-1?this.start=this._start+this._length:this.start=r.right.position,r}findAllNotIn(e){const t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}findFirstSequence(e,t=null,r=null){(t==null||t>this._length)&&(t=this._length),(r==null||r>t)&&(r=t);const a=this._stream.findFirstSequence(e,this._start,t,this.backward);if(a.value.length==0)return a;if(this.backward){if(a.position<this._start-a.value.length-r)return{position:-1,value:new bt}}else if(a.position>this._start+a.value.length+r)return{position:-1,value:new bt};return this.start=a.position,a}findAllSequences(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}findPairedPatterns(e,t,r=null){(r==null||r>this.length)&&(r=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedPatterns(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right<this.start-t.length-r)return[]}else if(n[0].left>this.start+e.length+r)return[]}return n}findPairedArrays(e,t,r=null){(r==null||r>this.length)&&(r=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedArrays(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right.position<this.start-t[n[0].right.id].length-r)return[]}else if(n[0].left.position>this.start+e[n[0].left.id].length+r)return[]}return n}replacePattern(e,t){const r=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,r,this.length)}skipPatterns(e){const t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}skipNotPatterns(e){const t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return t==-1?-1:(this.start=t,t)}append(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendView(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendChar(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}appendUint16(e){this.beforeAppend(2);const t=new Uint16Array([e]),r=new Uint8Array(t.buffer);this.stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendUint24(e){this.beforeAppend(3);const t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[2],this._stream.view[this._start+1]=r[1],this._stream.view[this._start+2]=r[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}appendUint32(e){this.beforeAppend(4);const t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}appendInt16(e){this.beforeAppend(2);const t=new Int16Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendInt32(e){this.beforeAppend(4);const t=new Int32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}getBlock(e,t=!0){if(this._length<=0)return new Uint8Array(0);this._length<e&&(e=this._length);let r;if(this.backward){const a=this._stream.view.subarray(this._length-e,this._length);r=new Uint8Array(e);for(let n=0;n<e;n++)r[e-1-n]=a[n]}else r=this._stream.view.subarray(this._start,this._start+e);return t&&(this.start+=this.backward?-1*e:e),r}getUint16(e=!0){const t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}getInt16(e=!0){const t=this.getUint16(e),r=32768;return t&r?-(r-(t^r)):t}getUint24(e=!0){const t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}getUint32(e=!0){const t=this.getBlock(4,e);return t.length<4?0:t[0]*wb+(t[1]<<16)+(t[2]<<8)+t[3]}getInt32(e=!0){const t=this.getUint32(e),r=2147483648;return t&r?-(r-(t^r)):t}beforeAppend(e){this._start+e>this._stream.length&&(e>this.appendBlock&&(this.appendBlock=e+_n.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}_n.APPEND_BLOCK=1e3;function Sb(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function Lm(s,...e){if(!Sb(s))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(s.length))throw new Error("Uint8Array expected of length "+e+", got length="+s.length)}function Dp(s,e=!0){if(s.destroyed)throw new Error("Hash instance has been destroyed");if(e&&s.finished)throw new Error("Hash#digest() has already been called")}function Cb(s,e){Lm(s);const t=e.outputLen;if(s.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function po(...s){for(let e=0;e<s.length;e++)s[e].fill(0)}function Md(s){return new DataView(s.buffer,s.byteOffset,s.byteLength)}function Ss(s,e){return s<<32-e|s>>>e}function Hd(s,e){return s<<e|s>>>32-e>>>0}function Ab(s){if(typeof s!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(s))}function v1(s){return typeof s=="string"&&(s=Ab(s)),Lm(s),s}class bb{}function Id(s){const e=r=>s().update(v1(r)).digest(),t=s();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>s(),e}function Eb(s,e,t,r){if(typeof s.setBigUint64=="function")return s.setBigUint64(e,t,r);const a=BigInt(32),n=BigInt(4294967295),i=Number(t>>a&n),o=Number(t&n),l=r?4:0,u=r?0:4;s.setUint32(e+l,i,r),s.setUint32(e+u,o,r)}function w1(s,e,t){return s&e^~s&t}function S1(s,e,t){return s&e^s&t^e&t}class Om extends bb{constructor(e,t,r,a){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=a,this.buffer=new Uint8Array(e),this.view=Md(this.buffer)}update(e){Dp(this),e=v1(e),Lm(e);const{view:t,buffer:r,blockLen:a}=this,n=e.length;for(let i=0;i<n;){const o=Math.min(a-this.pos,n-i);if(o===a){const l=Md(e);for(;a<=n-i;i+=a)this.process(l,i);continue}r.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===a&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Dp(this),Cb(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:a,isLE:n}=this;let{pos:i}=this;t[i++]=128,po(this.buffer.subarray(i)),this.padOffset>a-i&&(this.process(r,0),i=0);for(let f=i;f<a;f++)t[f]=0;Eb(r,a-8,BigInt(this.length*8),n),this.process(r,0);const o=Md(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=l/4,c=this.get();if(u>c.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)o.setUint32(4*f,c[f],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:a,finished:n,destroyed:i,pos:o}=this;return e.destroyed=i,e.finished=n,e.length=a,e.pos=o,a%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const Aa=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);const ir=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),or=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Lu=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),ba=new Uint32Array(80);class xb extends Om{constructor(){super(64,20,8,!1),this.A=Lu[0]|0,this.B=Lu[1]|0,this.C=Lu[2]|0,this.D=Lu[3]|0,this.E=Lu[4]|0}get(){const{A:e,B:t,C:r,D:a,E:n}=this;return[e,t,r,a,n]}set(e,t,r,a,n){this.A=e|0,this.B=t|0,this.C=r|0,this.D=a|0,this.E=n|0}process(e,t){for(let l=0;l<16;l++,t+=4)ba[l]=e.getUint32(t,!1);for(let l=16;l<80;l++)ba[l]=Hd(ba[l-3]^ba[l-8]^ba[l-14]^ba[l-16],1);let{A:r,B:a,C:n,D:i,E:o}=this;for(let l=0;l<80;l++){let u,c;l<20?(u=w1(a,n,i),c=1518500249):l<40?(u=a^n^i,c=1859775393):l<60?(u=S1(a,n,i),c=2400959708):(u=a^n^i,c=3395469782);const f=Hd(r,5)+u+o+c+ba[l]|0;o=i,i=n,n=Hd(a,30),a=r,r=f}r=r+this.A|0,a=a+this.B|0,n=n+this.C|0,i=i+this.D|0,o=o+this.E|0,this.set(r,a,n,i,o)}roundClean(){po(ba)}destroy(){this.set(0,0,0,0,0),po(this.buffer)}}const Bb=Id(()=>new xb);const Ib=Bb,kh=BigInt(2**32-1),Lp=BigInt(32);function kb(s,e=!1){return e?{h:Number(s&kh),l:Number(s>>Lp&kh)}:{h:Number(s>>Lp&kh)|0,l:Number(s&kh)|0}}function Nb(s,e=!1){const t=s.length;let r=new Uint32Array(t),a=new Uint32Array(t);for(let n=0;n<t;n++){const{h:i,l:o}=kb(s[n],e);[r[n],a[n]]=[i,o]}return[r,a]}const Op=(s,e,t)=>s>>>t,Pp=(s,e,t)=>s<<32-t|e>>>t,Bo=(s,e,t)=>s>>>t|e<<32-t,Io=(s,e,t)=>s<<32-t|e>>>t,Nh=(s,e,t)=>s<<64-t|e>>>t-32,Th=(s,e,t)=>s>>>t-32|e<<64-t;function Ms(s,e,t,r){const a=(e>>>0)+(r>>>0);return{h:s+t+(a/2**32|0)|0,l:a|0}}const Tb=(s,e,t)=>(s>>>0)+(e>>>0)+(t>>>0),_b=(s,e,t,r)=>e+t+r+(s/2**32|0)|0,Rb=(s,e,t,r)=>(s>>>0)+(e>>>0)+(t>>>0)+(r>>>0),Vb=(s,e,t,r,a)=>e+t+r+a+(s/2**32|0)|0,$b=(s,e,t,r,a)=>(s>>>0)+(e>>>0)+(t>>>0)+(r>>>0)+(a>>>0),Db=(s,e,t,r,a,n)=>e+t+r+a+n+(s/2**32|0)|0,Lb=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ea=new Uint32Array(64);class Ob extends Om{constructor(e=32){super(64,e,8,!1),this.A=Aa[0]|0,this.B=Aa[1]|0,this.C=Aa[2]|0,this.D=Aa[3]|0,this.E=Aa[4]|0,this.F=Aa[5]|0,this.G=Aa[6]|0,this.H=Aa[7]|0}get(){const{A:e,B:t,C:r,D:a,E:n,F:i,G:o,H:l}=this;return[e,t,r,a,n,i,o,l]}set(e,t,r,a,n,i,o,l){this.A=e|0,this.B=t|0,this.C=r|0,this.D=a|0,this.E=n|0,this.F=i|0,this.G=o|0,this.H=l|0}process(e,t){for(let f=0;f<16;f++,t+=4)Ea[f]=e.getUint32(t,!1);for(let f=16;f<64;f++){const g=Ea[f-15],v=Ea[f-2],p=Ss(g,7)^Ss(g,18)^g>>>3,h=Ss(v,17)^Ss(v,19)^v>>>10;Ea[f]=h+Ea[f-7]+p+Ea[f-16]|0}let{A:r,B:a,C:n,D:i,E:o,F:l,G:u,H:c}=this;for(let f=0;f<64;f++){const g=Ss(o,6)^Ss(o,11)^Ss(o,25),v=c+g+w1(o,l,u)+Lb[f]+Ea[f]|0,h=(Ss(r,2)^Ss(r,13)^Ss(r,22))+S1(r,a,n)|0;c=u,u=l,l=o,o=i+v|0,i=n,n=a,a=r,r=v+h|0}r=r+this.A|0,a=a+this.B|0,n=n+this.C|0,i=i+this.D|0,o=o+this.E|0,l=l+this.F|0,u=u+this.G|0,c=c+this.H|0,this.set(r,a,n,i,o,l,u,c)}roundClean(){po(Ea)}destroy(){this.set(0,0,0,0,0,0,0,0),po(this.buffer)}}const C1=(()=>Nb(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(s=>BigInt(s))))(),Pb=(()=>C1[0])(),Ub=(()=>C1[1])(),xa=new Uint32Array(80),Ba=new Uint32Array(80);class A1 extends Om{constructor(e=64){super(128,e,16,!1),this.Ah=or[0]|0,this.Al=or[1]|0,this.Bh=or[2]|0,this.Bl=or[3]|0,this.Ch=or[4]|0,this.Cl=or[5]|0,this.Dh=or[6]|0,this.Dl=or[7]|0,this.Eh=or[8]|0,this.El=or[9]|0,this.Fh=or[10]|0,this.Fl=or[11]|0,this.Gh=or[12]|0,this.Gl=or[13]|0,this.Hh=or[14]|0,this.Hl=or[15]|0}get(){const{Ah:e,Al:t,Bh:r,Bl:a,Ch:n,Cl:i,Dh:o,Dl:l,Eh:u,El:c,Fh:f,Fl:g,Gh:v,Gl:p,Hh:h,Hl:d}=this;return[e,t,r,a,n,i,o,l,u,c,f,g,v,p,h,d]}set(e,t,r,a,n,i,o,l,u,c,f,g,v,p,h,d){this.Ah=e|0,this.Al=t|0,this.Bh=r|0,this.Bl=a|0,this.Ch=n|0,this.Cl=i|0,this.Dh=o|0,this.Dl=l|0,this.Eh=u|0,this.El=c|0,this.Fh=f|0,this.Fl=g|0,this.Gh=v|0,this.Gl=p|0,this.Hh=h|0,this.Hl=d|0}process(e,t){for(let x=0;x<16;x++,t+=4)xa[x]=e.getUint32(t),Ba[x]=e.getUint32(t+=4);for(let x=16;x<80;x++){const N=xa[x-15]|0,_=Ba[x-15]|0,$=Bo(N,_,1)^Bo(N,_,8)^Op(N,_,7),se=Io(N,_,1)^Io(N,_,8)^Pp(N,_,7),te=xa[x-2]|0,me=Ba[x-2]|0,Ce=Bo(te,me,19)^Nh(te,me,61)^Op(te,me,6),pe=Io(te,me,19)^Th(te,me,61)^Pp(te,me,6),ve=Rb(se,pe,Ba[x-7],Ba[x-16]),it=Vb(ve,$,Ce,xa[x-7],xa[x-16]);xa[x]=it|0,Ba[x]=ve|0}let{Ah:r,Al:a,Bh:n,Bl:i,Ch:o,Cl:l,Dh:u,Dl:c,Eh:f,El:g,Fh:v,Fl:p,Gh:h,Gl:d,Hh:y,Hl:A}=this;for(let x=0;x<80;x++){const N=Bo(f,g,14)^Bo(f,g,18)^Nh(f,g,41),_=Io(f,g,14)^Io(f,g,18)^Th(f,g,41),$=f&v^~f&h,se=g&p^~g&d,te=$b(A,_,se,Ub[x],Ba[x]),me=Db(te,y,N,$,Pb[x],xa[x]),Ce=te|0,pe=Bo(r,a,28)^Nh(r,a,34)^Nh(r,a,39),ve=Io(r,a,28)^Th(r,a,34)^Th(r,a,39),it=r&n^r&o^n&o,Ye=a&i^a&l^i&l;y=h|0,A=d|0,h=v|0,d=p|0,v=f|0,p=g|0,{h:f,l:g}=Ms(u|0,c|0,me|0,Ce|0),u=o|0,c=l|0,o=n|0,l=i|0,n=r|0,i=a|0;const Ae=Tb(Ce,ve,Ye);r=_b(Ae,me,pe,it),a=Ae|0}({h:r,l:a}=Ms(this.Ah|0,this.Al|0,r|0,a|0)),{h:n,l:i}=Ms(this.Bh|0,this.Bl|0,n|0,i|0),{h:o,l}=Ms(this.Ch|0,this.Cl|0,o|0,l|0),{h:u,l:c}=Ms(this.Dh|0,this.Dl|0,u|0,c|0),{h:f,l:g}=Ms(this.Eh|0,this.El|0,f|0,g|0),{h:v,l:p}=Ms(this.Fh|0,this.Fl|0,v|0,p|0),{h,l:d}=Ms(this.Gh|0,this.Gl|0,h|0,d|0),{h:y,l:A}=Ms(this.Hh|0,this.Hl|0,y|0,A|0),this.set(r,a,n,i,o,l,u,c,f,g,v,p,h,d,y,A)}roundClean(){po(xa,Ba)}destroy(){po(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class Mb extends A1{constructor(){super(48),this.Ah=ir[0]|0,this.Al=ir[1]|0,this.Bh=ir[2]|0,this.Bl=ir[3]|0,this.Ch=ir[4]|0,this.Cl=ir[5]|0,this.Dh=ir[6]|0,this.Dl=ir[7]|0,this.Eh=ir[8]|0,this.El=ir[9]|0,this.Fh=ir[10]|0,this.Fl=ir[11]|0,this.Gh=ir[12]|0,this.Gl=ir[13]|0,this.Hh=ir[14]|0,this.Hl=ir[15]|0}}const Hb=Id(()=>new Ob);const Kb=Id(()=>new A1),Fb=Id(()=>new Mb);const qb=Hb,Jb=Kb,Gb=Fb;/*!
 * Copyright (c) 2014, GlobalSign
 * Copyright (c) 2015-2019, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the {organization} nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */const Ot=new ArrayBuffer(0),S="";class tt extends TypeError{constructor(){super(...arguments),this.name=tt.NAME}static isType(e,t){if(typeof t=="string"){if(t==="Array"&&Array.isArray(e))return!0;if(t==="ArrayBuffer"&&e instanceof ArrayBuffer)return!0;if(t==="ArrayBufferView"&&ArrayBuffer.isView(e))return!0;if(typeof e===t)return!0}else if(e instanceof t)return!0;return!1}static assert(e,t,...r){for(const n of r)if(this.isType(e,n))return;const a=r.map(n=>n instanceof Function&&"name"in n?n.name:`${n}`);throw new tt(`Parameter '${t}' is not of type ${a.length>1?`(${a.join(" or ")})`:a[0]}`)}}tt.NAME="ArgumentError";class Fe extends TypeError{static assert(...e){let t=null,r,a;typeof e[0]=="string"?(t=e[0],r=e[1],a=e.slice(2)):(r=e[0],a=e.slice(1)),tt.assert(r,"parameters","object");for(const n of a){const i=r[n];if(i==null)throw new Fe(n,t)}}static assertEmpty(e,t,r){if(e==null)throw new Fe(t,r)}constructor(e,t=null,r){super(),this.name=Fe.NAME,this.field=e,t&&(this.target=t),r?this.message=r:this.message=`Absent mandatory parameter '${e}' ${t?` in '${t}'`:S}`}}Fe.NAME="ParameterError";class M extends Error{static assertSchema(e,t){if(!e.verified)throw new Error(`Object's schema was not verified against input data for ${t}`)}static assert(e,t){if(e.offset===-1)throw new M(`Error during parsing of ASN.1 data. Data is not correct for '${t}'.`)}constructor(e){super(e),this.name="AsnError"}}class G{static blockName(){return this.CLASS_NAME}static fromBER(e){const t=Lt(e);M.assert(t,this.name);try{return new this({schema:t.result})}catch{throw new M(`Cannot create '${this.CLASS_NAME}' from ASN.1 object`)}}static defaultValues(e){throw new Error(`Invalid member name for ${this.CLASS_NAME} class: ${e}`)}static schema(e={}){throw new Error(`Method '${this.CLASS_NAME}.schema' should be overridden`)}get className(){return this.constructor.CLASS_NAME}toString(e="hex"){let t;try{t=this.toSchema()}catch{t=this.toSchema(!0)}return Ee.ToString(t.toBER(),e)}}G.CLASS_NAME="PkiObject";function dn(s){let e=!1,t=S;const r=s.trim();for(let a=0;a<r.length;a++)r.charCodeAt(a)===32?e===!1&&(e=!0):(e&&(t+=" ",e=!1),t+=r[a]);return t.toLowerCase()}const Ou="type",Kd="value";class bn extends G{constructor(e={}){super(),this.type=m(e,Ou,bn.defaultValues(Ou)),this.value=m(e,Kd,bn.defaultValues(Kd)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ou:return S;case Kd:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.type||S}),new ke({name:t.value||S})]})}fromSchema(e){W(e,[Ou,"typeValue"]);const t=j(e,e,bn.schema({names:{type:Ou,value:"typeValue"}}));M.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}toSchema(){return new E({value:[new fe({value:this.type}),this.value]})}toJSON(){const e={type:this.type};return Object.keys(this.value).length!==0?e.value=this.value.toJSON():e.value=this.value,e}isEqual(e){const t=[ps.blockName(),ah.blockName(),nh.blockName(),lu.blockName(),ds.blockName(),ih.blockName(),Rm.blockName(),xd.blockName(),Vm.blockName(),Bd.blockName(),$m.blockName(),Dm.blockName()];if(e instanceof ArrayBuffer)return Se.isEqual(this.value.valueBeforeDecodeView,e);if(e.constructor.blockName()===bn.blockName()){if(this.type!==e.type)return!1;const r=[!1,!1],a=this.value.constructor.blockName();for(const i of t)a===i&&(r[0]=!0),e.value.constructor.blockName()===i&&(r[1]=!0);if(r[0]!==r[1])return!1;if(r[0]&&r[1]){const i=dn(this.value.valueBlock.value),o=dn(e.value.valueBlock.value);if(i.localeCompare(o)!==0)return!1}else if(!Se.isEqual(this.value.valueBeforeDecodeView,e.value.valueBeforeDecodeView))return!1;return!0}return!1}}bn.CLASS_NAME="AttributeTypeAndValue";const Kn="typesAndValues",_h="valueBeforeDecode",Up="RDN";class rt extends G{constructor(e={}){super(),this.typesAndValues=m(e,Kn,rt.defaultValues(Kn)),this.valueBeforeDecode=m(e,_h,rt.defaultValues(_h)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Kn:return[];case _h:return Ot;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Kn:return t.length===0;case _h:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new Re({name:t.repeatedSequence||S,value:new Nt({value:[new Re({name:t.repeatedSet||S,value:bn.schema(t.typeAndValue||{})})]})})]})}fromSchema(e){W(e,[Up,Kn]);const t=j(e,e,rt.schema({names:{blockName:Up,repeatedSet:Kn}}));M.assertSchema(t,this.className),Kn in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,r=>new bn({schema:r}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecodeView.slice().buffer}toSchema(){if(this.valueBeforeDecode.byteLength===0)return new E({value:[new Nt({value:Array.from(this.typesAndValues,t=>t.toSchema())})]});const e=Lt(this.valueBeforeDecode);if(M.assert(e,"RelativeDistinguishedNames"),!(e.result instanceof E))throw new Error("ASN.1 result should be SEQUENCE");return e.result}toJSON(){return{typesAndValues:Array.from(this.typesAndValues,e=>e.toJSON())}}isEqual(e){if(e instanceof rt){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;for(const[t,r]of this.typesAndValues.entries())if(r.isEqual(e.typesAndValues[t])===!1)return!1;return!0}return e instanceof ArrayBuffer?wu(this.valueBeforeDecode,e):!1}}rt.CLASS_NAME="RelativeDistinguishedNames";const Xu="type",Zu="value";function jb(s={},e=!1){const t=m(s,"names",{});return new E({optional:e,value:[new T({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:t.country_name||S,value:[new St({value:[new lu,new ds]})]}),new T({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:t.administration_domain_name||S,value:[new St({value:[new lu,new ds]})]}),new Be({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:t.network_address||S,isHexOnly:!0}),new Be({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:t.terminal_identifier||S,isHexOnly:!0}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:t.private_domain_name||S,value:[new St({value:[new lu,new ds]})]}),new Be({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:t.organization_name||S,isHexOnly:!0}),new Be({optional:!0,name:t.numeric_user_identifier||S,idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new T({optional:!0,name:t.personal_name||S,idBlock:{tagClass:3,tagNumber:5},value:[new Be({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new Be({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new Be({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new Be({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new T({optional:!0,name:t.organizational_unit_names||S,idBlock:{tagClass:3,tagNumber:6},value:[new Re({value:new ds})]})]})}function Wb(s=!1){return new E({optional:s,value:[new ds,new ds]})}function Qb(s=!1){return new Nt({optional:s,value:[new Be({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ke]})]})}class Qe extends G{constructor(e={}){super(),this.type=m(e,Xu,Qe.defaultValues(Xu)),this.value=m(e,Zu,Qe.defaultValues(Zu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xu:return 9;case Zu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Xu:return t===Qe.defaultValues(e);case Zu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new St({value:[new T({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||S,value:[new fe,new T({idBlock:{tagClass:3,tagNumber:0},value:[new ke]})]}),new Be({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:1}}),new Be({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:2}}),new T({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||S,value:[jb(t.builtInStandardAttributes||{},!1),Wb(!0),Qb(!0)]}),new T({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||S,value:[rt.schema(t.directoryName||{})]}),new T({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||S,value:[new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new St({value:[new ih,new ds,new nh,new ps,new ah]})]}),new T({idBlock:{tagClass:3,tagNumber:1},value:[new St({value:[new ih,new ds,new nh,new ps,new ah]})]})]}),new Be({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:6}}),new Be({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:7}}),new Be({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:8}})]})}fromSchema(e){W(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);const t=j(e,e,Qe.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));switch(M.assertSchema(t,this.className),this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:this.value=t.result.blockName;break;case 1:case 2:case 6:{const r=t.result.blockName;r.idBlock.tagClass=1,r.idBlock.tagNumber=22;const a=r.toBER(!1),n=Lt(a);M.assert(n,"GeneralName value"),this.value=n.result.valueBlock.value}break;case 3:this.value=t.result.blockName;break;case 4:this.value=new rt({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new z({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:{const r=t.result.blockName;r.idBlock.tagClass=1,r.idBlock.tagNumber=6;const a=r.toBER(!1),n=Lt(a);M.assert(n,"GeneralName registeredID"),this.value=n.result.valueBlock.toString()}break}}toSchema(){switch(this.type){case 0:case 3:case 5:return new T({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{const e=new xd({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 4:return new T({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{const e=this.value;return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 8:{const e=new fe({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}default:return Qe.schema()}}toJSON(){const e={type:this.type,value:S};if(typeof this.value=="string")e.value=this.value;else try{e.value=this.value.toJSON()}catch{}return e}}Qe.CLASS_NAME="GeneralName";const ec="accessMethod",tc="accessLocation",Yb=[ec,tc];class so extends G{constructor(e={}){super(),this.accessMethod=m(e,ec,so.defaultValues(ec)),this.accessLocation=m(e,tc,so.defaultValues(tc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ec:return S;case tc:return new Qe;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.accessMethod||S}),Qe.schema(t.accessLocation||{})]})}fromSchema(e){W(e,Yb);const t=j(e,e,so.schema({names:{accessMethod:ec,accessLocation:{names:{blockName:tc}}}}));M.assertSchema(t,this.className),this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new Qe({schema:t.result.accessLocation})}toSchema(){return new E({value:[new fe({value:this.accessMethod}),this.accessLocation.toSchema()]})}toJSON(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}so.CLASS_NAME="AccessDescription";const ka="seconds",Na="millis",Ta="micros";class Or extends G{constructor(e={}){super(),ka in e&&(this.seconds=m(e,ka,Or.defaultValues(ka))),Na in e&&(this.millis=m(e,Na,Or.defaultValues(Na))),Ta in e&&(this.micros=m(e,Ta,Or.defaultValues(Ta))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ka:case Na:case Ta:return 0;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ka:case Na:case Ta:return t===Or.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,optional:!0,value:[new D({optional:!0,name:t.seconds||S}),new Be({name:t.millis||S,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Be({name:t.micros||S,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){W(e,[ka,Na,Ta]);const t=j(e,e,Or.schema({names:{seconds:ka,millis:Na,micros:Ta}}));if(M.assertSchema(t,this.className),"seconds"in t.result&&(this.seconds=t.result.seconds.valueBlock.valueDec),"millis"in t.result){const r=new D({valueHex:t.result.millis.valueBlock.valueHex});this.millis=r.valueBlock.valueDec}if("micros"in t.result){const r=new D({valueHex:t.result.micros.valueBlock.valueHex});this.micros=r.valueBlock.valueDec}}toSchema(){const e=[];if(this.seconds!==void 0&&e.push(new D({value:this.seconds})),this.millis!==void 0){const t=new D({value:this.millis});e.push(new Be({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHexView}))}if(this.micros!==void 0){const t=new D({value:this.micros});e.push(new Be({idBlock:{tagClass:3,tagNumber:1},valueHex:t.valueBlock.valueHexView}))}return new E({value:e})}toJSON(){const e={};return this.seconds!==void 0&&(e.seconds=this.seconds),this.millis!==void 0&&(e.millis=this.millis),this.micros!==void 0&&(e.micros=this.micros),e}}Or.CLASS_NAME="Accuracy";const Rh="algorithmId",Pu="algorithmParams",b1="algorithm",Ug="params",zb=[b1,Ug];class V extends G{constructor(e={}){super(),this.algorithmId=m(e,Rh,V.defaultValues(Rh)),Pu in e&&(this.algorithmParams=m(e,Pu,V.defaultValues(Pu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Rh:return S;case Pu:return new ke;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Rh:return t===S;case Pu:return t instanceof ke;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,optional:t.optional||!1,value:[new fe({name:t.algorithmIdentifier||S}),new ke({name:t.algorithmParams||S,optional:!0})]})}fromSchema(e){W(e,zb);const t=j(e,e,V.schema({names:{algorithmIdentifier:b1,algorithmParams:Ug}}));M.assertSchema(t,this.className),this.algorithmId=t.result.algorithm.valueBlock.toString(),Ug in t.result&&(this.algorithmParams=t.result.params)}toSchema(){const e=[];return e.push(new fe({value:this.algorithmId})),this.algorithmParams&&!(this.algorithmParams instanceof ke)&&e.push(this.algorithmParams),new E({value:e})}toJSON(){const e={algorithmId:this.algorithmId};return this.algorithmParams&&!(this.algorithmParams instanceof ke)&&(e.algorithmParams=this.algorithmParams.toJSON()),e}isEqual(e){return!(e instanceof V)||this.algorithmId!==e.algorithmId?!1:this.algorithmParams?e.algorithmParams?JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!1:!e.algorithmParams}}V.CLASS_NAME="AlgorithmIdentifier";const Lo="altNames",Xb=[Lo];class Au extends G{constructor(e={}){super(),this.altNames=m(e,Lo,Au.defaultValues(Lo)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Lo:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new Re({name:t.altNames||S,value:Qe.schema()})]})}fromSchema(e){W(e,Xb);const t=j(e,e,Au.schema({names:{altNames:Lo}}));M.assertSchema(t,this.className),Lo in t.result&&(this.altNames=Array.from(t.result.altNames,r=>new Qe({schema:r})))}toSchema(){return new E({value:Array.from(this.altNames,e=>e.toSchema())})}toJSON(){return{altNames:Array.from(this.altNames,e=>e.toJSON())}}}Au.CLASS_NAME="AltName";const Oo="type",Po="values",Zb=[Oo,Po];class gt extends G{constructor(e={}){super(),this.type=m(e,Oo,gt.defaultValues(Oo)),this.values=m(e,Po,gt.defaultValues(Po)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Oo:return S;case Po:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Oo:return t===S;case Po:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.type||S}),new Nt({name:t.setName||S,value:[new Re({name:t.values||S,value:new ke})]})]})}fromSchema(e){W(e,Zb);const t=j(e,e,gt.schema({names:{type:Oo,values:Po}}));M.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}toSchema(){return new E({value:[new fe({value:this.type}),new Nt({value:this.values})]})}toJSON(){return{type:this.type,values:Array.from(this.values,e=>e.toJSON())}}}gt.CLASS_NAME="Attribute";const rc="notBeforeTime",sc="notAfterTime",eE=[rc,sc];class gs extends G{constructor(e={}){super(),this.notBeforeTime=m(e,rc,gs.defaultValues(rc)),this.notAfterTime=m(e,sc,gs.defaultValues(sc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rc:case sc:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new wt({name:t.notBeforeTime||S}),new wt({name:t.notAfterTime||S})]})}fromSchema(e){W(e,eE);const t=j(e,e,gs.schema({names:{notBeforeTime:rc,notAfterTime:sc}}));M.assertSchema(t,this.className),this.notBeforeTime=t.result.notBeforeTime.toDate(),this.notAfterTime=t.result.notAfterTime.toDate()}toSchema(){return new E({value:[new wt({valueDate:this.notBeforeTime}),new wt({valueDate:this.notAfterTime})]})}toJSON(){return{notBeforeTime:this.notBeforeTime,notAfterTime:this.notAfterTime}}}gs.CLASS_NAME="AttCertValidityPeriod";const Uu="names",Mp="generalNames";class Kt extends G{constructor(e={}){super(),this.names=m(e,Uu,Kt.defaultValues(Uu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"names":return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const r=m(e,Uu,{});return new E({optional:t,name:r.blockName||S,value:[new Re({name:r.generalNames||S,value:Qe.schema()})]})}fromSchema(e){W(e,[Uu,Mp]);const t=j(e,e,Kt.schema({names:{blockName:Uu,generalNames:Mp}}));M.assertSchema(t,this.className),this.names=Array.from(t.result.generalNames,r=>new Qe({schema:r}))}toSchema(){return new E({value:Array.from(this.names,e=>e.toSchema())})}toJSON(){return{names:Array.from(this.names,e=>e.toJSON())}}}Kt.CLASS_NAME="GeneralNames";const tE="2.5.29.9",rE="2.5.29.14",sE="2.5.29.15",aE="2.5.29.16",E1="2.5.29.17",x1="2.5.29.18",Pm="2.5.29.19",nE="2.5.29.20",iE="2.5.29.27",oE="2.5.29.21",lE="2.5.29.24",B1="2.5.29.28",I1="2.5.29.29",k1="2.5.29.30",N1="2.5.29.31",Um="2.5.29.46",T1="2.5.29.32",qr="2.5.29.32.0",uE="1.3.6.1.4.1.311.21.10",_1="2.5.29.33",Mm="2.5.29.35",R1="2.5.29.36",cE="2.5.29.37",fE="2.5.29.54",Hm="1.3.6.1.5.5.7.1.1",hE="1.3.6.1.5.5.7.1.11",dE="1.3.6.1.4.1.11129.2.4.2",gE="1.3.6.1.4.1.311.21.7",mE="1.3.6.1.4.1.311.21.1",pE="1.3.6.1.5.5.7.1.3",Km="1.2.840.113549.1.7.1",V1="1.2.840.113549.1.7.2",$1="1.2.840.113549.1.7.3",D1="1.2.840.113549.1.7.6",yE="1.2.840.113549.1.9.16.1.4",Hp="1.2.840.113549.1.9.22.1",vE="1.2.840.113549.1.9.22.2",Kp="1.2.840.113549.1.9.22.3",Fp="1.2.840.113549.1.9.23.1",wE="1.3.6.1.5.5.7",SE=`${wE}.48`,o0=`${SE}.1.1`,Gn="keyIdentifier",jn="authorityCertIssuer",Wn="authorityCertSerialNumber",CE=[Gn,jn,Wn];class En extends G{constructor(e={}){super(),Gn in e&&(this.keyIdentifier=m(e,Gn,En.defaultValues(Gn))),jn in e&&(this.authorityCertIssuer=m(e,jn,En.defaultValues(jn))),Wn in e&&(this.authorityCertSerialNumber=m(e,Wn,En.defaultValues(Wn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gn:return new z;case jn:return[];case Wn:return new D;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new Be({name:t.keyIdentifier||S,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Re({name:t.authorityCertIssuer||S,value:Qe.schema()})]}),new Be({name:t.authorityCertSerialNumber||S,optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}fromSchema(e){W(e,CE);const t=j(e,e,En.schema({names:{keyIdentifier:Gn,authorityCertIssuer:jn,authorityCertSerialNumber:Wn}}));M.assertSchema(t,this.className),Gn in t.result&&(this.keyIdentifier=new z({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),jn in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,r=>new Qe({schema:r}))),Wn in t.result&&(this.authorityCertSerialNumber=new D({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}toSchema(){const e=[];return this.keyIdentifier&&e.push(new Be({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHexView})),this.authorityCertIssuer&&e.push(new T({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,t=>t.toSchema())})),this.authorityCertSerialNumber&&e.push(new Be({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHexView})),new E({value:e})}toJSON(){const e={};return this.keyIdentifier&&(e.keyIdentifier=this.keyIdentifier.toJSON()),this.authorityCertIssuer&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,t=>t.toJSON())),this.authorityCertSerialNumber&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}En.CLASS_NAME="AuthorityKeyIdentifier";const Fn="pathLenConstraint",qn="cA";class ao extends G{constructor(e={}){super(),this.cA=m(e,qn,!1),Fn in e&&(this.pathLenConstraint=m(e,Fn,0)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case qn:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new Ps({optional:!0,name:t.cA||S}),new D({optional:!0,name:t.pathLenConstraint||S})]})}fromSchema(e){W(e,[qn,Fn]);const t=j(e,e,ao.schema({names:{cA:qn,pathLenConstraint:Fn}}));M.assertSchema(t,this.className),qn in t.result&&(this.cA=t.result.cA.valueBlock.value),Fn in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}toSchema(){const e=[];return this.cA!==ao.defaultValues(qn)&&e.push(new Ps({value:this.cA})),Fn in this&&(this.pathLenConstraint instanceof D?e.push(this.pathLenConstraint):e.push(new D({value:this.pathLenConstraint}))),new E({value:e})}toJSON(){const e={};return this.cA!==ao.defaultValues(qn)&&(e.cA=this.cA),Fn in this&&(this.pathLenConstraint instanceof D?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}ao.CLASS_NAME="BasicConstraints";const Fd="certificateIndex",qd="keyIndex";class oh extends G{constructor(e={}){super(),this.certificateIndex=m(e,Fd,oh.defaultValues(Fd)),this.keyIndex=m(e,qd,oh.defaultValues(qd)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fd:case qd:return 0;default:return super.defaultValues(e)}}static schema(){return new D}fromSchema(e){if(e.constructor.blockName()!==D.blockName())throw new Error("Object's schema was not verified against input data for CAVersion");let t=e.valueBlock.valueHex.slice(0);const r=new Uint8Array(t);switch(!0){case t.byteLength<4:{const f=new ArrayBuffer(4);new Uint8Array(f).set(r,4-t.byteLength),t=f.slice(0)}break;case t.byteLength>4:{const f=new ArrayBuffer(4);new Uint8Array(f).set(r.slice(0,4)),t=f.slice(0)}break}const a=t.slice(0,2),n=new Uint8Array(a);let i=n[0];n[0]=n[1],n[1]=i;const o=new Uint16Array(a);this.keyIndex=o[0];const l=t.slice(2),u=new Uint8Array(l);i=u[0],u[0]=u[1],u[1]=i;const c=new Uint16Array(l);this.certificateIndex=c[0]}toSchema(){const e=new ArrayBuffer(2),t=new Uint16Array(e);t[0]=this.certificateIndex;const r=new Uint8Array(e);let a=r[0];r[0]=r[1],r[1]=a;const n=new ArrayBuffer(2),i=new Uint16Array(n);i[0]=this.keyIndex;const o=new Uint8Array(n);return a=o[0],o[0]=o[1],o[1]=a,new D({valueHex:ou(n,e)})}toJSON(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}oh.CLASS_NAME="CAVersion";const ac="policyQualifierId",nc="qualifier",AE=[ac,nc];class no extends G{constructor(e={}){super(),this.policyQualifierId=m(e,ac,no.defaultValues(ac)),this.qualifier=m(e,nc,no.defaultValues(nc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ac:return S;case nc:return new ke;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.policyQualifierId||S}),new ke({name:t.qualifier||S})]})}fromSchema(e){W(e,AE);const t=j(e,e,no.schema({names:{policyQualifierId:ac,qualifier:nc}}));M.assertSchema(t,this.className),this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}toSchema(){return new E({value:[new fe({value:this.policyQualifierId}),this.qualifier]})}toJSON(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}no.CLASS_NAME="PolicyQualifierInfo";const ic="policyIdentifier",Qn="policyQualifiers",bE=[ic,Qn];class io extends G{constructor(e={}){super(),this.policyIdentifier=m(e,ic,io.defaultValues(ic)),Qn in e&&(this.policyQualifiers=m(e,Qn,io.defaultValues(Qn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ic:return S;case Qn:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.policyIdentifier||S}),new E({optional:!0,value:[new Re({name:t.policyQualifiers||S,value:no.schema()})]})]})}fromSchema(e){W(e,bE);const t=j(e,e,io.schema({names:{policyIdentifier:ic,policyQualifiers:Qn}}));M.assertSchema(t,this.className),this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),Qn in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,r=>new no({schema:r})))}toSchema(){const e=[];return e.push(new fe({value:this.policyIdentifier})),this.policyQualifiers&&e.push(new E({value:Array.from(this.policyQualifiers,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={policyIdentifier:this.policyIdentifier};return this.policyQualifiers&&(e.policyQualifiers=Array.from(this.policyQualifiers,t=>t.toJSON())),e}}io.CLASS_NAME="PolicyInformation";const oc="certificatePolicies",EE=[oc];class bu extends G{constructor(e={}){super(),this.certificatePolicies=m(e,oc,bu.defaultValues(oc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case oc:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new Re({name:t.certificatePolicies||S,value:io.schema()})]})}fromSchema(e){W(e,EE);const t=j(e,e,bu.schema({names:{certificatePolicies:oc}}));M.assertSchema(t,this.className),this.certificatePolicies=Array.from(t.result.certificatePolicies,r=>new io({schema:r}))}toSchema(){return new E({value:Array.from(this.certificatePolicies,e=>e.toSchema())})}toJSON(){return{certificatePolicies:Array.from(this.certificatePolicies,e=>e.toJSON())}}}bu.CLASS_NAME="CertificatePolicies";const lc="templateID",Fs="templateMajorVersion",qs="templateMinorVersion",xE=[lc,Fs,qs];class nu extends G{constructor(e={}){super(),this.templateID=m(e,lc,nu.defaultValues(lc)),Fs in e&&(this.templateMajorVersion=m(e,Fs,nu.defaultValues(Fs))),qs in e&&(this.templateMinorVersion=m(e,qs,nu.defaultValues(qs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lc:return S;case Fs:case qs:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.templateID||S}),new D({name:t.templateMajorVersion||S,optional:!0}),new D({name:t.templateMinorVersion||S,optional:!0})]})}fromSchema(e){W(e,xE);const t=j(e,e,nu.schema({names:{templateID:lc,templateMajorVersion:Fs,templateMinorVersion:qs}}));M.assertSchema(t,this.className),this.templateID=t.result.templateID.valueBlock.toString(),Fs in t.result&&(this.templateMajorVersion=t.result.templateMajorVersion.valueBlock.valueDec),qs in t.result&&(this.templateMinorVersion=t.result.templateMinorVersion.valueBlock.valueDec)}toSchema(){const e=[];return e.push(new fe({value:this.templateID})),Fs in this&&e.push(new D({value:this.templateMajorVersion})),qs in this&&e.push(new D({value:this.templateMinorVersion})),new E({value:e})}toJSON(){const e={templateID:this.templateID};return Fs in this&&(e.templateMajorVersion=this.templateMajorVersion),qs in this&&(e.templateMinorVersion=this.templateMinorVersion),e}}const Yn="distributionPoint",L1="distributionPointNames",zn="reasons",Xn="cRLIssuer",O1="cRLIssuerNames",BE=[Yn,L1,zn,Xn,O1];class xn extends G{constructor(e={}){super(),Yn in e&&(this.distributionPoint=m(e,Yn,xn.defaultValues(Yn))),zn in e&&(this.reasons=m(e,zn,xn.defaultValues(zn))),Xn in e&&(this.cRLIssuer=m(e,Xn,xn.defaultValues(Xn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yn:return[];case zn:return new Pe;case Xn:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new St({value:[new T({name:t.distributionPoint||S,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Re({name:t.distributionPointNames||S,value:Qe.schema()})]}),new T({name:t.distributionPoint||S,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:rt.schema().valueBlock.value})]})]}),new Be({name:t.reasons||S,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new T({name:t.cRLIssuer||S,optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new Re({name:t.cRLIssuerNames||S,value:Qe.schema()})]})]})}fromSchema(e){W(e,BE);const t=j(e,e,xn.schema({names:{distributionPoint:Yn,distributionPointNames:L1,reasons:zn,cRLIssuer:Xn,cRLIssuerNames:O1}}));M.assertSchema(t,this.className),Yn in t.result&&(t.result.distributionPoint.idBlock.tagNumber===0&&(this.distributionPoint=Array.from(t.result.distributionPointNames,r=>new Qe({schema:r}))),t.result.distributionPoint.idBlock.tagNumber===1&&(this.distributionPoint=new rt({schema:new E({value:t.result.distributionPoint.valueBlock.value})}))),zn in t.result&&(this.reasons=new Pe({valueHex:t.result.reasons.valueBlock.valueHex})),Xn in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,r=>new Qe({schema:r})))}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new T({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,r=>r.toSchema())}):t=new T({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return this.reasons&&e.push(new Be({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHexView})),this.cRLIssuer&&e.push(new T({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.reasons&&(e.reasons=this.reasons.toJSON()),this.cRLIssuer&&(e.cRLIssuer=Array.from(this.cRLIssuer,t=>t.toJSON())),e}}xn.CLASS_NAME="DistributionPoint";const uc="distributionPoints",IE=[uc];class Eu extends G{constructor(e={}){super(),this.distributionPoints=m(e,uc,Eu.defaultValues(uc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uc:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new Re({name:t.distributionPoints||S,value:xn.schema()})]})}fromSchema(e){W(e,IE);const t=j(e,e,Eu.schema({names:{distributionPoints:uc}}));M.assertSchema(t,this.className),this.distributionPoints=Array.from(t.result.distributionPoints,r=>new xn({schema:r}))}toSchema(){return new E({value:Array.from(this.distributionPoints,e=>e.toSchema())})}toJSON(){return{distributionPoints:Array.from(this.distributionPoints,e=>e.toJSON())}}}Eu.CLASS_NAME="CRLDistributionPoints";const cc="keyPurposes",kE=[cc];class lh extends G{constructor(e={}){super(),this.keyPurposes=m(e,cc,lh.defaultValues(cc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cc:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new Re({name:t.keyPurposes||S,value:new fe})]})}fromSchema(e){W(e,kE);const t=j(e,e,lh.schema({names:{keyPurposes:cc}}));M.assertSchema(t,this.className),this.keyPurposes=Array.from(t.result.keyPurposes,r=>r.valueBlock.toString())}toSchema(){return new E({value:Array.from(this.keyPurposes,e=>new fe({value:e}))})}toJSON(){return{keyPurposes:Array.from(this.keyPurposes)}}}lh.CLASS_NAME="ExtKeyUsage";const Mu="accessDescriptions";class xu extends G{constructor(e={}){super(),this.accessDescriptions=m(e,Mu,xu.defaultValues(Mu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new Re({name:t.accessDescriptions||S,value:so.schema()})]})}fromSchema(e){W(e,[Mu]);const t=j(e,e,xu.schema({names:{accessDescriptions:Mu}}));M.assertSchema(t,this.className),this.accessDescriptions=Array.from(t.result.accessDescriptions,r=>new so({schema:r}))}toSchema(){return new E({value:Array.from(this.accessDescriptions,e=>e.toSchema())})}toJSON(){return{accessDescriptions:Array.from(this.accessDescriptions,e=>e.toJSON())}}}xu.CLASS_NAME="InfoAccess";const Zn="distributionPoint",P1="distributionPointNames",_a="onlyContainsUserCerts",Ra="onlyContainsCACerts",Va="onlySomeReasons",$a="indirectCRL",Da="onlyContainsAttributeCerts",NE=[Zn,P1,_a,Ra,Va,$a,Da];class Qt extends G{constructor(e={}){super(),Zn in e&&(this.distributionPoint=m(e,Zn,Qt.defaultValues(Zn))),this.onlyContainsUserCerts=m(e,_a,Qt.defaultValues(_a)),this.onlyContainsCACerts=m(e,Ra,Qt.defaultValues(Ra)),Va in e&&(this.onlySomeReasons=m(e,Va,Qt.defaultValues(Va))),this.indirectCRL=m(e,$a,Qt.defaultValues($a)),this.onlyContainsAttributeCerts=m(e,Da,Qt.defaultValues(Da)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Zn:return[];case _a:return!1;case Ra:return!1;case Va:return 0;case $a:return!1;case Da:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new St({value:[new T({name:t.distributionPoint||S,idBlock:{tagClass:3,tagNumber:0},value:[new Re({name:t.distributionPointNames||S,value:Qe.schema()})]}),new T({name:t.distributionPoint||S,idBlock:{tagClass:3,tagNumber:1},value:rt.schema().valueBlock.value})]})]}),new Be({name:t.onlyContainsUserCerts||S,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Be({name:t.onlyContainsCACerts||S,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new Be({name:t.onlySomeReasons||S,optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new Be({name:t.indirectCRL||S,optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new Be({name:t.onlyContainsAttributeCerts||S,optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}fromSchema(e){W(e,NE);const t=j(e,e,Qt.schema({names:{distributionPoint:Zn,distributionPointNames:P1,onlyContainsUserCerts:_a,onlyContainsCACerts:Ra,onlySomeReasons:Va,indirectCRL:$a,onlyContainsAttributeCerts:Da}}));if(M.assertSchema(t,this.className),Zn in t.result)switch(!0){case t.result.distributionPoint.idBlock.tagNumber===0:this.distributionPoint=Array.from(t.result.distributionPointNames,r=>new Qe({schema:r}));break;case t.result.distributionPoint.idBlock.tagNumber===1:this.distributionPoint=new rt({schema:new E({value:t.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if(_a in t.result){const r=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=r[0]!==0}if(Ra in t.result){const r=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=r[0]!==0}if(Va in t.result){const r=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=r[0]}if($a in t.result){const r=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=r[0]!==0}if(Da in t.result){const r=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=r[0]!==0}}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new T({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,r=>r.toSchema())}):(t=this.distributionPoint.toSchema(),t.idBlock.tagClass=3,t.idBlock.tagNumber=1),e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(this.onlyContainsUserCerts!==Qt.defaultValues(_a)&&e.push(new Be({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==Qt.defaultValues(Ra)&&e.push(new Be({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),this.onlySomeReasons!==void 0){const t=new ArrayBuffer(1),r=new Uint8Array(t);r[0]=this.onlySomeReasons,e.push(new Be({idBlock:{tagClass:3,tagNumber:3},valueHex:t}))}return this.indirectCRL!==Qt.defaultValues($a)&&e.push(new Be({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==Qt.defaultValues(Da)&&e.push(new Be({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new E({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==Qt.defaultValues(_a)&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==Qt.defaultValues(Ra)&&(e.onlyContainsCACerts=this.onlyContainsCACerts),Va in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==Qt.defaultValues($a)&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==Qt.defaultValues(Da)&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}Qt.CLASS_NAME="IssuingDistributionPoint";const fc="base",Uo="minimum",La="maximum",TE=[fc,Uo,La];class _s extends G{constructor(e={}){super(),this.base=m(e,fc,_s.defaultValues(fc)),this.minimum=m(e,Uo,_s.defaultValues(Uo)),La in e&&(this.maximum=m(e,La,_s.defaultValues(La))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fc:return new Qe;case Uo:return 0;case La:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[Qe.schema(t.base||{}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new D({name:t.minimum||S})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new D({name:t.maximum||S})]})]})}fromSchema(e){W(e,TE);const t=j(e,e,_s.schema({names:{base:{names:{blockName:fc}},minimum:Uo,maximum:La}}));M.assertSchema(t,this.className),this.base=new Qe({schema:t.result.base}),Uo in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),La in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}toSchema(){const e=[];if(e.push(this.base.toSchema()),this.minimum!==0){let t=0;this.minimum instanceof D?t=this.minimum:t=new D({value:this.minimum}),e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(La in this){let t=0;this.maximum instanceof D?t=this.maximum:t=new D({value:this.maximum}),e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[t]}))}return new E({value:e})}toJSON(){const e={base:this.base.toJSON()};return this.minimum!==0&&(typeof this.minimum=="number"?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),this.maximum!==void 0&&(typeof this.maximum=="number"?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}_s.CLASS_NAME="GeneralSubtree";const ei="permittedSubtrees",ti="excludedSubtrees",_E=[ei,ti];class uu extends G{constructor(e={}){super(),ei in e&&(this.permittedSubtrees=m(e,ei,uu.defaultValues(ei))),ti in e&&(this.excludedSubtrees=m(e,ti,uu.defaultValues(ti))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ei:case ti:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Re({name:t.permittedSubtrees||S,value:_s.schema()})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Re({name:t.excludedSubtrees||S,value:_s.schema()})]})]})}fromSchema(e){W(e,_E);const t=j(e,e,uu.schema({names:{permittedSubtrees:ei,excludedSubtrees:ti}}));M.assertSchema(t,this.className),ei in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,r=>new _s({schema:r}))),ti in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,r=>new _s({schema:r})))}toSchema(){const e=[];return this.permittedSubtrees&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,t=>t.toSchema())})),this.excludedSubtrees&&e.push(new T({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={};return this.permittedSubtrees&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,t=>t.toJSON())),this.excludedSubtrees&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,t=>t.toJSON())),e}}uu.CLASS_NAME="NameConstraints";const Js="requireExplicitPolicy",Gs="inhibitPolicyMapping",RE=[Js,Gs];class cu extends G{constructor(e={}){super(),Js in e&&(this.requireExplicitPolicy=m(e,Js,cu.defaultValues(Js))),Gs in e&&(this.inhibitPolicyMapping=m(e,Gs,cu.defaultValues(Gs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Js:return 0;case Gs:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new Be({name:t.requireExplicitPolicy||S,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Be({name:t.inhibitPolicyMapping||S,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){W(e,RE);const t=j(e,e,cu.schema({names:{requireExplicitPolicy:Js,inhibitPolicyMapping:Gs}}));if(M.assertSchema(t,this.className),Js in t.result){const r=t.result.requireExplicitPolicy;r.idBlock.tagClass=1,r.idBlock.tagNumber=2;const a=r.toBER(!1),n=Lt(a);M.assert(n,"Integer"),this.requireExplicitPolicy=n.result.valueBlock.valueDec}if(Gs in t.result){const r=t.result.inhibitPolicyMapping;r.idBlock.tagClass=1,r.idBlock.tagNumber=2;const a=r.toBER(!1),n=Lt(a);M.assert(n,"Integer"),this.inhibitPolicyMapping=n.result.valueBlock.valueDec}}toSchema(){const e=[];if(Js in this){const t=new D({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if(Gs in this){const t=new D({value:this.inhibitPolicyMapping});t.idBlock.tagClass=3,t.idBlock.tagNumber=1,e.push(t)}return new E({value:e})}toJSON(){const e={};return Js in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),Gs in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}cu.CLASS_NAME="PolicyConstraints";const hc="issuerDomainPolicy",dc="subjectDomainPolicy",VE=[hc,dc];class oo extends G{constructor(e={}){super(),this.issuerDomainPolicy=m(e,hc,oo.defaultValues(hc)),this.subjectDomainPolicy=m(e,dc,oo.defaultValues(dc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hc:return S;case dc:return S;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.issuerDomainPolicy||S}),new fe({name:t.subjectDomainPolicy||S})]})}fromSchema(e){W(e,VE);const t=j(e,e,oo.schema({names:{issuerDomainPolicy:hc,subjectDomainPolicy:dc}}));M.assertSchema(t,this.className),this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}toSchema(){return new E({value:[new fe({value:this.issuerDomainPolicy}),new fe({value:this.subjectDomainPolicy})]})}toJSON(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}oo.CLASS_NAME="PolicyMapping";const gc="mappings",$E=[gc];class uh extends G{constructor(e={}){super(),this.mappings=m(e,gc,uh.defaultValues(gc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gc:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new Re({name:t.mappings||S,value:oo.schema()})]})}fromSchema(e){W(e,$E);const t=j(e,e,uh.schema({names:{mappings:gc}}));M.assertSchema(t,this.className),this.mappings=Array.from(t.result.mappings,r=>new oo({schema:r}))}toSchema(){return new E({value:Array.from(this.mappings,e=>e.toSchema())})}toJSON(){return{mappings:Array.from(this.mappings,e=>e.toJSON())}}}uh.CLASS_NAME="PolicyMappings";const Oa="notBefore",Pa="notAfter",DE=[Oa,Pa];class fu extends G{constructor(e={}){super(),Oa in e&&(this.notBefore=m(e,Oa,fu.defaultValues(Oa))),Pa in e&&(this.notAfter=m(e,Pa,fu.defaultValues(Pa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Oa:return new Date;case Pa:return new Date;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new Be({name:t.notBefore||S,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Be({name:t.notAfter||S,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){W(e,DE);const t=j(e,e,fu.schema({names:{notBefore:Oa,notAfter:Pa}}));if(M.assertSchema(t,this.className),Oa in t.result){const r=new wt;r.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=r.toDate()}if(Pa in t.result){const r=new wt({valueHex:t.result.notAfter.valueBlock.valueHex});r.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=r.toDate()}}toSchema(){const e=[];return Oa in this&&e.push(new Be({idBlock:{tagClass:3,tagNumber:0},valueHex:new wt({valueDate:this.notBefore}).valueBlock.valueHexView})),Pa in this&&e.push(new Be({idBlock:{tagClass:3,tagNumber:1},valueHex:new wt({valueDate:this.notAfter}).valueBlock.valueHexView})),new E({value:e})}toJSON(){const e={};return this.notBefore&&(e.notBefore=this.notBefore),this.notAfter&&(e.notAfter=this.notAfter),e}}fu.CLASS_NAME="PrivateKeyUsagePeriod";const Mo="id",js="type",Ho="values",LE=[Mo,js],OE=[Ho];class lo extends G{constructor(e={}){super(),this.id=m(e,Mo,lo.defaultValues(Mo)),js in e&&(this.type=m(e,js,lo.defaultValues(js))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mo:return S;case js:return new kt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Mo:return t===S;case js:return t instanceof kt;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.id||S}),new ke({name:t.type||S,optional:!0})]})}fromSchema(e){W(e,LE);const t=j(e,e,lo.schema({names:{id:Mo,type:js}}));M.assertSchema(t,this.className),this.id=t.result.id.valueBlock.toString(),js in t.result&&(this.type=t.result.type)}toSchema(){const e=[new fe({value:this.id})];return js in this&&e.push(this.type),new E({value:e})}toJSON(){const e={id:this.id};return this.type&&(e.type=this.type.toJSON()),e}}lo.CLASS_NAME="QCStatement";class ch extends G{constructor(e={}){super(),this.values=m(e,Ho,ch.defaultValues(Ho)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ho:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ho:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new Re({name:t.values||S,value:lo.schema(t.value||{})})]})}fromSchema(e){W(e,OE);const t=j(e,e,ch.schema({names:{values:Ho}}));M.assertSchema(t,this.className),this.values=Array.from(t.result.values,r=>new lo({schema:r}))}toSchema(){return new E({value:Array.from(this.values,e=>e.toSchema())})}toJSON(){return{values:Array.from(this.values,e=>e.toJSON())}}}ch.CLASS_NAME="QCStatements";var ri;class Rn{static register(e,t,r){this.namedCurves[e.toLowerCase()]=this.namedCurves[t]={name:e,id:t,size:r}}static find(e){return this.namedCurves[e.toLowerCase()]||null}}ri=Rn;Rn.namedCurves={};ri.register("P-256","1.2.840.10045.3.1.7",32),ri.register("P-384","1.3.132.0.34",48),ri.register("P-521","1.3.132.0.35",66),ri.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),ri.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),ri.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);const Vh="x",$h="y",Dh="namedCurve";class wr extends G{constructor(e={}){super(),this.x=m(e,Vh,wr.defaultValues(Vh)),this.y=m(e,$h,wr.defaultValues($h)),this.namedCurve=m(e,Dh,wr.defaultValues(Dh)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vh:case $h:return Ot;case Dh:return S;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Vh:case $h:return t instanceof ArrayBuffer&&wu(t,wr.defaultValues(e));case Dh:return typeof t=="string"&&t===wr.defaultValues(e);default:return super.defaultValues(e)}}static schema(){return new Y0}fromSchema(e){const t=Se.toUint8Array(e);if(t[0]!==4)throw new Error("Object's schema was not verified against input data for ECPublicKey");const r=Rn.find(this.namedCurve);if(!r)throw new Error(`Incorrect curve OID: ${this.namedCurve}`);const a=r.size;if(t.byteLength!==a*2+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.namedCurve=r.name,this.x=t.slice(1,a+1).buffer,this.y=t.slice(1+a,a*2+1).buffer}toSchema(){return new Y0({data:ou(new Uint8Array([4]).buffer,this.x,this.y)})}toJSON(){const e=Rn.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:Lg(W0(this.x),!0,!0,!1),y:Lg(W0(this.y),!0,!0,!1)}}fromJSON(e){Fe.assert("json",e,"crv","x","y");let t=0;const r=Rn.find(e.crv);r&&(this.namedCurve=r.id,t=r.size);const a=Su(rh(e.x,!0));if(a.byteLength<t){this.x=new ArrayBuffer(t);const i=new Uint8Array(this.x),o=new Uint8Array(a);i.set(o,1)}else this.x=a.slice(0,t);const n=Su(rh(e.y,!0));if(n.byteLength<t){this.y=new ArrayBuffer(t);const i=new Uint8Array(this.y),o=new Uint8Array(n);i.set(o,1)}else this.y=n.slice(0,t)}}wr.CLASS_NAME="ECPublicKey";const mc="modulus",pc="publicExponent",PE=[mc,pc];class uo extends G{constructor(e={}){super(),this.modulus=m(e,mc,uo.defaultValues(mc)),this.publicExponent=m(e,pc,uo.defaultValues(pc)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mc:return new D;case pc:return new D;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new D({name:t.modulus||S}),new D({name:t.publicExponent||S})]})}fromSchema(e){W(e,PE);const t=j(e,e,uo.schema({names:{modulus:mc,publicExponent:pc}}));M.assertSchema(t,this.className),this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}toSchema(){return new E({value:[this.modulus.convertToDER(),this.publicExponent]})}toJSON(){return{n:Ee.ToBase64Url(this.modulus.valueBlock.valueHexView),e:Ee.ToBase64Url(this.publicExponent.valueBlock.valueHexView)}}fromJSON(e){Fe.assert("json",e,"n","e");const t=Su(rh(e.n,!0));this.modulus=new D({valueHex:t.slice(0,Math.pow(2,ib(t.byteLength)))}),this.publicExponent=new D({valueHex:Su(rh(e.e,!0)).slice(0,3)})}}uo.CLASS_NAME="RSAPublicKey";const yc="algorithm",vc="subjectPublicKey",UE=[yc,vc];class Ar extends G{get parsedKey(){if(this._parsedKey===void 0){switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===fe.blockName())try{this._parsedKey=new wr({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHexView})}catch{}break;case"1.2.840.113549.1.1.1":{const e=Lt(this.subjectPublicKey.valueBlock.valueHexView);if(e.offset!==-1)try{this._parsedKey=new uo({schema:e.result})}catch{}}break}this._parsedKey||(this._parsedKey=null)}return this._parsedKey||void 0}set parsedKey(e){this._parsedKey=e}constructor(e={}){super(),this.algorithm=m(e,yc,Ar.defaultValues(yc)),this.subjectPublicKey=m(e,vc,Ar.defaultValues(vc));const t=m(e,"parsedKey",null);t&&(this.parsedKey=t),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case yc:return new V;case vc:return new Pe;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[V.schema(t.algorithm||{}),new Pe({name:t.subjectPublicKey||S})]})}fromSchema(e){W(e,UE);const t=j(e,e,Ar.schema({names:{algorithm:{names:{blockName:yc}},subjectPublicKey:vc}}));M.assertSchema(t,this.className),this.algorithm=new V({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey}toSchema(){return new E({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}toJSON(){if(!this.parsedKey)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};const e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new wr({json:e}),this.algorithm=new V({algorithmId:"1.2.840.10045.2.1",algorithmParams:new fe({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new uo({json:e}),this.algorithm=new V({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new kt});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.subjectPublicKey=new Pe({valueHex:this.parsedKey.toSchema().toBER(!1)})}}async importKey(e,t=Ve(!0)){try{if(!e)throw new Error("Need to provide publicKey input parameter");const r=await t.exportKey("spki",e),a=Lt(r);try{this.fromSchema(a.result)}catch{throw new Error("Error during initializing object from schema")}}catch(r){const a=r instanceof Error?r.message:`${r}`;throw new Error(`Error during exporting public key: ${a}`)}}}Ar.CLASS_NAME="PublicKeyInfo";const Ko="version",Fo="privateKey",ss="namedCurve",Ua="publicKey",ME=[Ko,Fo,ss,Ua];class Jr extends G{constructor(e={}){super(),this.version=m(e,Ko,Jr.defaultValues(Ko)),this.privateKey=m(e,Fo,Jr.defaultValues(Fo)),ss in e&&(this.namedCurve=m(e,ss,Jr.defaultValues(ss))),Ua in e&&(this.publicKey=m(e,Ua,Jr.defaultValues(Ua))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ko:return 1;case Fo:return new z;case ss:return S;case Ua:return new wr;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ko:return t===Jr.defaultValues(e);case Fo:return t.isEqual(Jr.defaultValues(e));case ss:return t===S;case Ua:return wr.compareWithDefault(ss,t.namedCurve)&&wr.compareWithDefault("x",t.x)&&wr.compareWithDefault("y",t.y);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new D({name:t.version||S}),new z({name:t.privateKey||S}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new fe({name:t.namedCurve||S})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Pe({name:t.publicKey||S})]})]})}fromSchema(e){W(e,ME);const t=j(e,e,Jr.schema({names:{version:Ko,privateKey:Fo,namedCurve:ss,publicKey:Ua}}));if(M.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,ss in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),Ua in t.result){const r={schema:t.result.publicKey.valueBlock.valueHex};ss in this&&(r.namedCurve=this.namedCurve),this.publicKey=new wr(r)}}toSchema(){const e=[new D({value:this.version}),this.privateKey];return this.namedCurve&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[new fe({value:this.namedCurve})]})),this.publicKey&&e.push(new T({idBlock:{tagClass:3,tagNumber:1},value:[new Pe({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new E({value:e})}toJSON(){if(!this.namedCurve||Jr.compareWithDefault(ss,this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');const e=Rn.find(this.namedCurve),t={crv:e?e.name:this.namedCurve,d:Ee.ToBase64Url(this.privateKey.valueBlock.valueHexView)};if(this.publicKey){const r=this.publicKey.toJSON();t.x=r.x,t.y=r.y}return t}fromJSON(e){Fe.assert("json",e,"crv","d");let t=0;const r=Rn.find(e.crv);r&&(this.namedCurve=r.id,t=r.size);const a=Ee.FromBase64Url(e.d);if(a.byteLength<t){const n=new ArrayBuffer(t),i=new Uint8Array(n),o=new Uint8Array(a);i.set(o,1),this.privateKey=new z({valueHex:n})}else this.privateKey=new z({valueHex:a.slice(0,t)});e.x&&e.y&&(this.publicKey=new wr({json:e}))}}Jr.CLASS_NAME="ECPrivateKey";const wc="prime",Sc="exponent",Cc="coefficient",HE=[wc,Sc,Cc];class aa extends G{constructor(e={}){super(),this.prime=m(e,wc,aa.defaultValues(wc)),this.exponent=m(e,Sc,aa.defaultValues(Sc)),this.coefficient=m(e,Cc,aa.defaultValues(Cc)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wc:return new D;case Sc:return new D;case Cc:return new D;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new D({name:t.prime||S}),new D({name:t.exponent||S}),new D({name:t.coefficient||S})]})}fromSchema(e){W(e,HE);const t=j(e,e,aa.schema({names:{prime:wc,exponent:Sc,coefficient:Cc}}));M.assertSchema(t,this.className),this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}toSchema(){return new E({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}toJSON(){return{r:Ee.ToBase64Url(this.prime.valueBlock.valueHexView),d:Ee.ToBase64Url(this.exponent.valueBlock.valueHexView),t:Ee.ToBase64Url(this.coefficient.valueBlock.valueHexView)}}fromJSON(e){Fe.assert("json",e,"r","d","r"),this.prime=new D({valueHex:Ee.FromBase64Url(e.r)}),this.exponent=new D({valueHex:Ee.FromBase64Url(e.d)}),this.coefficient=new D({valueHex:Ee.FromBase64Url(e.t)})}}aa.CLASS_NAME="OtherPrimeInfo";const Ac="version",bc="modulus",Ec="publicExponent",xc="privateExponent",Bc="prime1",Ic="prime2",kc="exponent1",Nc="exponent2",Tc="coefficient",si="otherPrimeInfos",KE=[Ac,bc,Ec,xc,Bc,Ic,kc,Nc,Tc,si];class gr extends G{constructor(e={}){super(),this.version=m(e,Ac,gr.defaultValues(Ac)),this.modulus=m(e,bc,gr.defaultValues(bc)),this.publicExponent=m(e,Ec,gr.defaultValues(Ec)),this.privateExponent=m(e,xc,gr.defaultValues(xc)),this.prime1=m(e,Bc,gr.defaultValues(Bc)),this.prime2=m(e,Ic,gr.defaultValues(Ic)),this.exponent1=m(e,kc,gr.defaultValues(kc)),this.exponent2=m(e,Nc,gr.defaultValues(Nc)),this.coefficient=m(e,Tc,gr.defaultValues(Tc)),si in e&&(this.otherPrimeInfos=m(e,si,gr.defaultValues(si))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ac:return 0;case bc:return new D;case Ec:return new D;case xc:return new D;case Bc:return new D;case Ic:return new D;case kc:return new D;case Nc:return new D;case Tc:return new D;case si:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new D({name:t.version||S}),new D({name:t.modulus||S}),new D({name:t.publicExponent||S}),new D({name:t.privateExponent||S}),new D({name:t.prime1||S}),new D({name:t.prime2||S}),new D({name:t.exponent1||S}),new D({name:t.exponent2||S}),new D({name:t.coefficient||S}),new E({optional:!0,value:[new Re({name:t.otherPrimeInfosName||S,value:aa.schema(t.otherPrimeInfo||{})})]})]})}fromSchema(e){W(e,KE);const t=j(e,e,gr.schema({names:{version:Ac,modulus:bc,publicExponent:Ec,privateExponent:xc,prime1:Bc,prime2:Ic,exponent1:kc,exponent2:Nc,coefficient:Tc,otherPrimeInfo:{names:{blockName:si}}}}));M.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),si in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,r=>new aa({schema:r})))}toSchema(){const e=[];return e.push(new D({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),this.otherPrimeInfos&&e.push(new E({value:Array.from(this.otherPrimeInfos,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={n:Ee.ToBase64Url(this.modulus.valueBlock.valueHexView),e:Ee.ToBase64Url(this.publicExponent.valueBlock.valueHexView),d:Ee.ToBase64Url(this.privateExponent.valueBlock.valueHexView),p:Ee.ToBase64Url(this.prime1.valueBlock.valueHexView),q:Ee.ToBase64Url(this.prime2.valueBlock.valueHexView),dp:Ee.ToBase64Url(this.exponent1.valueBlock.valueHexView),dq:Ee.ToBase64Url(this.exponent2.valueBlock.valueHexView),qi:Ee.ToBase64Url(this.coefficient.valueBlock.valueHexView)};return this.otherPrimeInfos&&(e.oth=Array.from(this.otherPrimeInfos,t=>t.toJSON())),e}fromJSON(e){Fe.assert("json",e,"n","e","d","p","q","dp","dq","qi"),this.modulus=new D({valueHex:Ee.FromBase64Url(e.n)}),this.publicExponent=new D({valueHex:Ee.FromBase64Url(e.e)}),this.privateExponent=new D({valueHex:Ee.FromBase64Url(e.d)}),this.prime1=new D({valueHex:Ee.FromBase64Url(e.p)}),this.prime2=new D({valueHex:Ee.FromBase64Url(e.q)}),this.exponent1=new D({valueHex:Ee.FromBase64Url(e.dp)}),this.exponent2=new D({valueHex:Ee.FromBase64Url(e.dq)}),this.coefficient=new D({valueHex:Ee.FromBase64Url(e.qi)}),e.oth&&(this.otherPrimeInfos=Array.from(e.oth,t=>new aa({json:t})))}}gr.CLASS_NAME="RSAPrivateKey";const _c="version",Rc="privateKeyAlgorithm",Vc="privateKey",ai="attributes",Lh="parsedKey",FE=[_c,Rc,Vc,ai];class Wr extends G{constructor(e={}){super(),this.version=m(e,_c,Wr.defaultValues(_c)),this.privateKeyAlgorithm=m(e,Rc,Wr.defaultValues(Rc)),this.privateKey=m(e,Vc,Wr.defaultValues(Vc)),ai in e&&(this.attributes=m(e,ai,Wr.defaultValues(ai))),Lh in e&&(this.parsedKey=m(e,Lh,Wr.defaultValues(Lh))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _c:return 0;case Rc:return new V;case Vc:return new z;case ai:return[];case Lh:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new D({name:t.version||S}),V.schema(t.privateKeyAlgorithm||{}),new z({name:t.privateKey||S}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Re({name:t.attributes||S,value:gt.schema()})]})]})}fromSchema(e){W(e,FE);const t=j(e,e,Wr.schema({names:{version:_c,privateKeyAlgorithm:{names:{blockName:Rc}},privateKey:Vc,attributes:ai}}));switch(M.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new V({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,ai in t.result&&(this.attributes=Array.from(t.result.attributes,r=>new gt({schema:r}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{const r=Lt(this.privateKey.valueBlock.valueHexView);r.offset!==-1&&(this.parsedKey=new gr({schema:r.result}))}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof fe){const r=Lt(this.privateKey.valueBlock.valueHexView);r.offset!==-1&&(this.parsedKey=new Jr({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:r.result}))}break}}toSchema(){const e=[new D({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return this.attributes&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,t=>t.toSchema())})),new E({value:e})}toJSON(){if(!this.parsedKey){const r={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return this.attributes&&(r.attributes=Array.from(this.attributes,a=>a.toJSON())),r}const e={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Jr({json:e}),this.privateKeyAlgorithm=new V({algorithmId:"1.2.840.10045.2.1",algorithmParams:new fe({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new gr({json:e}),this.privateKeyAlgorithm=new V({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new kt});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.privateKey=new z({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}Wr.CLASS_NAME="PrivateKeyInfo";const qo="contentType",Jo="contentEncryptionAlgorithm",ni="encryptedContent",qE=[qo,Jo,ni],qp=1024;class _t extends G{constructor(e={}){if(super(),this.contentType=m(e,qo,_t.defaultValues(qo)),this.contentEncryptionAlgorithm=m(e,Jo,_t.defaultValues(Jo)),ni in e&&e.encryptedContent&&(this.encryptedContent=e.encryptedContent,this.encryptedContent.idBlock.tagClass===1&&this.encryptedContent.idBlock.tagNumber===4&&this.encryptedContent.idBlock.isConstructed===!1&&!e.disableSplit)){const t=new z({idBlock:{isConstructed:!0},isConstructed:!0});let r=0;const a=this.encryptedContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const i=new Uint8Array(a,r,r+qp>a.byteLength?a.byteLength-r:qp),o=new ArrayBuffer(i.length),l=new Uint8Array(o);for(let u=0;u<l.length;u++)l[u]=i[u];t.valueBlock.value.push(new z({valueHex:o})),n-=i.length,r+=i.length}this.encryptedContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case qo:return S;case Jo:return new V;case ni:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case qo:return t===S;case Jo:return t.algorithmId===S&&!("algorithmParams"in t);case ni:return t.isEqual(_t.defaultValues(ni));default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.contentType||S}),V.schema(t.contentEncryptionAlgorithm||{}),new St({value:[new T({name:t.encryptedContent||S,idBlock:{tagClass:3,tagNumber:0},value:[new Re({value:new z})]}),new Be({name:t.encryptedContent||S,idBlock:{tagClass:3,tagNumber:0}})]})]})}fromSchema(e){W(e,qE);const t=j(e,e,_t.schema({names:{contentType:qo,contentEncryptionAlgorithm:{names:{blockName:Jo}},encryptedContent:ni}}));M.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new V({schema:t.result.contentEncryptionAlgorithm}),ni in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}toSchema(){const e={isIndefiniteForm:!1},t=[];if(t.push(new fe({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),this.encryptedContent){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;const r=this.encryptedContent;r.idBlock.tagClass=3,r.idBlock.tagNumber=0,r.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(r)}return new E({lenBlock:e,value:t})}toJSON(){const e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return this.encryptedContent&&(e.encryptedContent=this.encryptedContent.toJSON()),e}getEncryptedContent(){if(!this.encryptedContent)throw new Error("Parameter 'encryptedContent' is undefined");return z.prototype.getValue.call(this.encryptedContent)}}_t.CLASS_NAME="EncryptedContentInfo";const Ma="hashAlgorithm",Ha="maskGenAlgorithm",Ka="saltLength",Fa="trailerField",JE=[Ma,Ha,Ka,Fa];class Yt extends G{constructor(e={}){super(),this.hashAlgorithm=m(e,Ma,Yt.defaultValues(Ma)),this.maskGenAlgorithm=m(e,Ha,Yt.defaultValues(Ha)),this.saltLength=m(e,Ka,Yt.defaultValues(Ka)),this.trailerField=m(e,Fa,Yt.defaultValues(Fa)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ma:return new V({algorithmId:"1.3.14.3.2.26",algorithmParams:new kt});case Ha:return new V({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new V({algorithmId:"1.3.14.3.2.26",algorithmParams:new kt}).toSchema()});case Ka:return 20;case Fa:return 1;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new T({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[V.schema(t.hashAlgorithm||{})]}),new T({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[V.schema(t.maskGenAlgorithm||{})]}),new T({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new D({name:t.saltLength||S})]}),new T({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new D({name:t.trailerField||S})]})]})}fromSchema(e){W(e,JE);const t=j(e,e,Yt.schema({names:{hashAlgorithm:{names:{blockName:Ma}},maskGenAlgorithm:{names:{blockName:Ha}},saltLength:Ka,trailerField:Fa}}));M.assertSchema(t,this.className),Ma in t.result&&(this.hashAlgorithm=new V({schema:t.result.hashAlgorithm})),Ha in t.result&&(this.maskGenAlgorithm=new V({schema:t.result.maskGenAlgorithm})),Ka in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),Fa in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}toSchema(){const e=[];return this.hashAlgorithm.isEqual(Yt.defaultValues(Ma))||e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(Yt.defaultValues(Ha))||e.push(new T({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==Yt.defaultValues(Ka)&&e.push(new T({idBlock:{tagClass:3,tagNumber:2},value:[new D({value:this.saltLength})]})),this.trailerField!==Yt.defaultValues(Fa)&&e.push(new T({idBlock:{tagClass:3,tagNumber:3},value:[new D({value:this.trailerField})]})),new E({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(Yt.defaultValues(Ma))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(Yt.defaultValues(Ha))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==Yt.defaultValues(Ka)&&(e.saltLength=this.saltLength),this.trailerField!==Yt.defaultValues(Fa)&&(e.trailerField=this.trailerField),e}}Yt.CLASS_NAME="RSASSAPSSParams";const Go="salt",$c="iterationCount",as="keyLength",Ws="prf",GE=[Go,$c,as,Ws];class fr extends G{constructor(e={}){super(),this.salt=m(e,Go,fr.defaultValues(Go)),this.iterationCount=m(e,$c,fr.defaultValues($c)),as in e&&(this.keyLength=m(e,as,fr.defaultValues(as))),Ws in e&&(this.prf=m(e,Ws,fr.defaultValues(Ws))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Go:return{};case $c:return-1;case as:return 0;case Ws:return new V({algorithmId:"1.3.14.3.2.26",algorithmParams:new kt});default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new St({value:[new z({name:t.saltPrimitive||S}),V.schema(t.saltConstructed||{})]}),new D({name:t.iterationCount||S}),new D({name:t.keyLength||S,optional:!0}),V.schema(t.prf||{names:{optional:!0}})]})}fromSchema(e){W(e,GE);const t=j(e,e,fr.schema({names:{saltPrimitive:Go,saltConstructed:{names:{blockName:Go}},iterationCount:$c,keyLength:as,prf:{names:{blockName:Ws,optional:!0}}}}));M.assertSchema(t,this.className),this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,as in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),Ws in t.result&&(this.prf=new V({schema:t.result.prf}))}toSchema(){const e=[];return e.push(this.salt),e.push(new D({value:this.iterationCount})),as in this&&fr.defaultValues(as)!==this.keyLength&&e.push(new D({value:this.keyLength})),this.prf&&fr.defaultValues(Ws).isEqual(this.prf)===!1&&e.push(this.prf.toSchema()),new E({value:e})}toJSON(){const e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return as in this&&fr.defaultValues(as)!==this.keyLength&&(e.keyLength=this.keyLength),this.prf&&fr.defaultValues(Ws).isEqual(this.prf)===!1&&(e.prf=this.prf.toJSON()),e}}fr.CLASS_NAME="PBKDF2Params";const Dc="keyDerivationFunc",Lc="encryptionScheme",jE=[Dc,Lc];class co extends G{constructor(e={}){super(),this.keyDerivationFunc=m(e,Dc,co.defaultValues(Dc)),this.encryptionScheme=m(e,Lc,co.defaultValues(Lc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Dc:return new V;case Lc:return new V;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[V.schema(t.keyDerivationFunc||{}),V.schema(t.encryptionScheme||{})]})}fromSchema(e){W(e,jE);const t=j(e,e,co.schema({names:{keyDerivationFunc:{names:{blockName:Dc}},encryptionScheme:{names:{blockName:Lc}}}}));M.assertSchema(t,this.className),this.keyDerivationFunc=new V({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new V({schema:t.result.encryptionScheme})}toSchema(){return new E({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}toJSON(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}co.CLASS_NAME="PBES2Params";class WE{constructor(e){this.crypto=e.crypto,this.subtle="webkitSubtle"in e.crypto?e.crypto.webkitSubtle:e.crypto.subtle,this.name=m(e,"name",S)}async encrypt(...e){return this.subtle.encrypt(...e)}async decrypt(...e){return this.subtle.decrypt(...e)}sign(...e){return this.subtle.sign(...e)}async verify(...e){return this.subtle.verify(...e)}async digest(...e){return this.subtle.digest(...e)}async generateKey(...e){return this.subtle.generateKey(...e)}async deriveKey(...e){return this.subtle.deriveKey(...e)}async deriveBits(...e){return this.subtle.deriveBits(...e)}async wrapKey(...e){return this.subtle.wrapKey(...e)}async unwrapKey(...e){return this.subtle.unwrapKey(...e)}exportKey(...e){return this.subtle.exportKey(...e)}importKey(...e){return this.subtle.importKey(...e)}getRandomValues(e){return this.crypto.getRandomValues(e)}}async function Jp(s,e,t,r,a){let n,i,o;switch(s.toUpperCase()){case"SHA-1":n=20,i=64,o=Ib;break;case"SHA-256":n=32,i=64,o=qb;break;case"SHA-384":n=48,i=128,o=Gb;break;case"SHA-512":n=64,i=128,o=Jb;break;default:throw new Error("Unsupported hashing algorithm")}const l=new Uint8Array(t);let u=new TextDecoder().decode(t);new TextEncoder().encode(u).some((N,_)=>N!==l[_])&&(u=String.fromCharCode(...l));const f=new Uint8Array(u.length*2+2),g=new DataView(f.buffer);for(let N=0;N<u.length;N++)g.setUint16(N*2,u.charCodeAt(N),!1);g.setUint16(u.length*2,0,!1);const v=new Uint8Array(i).fill(3),p=new Uint8Array(r),h=new Uint8Array(i*Math.ceil(p.length/i)).map((N,_)=>p[_%p.length]),d=new Uint8Array(i*Math.ceil(f.length/i)).map((N,_)=>f[_%f.length]);let y=new Uint8Array(h.length+d.length);y.set(h),y.set(d,h.length);const A=Math.ceil((e>>3)/n),x=[];for(let N=0;N<A;N++){let _=new Uint8Array(v.length+y.length);_.set(v),_.set(y,v.length);for(let me=0;me<a;me++)_=o(_);const $=new Uint8Array(i).map((me,Ce)=>_[Ce%_.length]),se=Math.ceil(p.length/i)+Math.ceil(f.length/i),te=[];for(let me=0;me<se;me++){const Ce=Array.from(y.slice(me*i,(me+1)*i));let pe=511;for(let ve=$.length-1;ve>=0;ve--)pe>>=8,pe+=$[ve]+(Ce[ve]||0),Ce[ve]=pe&255;te.push(...Ce)}y=new Uint8Array(te),x.push(..._)}return new Uint8Array(x.slice(0,e>>3)).buffer}function U1(s){const e=typeof s=="string"?{name:s}:s;return"hash"in e?{...e,hash:U1(e.hash)}:e}class z0 extends WE{async importKey(e,t,r,a,n){var i,o,l,u,c,f;let g={};const v=U1(r);switch(e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,r,a,n);case"spki":{const p=Lt(Se.toArrayBuffer(t));M.assert(p,"keyData");const h=new Ar;try{h.fromSchema(p.result)}catch{throw new tt("Incorrect keyData")}switch(v.name.toUpperCase()){case"RSA-PSS":{if(!v.hash)throw new Fe("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(v.hash.name.toUpperCase()){case"SHA-1":g.alg="PS1";break;case"SHA-256":g.alg="PS256";break;case"SHA-384":g.alg="PS384";break;case"SHA-512":g.alg="PS512";break;default:throw new Error(`Incorrect hash algorithm: ${v.hash.name.toUpperCase()}`)}}case"RSASSA-PKCS1-V1_5":{if(n=["verify"],g.kty="RSA",g.ext=a,g.key_ops=n,h.algorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error(`Incorrect public key algorithm: ${h.algorithm.algorithmId}`);if(!g.alg){if(!v.hash)throw new Fe("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(v.hash.name.toUpperCase()){case"SHA-1":g.alg="RS1";break;case"SHA-256":g.alg="RS256";break;case"SHA-384":g.alg="RS384";break;case"SHA-512":g.alg="RS512";break;default:throw new Error(`Incorrect hash algorithm: ${v.hash.name.toUpperCase()}`)}}const d=h.toJSON();Object.assign(g,d)}break;case"ECDSA":n=["verify"];case"ECDH":{if(g={kty:"EC",ext:a,key_ops:n},h.algorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error(`Incorrect public key algorithm: ${h.algorithm.algorithmId}`);const d=h.toJSON();Object.assign(g,d)}break;case"RSA-OAEP":{if(g.kty="RSA",g.ext=a,g.key_ops=n,this.name.toLowerCase()==="safari")g.alg="RSA-OAEP";else{if(!v.hash)throw new Fe("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(v.hash.name.toUpperCase()){case"SHA-1":g.alg="RSA-OAEP";break;case"SHA-256":g.alg="RSA-OAEP-256";break;case"SHA-384":g.alg="RSA-OAEP-384";break;case"SHA-512":g.alg="RSA-OAEP-512";break;default:throw new Error(`Incorrect hash algorithm: ${v.hash.name.toUpperCase()}`)}}const d=h.toJSON();Object.assign(g,d)}break;case"RSAES-PKCS1-V1_5":{g.kty="RSA",g.ext=a,g.key_ops=n,g.alg="PS1";const d=h.toJSON();Object.assign(g,d)}break;default:throw new Error(`Incorrect algorithm name: ${v.name.toUpperCase()}`)}}break;case"pkcs8":{const p=new Wr,h=Lt(Se.toArrayBuffer(t));M.assert(h,"keyData");try{p.fromSchema(h.result)}catch{throw new Error("Incorrect keyData")}if(!p.parsedKey)throw new Error("Incorrect keyData");switch(v.name.toUpperCase()){case"RSA-PSS":switch((i=v.hash)===null||i===void 0?void 0:i.name.toUpperCase()){case"SHA-1":g.alg="PS1";break;case"SHA-256":g.alg="PS256";break;case"SHA-384":g.alg="PS384";break;case"SHA-512":g.alg="PS512";break;default:throw new Error(`Incorrect hash algorithm: ${(o=v.hash)===null||o===void 0?void 0:o.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":{if(n=["sign"],g.kty="RSA",g.ext=a,g.key_ops=n,p.privateKeyAlgorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error(`Incorrect private key algorithm: ${p.privateKeyAlgorithm.algorithmId}`);if(!("alg"in g))switch((l=v.hash)===null||l===void 0?void 0:l.name.toUpperCase()){case"SHA-1":g.alg="RS1";break;case"SHA-256":g.alg="RS256";break;case"SHA-384":g.alg="RS384";break;case"SHA-512":g.alg="RS512";break;default:throw new Error(`Incorrect hash algorithm: ${(u=v.hash)===null||u===void 0?void 0:u.name.toUpperCase()}`)}const d=p.toJSON();Object.assign(g,d)}break;case"ECDSA":n=["sign"];case"ECDH":{if(g={kty:"EC",ext:a,key_ops:n},p.privateKeyAlgorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error(`Incorrect algorithm: ${p.privateKeyAlgorithm.algorithmId}`);const d=p.toJSON();Object.assign(g,d)}break;case"RSA-OAEP":{if(g.kty="RSA",g.ext=a,g.key_ops=n,this.name.toLowerCase()==="safari")g.alg="RSA-OAEP";else switch((c=v.hash)===null||c===void 0?void 0:c.name.toUpperCase()){case"SHA-1":g.alg="RSA-OAEP";break;case"SHA-256":g.alg="RSA-OAEP-256";break;case"SHA-384":g.alg="RSA-OAEP-384";break;case"SHA-512":g.alg="RSA-OAEP-512";break;default:throw new Error(`Incorrect hash algorithm: ${(f=v.hash)===null||f===void 0?void 0:f.name.toUpperCase()}`)}const d=p.toJSON();Object.assign(g,d)}break;case"RSAES-PKCS1-V1_5":{n=["decrypt"],g.kty="RSA",g.ext=a,g.key_ops=n,g.alg="PS1";const d=p.toJSON();Object.assign(g,d)}break;default:throw new Error(`Incorrect algorithm name: ${v.name.toUpperCase()}`)}}break;case"jwk":g=t;break;default:throw new Error(`Incorrect format: ${e}`)}if(this.name.toLowerCase()==="safari")try{return this.subtle.importKey("jwk",Su(JSON.stringify(g)),r,a,n)}catch{return this.subtle.importKey("jwk",g,r,a,n)}return this.subtle.importKey("jwk",g,r,a,n)}async exportKey(e,t){let r=await this.subtle.exportKey("jwk",t);switch(this.name.toLowerCase()==="safari"&&r instanceof ArrayBuffer&&(r=JSON.parse(W0(r))),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":{const a=new Ar;try{a.fromJSON(r)}catch{throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"pkcs8":{const a=new Wr;try{a.fromJSON(r)}catch{throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"jwk":return r;default:throw new Error(`Incorrect format: ${e}`)}}async convert(e,t,r,a,n,i){if(e.toLowerCase()===t.toLowerCase())return r;const o=await this.importKey(e,r,a,n,i);return this.exportKey(t,o)}getAlgorithmByOID(e,t=!1,r){switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}if(t)throw new Error(`Unsupported algorithm identifier ${r?`for ${r} `:S}: ${e}`);return{}}getOIDByAlgorithm(e,t=!1,r){let a=S;switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":a="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.1.1.5";break;case"SHA-256":a="1.2.840.113549.1.1.11";break;case"SHA-384":a="1.2.840.113549.1.1.12";break;case"SHA-512":a="1.2.840.113549.1.1.13";break}break;case"RSA-PSS":a="1.2.840.113549.1.1.10";break;case"RSA-OAEP":a="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.10045.4.1";break;case"SHA-256":a="1.2.840.10045.4.3.2";break;case"SHA-384":a="1.2.840.10045.4.3.3";break;case"SHA-512":a="1.2.840.10045.4.3.4";break}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":a="1.3.133.16.840.63.0.2";break;case"SHA-256":a="1.3.132.1.11.1";break;case"SHA-384":a="1.3.132.1.11.2";break;case"SHA-512":a="1.3.132.1.11.3";break}break;case"AES-CTR":break;case"AES-CBC":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.2";break;case 192:a="2.16.840.1.101.3.4.1.22";break;case 256:a="2.16.840.1.101.3.4.1.42";break}break;case"AES-CMAC":break;case"AES-GCM":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.6";break;case 192:a="2.16.840.1.101.3.4.1.26";break;case 256:a="2.16.840.1.101.3.4.1.46";break}break;case"AES-CFB":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.4";break;case 192:a="2.16.840.1.101.3.4.1.24";break;case 256:a="2.16.840.1.101.3.4.1.44";break}break;case"AES-KW":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.5";break;case 192:a="2.16.840.1.101.3.4.1.25";break;case 256:a="2.16.840.1.101.3.4.1.45";break}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.2.7";break;case"SHA-256":a="1.2.840.113549.2.9";break;case"SHA-384":a="1.2.840.113549.2.10";break;case"SHA-512":a="1.2.840.113549.2.11";break}break;case"DH":a="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":a="1.3.14.3.2.26";break;case"SHA-256":a="2.16.840.1.101.3.4.2.1";break;case"SHA-384":a="2.16.840.1.101.3.4.2.2";break;case"SHA-512":a="2.16.840.1.101.3.4.2.3";break;case"CONCAT":break;case"HKDF":break;case"PBKDF2":a="1.2.840.113549.1.5.12";break;case"P-256":a="1.2.840.10045.3.1.7";break;case"P-384":a="1.3.132.0.34";break;case"P-521":a="1.3.132.0.35";break}if(!a&&t)throw new Error(`Unsupported algorithm ${r?`for ${r} `:S}: ${e.name}`);return a}getAlgorithmParameters(e,t){let r={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":r={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":r={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":r={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":r={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;case"exportkey":default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":r={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":r={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":r={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":r={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":switch(t.toLowerCase()){case"derivekey":r={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"HKDF"},usages:[]}}break;case"PBKDF2":switch(t.toLowerCase()){case"derivekey":r={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"PBKDF2"},usages:[]}}break}return r}getHashAlgorithm(e){let t=S;switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{const r=new Yt({schema:e.algorithmParams});if(r.hashAlgorithm){const a=this.getAlgorithmByOID(r.hashAlgorithm.algorithmId);if("name"in a)t=a.name;else return S}else t="SHA-1"}catch{}break}return t}async encryptEncryptedContentInfo(e){Fe.assert(e,"password","contentEncryptionAlgorithm","hmacHashAlgorithm","iterationCount","contentToEncrypt","contentToEncrypt","contentType");const t=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm,!0,"contentEncryptionAlgorithm"),r=this.getOIDByAlgorithm({name:"PBKDF2"},!0,"PBKDF2"),a=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),n=new ArrayBuffer(16),i=new Uint8Array(n);this.getRandomValues(i);const o=new ArrayBuffer(64),l=new Uint8Array(o);this.getRandomValues(l);const u=new Uint8Array(e.contentToEncrypt),c=new fr({salt:new z({valueHex:o}),iterationCount:e.iterationCount,prf:new V({algorithmId:a,algorithmParams:new kt})}),f=new Uint8Array(e.password),g=await this.importKey("raw",f,"PBKDF2",!1,["deriveKey"]),v=await this.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:l,iterations:e.iterationCount},g,e.contentEncryptionAlgorithm,!1,["encrypt"]),p=await this.encrypt({name:e.contentEncryptionAlgorithm.name,iv:i},v,u),h=new co({keyDerivationFunc:new V({algorithmId:r,algorithmParams:c.toSchema()}),encryptionScheme:new V({algorithmId:t,algorithmParams:new z({valueHex:n})})});return new _t({contentType:e.contentType,contentEncryptionAlgorithm:new V({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:h.toSchema()}),encryptedContent:new z({valueHex:p})})}async decryptEncryptedContentInfo(e){if(Fe.assert(e,"password","encryptedContentInfo"),e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId!=="1.2.840.113549.1.5.13")throw new Error(`Unknown "contentEncryptionAlgorithm": ${e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId}`);let t;try{t=new co({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch{throw new Error('Incorrectly encoded "pbes2Parameters"')}let r;try{r=new fr({schema:t.keyDerivationFunc.algorithmParams})}catch{throw new Error('Incorrectly encoded "pbkdf2Params"')}const a=this.getAlgorithmByOID(t.encryptionScheme.algorithmId,!0),n=t.encryptionScheme.algorithmParams.valueBlock.valueHex,i=new Uint8Array(n),o=r.salt.valueBlock.valueHex,l=new Uint8Array(o),u=r.iterationCount;let c="SHA-1";r.prf&&(c=this.getAlgorithmByOID(r.prf.algorithmId,!0).hash.name);const f=await this.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"]),g=await this.deriveKey({name:"PBKDF2",hash:{name:c},salt:l,iterations:u},f,a,!1,["decrypt"]),v=e.encryptedContentInfo.getEncryptedContent();return this.decrypt({name:a.name,iv:i},g,v)}async stampDataWithPassword(e){if(!(e instanceof Object))throw new Error('Parameters must have type "Object"');Fe.assert(e,"password","hashAlgorithm","iterationCount","salt","contentToStamp");let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}const r={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await Jp(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),r,!1,["sign"]);return this.sign(r,n,new Uint8Array(e.contentToStamp))}async verifyDataStampedWithPassword(e){Fe.assert(e,"password","hashAlgorithm","salt","iterationCount","contentToVerify","signatureToVerify");let t=0;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error(`Incorrect "parameters.hashAlgorithm" parameter: ${e.hashAlgorithm}`)}const r={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await Jp(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),r,!1,["verify"]);return this.verify(r,n,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify))}async getSignatureParameters(e,t="SHA-1"){this.getOIDByAlgorithm({name:t},!0,"hashAlgorithm");const r=new V,a=this.getAlgorithmParameters(e.algorithm.name,"sign");if(!Object.keys(a.algorithm).length)throw new Error("Parameter 'algorithm' is empty");const n=a.algorithm;switch("hash"in e.algorithm&&e.algorithm.hash&&e.algorithm.hash.name?n.hash.name=e.algorithm.hash.name:n.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":r.algorithmId=this.getOIDByAlgorithm(n,!0);break;case"RSA-PSS":{switch(n.hash.name.toUpperCase()){case"SHA-256":n.saltLength=32;break;case"SHA-384":n.saltLength=48;break;case"SHA-512":n.saltLength=64;break}const i={};if(n.hash.name.toUpperCase()!=="SHA-1"){const l=this.getOIDByAlgorithm({name:n.hash.name},!0,"hashAlgorithm");i.hashAlgorithm=new V({algorithmId:l,algorithmParams:new kt}),i.maskGenAlgorithm=new V({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:i.hashAlgorithm.toSchema()})}n.saltLength!==20&&(i.saltLength=n.saltLength);const o=new Yt(i);r.algorithmId="1.2.840.113549.1.1.10",r.algorithmParams=o.toSchema()}break;default:throw new Error(`Unsupported signature algorithm: ${e.algorithm.name}`)}return{signatureAlgorithm:r,parameters:a}}async signWithPrivateKey(e,t,r){const a=await this.sign(r.algorithm,t,e);return r.algorithm.name==="ECDSA"?YE(a):a}fillPublicKeyParameters(e,t){const r={},a=this.getHashAlgorithm(t);if(a===S)throw new Error(`Unsupported signature algorithm: ${t.algorithmId}`);let n;t.algorithmId==="1.2.840.113549.1.1.10"?n=t.algorithmId:n=e.algorithm.algorithmId;const i=this.getAlgorithmByOID(n,!0);if(r.algorithm=this.getAlgorithmParameters(i.name,"importKey"),"hash"in r.algorithm.algorithm&&(r.algorithm.algorithm.hash.name=a),i.name==="ECDSA"){const o=e.algorithm;if(!o.algorithmParams)throw new Error("Algorithm parameters for ECDSA public key are missed");const l=o.algorithmParams;if("idBlock"in o.algorithmParams&&!(l.idBlock.tagClass===1&&l.idBlock.tagNumber===6))throw new Error("Incorrect type for ECDSA public key parameters");const u=this.getAlgorithmByOID(l.valueBlock.toString(),!0);r.algorithm.algorithm.namedCurve=u.name}return r}async getPublicKey(e,t,r){r||(r=this.fillPublicKeyParameters(e,t));const a=e.toSchema().toBER(!1);return this.importKey("spki",a,r.algorithm.algorithm,!0,r.algorithm.usages)}async verifyWithPublicKey(e,t,r,a,n){let i;if(n){const u={};let c;a.algorithmId==="1.2.840.113549.1.1.10"?c=a.algorithmId:c=r.algorithm.algorithmId;const f=this.getAlgorithmByOID(c,!0);if(u.algorithm=this.getAlgorithmParameters(f.name,"importKey"),"hash"in u.algorithm.algorithm&&(u.algorithm.algorithm.hash.name=n),f.name==="ECDSA"){let g=!1;if("algorithmParams"in r.algorithm&&"idBlock"in r.algorithm.algorithmParams&&r.algorithm.algorithmParams.idBlock.tagClass===1&&r.algorithm.algorithmParams.idBlock.tagNumber===6&&(g=!0),g===!1)throw new Error("Incorrect type for ECDSA public key parameters");const v=this.getAlgorithmByOID(r.algorithm.algorithmParams.valueBlock.toString(),!0);u.algorithm.algorithm.namedCurve=v.name}i=await this.getPublicKey(r,null,u)}else{if(n=this.getHashAlgorithm(a),!n)throw new Error(`Unsupported signature algorithm: ${a.algorithmId}`);i=await this.getPublicKey(r,a)}const o=this.getAlgorithmParameters(i.algorithm.name,"verify");"hash"in o.algorithm&&(o.algorithm.hash.name=n);let l=t.valueBlock.valueHexView;if(i.algorithm.name==="ECDSA"){const u=Rn.find(i.algorithm.namedCurve);if(!u)throw new Error("Unsupported named curve in use");const c=Lt(l);M.assert(c,"Signature value"),l=zE(c.result,u.size)}if(i.algorithm.name==="RSA-PSS"){const u=new Yt({schema:a.algorithmParams});"saltLength"in u?o.algorithm.saltLength=u.saltLength:o.algorithm.saltLength=20;let c="SHA-1";"hashAlgorithm"in u&&(c=this.getAlgorithmByOID(u.hashAlgorithm.algorithmId,!0).name),o.algorithm.hash.name=c}return this.verify(o.algorithm,i,l,e)}}let M1={name:"none",crypto:null};function Gp(s){return!!(s&&typeof s=="object"&&"crypto"in s)}function jp(s,...e){let t=null;if(e.length<2)e.length?t=e[0]:t=typeof self<"u"&&self.crypto?new z0({name:"browser",crypto:self.crypto}):null;else{const r=e[0],a=e[1];Gp(a)?t=a:Gp(r)?t=r:"subtle"in r&&"getRandomValues"in r&&(t=new z0({crypto:r}))}if(typeof process<"u"&&"pid"in process&&typeof global<"u"&&typeof window>"u"){if(typeof global[process.pid]>"u")global[process.pid]={};else if(typeof global[process.pid]!="object")throw new Error(`Name global.${process.pid} already exists and it is not an object`);if(typeof global[process.pid].pkijs>"u")global[process.pid].pkijs={};else if(typeof global[process.pid].pkijs!="object")throw new Error(`Name global.${process.pid}.pkijs already exists and it is not an object`);global[process.pid].pkijs.engine={name:s,crypto:t}}else M1={name:s,crypto:t}}function QE(){if(typeof process<"u"&&"pid"in process&&typeof global<"u"&&typeof window>"u"){let s;try{s=global[process.pid].pkijs.engine}catch{throw new Error("Please call 'setEngine' before call to 'getEngine'")}return s}return M1}function Ve(s=!1){const e=QE();if(!e.crypto&&s)throw new Error("Unable to create WebCrypto object");return e.crypto}function YE(s){if(s.byteLength%2!==0)return Ot;const e=s.byteLength/2,t=new ArrayBuffer(e);new Uint8Array(t).set(new Uint8Array(s,0,e));const a=new D({valueHex:t}),n=new ArrayBuffer(e);new Uint8Array(n).set(new Uint8Array(s,e,e));const o=new D({valueHex:n});return new E({value:[a.convertToDER(),o.convertToDER()]}).toBER(!1)}function zE(s,e){if(!(s instanceof E&&s.valueBlock.value.length===2&&s.valueBlock.value[0]instanceof D&&s.valueBlock.value[1]instanceof D))return Ot;const t=s.valueBlock.value[0].convertFromDER().valueBlock.valueHexView,r=s.valueBlock.value[1].convertFromDER().valueBlock.valueHexView,a=new Uint8Array(e*2);return a.set(t,e-t.byteLength),a.set(r,2*e-r.byteLength),a.buffer}async function XE(s,e,t,r,a){switch(s.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;default:throw new tt(`Unknown hash function: ${s}`)}if(tt.assert(e,"zBuffer","ArrayBuffer"),e.byteLength===0)throw new tt("'zBuffer' has zero length, error");if(tt.assert(r,"SharedInfo","ArrayBuffer"),t>255)throw new tt("Please set 'Counter' argument to value less or equal to 255");const n=new ArrayBuffer(4),i=new Uint8Array(n);i[0]=0,i[1]=0,i[2]=0,i[3]=t;let o=Ot;o=ou(o,e),o=ou(o,n),o=ou(o,r);const l=await a.digest({name:s},o);return{counter:t,result:l}}async function Wp(s,e,t,r,a=Ve(!0)){let n=0,i=1;switch(s.toUpperCase()){case"SHA-1":n=160;break;case"SHA-256":n=256;break;case"SHA-384":n=384;break;case"SHA-512":n=512;break;default:throw new tt(`Unknown hash function: ${s}`)}if(tt.assert(e,"Zbuffer","ArrayBuffer"),e.byteLength===0)throw new tt("'Zbuffer' has zero length, error");tt.assert(r,"SharedInfo","ArrayBuffer");const o=t/n;Math.floor(o)>0&&(i=Math.floor(o),o-i>0&&i++);const l=[];for(let g=1;g<=i;g++)l.push(await XE(s,e,g,r,a));let u=Ot,c=1,f=!0;for(;f;){f=!1;for(const g of l)if(g.counter===c){u=ou(u,g.result),f=!0;break}c++}if(t>>=3,u.byteLength>t){const g=new ArrayBuffer(t),v=new Uint8Array(g),p=new Uint8Array(u);for(let h=0;h<t;h++)v[h]=p[h];return g}return u}const Jd="version",Gd="logID",jd="extensions",Wd="timestamp",Qd="hashAlgorithm",Yd="signatureAlgorithm",zd="signature",Qp="none",Yp="md5",zp="sha1",Xp="sha224",Zp="sha256",ey="sha384",ty="sha512",ry="anonymous",sy="rsa",ay="dsa",ny="ecdsa";class bs extends G{constructor(e={}){super(),this.version=m(e,Jd,bs.defaultValues(Jd)),this.logID=m(e,Gd,bs.defaultValues(Gd)),this.timestamp=m(e,Wd,bs.defaultValues(Wd)),this.extensions=m(e,jd,bs.defaultValues(jd)),this.hashAlgorithm=m(e,Qd,bs.defaultValues(Qd)),this.signatureAlgorithm=m(e,Yd,bs.defaultValues(Yd)),this.signature=m(e,zd,bs.defaultValues(zd)),"stream"in e&&e.stream&&this.fromStream(e.stream),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Jd:return 0;case Gd:case jd:return Ot;case Wd:return new Date(0);case Qd:case Yd:return S;case zd:return new ke;default:return super.defaultValues(e)}}fromSchema(e){if(!(e instanceof Y0))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");const t=new _n({stream:new bt({buffer:e.data})});this.fromStream(t)}fromStream(e){const t=e.getUint16();if(this.version=e.getBlock(1)[0],this.version===0){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(go(new Uint8Array(e.getBlock(8)),8));const r=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(r)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm=Qp;break;case 1:this.hashAlgorithm=Yp;break;case 2:this.hashAlgorithm=zp;break;case 3:this.hashAlgorithm=Xp;break;case 4:this.hashAlgorithm=Zp;break;case 5:this.hashAlgorithm=ey;break;case 6:this.hashAlgorithm=ty;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm=ry;break;case 1:this.signatureAlgorithm=sy;break;case 2:this.signatureAlgorithm=ay;break;case 3:this.signatureAlgorithm=ny;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}const a=e.getUint16(),n=new Uint8Array(e.getBlock(a)).buffer.slice(0),i=Lt(n);if(M.assert(i,"SignedCertificateTimestamp"),this.signature=i.result,t!==47+r+a)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}toSchema(){const e=this.toStream();return new Y0({data:e.stream.buffer})}toStream(){const e=new _n;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecodeView.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));const t=new ArrayBuffer(8),r=new Uint8Array(t),a=ma(this.timestamp.valueOf(),8);r.set(new Uint8Array(a),8-a.byteLength),e.appendView(r),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions));let n;switch(this.hashAlgorithm.toLowerCase()){case Qp:n=0;break;case Yp:n=1;break;case zp:n=2;break;case Xp:n=3;break;case Zp:n=4;break;case ey:n=5;break;case ty:n=6;break;default:throw new Error(`Incorrect data for hashAlgorithm: ${this.hashAlgorithm}`)}e.appendChar(n);let i;switch(this.signatureAlgorithm.toLowerCase()){case ry:i=0;break;case sy:i=1;break;case ay:i=2;break;case ny:i=3;break;default:throw new Error(`Incorrect data for signatureAlgorithm: ${this.signatureAlgorithm}`)}e.appendChar(i);const o=this.signature.toBER(!1);return e.appendUint16(o.byteLength),e.appendView(new Uint8Array(o)),e}toJSON(){return{version:this.version,logID:_p(this.logID),timestamp:this.timestamp,extensions:_p(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}async verify(e,t,r=0,a=Ve(!0)){const n=Lg(W0(this.logID));let i=null;const o=new _n;for(const v of e)if(v.log_id===n){i=v.key;break}if(!i)throw new Error(`Public key not found for CT with logId: ${n}`);const l=Su(rh(i)),u=Ar.fromBER(l);o.appendChar(0),o.appendChar(0);const c=new ArrayBuffer(8),f=new Uint8Array(c),g=ma(this.timestamp.valueOf(),8);return f.set(new Uint8Array(g),8-g.byteLength),o.appendView(f),o.appendUint16(r),r===0&&o.appendUint24(t.byteLength),o.appendView(new Uint8Array(t)),o.appendUint16(this.extensions.byteLength),this.extensions.byteLength!==0&&o.appendView(new Uint8Array(this.extensions)),a.verifyWithPublicKey(o.buffer.slice(0,o.length),new z({valueHex:this.signature.toBER(!1)}),u,{algorithmId:S},"SHA-256")}}bs.CLASS_NAME="SignedCertificateTimestamp";const Oh="timestamps";class kd extends G{constructor(e={}){super(),this.timestamps=m(e,Oh,kd.defaultValues(Oh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Oh:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Oh:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){var t;const r=m(e,"names",{});return(t=r.optional)!==null&&t!==void 0||(r.optional=!1),new z({name:r.blockName||"SignedCertificateTimestampList",optional:r.optional})}fromSchema(e){if(!(e instanceof z))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");const t=new _n({stream:new bt({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new bs({stream:t}))}toSchema(){const e=new _n;let t=0;const r=[];for(const a of this.timestamps){const n=a.toStream();r.push(n),t+=n.stream.buffer.byteLength}e.appendUint16(t);for(const a of r)e.appendView(a.stream.view);return new z({valueHex:e.stream.buffer.slice(0)})}toJSON(){return{timestamps:Array.from(this.timestamps,e=>e.toJSON())}}}kd.CLASS_NAME="SignedCertificateTimestampList";const Oc="attributes",ZE=[Oc];class fh extends G{constructor(e={}){super(),this.attributes=m(e,Oc,fh.defaultValues(Oc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Oc:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new Re({name:t.attributes||S,value:gt.schema()})]})}fromSchema(e){W(e,ZE);const t=j(e,e,fh.schema({names:{attributes:Oc}}));M.assertSchema(t,this.className),this.attributes=Array.from(t.result.attributes,r=>new gt({schema:r}))}toSchema(){return new E({value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){return{attributes:Array.from(this.attributes,e=>e.toJSON())}}}fh.CLASS_NAME="SubjectDirectoryAttributes";class Ct{static getItems(){return this.types||(this.types={},Ct.register(E1,"SubjectAltName",Au),Ct.register(x1,"IssuerAltName",Au),Ct.register(Mm,"AuthorityKeyIdentifier",En),Ct.register(Pm,"BasicConstraints",ao),Ct.register(mE,"MicrosoftCaVersion",oh),Ct.register(T1,"CertificatePolicies",bu),Ct.register(uE,"CertificatePoliciesMicrosoft",bu),Ct.register(gE,"MicrosoftCertTemplateV2",nu),Ct.register(N1,"CRLDistributionPoints",Eu),Ct.register(Um,"FreshestCRL",Eu),Ct.register(cE,"ExtKeyUsage",lh),Ct.register(I1,"CertificateIssuer",Kt),Ct.register(Hm,"AuthorityInfoAccess",xu),Ct.register(hE,"SubjectInfoAccess",xu),Ct.register(B1,"IssuingDistributionPoint",Qt),Ct.register(k1,"NameConstraints",uu),Ct.register(R1,"PolicyConstraints",cu),Ct.register(_1,"PolicyMappings",uh),Ct.register(aE,"PrivateKeyUsagePeriod",fu),Ct.register(pE,"QCStatements",ch),Ct.register(dE,"SignedCertificateTimestampList",kd),Ct.register(tE,"SubjectDirectoryAttributes",fh)),this.types}static fromBER(e,t){const r=Lt(t);if(r.offset===-1)return null;const a=this.find(e);if(a)try{return new a.type({schema:r.result})}catch{const i=new a.type;return i.parsingError=`Incorrectly formatted value of extension ${a.name} (${e})`,i}return r.result}static find(e){return this.getItems()[e]||null}static register(e,t,r){this.getItems()[e]={name:t,type:r}}}const Pc="extnID",qa="critical",Uc="extnValue",Ph="parsedValue",e2=[Pc,qa,Uc];class Rt extends G{get parsedValue(){if(this._parsedValue===void 0){const e=Ct.fromBER(this.extnID,this.extnValue.valueBlock.valueHexView);this._parsedValue=e}return this._parsedValue||void 0}set parsedValue(e){this._parsedValue=e}constructor(e={}){super(),this.extnID=m(e,Pc,Rt.defaultValues(Pc)),this.critical=m(e,qa,Rt.defaultValues(qa)),Uc in e?this.extnValue=new z({valueHex:e.extnValue}):this.extnValue=Rt.defaultValues(Uc),Ph in e&&(this.parsedValue=m(e,Ph,Rt.defaultValues(Ph))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pc:return S;case qa:return!1;case Uc:return new z;case Ph:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.extnID||S}),new Ps({name:t.critical||S,optional:!0}),new z({name:t.extnValue||S})]})}fromSchema(e){W(e,e2);const t=j(e,e,Rt.schema({names:{extnID:Pc,critical:qa,extnValue:Uc}}));M.assertSchema(t,this.className),this.extnID=t.result.extnID.valueBlock.toString(),qa in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue}toSchema(){const e=[];return e.push(new fe({value:this.extnID})),this.critical!==Rt.defaultValues(qa)&&e.push(new Ps({value:this.critical})),e.push(this.extnValue),new E({value:e})}toJSON(){const e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==Rt.defaultValues(qa)&&(e.critical=this.critical),this.parsedValue&&this.parsedValue.toJSON&&(e.parsedValue=this.parsedValue.toJSON()),e}}Rt.CLASS_NAME="Extension";const Mc="extensions",t2=[Mc];class Pt extends G{constructor(e={}){super(),this.extensions=m(e,Mc,Pt.defaultValues(Mc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mc:return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const r=m(e,"names",{});return new E({optional:t,name:r.blockName||S,value:[new Re({name:r.extensions||S,value:Rt.schema(r.extension||{})})]})}fromSchema(e){W(e,t2);const t=j(e,e,Pt.schema({names:{extensions:Mc}}));M.assertSchema(t,this.className),this.extensions=Array.from(t.result.extensions,r=>new Rt({schema:r}))}toSchema(){return new E({value:Array.from(this.extensions,e=>e.toSchema())})}toJSON(){return{extensions:this.extensions.map(e=>e.toJSON())}}}Pt.CLASS_NAME="Extensions";const Hc="issuer",Kc="serialNumber",ii="issuerUID",r2=[Hc,Kc,ii];class Cr extends G{constructor(e={}){super(),this.issuer=m(e,Hc,Cr.defaultValues(Hc)),this.serialNumber=m(e,Kc,Cr.defaultValues(Kc)),ii in e&&(this.issuerUID=m(e,ii,Cr.defaultValues(ii))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hc:return new Kt;case Kc:return new D;case ii:return new Pe;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[Kt.schema(t.issuer||{}),new D({name:t.serialNumber||S}),new Pe({optional:!0,name:t.issuerUID||S})]})}fromSchema(e){W(e,r2);const t=j(e,e,Cr.schema({names:{issuer:{names:{blockName:Hc}},serialNumber:Kc,issuerUID:ii}}));M.assertSchema(t,this.className),this.issuer=new Kt({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber,ii in t.result&&(this.issuerUID=t.result.issuerUID)}toSchema(){const e=new E({value:[this.issuer.toSchema(),this.serialNumber]});return this.issuerUID&&e.valueBlock.value.push(this.issuerUID),e}toJSON(){const e={issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()};return this.issuerUID&&(e.issuerUID=this.issuerUID.toJSON()),e}}Cr.CLASS_NAME="IssuerSerial";const Fc="version",oi="baseCertificateID",li="subjectName",qc="issuer",Jc="signature",Gc="serialNumber",jc="attrCertValidityPeriod",Wc="attributes",ui="issuerUniqueID",ci="extensions",s2=[Fc,oi,li,qc,Jc,Gc,jc,Wc,ui,ci];class cr extends G{constructor(e={}){super(),this.version=m(e,Fc,cr.defaultValues(Fc)),oi in e&&(this.baseCertificateID=m(e,oi,cr.defaultValues(oi))),li in e&&(this.subjectName=m(e,li,cr.defaultValues(li))),this.issuer=m(e,qc,cr.defaultValues(qc)),this.signature=m(e,Jc,cr.defaultValues(Jc)),this.serialNumber=m(e,Gc,cr.defaultValues(Gc)),this.attrCertValidityPeriod=m(e,jc,cr.defaultValues(jc)),this.attributes=m(e,Wc,cr.defaultValues(Wc)),ui in e&&(this.issuerUniqueID=m(e,ui,cr.defaultValues(ui))),ci in e&&(this.extensions=m(e,ci,cr.defaultValues(ci))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fc:return 0;case oi:return new Cr;case li:return new Kt;case qc:return new Kt;case Jc:return new V;case Gc:return new D;case jc:return new gs;case Wc:return[];case ui:return new Pe;case ci:return new Pt;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new D({name:t.version||S}),new St({value:[new T({name:t.baseCertificateID||S,idBlock:{tagClass:3,tagNumber:0},value:Cr.schema().valueBlock.value}),new T({name:t.subjectName||S,idBlock:{tagClass:3,tagNumber:1},value:Kt.schema().valueBlock.value})]}),Kt.schema({names:{blockName:t.issuer||S}}),V.schema(t.signature||{}),new D({name:t.serialNumber||S}),gs.schema(t.attrCertValidityPeriod||{}),new E({name:t.attributes||S,value:[new Re({value:gt.schema()})]}),new Pe({optional:!0,name:t.issuerUniqueID||S}),Pt.schema(t.extensions||{},!0)]})}fromSchema(e){W(e,s2);const t=j(e,e,cr.schema({names:{version:Fc,baseCertificateID:oi,subjectName:li,issuer:qc,signature:{names:{blockName:Jc}},serialNumber:Gc,attrCertValidityPeriod:{names:{blockName:jc}},attributes:Wc,issuerUniqueID:ui,extensions:{names:{blockName:ci}}}}));M.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,oi in t.result&&(this.baseCertificateID=new Cr({schema:new E({value:t.result.baseCertificateID.valueBlock.value})})),li in t.result&&(this.subjectName=new Kt({schema:new E({value:t.result.subjectName.valueBlock.value})})),this.issuer=t.result.issuer,this.signature=new V({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new gs({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,r=>new gt({schema:r})),ui in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),ci in t.result&&(this.extensions=new Pt({schema:t.result.extensions}))}toSchema(){const e=new E({value:[new D({value:this.version})]});return this.baseCertificateID&&e.valueBlock.value.push(new T({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.subjectName&&e.valueBlock.value.push(new T({idBlock:{tagClass:3,tagNumber:1},value:this.subjectName.toSchema().valueBlock.value})),e.valueBlock.value.push(this.issuer.toSchema()),e.valueBlock.value.push(this.signature.toSchema()),e.valueBlock.value.push(this.serialNumber),e.valueBlock.value.push(this.attrCertValidityPeriod.toSchema()),e.valueBlock.value.push(new E({value:Array.from(this.attributes,t=>t.toSchema())})),this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.subjectName&&(e.subjectName=this.subjectName.toJSON()),e.issuer=this.issuer.toJSON(),e.signature=this.signature.toJSON(),e.serialNumber=this.serialNumber.toJSON(),e.attrCertValidityPeriod=this.attrCertValidityPeriod.toJSON(),e.attributes=Array.from(this.attributes,t=>t.toJSON()),this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}cr.CLASS_NAME="AttributeCertificateInfoV1";const Qc="acinfo",Yc="signatureAlgorithm",zc="signatureValue",a2=[Qc,zc,Yc];class na extends G{constructor(e={}){super(),this.acinfo=m(e,Qc,na.defaultValues(Qc)),this.signatureAlgorithm=m(e,Yc,na.defaultValues(Yc)),this.signatureValue=m(e,zc,na.defaultValues(zc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qc:return new cr;case Yc:return new V;case zc:return new Pe;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[cr.schema(t.acinfo||{}),V.schema(t.signatureAlgorithm||{}),new Pe({name:t.signatureValue||S})]})}fromSchema(e){W(e,a2);const t=j(e,e,na.schema({names:{acinfo:{names:{blockName:Qc}},signatureAlgorithm:{names:{blockName:Yc}},signatureValue:zc}}));M.assertSchema(t,this.className),this.acinfo=new cr({schema:t.result.acinfo}),this.signatureAlgorithm=new V({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new E({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}na.CLASS_NAME="AttributeCertificateV1";const Xc="digestedObjectType",fi="otherObjectTypeID",Zc="digestAlgorithm",ef="objectDigest",n2=[Xc,fi,Zc,ef];class Mr extends G{constructor(e={}){super(),this.digestedObjectType=m(e,Xc,Mr.defaultValues(Xc)),fi in e&&(this.otherObjectTypeID=m(e,fi,Mr.defaultValues(fi))),this.digestAlgorithm=m(e,Zc,Mr.defaultValues(Zc)),this.objectDigest=m(e,ef,Mr.defaultValues(ef)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xc:return new mo;case fi:return new fe;case Zc:return new V;case ef:return new Pe;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new mo({name:t.digestedObjectType||S}),new fe({optional:!0,name:t.otherObjectTypeID||S}),V.schema(t.digestAlgorithm||{}),new Pe({name:t.objectDigest||S})]})}fromSchema(e){W(e,n2);const t=j(e,e,Mr.schema({names:{digestedObjectType:Xc,otherObjectTypeID:fi,digestAlgorithm:{names:{blockName:Zc}},objectDigest:ef}}));M.assertSchema(t,this.className),this.digestedObjectType=t.result.digestedObjectType,fi in t.result&&(this.otherObjectTypeID=t.result.otherObjectTypeID),this.digestAlgorithm=new V({schema:t.result.digestAlgorithm}),this.objectDigest=t.result.objectDigest}toSchema(){const e=new E({value:[this.digestedObjectType]});return this.otherObjectTypeID&&e.valueBlock.value.push(this.otherObjectTypeID),e.valueBlock.value.push(this.digestAlgorithm.toSchema()),e.valueBlock.value.push(this.objectDigest),e}toJSON(){const e={digestedObjectType:this.digestedObjectType.toJSON(),digestAlgorithm:this.digestAlgorithm.toJSON(),objectDigest:this.objectDigest.toJSON()};return this.otherObjectTypeID&&(e.otherObjectTypeID=this.otherObjectTypeID.toJSON()),e}}Mr.CLASS_NAME="ObjectDigestInfo";const hi="issuerName",di="baseCertificateID",gi="objectDigestInfo",i2=[hi,di,gi];class Bn extends G{constructor(e={}){super(),hi in e&&(this.issuerName=m(e,hi,Bn.defaultValues(hi))),di in e&&(this.baseCertificateID=m(e,di,Bn.defaultValues(di))),gi in e&&(this.objectDigestInfo=m(e,gi,Bn.defaultValues(gi))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hi:return new Kt;case di:return new Cr;case gi:return new Mr;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[Kt.schema({names:{blockName:t.issuerName}},!0),new T({optional:!0,name:t.baseCertificateID||S,idBlock:{tagClass:3,tagNumber:0},value:Cr.schema().valueBlock.value}),new T({optional:!0,name:t.objectDigestInfo||S,idBlock:{tagClass:3,tagNumber:1},value:Mr.schema().valueBlock.value})]})}fromSchema(e){W(e,i2);const t=j(e,e,Bn.schema({names:{issuerName:hi,baseCertificateID:di,objectDigestInfo:gi}}));M.assertSchema(t,this.className),hi in t.result&&(this.issuerName=new Kt({schema:t.result.issuerName})),di in t.result&&(this.baseCertificateID=new Cr({schema:new E({value:t.result.baseCertificateID.valueBlock.value})})),gi in t.result&&(this.objectDigestInfo=new Mr({schema:new E({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new E;return this.issuerName&&e.valueBlock.value.push(this.issuerName.toSchema()),this.baseCertificateID&&e.valueBlock.value.push(new T({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new T({idBlock:{tagClass:3,tagNumber:1},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.issuerName&&(e.issuerName=this.issuerName.toJSON()),this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}Bn.CLASS_NAME="V2Form";const mi="baseCertificateID",pi="entityName",yi="objectDigestInfo",o2=[mi,pi,yi];class ia extends G{constructor(e={}){super(),mi in e&&(this.baseCertificateID=m(e,mi,ia.defaultValues(mi))),pi in e&&(this.entityName=m(e,pi,ia.defaultValues(pi))),yi in e&&(this.objectDigestInfo=m(e,yi,ia.defaultValues(yi))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mi:return new Cr;case pi:return new Kt;case yi:return new Mr;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new T({optional:!0,name:t.baseCertificateID||S,idBlock:{tagClass:3,tagNumber:0},value:Cr.schema().valueBlock.value}),new T({optional:!0,name:t.entityName||S,idBlock:{tagClass:3,tagNumber:1},value:Kt.schema().valueBlock.value}),new T({optional:!0,name:t.objectDigestInfo||S,idBlock:{tagClass:3,tagNumber:2},value:Mr.schema().valueBlock.value})]})}fromSchema(e){W(e,o2);const t=j(e,e,ia.schema({names:{baseCertificateID:mi,entityName:pi,objectDigestInfo:yi}}));M.assertSchema(t,this.className),mi in t.result&&(this.baseCertificateID=new Cr({schema:new E({value:t.result.baseCertificateID.valueBlock.value})})),pi in t.result&&(this.entityName=new Kt({schema:new E({value:t.result.entityName.valueBlock.value})})),yi in t.result&&(this.objectDigestInfo=new Mr({schema:new E({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new E;return this.baseCertificateID&&e.valueBlock.value.push(new T({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.entityName&&e.valueBlock.value.push(new T({idBlock:{tagClass:3,tagNumber:1},value:this.entityName.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new T({idBlock:{tagClass:3,tagNumber:2},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.entityName&&(e.entityName=this.entityName.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}ia.CLASS_NAME="Holder";const tf="version",rf="holder",sf="issuer",af="signature",nf="serialNumber",of="attrCertValidityPeriod",lf="attributes",vi="issuerUniqueID",wi="extensions",l2=[tf,rf,sf,af,nf,of,lf,vi,wi];class mr extends G{constructor(e={}){super(),this.version=m(e,tf,mr.defaultValues(tf)),this.holder=m(e,rf,mr.defaultValues(rf)),this.issuer=m(e,sf,mr.defaultValues(sf)),this.signature=m(e,af,mr.defaultValues(af)),this.serialNumber=m(e,nf,mr.defaultValues(nf)),this.attrCertValidityPeriod=m(e,of,mr.defaultValues(of)),this.attributes=m(e,lf,mr.defaultValues(lf)),vi in e&&(this.issuerUniqueID=m(e,vi,mr.defaultValues(vi))),wi in e&&(this.extensions=m(e,wi,mr.defaultValues(wi))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tf:return 1;case rf:return new ia;case sf:return{};case af:return new V;case nf:return new D;case of:return new gs;case lf:return[];case vi:return new Pe;case wi:return new Pt;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new D({name:t.version||S}),ia.schema(t.holder||{}),new St({value:[Kt.schema({names:{blockName:t.issuer||S}}),new T({name:t.issuer||S,idBlock:{tagClass:3,tagNumber:0},value:Bn.schema().valueBlock.value})]}),V.schema(t.signature||{}),new D({name:t.serialNumber||S}),gs.schema(t.attrCertValidityPeriod||{}),new E({name:t.attributes||S,value:[new Re({value:gt.schema()})]}),new Pe({optional:!0,name:t.issuerUniqueID||S}),Pt.schema(t.extensions||{},!0)]})}fromSchema(e){W(e,l2);const t=j(e,e,mr.schema({names:{version:tf,holder:{names:{blockName:rf}},issuer:sf,signature:{names:{blockName:af}},serialNumber:nf,attrCertValidityPeriod:{names:{blockName:of}},attributes:lf,issuerUniqueID:vi,extensions:{names:{blockName:wi}}}}));switch(M.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.holder=new ia({schema:t.result.holder}),t.result.issuer.idBlock.tagClass){case 3:this.issuer=new Bn({schema:new E({value:t.result.issuer.valueBlock.value})});break;case 1:default:throw new Error("Incorrect value for 'issuer' in AttributeCertificateInfoV2")}this.signature=new V({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new gs({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,r=>new gt({schema:r})),vi in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),wi in t.result&&(this.extensions=new Pt({schema:t.result.extensions}))}toSchema(){const e=new E({value:[new D({value:this.version}),this.holder.toSchema(),new T({idBlock:{tagClass:3,tagNumber:0},value:this.issuer.toSchema().valueBlock.value}),this.signature.toSchema(),this.serialNumber,this.attrCertValidityPeriod.toSchema(),new E({value:Array.from(this.attributes,t=>t.toSchema())})]});return this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version,holder:this.holder.toJSON(),issuer:this.issuer.toJSON(),signature:this.signature.toJSON(),serialNumber:this.serialNumber.toJSON(),attrCertValidityPeriod:this.attrCertValidityPeriod.toJSON(),attributes:Array.from(this.attributes,t=>t.toJSON())};return this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}mr.CLASS_NAME="AttributeCertificateInfoV2";const uf="acinfo",cf="signatureAlgorithm",ff="signatureValue",u2=[uf,cf,ff];class Hr extends G{constructor(e={}){super(),this.acinfo=m(e,uf,Hr.defaultValues(uf)),this.signatureAlgorithm=m(e,cf,Hr.defaultValues(cf)),this.signatureValue=m(e,ff,Hr.defaultValues(ff)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uf:return new mr;case cf:return new V;case ff:return new Pe;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[mr.schema(t.acinfo||{}),V.schema(t.signatureAlgorithm||{}),new Pe({name:t.signatureValue||S})]})}fromSchema(e){W(e,u2);const t=j(e,e,Hr.schema({names:{acinfo:{names:{blockName:uf}},signatureAlgorithm:{names:{blockName:cf}},signatureValue:ff}}));M.assertSchema(t,this.className),this.acinfo=new mr({schema:t.result.acinfo}),this.signatureAlgorithm=new V({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new E({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}Hr.CLASS_NAME="AttributeCertificateV2";const Si="contentType",jo="content",c2=[Si,jo];class ct extends G{constructor(e={}){super(),this.contentType=m(e,Si,ct.defaultValues(Si)),this.content=m(e,jo,ct.defaultValues(jo)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Si:return S;case jo:return new ke;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Si:return typeof t=="string"&&t===this.defaultValues(Si);case jo:return t instanceof ke;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return"optional"in t||(t.optional=!1),new E({name:t.blockName||"ContentInfo",optional:t.optional,value:[new fe({name:t.contentType||Si}),new T({idBlock:{tagClass:3,tagNumber:0},value:[new ke({name:t.content||jo})]})]})}fromSchema(e){W(e,c2);const t=j(e,e,ct.schema());M.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.content=t.result.content}toSchema(){return new E({value:[new fe({value:this.contentType}),new T({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}toJSON(){const e={contentType:this.contentType};return this.content instanceof ke||(e.content=this.content.toJSON()),e}}ct.CLASS_NAME="ContentInfo";ct.DATA=Km;ct.SIGNED_DATA=V1;ct.ENVELOPED_DATA=$1;ct.ENCRYPTED_DATA=D1;const Xd="type",Zd="value",Mg="utcTimeName",Hg="generalTimeName",f2=[Mg,Hg];var iy;(function(s){s[s.UTCTime=0]="UTCTime",s[s.GeneralizedTime=1]="GeneralizedTime",s[s.empty=2]="empty"})(iy||(iy={}));class Dt extends G{constructor(e={}){super(),this.type=m(e,Xd,Dt.defaultValues(Xd)),this.value=m(e,Zd,Dt.defaultValues(Zd)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xd:return 0;case Zd:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={},t=!1){const r=m(e,"names",{});return new St({optional:t,value:[new Cu({name:r.utcTimeName||S}),new wt({name:r.generalTimeName||S})]})}fromSchema(e){W(e,f2);const t=j(e,e,Dt.schema({names:{utcTimeName:Mg,generalTimeName:Hg}}));M.assertSchema(t,this.className),Mg in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),Hg in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}toSchema(){return this.type===0?new Cu({valueDate:this.value}):this.type===1?new wt({valueDate:this.value}):{}}toJSON(){return{type:this.type,value:this.value}}}Dt.CLASS_NAME="Time";const eg="tbs",Ja="version",l0="serialNumber",u0="signature",c0="issuer",f0="notBefore",h0="notAfter",d0="subject",g0="subjectPublicKeyInfo",hf="issuerUniqueID",df="subjectUniqueID",gf="extensions",mf="signatureAlgorithm",pf="signatureValue",Fr="tbsCertificate",X0=`${Fr}.${Ja}`,Fm=`${Fr}.${l0}`,qm=`${Fr}.${u0}`,Jm=`${Fr}.${c0}`,Z0=`${Fr}.${f0}`,ed=`${Fr}.${h0}`,Gm=`${Fr}.${d0}`,jm=`${Fr}.${g0}`,td=`${Fr}.${hf}`,rd=`${Fr}.${df}`,Xf=`${Fr}.${gf}`,h2=[Fr,X0,Fm,qm,Jm,Z0,ed,Gm,jm,td,rd,Xf,mf,pf];function d2(s={}){const e=m(s,"names",{});return new E({name:e.blockName||Fr,value:[new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new D({name:e.tbsCertificateVersion||X0})]}),new D({name:e.tbsCertificateSerialNumber||Fm}),V.schema(e.signature||{names:{blockName:qm}}),rt.schema(e.issuer||{names:{blockName:Jm}}),new E({name:e.tbsCertificateValidity||"tbsCertificate.validity",value:[Dt.schema(e.notBefore||{names:{utcTimeName:Z0,generalTimeName:Z0}}),Dt.schema(e.notAfter||{names:{utcTimeName:ed,generalTimeName:ed}})]}),rt.schema(e.subject||{names:{blockName:Gm}}),Ar.schema(e.subjectPublicKeyInfo||{names:{blockName:jm}}),new Be({name:e.tbsCertificateIssuerUniqueID||td,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Be({name:e.tbsCertificateSubjectUniqueID||rd,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[Pt.schema(e.extensions||{names:{blockName:Xf}})]})]})}class ze extends G{get tbs(){return Se.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(m(e,eg,ze.defaultValues(eg))),this.version=m(e,Ja,ze.defaultValues(Ja)),this.serialNumber=m(e,l0,ze.defaultValues(l0)),this.signature=m(e,u0,ze.defaultValues(u0)),this.issuer=m(e,c0,ze.defaultValues(c0)),this.notBefore=m(e,f0,ze.defaultValues(f0)),this.notAfter=m(e,h0,ze.defaultValues(h0)),this.subject=m(e,d0,ze.defaultValues(d0)),this.subjectPublicKeyInfo=m(e,g0,ze.defaultValues(g0)),hf in e&&(this.issuerUniqueID=m(e,hf,ze.defaultValues(hf))),df in e&&(this.subjectUniqueID=m(e,df,ze.defaultValues(df))),gf in e&&(this.extensions=m(e,gf,ze.defaultValues(gf))),this.signatureAlgorithm=m(e,mf,ze.defaultValues(mf)),this.signatureValue=m(e,pf,ze.defaultValues(pf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case eg:return Ot;case Ja:return 0;case l0:return new D;case u0:return new V;case c0:return new rt;case f0:return new Dt;case h0:return new Dt;case d0:return new rt;case g0:return new Ar;case hf:return Ot;case df:return Ot;case gf:return[];case mf:return new V;case pf:return new Pe;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[d2(t.tbsCertificate),V.schema(t.signatureAlgorithm||{names:{blockName:mf}}),new Pe({name:t.signatureValue||pf})]})}fromSchema(e){W(e,h2);const t=j(e,e,ze.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:Xf}}}}}}));M.assertSchema(t,this.className),this.tbsView=t.result.tbsCertificate.valueBeforeDecodeView,X0 in t.result&&(this.version=t.result[X0].valueBlock.valueDec),this.serialNumber=t.result[Fm],this.signature=new V({schema:t.result[qm]}),this.issuer=new rt({schema:t.result[Jm]}),this.notBefore=new Dt({schema:t.result[Z0]}),this.notAfter=new Dt({schema:t.result[ed]}),this.subject=new rt({schema:t.result[Gm]}),this.subjectPublicKeyInfo=new Ar({schema:t.result[jm]}),td in t.result&&(this.issuerUniqueID=t.result[td].valueBlock.valueHex),rd in t.result&&(this.subjectUniqueID=t.result[rd].valueBlock.valueHex),Xf in t.result&&(this.extensions=Array.from(t.result[Xf],r=>new Rt({schema:r}))),this.signatureAlgorithm=new V({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return Ja in this&&this.version!==ze.defaultValues(Ja)&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new D({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new E({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),this.issuerUniqueID&&e.push(new Be({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),this.subjectUniqueID&&e.push(new Be({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),this.extensions&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new E({value:Array.from(this.extensions,t=>t.toSchema())})]})),new E({value:e})}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return ze.schema().value[0];const r=Lt(this.tbsView);M.assert(r,"TBS Certificate"),t=r.result}else t=this.encodeTBS();return new E({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:Ee.ToHex(this.tbsView),version:this.version,serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return Ja in this&&this.version!==ze.defaultValues(Ja)&&(e.version=this.version),this.issuerUniqueID&&(e.issuerUniqueID=Ee.ToHex(this.issuerUniqueID)),this.subjectUniqueID&&(e.subjectUniqueID=Ee.ToHex(this.subjectUniqueID)),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async getPublicKey(e,t=Ve(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}async getKeyHash(e="SHA-1",t=Ve(!0)){return t.digest({name:e},this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView)}async sign(e,t="SHA-1",r=Ve(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await r.getSignatureParameters(e,t),n=a.parameters;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await r.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new Pe({valueHex:i})}async verify(e,t=Ve(!0)){let r;if(e?r=e.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(r=this.subjectPublicKeyInfo),!(r instanceof Ar))throw new Error("Please provide issuer certificate as a parameter");return t.verifyWithPublicKey(this.tbsView,this.signatureValue,r,this.signatureAlgorithm)}}ze.CLASS_NAME="Certificate";function H1(s,e=null){if(e&&s.issuer.isEqual(e.issuer)&&s.serialNumber.isEqual(e.serialNumber))return null;let t=!1;if(s.extensions){for(const r of s.extensions)if(r.extnID===Pm&&r.parsedValue instanceof ao&&r.parsedValue.cA){t=!0;break}}return t?s:null}const Wo="certId",Qo="certValue",ko="parsedValue",g2=[Wo,Qo];class Zi extends G{constructor(e={}){super(),this.certId=m(e,Wo,Zi.defaultValues(Wo)),this.certValue=m(e,Qo,Zi.defaultValues(Qo)),ko in e&&(this.parsedValue=m(e,ko,Zi.defaultValues(ko))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Wo:return S;case Qo:return new ke;case ko:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Wo:return t===S;case Qo:return t instanceof ke;case ko:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.id||"id"}),new T({idBlock:{tagClass:3,tagNumber:0},value:[new ke({name:t.value||"value"})]})]})}fromSchema(e){W(e,g2);const t=j(e,e,Zi.schema({names:{id:Wo,value:Qo}}));M.assertSchema(t,this.className),this.certId=t.result.certId.valueBlock.toString(),this.certValue=t.result.certValue;const r=this.certValue.valueBlock.valueHexView;switch(this.certId){case Hp:try{this.parsedValue=ze.fromBER(r)}catch{Hr.fromBER(r)}break;case Kp:this.parsedValue=Hr.fromBER(r);break;case vE:default:throw new Error(`Incorrect CERT_ID value in CertBag: ${this.certId}`)}}toSchema(){return ko in this&&("acinfo"in this.parsedValue?this.certId=Kp:this.certId=Hp,this.certValue=new z({valueHex:this.parsedValue.toSchema().toBER(!1)})),new E({value:[new fe({value:this.certId}),new T({idBlock:{tagClass:3,tagNumber:0},value:["toSchema"in this.certValue?this.certValue.toSchema():this.certValue]})]})}toJSON(){return{certId:this.certId,certValue:this.certValue.toJSON()}}}Zi.CLASS_NAME="CertBag";const yf="userCertificate",Yo="revocationDate",Ci="crlEntryExtensions",m2=[yf,Yo,Ci];class eo extends G{constructor(e={}){super(),this.userCertificate=m(e,yf,eo.defaultValues(yf)),this.revocationDate=m(e,Yo,eo.defaultValues(Yo)),Ci in e&&(this.crlEntryExtensions=m(e,Ci,eo.defaultValues(Ci))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case yf:return new D;case Yo:return new Dt;case Ci:return new Pt;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new D({name:t.userCertificate||yf}),Dt.schema({names:{utcTimeName:t.revocationDate||Yo,generalTimeName:t.revocationDate||Yo}}),Pt.schema({names:{blockName:t.crlEntryExtensions||Ci}},!0)]})}fromSchema(e){W(e,m2);const t=j(e,e,eo.schema());M.assertSchema(t,this.className),this.userCertificate=t.result.userCertificate,this.revocationDate=new Dt({schema:t.result.revocationDate}),Ci in t.result&&(this.crlEntryExtensions=new Pt({schema:t.result.crlEntryExtensions}))}toSchema(){const e=[this.userCertificate,this.revocationDate.toSchema()];return this.crlEntryExtensions&&e.push(this.crlEntryExtensions.toSchema()),new E({value:e})}toJSON(){const e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON()};return this.crlEntryExtensions&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}eo.CLASS_NAME="RevokedCertificate";const tg="tbs",Hu="version",rg="signature",sg="issuer",ag="thisUpdate",Uh="nextUpdate",Mh="revokedCertificates",Hh="crlExtensions",vf="signatureAlgorithm",wf="signatureValue",va="tbsCertList",sd=`${va}.version`,Wm=`${va}.signature`,Qm=`${va}.issuer`,ad=`${va}.thisUpdate`,hh=`${va}.nextUpdate`,nd=`${va}.revokedCertificates`,id=`${va}.extensions`,p2=[va,sd,Wm,Qm,ad,hh,nd,id,vf,wf];function y2(s={}){const e=m(s,"names",{});return new E({name:e.blockName||va,value:[new D({optional:!0,name:e.tbsCertListVersion||sd,value:2}),V.schema(e.signature||{names:{blockName:Wm}}),rt.schema(e.issuer||{names:{blockName:Qm}}),Dt.schema(e.tbsCertListThisUpdate||{names:{utcTimeName:ad,generalTimeName:ad}}),Dt.schema(e.tbsCertListNextUpdate||{names:{utcTimeName:hh,generalTimeName:hh}},!0),new E({optional:!0,value:[new Re({name:e.tbsCertListRevokedCertificates||nd,value:new E({value:[new D,Dt.schema(),Pt.schema({},!0)]})})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Pt.schema(e.crlExtensions||{names:{blockName:id}})]})]})}const v2=[Mm,x1,nE,iE,B1,Um,Hm,oE,lE,I1];class Mt extends G{get tbs(){return Se.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(m(e,tg,Mt.defaultValues(tg))),this.version=m(e,Hu,Mt.defaultValues(Hu)),this.signature=m(e,rg,Mt.defaultValues(rg)),this.issuer=m(e,sg,Mt.defaultValues(sg)),this.thisUpdate=m(e,ag,Mt.defaultValues(ag)),Uh in e&&(this.nextUpdate=m(e,Uh,Mt.defaultValues(Uh))),Mh in e&&(this.revokedCertificates=m(e,Mh,Mt.defaultValues(Mh))),Hh in e&&(this.crlExtensions=m(e,Hh,Mt.defaultValues(Hh))),this.signatureAlgorithm=m(e,vf,Mt.defaultValues(vf)),this.signatureValue=m(e,wf,Mt.defaultValues(wf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tg:return Ot;case Hu:return 0;case rg:return new V;case sg:return new rt;case ag:return new Dt;case Uh:return new Dt;case Mh:return[];case Hh:return new Pt;case vf:return new V;case wf:return new Pe;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||"CertificateList",value:[y2(e),V.schema(t.signatureAlgorithm||{names:{blockName:vf}}),new Pe({name:t.signatureValue||wf})]})}fromSchema(e){W(e,p2);const t=j(e,e,Mt.schema());M.assertSchema(t,this.className),this.tbsView=t.result.tbsCertList.valueBeforeDecodeView,sd in t.result&&(this.version=t.result[sd].valueBlock.valueDec),this.signature=new V({schema:t.result[Wm]}),this.issuer=new rt({schema:t.result[Qm]}),this.thisUpdate=new Dt({schema:t.result[ad]}),hh in t.result&&(this.nextUpdate=new Dt({schema:t.result[hh]})),nd in t.result&&(this.revokedCertificates=Array.from(t.result[nd],r=>new eo({schema:r}))),id in t.result&&(this.crlExtensions=new Pt({schema:t.result[id]})),this.signatureAlgorithm=new V({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return this.version!==Mt.defaultValues(Hu)&&e.push(new D({value:this.version})),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(this.thisUpdate.toSchema()),this.nextUpdate&&e.push(this.nextUpdate.toSchema()),this.revokedCertificates&&e.push(new E({value:Array.from(this.revokedCertificates,t=>t.toSchema())})),this.crlExtensions&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new E({value:e})}toSchema(e=!1){let t;if(e)t=this.encodeTBS();else{if(!this.tbsView.byteLength)return Mt.schema();const r=Lt(this.tbsView);M.assert(r,"TBS Certificate Revocation List"),t=r.result}return new E({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:Ee.ToHex(this.tbsView),version:this.version,signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==Mt.defaultValues(Hu)&&(e.version=this.version),this.nextUpdate&&(e.nextUpdate=this.nextUpdate.toJSON()),this.revokedCertificates&&(e.revokedCertificates=Array.from(this.revokedCertificates,t=>t.toJSON())),this.crlExtensions&&(e.crlExtensions=this.crlExtensions.toJSON()),e}isCertificateRevoked(e){if(!this.issuer.isEqual(e.issuer)||!this.revokedCertificates)return!1;for(const t of this.revokedCertificates)if(t.userCertificate.isEqual(e.serialNumber))return!0;return!1}async sign(e,t="SHA-1",r=Ve(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await r.getSignatureParameters(e,t),{parameters:n}=a;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await r.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new Pe({valueHex:i})}async verify(e={},t=Ve(!0)){let r;if(e.issuerCertificate&&(r=e.issuerCertificate.subjectPublicKeyInfo,!this.issuer.isEqual(e.issuerCertificate.subject)))return!1;if(e.publicKeyInfo&&(r=e.publicKeyInfo),!r)throw new Error("Issuer's certificate must be provided as an input parameter");if(this.crlExtensions){for(const a of this.crlExtensions.extensions)if(a.critical&&!v2.includes(a.extnID))return!1}return t.verifyWithPublicKey(this.tbsView,this.signatureValue,r,this.signatureAlgorithm)}}Mt.CLASS_NAME="CertificateRevocationList";const zo="crlId",Xo="crlValue",Ku="parsedValue",w2=[zo,Xo];class to extends G{constructor(e={}){super(),this.crlId=m(e,zo,to.defaultValues(zo)),this.crlValue=m(e,Xo,to.defaultValues(Xo)),Ku in e&&(this.parsedValue=m(e,Ku,to.defaultValues(Ku))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zo:return S;case Xo:return new ke;case Ku:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case zo:return t===S;case Xo:return t instanceof ke;case Ku:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.id||"id"}),new T({idBlock:{tagClass:3,tagNumber:0},value:[new ke({name:t.value||"value"})]})]})}fromSchema(e){W(e,w2);const t=j(e,e,to.schema({names:{id:zo,value:Xo}}));switch(M.assertSchema(t,this.className),this.crlId=t.result.crlId.valueBlock.toString(),this.crlValue=t.result.crlValue,this.crlId){case Fp:this.parsedValue=Mt.fromBER(this.certValue.valueBlock.valueHex);break;default:throw new Error(`Incorrect CRL_ID value in CRLBag: ${this.crlId}`)}}toSchema(){return this.parsedValue&&(this.crlId=Fp,this.crlValue=new z({valueHex:this.parsedValue.toSchema().toBER(!1)})),new E({value:[new fe({value:this.crlId}),new T({idBlock:{tagClass:3,tagNumber:0},value:[this.crlValue.toSchema()]})]})}toJSON(){return{crlId:this.crlId,crlValue:this.crlValue.toJSON()}}}to.CLASS_NAME="CRLBag";const Zo="version",el="encryptedContentInfo",Ga="unprotectedAttrs",S2=[Zo,el,Ga];class Rs extends G{constructor(e={}){super(),this.version=m(e,Zo,Rs.defaultValues(Zo)),this.encryptedContentInfo=m(e,el,Rs.defaultValues(el)),Ga in e&&(this.unprotectedAttrs=m(e,Ga,Rs.defaultValues(Ga))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Zo:return 0;case el:return new _t;case Ga:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Zo:return t===0;case el:return _t.compareWithDefault("contentType",t.contentType)&&_t.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&_t.compareWithDefault("encryptedContent",t.encryptedContent);case Ga:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new D({name:t.version||S}),_t.schema(t.encryptedContentInfo||{}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Re({name:t.unprotectedAttrs||S,value:gt.schema()})]})]})}fromSchema(e){W(e,S2);const t=j(e,e,Rs.schema({names:{version:Zo,encryptedContentInfo:{names:{blockName:el}},unprotectedAttrs:Ga}}));M.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.encryptedContentInfo=new _t({schema:t.result.encryptedContentInfo}),Ga in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,r=>new gt({schema:r})))}toSchema(){const e=[];return e.push(new D({value:this.version})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={version:this.version,encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}async encrypt(e,t=Ve(!0)){tt.assert(e,"parameters","object");const r={...e,contentType:"1.2.840.113549.1.7.1"};this.encryptedContentInfo=await t.encryptEncryptedContentInfo(r)}async decrypt(e,t=Ve(!0)){tt.assert(e,"parameters","object");const r={...e,encryptedContentInfo:this.encryptedContentInfo};return t.decryptEncryptedContentInfo(r)}}Rs.CLASS_NAME="EncryptedData";const Ai="encryptionAlgorithm",ja="encryptedData",Fu="parsedValue",C2=[Ai,ja];class pn extends G{constructor(e={}){super(),this.encryptionAlgorithm=m(e,Ai,pn.defaultValues(Ai)),this.encryptedData=m(e,ja,pn.defaultValues(ja)),Fu in e&&(this.parsedValue=m(e,Fu,pn.defaultValues(Fu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ai:return new V;case ja:return new z;case Fu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ai:return V.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case ja:return t.isEqual(pn.defaultValues(e));case Fu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[V.schema(t.encryptionAlgorithm||{names:{blockName:Ai}}),new St({value:[new z({name:t.encryptedData||ja}),new z({idBlock:{isConstructed:!0},name:t.encryptedData||ja})]})]})}fromSchema(e){W(e,C2);const t=j(e,e,pn.schema({names:{encryptionAlgorithm:{names:{blockName:Ai}},encryptedData:ja}}));M.assertSchema(t,this.className),this.encryptionAlgorithm=new V({schema:t.result.encryptionAlgorithm}),this.encryptedData=t.result.encryptedData}toSchema(){return new E({value:[this.encryptionAlgorithm.toSchema(),this.encryptedData]})}toJSON(){return{encryptionAlgorithm:this.encryptionAlgorithm.toJSON(),encryptedData:this.encryptedData.toJSON()}}async parseInternalValues(e,t=Ve(!0)){const a=await new Rs({encryptedContentInfo:new _t({contentEncryptionAlgorithm:this.encryptionAlgorithm,encryptedContent:this.encryptedData})}).decrypt(e,t);this.parsedValue=Wr.fromBER(a)}async makeInternalValues(e,t=Ve(!0)){if(!this.parsedValue)throw new Error('Please initialize "parsedValue" first');const r=new Rs,a={...e,contentToEncrypt:this.parsedValue.toSchema().toBER(!1)};if(await r.encrypt(a,t),!r.encryptedContentInfo.encryptedContent)throw new Error("The filed `encryptedContent` in EncryptedContentInfo is empty");this.encryptionAlgorithm=r.encryptedContentInfo.contentEncryptionAlgorithm,this.encryptedData=r.encryptedContentInfo.encryptedContent}}pn.CLASS_NAME="PKCS8ShroudedKeyBag";const tl="secretTypeId",rl="secretValue",A2=[tl,rl];class hu extends G{constructor(e={}){super(),this.secretTypeId=m(e,tl,hu.defaultValues(tl)),this.secretValue=m(e,rl,hu.defaultValues(rl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tl:return S;case rl:return new ke;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case tl:return t===S;case rl:return t instanceof ke;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.id||"id"}),new T({idBlock:{tagClass:3,tagNumber:0},value:[new ke({name:t.value||"value"})]})]})}fromSchema(e){W(e,A2);const t=j(e,e,hu.schema({names:{id:tl,value:rl}}));M.assertSchema(t,this.className),this.secretTypeId=t.result.secretTypeId.valueBlock.toString(),this.secretValue=t.result.secretValue}toSchema(){return new E({value:[new fe({value:this.secretTypeId}),new T({idBlock:{tagClass:3,tagNumber:0},value:[this.secretValue.toSchema()]})]})}toJSON(){return{secretTypeId:this.secretTypeId,secretValue:this.secretValue.toJSON()}}}hu.CLASS_NAME="SecretBag";class gn{static getItems(){return this.items||(this.items={},gn.register("1.2.840.113549.1.12.10.1.1",Wr),gn.register("1.2.840.113549.1.12.10.1.2",pn),gn.register("1.2.840.113549.1.12.10.1.3",Zi),gn.register("1.2.840.113549.1.12.10.1.4",to),gn.register("1.2.840.113549.1.12.10.1.5",hu),gn.register("1.2.840.113549.1.12.10.1.6",oa)),this.items}static register(e,t){this.getItems()[e]=t}static find(e){return this.getItems()[e]||null}}const bi="bagId",Ei="bagValue",Qs="bagAttributes",b2=[bi,Ei,Qs];class In extends G{constructor(e={}){super(),this.bagId=m(e,bi,In.defaultValues(bi)),this.bagValue=m(e,Ei,In.defaultValues(Ei)),Qs in e&&(this.bagAttributes=m(e,Qs,In.defaultValues(Qs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bi:return S;case Ei:return new ke;case Qs:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bi:return t===S;case Ei:return t instanceof ke;case Qs:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.bagId||bi}),new T({idBlock:{tagClass:3,tagNumber:0},value:[new ke({name:t.bagValue||Ei})]}),new Nt({optional:!0,value:[new Re({name:t.bagAttributes||Qs,value:gt.schema()})]})]})}fromSchema(e){W(e,b2);const t=j(e,e,In.schema({names:{bagId:bi,bagValue:Ei,bagAttributes:Qs}}));M.assertSchema(t,this.className),this.bagId=t.result.bagId.valueBlock.toString();const r=gn.find(this.bagId);if(!r)throw new Error(`Invalid BAG_ID for SafeBag: ${this.bagId}`);this.bagValue=new r({schema:t.result.bagValue}),Qs in t.result&&(this.bagAttributes=Array.from(t.result.bagAttributes,a=>new gt({schema:a})))}toSchema(){const e=[new fe({value:this.bagId}),new T({idBlock:{tagClass:3,tagNumber:0},value:[this.bagValue.toSchema()]})];return this.bagAttributes&&e.push(new Nt({value:Array.from(this.bagAttributes,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={bagId:this.bagId,bagValue:this.bagValue.toJSON()};return this.bagAttributes&&(e.bagAttributes=Array.from(this.bagAttributes,t=>t.toJSON())),e}}In.CLASS_NAME="SafeBag";const No="safeBags";class oa extends G{constructor(e={}){super(),this.safeBags=m(e,No,oa.defaultValues(No)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case No:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case No:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new Re({name:t.safeBags||S,value:In.schema()})]})}fromSchema(e){W(e,[No]);const t=j(e,e,oa.schema({names:{safeBags:No}}));M.assertSchema(t,this.className),this.safeBags=Array.from(t.result.safeBags,r=>new In({schema:r}))}toSchema(){return new E({value:Array.from(this.safeBags,e=>e.toSchema())})}toJSON(){return{safeBags:Array.from(this.safeBags,e=>e.toJSON())}}}oa.CLASS_NAME="SafeContents";const Sf="otherCertFormat",Cf="otherCert",E2=[Sf,Cf];class Vn extends G{constructor(e={}){super(),this.otherCertFormat=m(e,Sf,Vn.defaultValues(Sf)),this.otherCert=m(e,Cf,Vn.defaultValues(Cf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Sf:return S;case Cf:return new ke;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.otherCertFormat||Sf}),new ke({name:t.otherCert||Cf})]})}fromSchema(e){W(e,E2);const t=j(e,e,Vn.schema());M.assertSchema(t,this.className),this.otherCertFormat=t.result.otherCertFormat.valueBlock.toString(),this.otherCert=t.result.otherCert}toSchema(){return new E({value:[new fe({value:this.otherCertFormat}),this.otherCert]})}toJSON(){const e={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof ke||(e.otherCert=this.otherCert.toJSON()),e}}const Af="certificates",x2=[Af];class Ds extends G{constructor(e={}){super(),this.certificates=m(e,Af,Ds.defaultValues(Af)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Af:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new Nt({name:t.blockName||S,value:[new Re({name:t.certificates||Af,value:new St({value:[ze.schema(),new T({idBlock:{tagClass:3,tagNumber:0},value:[new ke]}),new T({idBlock:{tagClass:3,tagNumber:1},value:[new E]}),new T({idBlock:{tagClass:3,tagNumber:2},value:Hr.schema().valueBlock.value}),new T({idBlock:{tagClass:3,tagNumber:3},value:Vn.schema().valueBlock.value})]})})]})}fromSchema(e){W(e,x2);const t=j(e,e,Ds.schema());M.assertSchema(t,this.className),this.certificates=Array.from(t.result.certificates||[],r=>{const a=r.idBlock.tagNumber;if(r.idBlock.tagClass===1)return new ze({schema:r});const n=new E({value:r.valueBlock.value});switch(a){case 1:return n.valueBlock.value[0].valueBlock.value[0].valueBlock.valueDec===1?new Hr({schema:n}):new na({schema:n});case 2:return new Hr({schema:n});case 3:return new Vn({schema:n})}return r})}toSchema(){return new Nt({value:Array.from(this.certificates,e=>{switch(!0){case e instanceof ze:return e.toSchema();case e instanceof na:return new T({idBlock:{tagClass:3,tagNumber:1},value:e.toSchema().valueBlock.value});case e instanceof Hr:return new T({idBlock:{tagClass:3,tagNumber:2},value:e.toSchema().valueBlock.value});case e instanceof Vn:return new T({idBlock:{tagClass:3,tagNumber:3},value:e.toSchema().valueBlock.value})}return e.toSchema()})})}toJSON(){return{certificates:Array.from(this.certificates,e=>e.toJSON())}}}Ds.CLASS_NAME="CertificateSet";const bf="otherRevInfoFormat",Ef="otherRevInfo",B2=[bf,Ef];class ha extends G{constructor(e={}){super(),this.otherRevInfoFormat=m(e,bf,ha.defaultValues(bf)),this.otherRevInfo=m(e,Ef,ha.defaultValues(Ef)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bf:return S;case Ef:return new ke;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.otherRevInfoFormat||bf}),new ke({name:t.otherRevInfo||Ef})]})}fromSchema(e){W(e,B2);const t=j(e,e,ha.schema());M.assertSchema(t,this.className),this.otherRevInfoFormat=t.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=t.result.otherRevInfo}toSchema(){return new E({value:[new fe({value:this.otherRevInfoFormat}),this.otherRevInfo]})}toJSON(){const e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof ke||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}ha.CLASS_NAME="OtherRevocationInfoFormat";const xf="crls",ng="otherRevocationInfos",I2=[xf];class da extends G{constructor(e={}){super(),this.crls=m(e,xf,da.defaultValues(xf)),this.otherRevocationInfos=m(e,ng,da.defaultValues(ng)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xf:return[];case ng:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new Nt({name:t.blockName||S,value:[new Re({name:t.crls||S,value:new St({value:[Mt.schema(),new T({idBlock:{tagClass:3,tagNumber:1},value:[new fe,new ke]})]})})]})}fromSchema(e){W(e,I2);const t=j(e,e,da.schema({names:{crls:xf}}));if(M.assertSchema(t,this.className),t.result.crls)for(const r of t.result.crls)r.idBlock.tagClass===1?this.crls.push(new Mt({schema:r})):this.otherRevocationInfos.push(new ha({schema:r}))}toSchema(){const e=[];return e.push(...Array.from(this.crls,t=>t.toSchema())),e.push(...Array.from(this.otherRevocationInfos,t=>{const r=t.toSchema();return r.idBlock.tagClass=3,r.idBlock.tagNumber=1,r})),new Nt({value:e})}toJSON(){return{crls:Array.from(this.crls,e=>e.toJSON()),otherRevocationInfos:Array.from(this.otherRevocationInfos,e=>e.toJSON())}}}da.CLASS_NAME="RevocationInfoChoices";const Bf="certs",xi="crls",k2=[Bf,xi];class fo extends G{constructor(e={}){super(),this.crls=m(e,xi,fo.defaultValues(xi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bf:return new Ds;case xi:return new da;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Bf:return t.certificates.length===0;case xi:return t.crls.length===0&&t.otherRevocationInfos.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new T({name:t.certs||S,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Ds.schema().valueBlock.value}),new T({name:t.crls||S,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:da.schema().valueBlock.value})]})}fromSchema(e){W(e,k2);const t=j(e,e,fo.schema({names:{certs:Bf,crls:xi}}));M.assertSchema(t,this.className),Bf in t.result&&(this.certs=new Ds({schema:new Nt({value:t.result.certs.valueBlock.value})})),xi in t.result&&(this.crls=new da({schema:new Nt({value:t.result.crls.valueBlock.value})}))}toSchema(){const e=[];return this.certs&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value})),this.crls&&e.push(new T({idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})),new E({value:e})}toJSON(){const e={};return this.certs&&(e.certs=this.certs.toJSON()),this.crls&&(e.crls=this.crls.toJSON()),e}}fo.CLASS_NAME="OriginatorInfo";const If="issuer",kf="serialNumber",N2=[If,kf];class Ut extends G{constructor(e={}){super(),this.issuer=m(e,If,Ut.defaultValues(If)),this.serialNumber=m(e,kf,Ut.defaultValues(kf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case If:return new rt;case kf:return new D;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[rt.schema(t.issuer||{}),new D({name:t.serialNumber||S})]})}fromSchema(e){W(e,N2);const t=j(e,e,Ut.schema({names:{issuer:{names:{blockName:If}},serialNumber:kf}}));M.assertSchema(t,this.className),this.issuer=new rt({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber}toSchema(){return new E({value:[this.issuer.toSchema(),this.serialNumber]})}toJSON(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}Ut.CLASS_NAME="IssuerAndSerialNumber";const Kh="variant",qu="value",T2=["blockName"];class du extends G{constructor(e={}){super(),this.variant=m(e,Kh,du.defaultValues(Kh)),qu in e&&(this.value=m(e,qu,du.defaultValues(qu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Kh:return-1;case qu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Kh:return t===-1;case qu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new St({value:[Ut.schema({names:{blockName:t.blockName||S}}),new Be({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:0}})]})}fromSchema(e){W(e,T2);const t=j(e,e,du.schema({names:{blockName:"blockName"}}));M.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ut({schema:t.result.blockName})):(this.variant=2,this.value=new z({valueHex:t.result.blockName.valueBlock.valueHex}))}toSchema(){switch(this.variant){case 1:if(!(this.value instanceof Ut))throw new Error("Incorrect type of RecipientIdentifier.value. It should be IssuerAndSerialNumber.");return this.value.toSchema();case 2:if(!(this.value instanceof z))throw new Error("Incorrect type of RecipientIdentifier.value. It should be ASN.1 OctetString.");return new Be({idBlock:{tagClass:3,tagNumber:0},valueHex:this.value.valueBlock.valueHexView});default:return new ke}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&this.value&&(e.value=this.value.toJSON()),e}}du.CLASS_NAME="RecipientIdentifier";const Bi="version",sl="rid",al="keyEncryptionAlgorithm",nl="encryptedKey",Fh="recipientCertificate",_2=[Bi,sl,al,nl];class Vr extends G{constructor(e={}){super(),this.version=m(e,Bi,Vr.defaultValues(Bi)),this.rid=m(e,sl,Vr.defaultValues(sl)),this.keyEncryptionAlgorithm=m(e,al,Vr.defaultValues(al)),this.encryptedKey=m(e,nl,Vr.defaultValues(nl)),this.recipientCertificate=m(e,Fh,Vr.defaultValues(Fh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bi:return-1;case sl:return{};case al:return new V;case nl:return new z;case Fh:return new ze;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Bi:return t===Vr.defaultValues(Bi);case sl:return Object.keys(t).length===0;case al:case nl:return t.isEqual(Vr.defaultValues(e));case Fh:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new D({name:t.version||S}),du.schema(t.rid||{}),V.schema(t.keyEncryptionAlgorithm||{}),new z({name:t.encryptedKey||S})]})}fromSchema(e){W(e,_2);const t=j(e,e,Vr.schema({names:{version:Bi,rid:{names:{blockName:sl}},keyEncryptionAlgorithm:{names:{blockName:al}},encryptedKey:nl}}));M.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,t.result.rid.idBlock.tagClass===3?this.rid=new z({valueHex:t.result.rid.valueBlock.valueHex}):this.rid=new Ut({schema:t.result.rid}),this.keyEncryptionAlgorithm=new V({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return this.rid instanceof Ut?(this.version=0,e.push(new D({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new D({value:this.version})),e.push(new Be({idBlock:{tagClass:3,tagNumber:0},valueHex:this.rid.valueBlock.valueHexView}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new E({value:e})}toJSON(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Vr.CLASS_NAME="KeyTransRecipientInfo";const il="algorithm",ol="publicKey",R2=[il,ol];class la extends G{constructor(e={}){super(),this.algorithm=m(e,il,la.defaultValues(il)),this.publicKey=m(e,ol,la.defaultValues(ol)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case il:return new V;case ol:return new Pe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case il:case ol:return t.isEqual(la.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[V.schema(t.algorithm||{}),new Pe({name:t.publicKey||S})]})}fromSchema(e){W(e,R2);const t=j(e,e,la.schema({names:{algorithm:{names:{blockName:il}},publicKey:ol}}));M.assertSchema(t,this.className),this.algorithm=new V({schema:t.result.algorithm}),this.publicKey=t.result.publicKey}toSchema(){return new E({value:[this.algorithm.toSchema(),this.publicKey]})}toJSON(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}la.CLASS_NAME="OriginatorPublicKey";const qh="variant",Ju="value",V2=["blockName"];class ga extends G{constructor(e={}){super(),this.variant=m(e,qh,ga.defaultValues(qh)),Ju in e&&(this.value=m(e,Ju,ga.defaultValues(Ju))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case qh:return-1;case Ju:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case qh:return t===-1;case Ju:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new St({value:[Ut.schema({names:{blockName:t.blockName||S}}),new Be({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||S}),new T({idBlock:{tagClass:3,tagNumber:1},name:t.blockName||S,value:la.schema().valueBlock.value})]})}fromSchema(e){W(e,V2);const t=j(e,e,ga.schema({names:{blockName:"blockName"}}));M.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ut({schema:t.result.blockName})):t.result.blockName.idBlock.tagNumber===0?(t.result.blockName.idBlock.tagClass=1,t.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=t.result.blockName):(this.variant=3,this.value=new la({schema:new E({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:{const e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e}default:return new ke}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2||this.variant===3)&&(e.value=this.value.toJSON()),e}}ga.CLASS_NAME="OriginatorIdentifierOrKey";const ll="keyAttrId",Cs="keyAttr",$2=[ll,Cs];class ms extends G{constructor(e={}){super(),this.keyAttrId=m(e,ll,ms.defaultValues(ll)),Cs in e&&(this.keyAttr=m(e,Cs,ms.defaultValues(Cs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ll:return S;case Cs:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ll:return typeof t=="string"&&t===S;case Cs:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({optional:t.optional||!0,name:t.blockName||S,value:[new fe({name:t.keyAttrId||S}),new ke({optional:!0,name:t.keyAttr||S})]})}fromSchema(e){W(e,$2);const t=j(e,e,ms.schema({names:{keyAttrId:ll,keyAttr:Cs}}));M.assertSchema(t,this.className),this.keyAttrId=t.result.keyAttrId.valueBlock.toString(),Cs in t.result&&(this.keyAttr=t.result.keyAttr)}toSchema(){const e=[];return e.push(new fe({value:this.keyAttrId})),Cs in this&&e.push(this.keyAttr),new E({value:e})}toJSON(){const e={keyAttrId:this.keyAttrId};return Cs in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}ms.CLASS_NAME="OtherKeyAttribute";const Ii="subjectKeyIdentifier",Wa="date",Qa="other",D2=[Ii,Wa,Qa];class Ns extends G{constructor(e={}){super(),this.subjectKeyIdentifier=m(e,Ii,Ns.defaultValues(Ii)),Wa in e&&(this.date=m(e,Wa,Ns.defaultValues(Wa))),Qa in e&&(this.other=m(e,Qa,Ns.defaultValues(Qa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ii:return new z;case Wa:return new wt;case Qa:return new ms;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ii:return t.isEqual(Ns.defaultValues(Ii));case Wa:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case Qa:return t.keyAttrId===S&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new z({name:t.subjectKeyIdentifier||S}),new wt({optional:!0,name:t.date||S}),ms.schema(t.other||{})]})}fromSchema(e){W(e,D2);const t=j(e,e,Ns.schema({names:{subjectKeyIdentifier:Ii,date:Wa,other:{names:{blockName:Qa}}}}));M.assertSchema(t,this.className),this.subjectKeyIdentifier=t.result.subjectKeyIdentifier,Wa in t.result&&(this.date=t.result.date),Qa in t.result&&(this.other=new ms({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.subjectKeyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new E({value:e})}toJSON(){const e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return this.date&&(e.date=this.date.toJSON()),this.other&&(e.other=this.other.toJSON()),e}}Ns.CLASS_NAME="RecipientKeyIdentifier";const Jh="variant",Gh="value",L2=["blockName"];class Ls extends G{constructor(e={}){super(),this.variant=m(e,Jh,Ls.defaultValues(Jh)),this.value=m(e,Gh,Ls.defaultValues(Gh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Jh:return-1;case Gh:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Jh:return t===-1;case Gh:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new St({value:[Ut.schema(t.issuerAndSerialNumber||{names:{blockName:t.blockName||S}}),new T({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:0},value:Ns.schema(t.rKeyId||{names:{blockName:t.blockName||S}}).valueBlock.value})]})}fromSchema(e){W(e,L2);const t=j(e,e,Ls.schema({names:{blockName:"blockName"}}));M.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ut({schema:t.result.blockName})):(this.variant=2,this.value=new Ns({schema:new E({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new T({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new ke}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&(e.value=this.value.toJSON()),e}}Ls.CLASS_NAME="KeyAgreeRecipientIdentifier";const ul="rid",ki="encryptedKey",O2=[ul,ki];class ua extends G{constructor(e={}){super(),this.rid=m(e,ul,ua.defaultValues(ul)),this.encryptedKey=m(e,ki,ua.defaultValues(ki)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ul:return new Ls;case ki:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ul:return t.variant===-1&&!("value"in t);case ki:return t.isEqual(ua.defaultValues(ki));default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[Ls.schema(t.rid||{}),new z({name:t.encryptedKey||S})]})}fromSchema(e){W(e,O2);const t=j(e,e,ua.schema({names:{rid:{names:{blockName:ul}},encryptedKey:ki}}));M.assertSchema(t,this.className),this.rid=new Ls({schema:t.result.rid}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new E({value:[this.rid.toSchema(),this.encryptedKey]})}toJSON(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}ua.CLASS_NAME="RecipientEncryptedKey";const jh="encryptedKeys",K1="RecipientEncryptedKeys",P2=[K1];class $n extends G{constructor(e={}){super(),this.encryptedKeys=m(e,jh,$n.defaultValues(jh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case jh:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case jh:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new Re({name:t.RecipientEncryptedKeys||S,value:ua.schema()})]})}fromSchema(e){W(e,P2);const t=j(e,e,$n.schema({names:{RecipientEncryptedKeys:K1}}));M.assertSchema(t,this.className),this.encryptedKeys=Array.from(t.result.RecipientEncryptedKeys,r=>new ua({schema:r}))}toSchema(){return new E({value:Array.from(this.encryptedKeys,e=>e.toSchema())})}toJSON(){return{encryptedKeys:Array.from(this.encryptedKeys,e=>e.toJSON())}}}$n.CLASS_NAME="RecipientEncryptedKeys";const cl="version",fl="originator",Ys="ukm",hl="keyEncryptionAlgorithm",dl="recipientEncryptedKeys",Wh="recipientCertificate",Qh="recipientPublicKey",U2=[cl,fl,Ys,hl,dl];class xr extends G{constructor(e={}){super(),this.version=m(e,cl,xr.defaultValues(cl)),this.originator=m(e,fl,xr.defaultValues(fl)),Ys in e&&(this.ukm=m(e,Ys,xr.defaultValues(Ys))),this.keyEncryptionAlgorithm=m(e,hl,xr.defaultValues(hl)),this.recipientEncryptedKeys=m(e,dl,xr.defaultValues(dl)),this.recipientCertificate=m(e,Wh,xr.defaultValues(Wh)),this.recipientPublicKey=m(e,Qh,xr.defaultValues(Qh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cl:return 0;case fl:return new ga;case Ys:return new z;case hl:return new V;case dl:return new $n;case Wh:return new ze;case Qh:return null;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case cl:return t===0;case fl:return t.variant===-1&&!("value"in t);case Ys:return t.isEqual(xr.defaultValues(Ys));case hl:return t.algorithmId===S&&!("algorithmParams"in t);case dl:return t.encryptedKeys.length===0;case Wh:return!1;case Qh:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new D({name:t.version||S}),new T({idBlock:{tagClass:3,tagNumber:0},value:[ga.schema(t.originator||{})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new z({name:t.ukm||S})]}),V.schema(t.keyEncryptionAlgorithm||{}),$n.schema(t.recipientEncryptedKeys||{})]})}fromSchema(e){W(e,U2);const t=j(e,e,xr.schema({names:{version:cl,originator:{names:{blockName:fl}},ukm:Ys,keyEncryptionAlgorithm:{names:{blockName:hl}},recipientEncryptedKeys:{names:{blockName:dl}}}}));M.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.originator=new ga({schema:t.result.originator}),Ys in t.result&&(this.ukm=t.result.ukm),this.keyEncryptionAlgorithm=new V({schema:t.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new $n({schema:t.result.recipientEncryptedKeys})}toSchema(){const e=[];return e.push(new D({value:this.version})),e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),this.ukm&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new E({value:e})}toJSON(){const e={version:this.version,originator:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()};return this.ukm&&(e.ukm=this.ukm.toJSON()),e}}xr.CLASS_NAME="KeyAgreeRecipientInfo";const Ni="keyIdentifier",Ya="date",za="other",M2=[Ni,Ya,za];class cs extends G{constructor(e={}){super(),this.keyIdentifier=m(e,Ni,cs.defaultValues(Ni)),Ya in e&&(this.date=m(e,Ya,cs.defaultValues(Ya))),za in e&&(this.other=m(e,za,cs.defaultValues(za))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ni:return new z;case Ya:return new wt;case za:return new ms;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ni:return t.isEqual(cs.defaultValues(Ni));case Ya:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case za:return t.compareWithDefault("keyAttrId",t.keyAttrId)&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new z({name:t.keyIdentifier||S}),new wt({optional:!0,name:t.date||S}),ms.schema(t.other||{})]})}fromSchema(e){W(e,M2);const t=j(e,e,cs.schema({names:{keyIdentifier:Ni,date:Ya,other:{names:{blockName:za}}}}));M.assertSchema(t,this.className),this.keyIdentifier=t.result.keyIdentifier,Ya in t.result&&(this.date=t.result.date),za in t.result&&(this.other=new ms({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.keyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new E({value:e})}toJSON(){const e={keyIdentifier:this.keyIdentifier.toJSON()};return this.date&&(e.date=this.date),this.other&&(e.other=this.other.toJSON()),e}}cs.CLASS_NAME="KEKIdentifier";const gl="version",ml="kekid",pl="keyEncryptionAlgorithm",Ti="encryptedKey",Yh="preDefinedKEK",H2=[gl,ml,pl,Ti];class $r extends G{constructor(e={}){super(),this.version=m(e,gl,$r.defaultValues(gl)),this.kekid=m(e,ml,$r.defaultValues(ml)),this.keyEncryptionAlgorithm=m(e,pl,$r.defaultValues(pl)),this.encryptedKey=m(e,Ti,$r.defaultValues(Ti)),this.preDefinedKEK=m(e,Yh,$r.defaultValues(Yh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gl:return 0;case ml:return new cs;case pl:return new V;case Ti:return new z;case Yh:return Ot;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"KEKRecipientInfo":return t===$r.defaultValues(gl);case ml:return t.compareWithDefault("keyIdentifier",t.keyIdentifier)&&!("date"in t)&&!("other"in t);case pl:return t.algorithmId===S&&!("algorithmParams"in t);case Ti:return t.isEqual($r.defaultValues(Ti));case Yh:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new D({name:t.version||S}),cs.schema(t.kekid||{}),V.schema(t.keyEncryptionAlgorithm||{}),new z({name:t.encryptedKey||S})]})}fromSchema(e){W(e,H2);const t=j(e,e,$r.schema({names:{version:gl,kekid:{names:{blockName:ml}},keyEncryptionAlgorithm:{names:{blockName:pl}},encryptedKey:Ti}}));M.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.kekid=new cs({schema:t.result.kekid}),this.keyEncryptionAlgorithm=new V({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new E({value:[new D({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}toJSON(){return{version:this.version,kekid:this.kekid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}$r.CLASS_NAME="KEKRecipientInfo";const yl="version",Xa="keyDerivationAlgorithm",vl="keyEncryptionAlgorithm",_i="encryptedKey",zh="password",K2=[yl,Xa,vl,_i];class jr extends G{constructor(e={}){super(),this.version=m(e,yl,jr.defaultValues(yl)),Xa in e&&(this.keyDerivationAlgorithm=m(e,Xa,jr.defaultValues(Xa))),this.keyEncryptionAlgorithm=m(e,vl,jr.defaultValues(vl)),this.encryptedKey=m(e,_i,jr.defaultValues(_i)),this.password=m(e,zh,jr.defaultValues(zh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case yl:return-1;case Xa:return new V;case vl:return new V;case _i:return new z;case zh:return Ot;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case yl:return t===-1;case Xa:case vl:return t.algorithmId===S&&!("algorithmParams"in t);case _i:return t.isEqual(jr.defaultValues(_i));case zh:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new D({name:t.version||S}),new T({name:t.keyDerivationAlgorithm||S,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:V.schema().valueBlock.value}),V.schema(t.keyEncryptionAlgorithm||{}),new z({name:t.encryptedKey||S})]})}fromSchema(e){W(e,K2);const t=j(e,e,jr.schema({names:{version:yl,keyDerivationAlgorithm:Xa,keyEncryptionAlgorithm:{names:{blockName:vl}},encryptedKey:_i}}));M.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Xa in t.result&&(this.keyDerivationAlgorithm=new V({schema:new E({value:t.result.keyDerivationAlgorithm.valueBlock.value})})),this.keyEncryptionAlgorithm=new V({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return e.push(new D({value:this.version})),this.keyDerivationAlgorithm&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new E({value:e})}toJSON(){const e={version:this.version,keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()};return this.keyDerivationAlgorithm&&(e.keyDerivationAlgorithm=this.keyDerivationAlgorithm.toJSON()),e}}jr.CLASS_NAME="PasswordRecipientInfo";const wl="oriType",Ri="oriValue",F2=[wl,Ri];class kn extends G{constructor(e={}){super(),this.oriType=m(e,wl,kn.defaultValues(wl)),this.oriValue=m(e,Ri,kn.defaultValues(Ri)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wl:return S;case Ri:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case wl:return t===S;case Ri:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.oriType||S}),new ke({name:t.oriValue||S})]})}fromSchema(e){W(e,F2);const t=j(e,e,kn.schema({names:{oriType:wl,oriValue:Ri}}));M.assertSchema(t,this.className),this.oriType=t.result.oriType.valueBlock.toString(),this.oriValue=t.result.oriValue}toSchema(){return new E({value:[new fe({value:this.oriType}),this.oriValue]})}toJSON(){const e={oriType:this.oriType};return kn.compareWithDefault(Ri,this.oriValue)||(e.oriValue=this.oriValue.toJSON()),e}}kn.CLASS_NAME="OtherRecipientInfo";const Xh="variant",Gu="value",q2=["blockName"];class Qr extends G{constructor(e={}){super(),this.variant=m(e,Xh,Qr.defaultValues(Xh)),Gu in e&&(this.value=m(e,Gu,Qr.defaultValues(Gu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xh:return-1;case Gu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Xh:return t===Qr.defaultValues(e);case Gu:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new St({value:[Vr.schema({names:{blockName:t.blockName||S}}),new T({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:1},value:xr.schema().valueBlock.value}),new T({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:2},value:$r.schema().valueBlock.value}),new T({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:3},value:jr.schema().valueBlock.value}),new T({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:4},value:kn.schema().valueBlock.value})]})}fromSchema(e){W(e,q2);const t=j(e,e,Qr.schema({names:{blockName:"blockName"}}));if(M.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1)this.variant=1,this.value=new Vr({schema:t.result.blockName});else{const r=new E({value:t.result.blockName.valueBlock.value});switch(t.result.blockName.idBlock.tagNumber){case 1:this.variant=2,this.value=new xr({schema:r});break;case 2:this.variant=3,this.value=new $r({schema:r});break;case 3:this.variant=4,this.value=new jr({schema:r});break;case 4:this.variant=5,this.value=new kn({schema:r});break;default:throw new Error("Incorrect structure of RecipientInfo block")}}}toSchema(){Fe.assertEmpty(this.value,"value","RecipientInfo");const e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new ke}}toJSON(){const e={variant:this.variant};return this.value&&this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}Qr.CLASS_NAME="RecipientInfo";const Za="hashAlgorithm",en="maskGenAlgorithm",tn="pSourceAlgorithm",J2=[Za,en,tn];class pr extends G{constructor(e={}){super(),this.hashAlgorithm=m(e,Za,pr.defaultValues(Za)),this.maskGenAlgorithm=m(e,en,pr.defaultValues(en)),this.pSourceAlgorithm=m(e,tn,pr.defaultValues(tn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Za:return new V({algorithmId:"1.3.14.3.2.26",algorithmParams:new kt});case en:return new V({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new V({algorithmId:"1.3.14.3.2.26",algorithmParams:new kt}).toSchema()});case tn:return new V({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new z({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new T({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[V.schema(t.hashAlgorithm||{})]}),new T({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[V.schema(t.maskGenAlgorithm||{})]}),new T({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[V.schema(t.pSourceAlgorithm||{})]})]})}fromSchema(e){W(e,J2);const t=j(e,e,pr.schema({names:{hashAlgorithm:{names:{blockName:Za}},maskGenAlgorithm:{names:{blockName:en}},pSourceAlgorithm:{names:{blockName:tn}}}}));M.assertSchema(t,this.className),Za in t.result&&(this.hashAlgorithm=new V({schema:t.result.hashAlgorithm})),en in t.result&&(this.maskGenAlgorithm=new V({schema:t.result.maskGenAlgorithm})),tn in t.result&&(this.pSourceAlgorithm=new V({schema:t.result.pSourceAlgorithm}))}toSchema(){const e=[];return this.hashAlgorithm.isEqual(pr.defaultValues(Za))||e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(pr.defaultValues(en))||e.push(new T({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(pr.defaultValues(tn))||e.push(new T({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new E({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(pr.defaultValues(Za))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(pr.defaultValues(en))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(pr.defaultValues(tn))||(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e}}pr.CLASS_NAME="RSAESOAEPParams";const Sl="keyInfo",rn="entityUInfo",Cl="suppPubInfo",G2=[Sl,rn,Cl];class ra extends G{constructor(e={}){super(),this.keyInfo=m(e,Sl,ra.defaultValues(Sl)),rn in e&&(this.entityUInfo=m(e,rn,ra.defaultValues(rn))),this.suppPubInfo=m(e,Cl,ra.defaultValues(Cl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Sl:return new V;case rn:return new z;case Cl:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Sl:case rn:case Cl:return t.isEqual(ra.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[V.schema(t.keyInfo||{}),new T({name:t.entityUInfo||S,idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new z]}),new T({name:t.suppPubInfo||S,idBlock:{tagClass:3,tagNumber:2},value:[new z]})]})}fromSchema(e){W(e,G2);const t=j(e,e,ra.schema({names:{keyInfo:{names:{blockName:Sl}},entityUInfo:rn,suppPubInfo:Cl}}));M.assertSchema(t,this.className),this.keyInfo=new V({schema:t.result.keyInfo}),rn in t.result&&(this.entityUInfo=t.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=t.result.suppPubInfo.valueBlock.value[0]}toSchema(){const e=[];return e.push(this.keyInfo.toSchema()),this.entityUInfo&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new T({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new E({value:e})}toJSON(){const e={keyInfo:this.keyInfo.toJSON(),suppPubInfo:this.suppPubInfo.toJSON()};return this.entityUInfo&&(e.entityUInfo=this.entityUInfo.toJSON()),e}}ra.CLASS_NAME="ECCCMSSharedInfo";const Al="version",sn="originatorInfo",bl="recipientInfos",El="encryptedContentInfo",an="unprotectedAttrs",j2=[Al,sn,bl,El,an],oy={kdfAlgorithm:"SHA-512",kekEncryptionLength:256},W2={"P-256":256,"P-384":384,"P-521":528};class ls extends G{constructor(e={}){super(),this.version=m(e,Al,ls.defaultValues(Al)),sn in e&&(this.originatorInfo=m(e,sn,ls.defaultValues(sn))),this.recipientInfos=m(e,bl,ls.defaultValues(bl)),this.encryptedContentInfo=m(e,El,ls.defaultValues(El)),an in e&&(this.unprotectedAttrs=m(e,an,ls.defaultValues(an))),this.policy={disableSplit:!!e.disableSplit},e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Al:return 0;case sn:return new fo;case bl:return[];case El:return new _t;case an:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Al:return t===ls.defaultValues(e);case sn:return t.certs.certificates.length===0&&t.crls.crls.length===0;case bl:case an:return t.length===0;case El:return _t.compareWithDefault("contentType",t.contentType)&&_t.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&_t.compareWithDefault("encryptedContent",t.encryptedContent);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new D({name:t.version||S}),new T({name:t.originatorInfo||S,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:fo.schema().valueBlock.value}),new Nt({value:[new Re({name:t.recipientInfos||S,value:Qr.schema()})]}),_t.schema(t.encryptedContentInfo||{}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Re({name:t.unprotectedAttrs||S,value:gt.schema()})]})]})}fromSchema(e){W(e,j2);const t=j(e,e,ls.schema({names:{version:Al,originatorInfo:sn,recipientInfos:bl,encryptedContentInfo:{names:{blockName:El}},unprotectedAttrs:an}}));M.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,sn in t.result&&(this.originatorInfo=new fo({schema:new E({value:t.result.originatorInfo.valueBlock.value})})),this.recipientInfos=Array.from(t.result.recipientInfos,r=>new Qr({schema:r})),this.encryptedContentInfo=new _t({schema:t.result.encryptedContentInfo}),an in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,r=>new gt({schema:r})))}toSchema(){const e=[];return e.push(new D({value:this.version})),this.originatorInfo&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new Nt({value:Array.from(this.recipientInfos,t=>t.toSchema())})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={version:this.version,recipientInfos:Array.from(this.recipientInfos,t=>t.toJSON()),encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.originatorInfo&&(e.originatorInfo=this.originatorInfo.toJSON()),this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}addRecipientByCertificate(e,t,r,a=Ve(!0)){const n=Object.assign({useOAEP:!0,oaepHashAlgorithm:"SHA-512"},oy,t||{});if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549")!==-1)r=1;else if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045")!==-1)r=2;else throw new Error(`Unknown type of certificate's public key: ${e.subjectPublicKeyInfo.algorithm.algorithmId}`);switch(r){case 1:{let i,o;if(n.useOAEP===!0){i=a.getOIDByAlgorithm({name:"RSA-OAEP"},!0,"keyEncryptionAlgorithm");const u=a.getOIDByAlgorithm({name:n.oaepHashAlgorithm},!0,"RSAES-OAEP-params"),c=new V({algorithmId:u,algorithmParams:new kt});o=new pr({hashAlgorithm:c,maskGenAlgorithm:new V({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:c.toSchema()})}).toSchema()}else{if(i=a.getOIDByAlgorithm({name:"RSAES-PKCS1-v1_5"}),i===S)throw new Error("Can not find OID for RSAES-PKCS1-v1_5");o=new kt}const l=new Vr({version:0,rid:new Ut({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new V({algorithmId:i,algorithmParams:o}),recipientCertificate:e});this.recipientInfos.push(new Qr({variant:1,value:l}))}break;case 2:{const i=new Ls({variant:1,value:new Ut({issuer:e.issuer,serialNumber:e.serialNumber})});this._addKeyAgreeRecipientInfo(i,n,{recipientCertificate:e},a)}break;default:throw new Error(`Unknown "variant" value: ${r}`)}return!0}addRecipientByPreDefinedData(e,t={},r,a=Ve(!0)){if(tt.assert(e,"preDefinedData","ArrayBuffer"),!e.byteLength)throw new Error("Pre-defined data could have zero length");if(!t.keyIdentifier){const n=new ArrayBuffer(16),i=new Uint8Array(n);a.getRandomValues(i),t.keyIdentifier=n}switch(t.hmacHashAlgorithm||(t.hmacHashAlgorithm="SHA-512"),t.iterationCount===void 0&&(t.iterationCount=2048),t.keyEncryptionAlgorithm||(t.keyEncryptionAlgorithm={name:"AES-KW",length:256}),t.keyEncryptionAlgorithmParams||(t.keyEncryptionAlgorithmParams=new kt),r){case 1:{const n=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),i=new $r({version:4,kekid:new cs({keyIdentifier:new z({valueHex:t.keyIdentifier})}),keyEncryptionAlgorithm:new V({algorithmId:n,algorithmParams:t.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new Qr({variant:3,value:i}))}break;case 2:{const n=a.getOIDByAlgorithm({name:"PBKDF2"},!0,"keyDerivationAlgorithm"),i=new ArrayBuffer(64),o=new Uint8Array(i);a.getRandomValues(o);const l=a.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),u=new fr({salt:new z({valueHex:i}),iterationCount:t.iterationCount,prf:new V({algorithmId:l,algorithmParams:new kt})}),c=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),f=new jr({version:0,keyDerivationAlgorithm:new V({algorithmId:n,algorithmParams:u.toSchema()}),keyEncryptionAlgorithm:new V({algorithmId:c,algorithmParams:t.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new Qr({variant:4,value:f}))}break;default:throw new Error(`Unknown value for "variant": ${r}`)}}addRecipientByKeyIdentifier(e,t,r,a=Ve(!0)){const n=Object.assign({},oy,r||{}),i=new Ls({variant:2,value:new Ns({subjectKeyIdentifier:new z({valueHex:t})})});this._addKeyAgreeRecipientInfo(i,n,{recipientPublicKey:e},a)}_addKeyAgreeRecipientInfo(e,t,r,a=Ve(!0)){const n=new ua({rid:e}),i=a.getOIDByAlgorithm({name:"AES-KW",length:t.kekEncryptionLength},!0,"keyEncryptionAlgorithm"),o=new V({algorithmId:i}),l=a.getOIDByAlgorithm({name:"ECDH",kdf:t.kdfAlgorithm},!0,"KeyAgreeRecipientInfo"),u=new ArrayBuffer(64),c=new Uint8Array(u);a.getRandomValues(c);const f={version:3,ukm:new z({valueHex:u}),keyEncryptionAlgorithm:new V({algorithmId:l,algorithmParams:o.toSchema()}),recipientEncryptedKeys:new $n({encryptedKeys:[n]})},g=new xr(Object.assign(f,r));this.recipientInfos.push(new Qr({variant:2,value:g}))}async encrypt(e,t,r=Ve(!0)){const a=new ArrayBuffer(16),n=new Uint8Array(a);r.getRandomValues(n);const i=new Uint8Array(t),o=r.getOIDByAlgorithm(e,!0,"contentEncryptionAlgorithm"),l=await r.generateKey(e,!0,["encrypt"]),u=await r.encrypt({name:e.name,iv:n},l,i),c=await r.exportKey("raw",l);this.version=2,this.encryptedContentInfo=new _t({disableSplit:this.policy.disableSplit,contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new V({algorithmId:o,algorithmParams:new z({valueHex:a})}),encryptedContent:new z({valueHex:u})});const f=async d=>{const y=this.recipientInfos[d].value;let A,x;if(y.recipientPublicKey)A=y.recipientPublicKey.algorithm.namedCurve,x=y.recipientPublicKey;else if(y.recipientCertificate){const re=y.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(re.constructor.blockName()!==fe.blockName())throw new Error(`Incorrect "recipientCertificate" for index ${d}`);switch(re.valueBlock.toString()){case"1.2.840.10045.3.1.7":A="P-256";break;case"1.3.132.0.34":A="P-384";break;case"1.3.132.0.35":A="P-521";break;default:throw new Error(`Incorrect curve OID for index ${d}`)}x=await y.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:A},usages:[]}},r)}else throw new Error("Unsupported RecipientInfo");const N=W2[A],_=await r.generateKey({name:"ECDH",namedCurve:A},!0,["deriveBits"]),$=await r.exportKey("spki",_.publicKey),se=await r.deriveBits({name:"ECDH",public:x},_.privateKey,N),te=new V({schema:y.keyEncryptionAlgorithm.algorithmParams}),me=r.getAlgorithmByOID(te.algorithmId,!0,"aesKWAlgorithm");let Ce=me.length;const pe=new ArrayBuffer(4),ve=new Uint8Array(pe);for(let re=3;re>=0;re--)ve[re]=Ce,Ce>>=8;const Ye=new ra({keyInfo:new V({algorithmId:te.algorithmId}),entityUInfo:y.ukm,suppPubInfo:new z({valueHex:pe})}).toSchema().toBER(!1),Ae=r.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm"),Ue=await Wp(Ae.kdf,se,me.length,Ye,r),oe=await r.importKey("raw",Ue,{name:"AES-KW"},!0,["wrapKey"]),xt=await r.wrapKey("raw",l,oe,{name:"AES-KW"}),je=new ga;return je.variant=3,je.value=la.fromBER($),y.originator=je,y.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new z({valueHex:xt}),{ecdhPrivateKey:_.privateKey}},g=async d=>{const y=this.recipientInfos[d].value,A=r.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(A.name==="RSA-OAEP"){const x=y.keyEncryptionAlgorithm.algorithmParams,N=new pr({schema:x});if(A.hash=r.getAlgorithmByOID(N.hashAlgorithm.algorithmId),!("name"in A.hash))throw new Error(`Incorrect OID for hash algorithm: ${N.hashAlgorithm.algorithmId}`)}try{const x=await y.recipientCertificate.getPublicKey({algorithm:{algorithm:A,usages:["encrypt","wrapKey"]}},r),N=await r.encrypt(x.algorithm,x,c);y.encryptedKey=new z({valueHex:N})}catch{}},v=async d=>{const y=this.recipientInfos[d].value,A=r.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),x=await r.importKey("raw",new Uint8Array(y.preDefinedKEK),A,!0,["wrapKey"]),N=await r.wrapKey("raw",l,x,A);y.encryptedKey=new z({valueHex:N})},p=async d=>{const y=this.recipientInfos[d].value;let A;if(!y.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!y.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{A=new fr({schema:y.keyDerivationAlgorithm.algorithmParams})}catch{throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const x=new Uint8Array(y.password),N=await r.importKey("raw",x,"PBKDF2",!1,["deriveKey"]),_=r.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm");let $="SHA-1";A.prf&&($=r.getAlgorithmByOID(A.prf.algorithmId,!0,"prfAlgorithm").hash.name);const se=new Uint8Array(A.salt.valueBlock.valueHex),te=A.iterationCount,me=await r.deriveKey({name:"PBKDF2",hash:{name:$},salt:se,iterations:te},N,_,!0,["wrapKey"]),Ce=await r.wrapKey("raw",l,me,_);y.encryptedKey=new z({valueHex:Ce})},h=[];for(let d=0;d<this.recipientInfos.length;d++)switch(this.recipientInfos[d].variant){case 1:h.push(await g(d));break;case 2:h.push(await f(d));break;case 3:h.push(await v(d));break;case 4:h.push(await p(d));break;default:throw new Error(`Unknown recipient type in array with index ${d}`)}return h}async decrypt(e,t,r=Ve(!0)){const a=t||{};if(e+1>this.recipientInfos.length)throw new Error(`Maximum value for "index" is: ${this.recipientInfos.length-1}`);const n=async h=>{const d=this.recipientInfos[h].value;let y,A,x;const N=d.originator;if(a.recipientCertificate){const Ae=a.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(Ae.constructor.blockName()!==fe.blockName())throw new Error(`Incorrect "recipientCertificate" for index ${h}`);y=Ae.valueBlock.toString()}else if(N.value.algorithm.algorithmParams){const Ae=N.value.algorithm.algorithmParams;if(Ae.constructor.blockName()!==fe.blockName())throw new Error(`Incorrect originator for index ${h}`);y=Ae.valueBlock.toString()}else throw new Error('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo" if algorithm params are missing from originator');if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');switch(y){case"1.2.840.10045.3.1.7":A="P-256",x=256;break;case"1.3.132.0.34":A="P-384",x=384;break;case"1.3.132.0.35":A="P-521",x=528;break;default:throw new Error(`Incorrect curve OID for index ${h}`)}let _,$=r;Se.isBufferSource(a.recipientPrivateKey)?_=await r.importKey("pkcs8",a.recipientPrivateKey,{name:"ECDH",namedCurve:A},!0,["deriveBits"]):(_=a.recipientPrivateKey,"crypto"in a&&a.crypto&&($=a.crypto.subtle)),"algorithmParams"in N.value.algorithm||(N.value.algorithm.algorithmParams=new fe({value:y}));const se=N.value.toSchema().toBER(!1),te=await r.importKey("spki",se,{name:"ECDH",namedCurve:A},!0,[]),me=await $.deriveBits({name:"ECDH",public:te},_,x);async function Ce(Ae){Ae=Ae||!1;const Ue=new V({schema:d.keyEncryptionAlgorithm.algorithmParams}),oe=r.getAlgorithmByOID(Ue.algorithmId,!0,"kwAlgorithm");let xt=oe.length;const je=new ArrayBuffer(4),re=new Uint8Array(je);for(let He=3;He>=0;He--)re[He]=xt,xt>>=8;const de={algorithmId:Ue.algorithmId};Ae&&(de.algorithmParams=new kt);const ye=new ra({keyInfo:new V(de),entityUInfo:d.ukm,suppPubInfo:new z({valueHex:je})}).toSchema().toBER(!1),Te=r.getAlgorithmByOID(d.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm");if(!Te.name)throw new Error(`Incorrect OID for key encryption algorithm: ${d.keyEncryptionAlgorithm.algorithmId}`);return Wp(Te.kdf,me,oe.length,ye,r)}const pe=await Ce(),ve=async Ae=>r.importKey("raw",Ae,{name:"AES-KW"},!0,["unwrapKey"]),it=await ve(pe),Ye=async Ae=>{const Ue=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,oe=r.getAlgorithmByOID(Ue,!0,"contentEncryptionAlgorithm");return r.unwrapKey("raw",d.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHexView,Ae,{name:"AES-KW"},oe,!0,["decrypt"])};try{return await Ye(it)}catch{const Ae=await Ce(!0),Ue=await ve(Ae);return Ye(Ue)}},i=async h=>{const d=this.recipientInfos[h].value;if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');const y=r.getAlgorithmByOID(d.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(y.name==="RSA-OAEP"){const se=d.keyEncryptionAlgorithm.algorithmParams,te=new pr({schema:se});if(y.hash=r.getAlgorithmByOID(te.hashAlgorithm.algorithmId),!("name"in y.hash))throw new Error(`Incorrect OID for hash algorithm: ${te.hashAlgorithm.algorithmId}`)}let A,x=r;Se.isBufferSource(a.recipientPrivateKey)?A=await r.importKey("pkcs8",a.recipientPrivateKey,y,!0,["decrypt"]):(A=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(x=a.crypto.subtle));const N=await x.decrypt(A.algorithm,A,d.encryptedKey.valueBlock.valueHexView),_=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,$=r.getAlgorithmByOID(_,!0,"contentEncryptionAlgorithm");if(!("name"in $))throw new Error(`Incorrect "contentEncryptionAlgorithm": ${_}`);return r.importKey("raw",N,$,!0,["decrypt"])},o=async h=>{const d=this.recipientInfos[h].value;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');const y=r.getAlgorithmByOID(d.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),A=await r.importKey("raw",a.preDefinedData,y,!0,["unwrapKey"]),x=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,N=r.getAlgorithmByOID(x,!0,"contentEncryptionAlgorithm");if(!N.name)throw new Error(`Incorrect "contentEncryptionAlgorithm": ${x}`);return r.unwrapKey("raw",d.encryptedKey.valueBlock.valueHexView,A,y,N,!0,["decrypt"])},l=async h=>{const d=this.recipientInfos[h].value;let y;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');if(!d.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!d.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{y=new fr({schema:d.keyDerivationAlgorithm.algorithmParams})}catch{throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const A=await r.importKey("raw",a.preDefinedData,"PBKDF2",!1,["deriveKey"]),x=r.getAlgorithmByOID(d.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm"),N=y.prf?r.getAlgorithmByOID(y.prf.algorithmId,!0,"prfAlgorithm").hash.name:"SHA-1",_=new Uint8Array(y.salt.valueBlock.valueHex),$=y.iterationCount,se=await r.deriveKey({name:"PBKDF2",hash:{name:N},salt:_,iterations:$},A,x,!0,["unwrapKey"]),te=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,me=r.getAlgorithmByOID(te,!0,"contentEncryptionAlgorithm");return r.unwrapKey("raw",d.encryptedKey.valueBlock.valueHexView,se,x,me,!0,["decrypt"])};let u;switch(this.recipientInfos[e].variant){case 1:u=await i(e);break;case 2:u=await n(e);break;case 3:u=await o(e);break;case 4:u=await l(e);break;default:throw new Error(`Unknown recipient type in array with index ${e}`)}const c=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,f=r.getAlgorithmByOID(c,!0,"contentEncryptionAlgorithm"),g=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex,v=new Uint8Array(g);if(!this.encryptedContentInfo.encryptedContent)throw new Error("Required property `encryptedContent` is empty");const p=this.encryptedContentInfo.getEncryptedContent();return r.decrypt({name:f.name,iv:v},u,p)}}ls.CLASS_NAME="EnvelopedData";const To="safeContents",ju="parsedValue",ly="contentInfos";class ho extends G{constructor(e={}){super(),this.safeContents=m(e,To,ho.defaultValues(To)),ju in e&&(this.parsedValue=m(e,ju,ho.defaultValues(ju))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case To:return[];case ju:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case To:return t.length===0;case ju:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new Re({name:t.contentInfos||S,value:ct.schema()})]})}fromSchema(e){W(e,[ly]);const t=j(e,e,ho.schema({names:{contentInfos:ly}}));M.assertSchema(t,this.className),this.safeContents=Array.from(t.result.contentInfos,r=>new ct({schema:r}))}toSchema(){return new E({value:Array.from(this.safeContents,e=>e.toSchema())})}toJSON(){return{safeContents:Array.from(this.safeContents,e=>e.toJSON())}}async parseInternalValues(e,t=Ve(!0)){if(Fe.assert(e,To),tt.assert(e.safeContents,To,"Array"),e.safeContents.length!==this.safeContents.length)throw new tt('Length of "parameters.safeContents" must be equal to "this.safeContents.length"');this.parsedValue={safeContents:[]};for(const[r,a]of this.safeContents.entries()){const n=e.safeContents[r],i=`parameters.safeContents[${r}]`;switch(a.contentType){case Km:{tt.assert(a.content,"this.safeContents[j].content",z);const o=a.content.getValue();this.parsedValue.safeContents.push({privacyMode:0,value:oa.fromBER(o)})}break;case $1:{const o=new ls({schema:a.content});Fe.assert(i,n,"recipientCertificate","recipientKey");const l=n,u=l.recipientCertificate,c=l.recipientKey,f=await o.decrypt(0,{recipientCertificate:u,recipientPrivateKey:c},t);this.parsedValue.safeContents.push({privacyMode:2,value:oa.fromBER(f)})}break;case D1:{const o=new Rs({schema:a.content});Fe.assert(i,n,"password");const l=n.password,u=await o.decrypt({password:l},t);this.parsedValue.safeContents.push({privacyMode:1,value:oa.fromBER(u)})}break;default:throw new Error(`Unknown "contentType" for AuthenticatedSafe: " ${a.contentType}`)}}}async makeInternalValues(e,t=Ve(!0)){if(!this.parsedValue)throw new Error('Please run "parseValues" first or add "parsedValue" manually');if(tt.assert(this.parsedValue,"this.parsedValue","object"),tt.assert(this.parsedValue.safeContents,"this.parsedValue.safeContents","Array"),tt.assert(e,"parameters","object"),Fe.assert(e,"safeContents"),tt.assert(e.safeContents,"parameters.safeContents","Array"),e.safeContents.length!==this.parsedValue.safeContents.length)throw new tt('Length of "parameters.safeContents" must be equal to "this.parsedValue.safeContents"');this.safeContents=[];for(const[r,a]of this.parsedValue.safeContents.entries())switch(Fe.assert("content",a,"privacyMode","value"),tt.assert(a.value,"content.value",oa),a.privacyMode){case 0:{const n=a.value.toSchema().toBER(!1);this.safeContents.push(new ct({contentType:"1.2.840.113549.1.7.1",content:new z({valueHex:n})}))}break;case 1:{const n=new Rs,i=e.safeContents[r];i.contentToEncrypt=a.value.toSchema().toBER(!1),await n.encrypt(i,t),this.safeContents.push(new ct({contentType:"1.2.840.113549.1.7.6",content:n.toSchema()}))}break;case 2:{const n=new ls,i=a.value.toSchema().toBER(!1),o=e.safeContents[r];switch(Fe.assert(`parameters.safeContents[${r}]`,o,"encryptingCertificate","encryptionAlgorithm"),!0){case o.encryptionAlgorithm.name.toLowerCase()==="aes-cbc":case o.encryptionAlgorithm.name.toLowerCase()==="aes-gcm":break;default:throw new Error(`Incorrect parameter "encryptionAlgorithm" in "parameters.safeContents[i]": ${o.encryptionAlgorithm}`)}switch(!0){case o.encryptionAlgorithm.length===128:case o.encryptionAlgorithm.length===192:case o.encryptionAlgorithm.length===256:break;default:throw new Error(`Incorrect parameter "encryptionAlgorithm.length" in "parameters.safeContents[i]": ${o.encryptionAlgorithm.length}`)}const l=o.encryptionAlgorithm;n.addRecipientByCertificate(o.encryptingCertificate,{},void 0,t),await n.encrypt(l,i,t),this.safeContents.push(new ct({contentType:"1.2.840.113549.1.7.3",content:n.toSchema()}))}break;default:throw new Error(`Incorrect value for "content.privacyMode": ${a.privacyMode}`)}return this}}ho.CLASS_NAME="AuthenticatedSafe";const Vi="hashAlgorithm",xl="issuerNameHash",Bl="issuerKeyHash",$i="serialNumber",Q2=[Vi,xl,Bl,$i];class Vt extends G{static async create(e,t,r=Ve(!0)){const a=new Vt;return await a.createForCertificate(e,t,r),a}constructor(e={}){super(),this.hashAlgorithm=m(e,Vi,Vt.defaultValues(Vi)),this.issuerNameHash=m(e,xl,Vt.defaultValues(xl)),this.issuerKeyHash=m(e,Bl,Vt.defaultValues(Bl)),this.serialNumber=m(e,$i,Vt.defaultValues($i)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vi:return new V;case xl:case Bl:return new z;case $i:return new D;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Vi:return t.algorithmId===S&&!("algorithmParams"in t);case xl:case Bl:case $i:return t.isEqual(Vt.defaultValues($i));default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[V.schema(t.hashAlgorithmObject||{names:{blockName:t.hashAlgorithm||S}}),new z({name:t.issuerNameHash||S}),new z({name:t.issuerKeyHash||S}),new D({name:t.serialNumber||S})]})}fromSchema(e){W(e,Q2);const t=j(e,e,Vt.schema({names:{hashAlgorithm:Vi,issuerNameHash:xl,issuerKeyHash:Bl,serialNumber:$i}}));M.assertSchema(t,this.className),this.hashAlgorithm=new V({schema:t.result.hashAlgorithm}),this.issuerNameHash=t.result.issuerNameHash,this.issuerKeyHash=t.result.issuerKeyHash,this.serialNumber=t.result.serialNumber}toSchema(){return new E({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}isEqual(e){return!(this.hashAlgorithm.algorithmId!==e.hashAlgorithm.algorithmId||!Se.isEqual(this.issuerNameHash.valueBlock.valueHexView,e.issuerNameHash.valueBlock.valueHexView)||!Se.isEqual(this.issuerKeyHash.valueBlock.valueHexView,e.issuerKeyHash.valueBlock.valueHexView)||!this.serialNumber.isEqual(e.serialNumber))}async createForCertificate(e,t,r=Ve(!0)){Fe.assert(t,Vi,"issuerCertificate");const a=r.getOIDByAlgorithm({name:t.hashAlgorithm},!0,"hashAlgorithm");this.hashAlgorithm=new V({algorithmId:a,algorithmParams:new kt});const n=t.issuerCertificate;this.serialNumber=e.serialNumber;const i=await r.digest({name:t.hashAlgorithm},n.subject.toSchema().toBER(!1));this.issuerNameHash=new z({valueHex:i});const o=n.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView,l=await r.digest({name:t.hashAlgorithm},o);this.issuerKeyHash=new z({valueHex:l})}}Vt.CLASS_NAME="CertID";const Il="certID",kl="certStatus",Nl="thisUpdate",nn="nextUpdate",Di="singleExtensions",Y2=[Il,kl,Nl,nn,Di];class us extends G{constructor(e={}){super(),this.certID=m(e,Il,us.defaultValues(Il)),this.certStatus=m(e,kl,us.defaultValues(kl)),this.thisUpdate=m(e,Nl,us.defaultValues(Nl)),nn in e&&(this.nextUpdate=m(e,nn,us.defaultValues(nn))),Di in e&&(this.singleExtensions=m(e,Di,us.defaultValues(Di))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Il:return new Vt;case kl:return{};case Nl:case nn:return new Date(0,0,0);case Di:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Il:return Vt.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&Vt.compareWithDefault("issuerNameHash",t.issuerNameHash)&&Vt.compareWithDefault("issuerKeyHash",t.issuerKeyHash)&&Vt.compareWithDefault("serialNumber",t.serialNumber);case kl:return Object.keys(t).length===0;case Nl:case nn:return t===us.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[Vt.schema(t.certID||{}),new St({value:[new Be({name:t.certStatus||S,idBlock:{tagClass:3,tagNumber:0}}),new T({name:t.certStatus||S,idBlock:{tagClass:3,tagNumber:1},value:[new wt,new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new mo]})]}),new Be({name:t.certStatus||S,idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new wt({name:t.thisUpdate||S}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new wt({name:t.nextUpdate||S})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Pt.schema(t.singleExtensions||{})]})]})}fromSchema(e){W(e,Y2);const t=j(e,e,us.schema({names:{certID:{names:{blockName:Il}},certStatus:kl,thisUpdate:Nl,nextUpdate:nn,singleExtensions:{names:{blockName:Di}}}}));M.assertSchema(t,this.className),this.certID=new Vt({schema:t.result.certID}),this.certStatus=t.result.certStatus,this.thisUpdate=t.result.thisUpdate.toDate(),nn in t.result&&(this.nextUpdate=t.result.nextUpdate.toDate()),Di in t.result&&(this.singleExtensions=Array.from(t.result.singleExtensions.valueBlock.value,r=>new Rt({schema:r})))}toSchema(){const e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new wt({valueDate:this.thisUpdate})),this.nextUpdate&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[new wt({valueDate:this.nextUpdate})]})),this.singleExtensions&&e.push(new E({value:Array.from(this.singleExtensions,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return this.nextUpdate&&(e.nextUpdate=this.nextUpdate),this.singleExtensions&&(e.singleExtensions=Array.from(this.singleExtensions,t=>t.toJSON())),e}}us.CLASS_NAME="SingleResponse";const Zh="tbs",Li="version",Nf="responderID",Tf="producedAt",_f="responses",Tl="responseExtensions",Co="ResponseData",m0=`${Co}.${Li}`,_l=`${Co}.${Nf}`,Kg=`${Co}.${Tf}`,Fg=`${Co}.${_f}`,p0=`${Co}.${Tl}`,z2=[Co,m0,_l,Kg,Fg,p0];class qt extends G{get tbs(){return Se.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(m(e,Zh,qt.defaultValues(Zh))),Li in e&&(this.version=m(e,Li,qt.defaultValues(Li))),this.responderID=m(e,Nf,qt.defaultValues(Nf)),this.producedAt=m(e,Tf,qt.defaultValues(Tf)),this.responses=m(e,_f,qt.defaultValues(_f)),Tl in e&&(this.responseExtensions=m(e,Tl,qt.defaultValues(Tl))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Li:return 0;case Zh:return Ot;case Nf:return{};case Tf:return new Date(0,0,0);case _f:case Tl:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Zh:return t.byteLength===0;case Nf:return Object.keys(t).length===0;case Tf:return t===qt.defaultValues(e);case _f:case Tl:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||Co,value:[new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new D({name:t.version||m0})]}),new St({value:[new T({name:t.responderID||_l,idBlock:{tagClass:3,tagNumber:1},value:[rt.schema(t.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new T({name:t.responderID||_l,idBlock:{tagClass:3,tagNumber:2},value:[new z({name:t.ResponseDataByKey||"ResponseData.byKey"})]})]}),new wt({name:t.producedAt||Kg}),new E({value:[new Re({name:Fg,value:us.schema(t.response||{})})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Pt.schema(t.extensions||{names:{blockName:p0}})]})]})}fromSchema(e){W(e,z2);const t=j(e,e,qt.schema());M.assertSchema(t,this.className),this.tbsView=t.result.ResponseData.valueBeforeDecodeView,m0 in t.result&&(this.version=t.result[m0].valueBlock.valueDec),t.result[_l].idBlock.tagNumber===1?this.responderID=new rt({schema:t.result[_l].valueBlock.value[0]}):this.responderID=t.result[_l].valueBlock.value[0],this.producedAt=t.result[Kg].toDate(),this.responses=Array.from(t.result[Fg],r=>new us({schema:r})),p0 in t.result&&(this.responseExtensions=Array.from(t.result[p0].valueBlock.value,r=>new Rt({schema:r})))}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return qt.schema();const r=Lt(this.tbsView);M.assert(r,"TBS Response Data"),t=r.result}else{const r=[];Li in this&&r.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[new D({value:this.version})]})),this.responderID instanceof rt?r.push(new T({idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]})):r.push(new T({idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),r.push(new wt({valueDate:this.producedAt})),r.push(new E({value:Array.from(this.responses,a=>a.toSchema())})),this.responseExtensions&&r.push(new T({idBlock:{tagClass:3,tagNumber:1},value:[new E({value:Array.from(this.responseExtensions,a=>a.toSchema())})]})),t=new E({value:r})}return t}toJSON(){const e={};return Li in this&&(e.version=this.version),this.responderID&&(e.responderID=this.responderID),this.producedAt&&(e.producedAt=this.producedAt),this.responses&&(e.responses=Array.from(this.responses,t=>t.toJSON())),this.responseExtensions&&(e.responseExtensions=Array.from(this.responseExtensions,t=>t.toJSON())),e}}qt.CLASS_NAME="ResponseData";const ig="trustedCerts",og="certs",lg="crls",ug="ocsps",cg="checkDate",fg="findOrigin",hg="findIssuer";var Qi;(function(s){s[s.unknown=-1]="unknown",s[s.success=0]="success",s[s.noRevocation=11]="noRevocation",s[s.noPath=60]="noPath",s[s.noValidPath=97]="noValidPath"})(Qi||(Qi={}));class yn extends Error{constructor(e,t){super(t),this.name=yn.NAME,this.code=e,this.message=t}}yn.NAME="ChainValidationError";function X2(s,e){for(let t=0;t<e.length;t++)if(Se.isEqual(s.tbsView,e[t].tbsView))return!0;return!1}class Nd{constructor(e={}){this.trustedCerts=m(e,ig,this.defaultValues(ig)),this.certs=m(e,og,this.defaultValues(og)),this.crls=m(e,lg,this.defaultValues(lg)),this.ocsps=m(e,ug,this.defaultValues(ug)),this.checkDate=m(e,cg,this.defaultValues(cg)),this.findOrigin=m(e,fg,this.defaultValues(fg)),this.findIssuer=m(e,hg,this.defaultValues(hg))}static defaultFindOrigin(e,t){e.tbsView.byteLength===0&&(e.tbsView=new Uint8Array(e.encodeTBS().toBER()));for(const r of t.certs)if(r.tbsView.byteLength===0&&(r.tbsView=new Uint8Array(r.encodeTBS().toBER())),Se.isEqual(e.tbsView,r.tbsView))return"Intermediate Certificates";for(const r of t.trustedCerts)if(r.tbsView.byteLength===0&&(r.tbsView=new Uint8Array(r.encodeTBS().toBER())),Se.isEqual(e.tbsView,r.tbsView))return"Trusted Certificates";return"Unknown"}async defaultFindIssuer(e,t,r=Ve(!0)){const a=[];let n=null,i=null,o=null;if(e.subject.isEqual(e.issuer))try{if(await e.verify(void 0,r))return[e]}catch{}if(e.extensions){for(const u of e.extensions)if(u.extnID===Mm&&u.parsedValue instanceof En){u.parsedValue.keyIdentifier?n=u.parsedValue.keyIdentifier:(u.parsedValue.authorityCertIssuer&&(i=u.parsedValue.authorityCertIssuer),u.parsedValue.authorityCertSerialNumber&&(o=u.parsedValue.authorityCertSerialNumber));break}}function l(u){if(n!==null&&u.extensions){let f=!1;for(const g of u.extensions)if(g.extnID===rE&&g.parsedValue){f=!0,Se.isEqual(g.parsedValue.valueBlock.valueHex,n.valueBlock.valueHexView)&&a.push(u);break}if(f)return}let c=!1;o!==null&&(c=u.serialNumber.isEqual(o)),i!==null?u.subject.isEqual(i)&&c&&a.push(u):e.issuer.isEqual(u.subject)&&a.push(u)}for(const u of t.trustedCerts)l(u);for(const u of t.certs)l(u);for(let u=a.length-1;u>=0;u--)try{await e.verify(a[u],r)===!1&&a.splice(u,1)}catch{a.splice(u,1)}return a}defaultValues(e){switch(e){case ig:return[];case og:return[];case lg:return[];case ug:return[];case cg:return new Date;case fg:return Nd.defaultFindOrigin;case hg:return this.defaultFindIssuer;default:throw new Error(`Invalid member name for CertificateChainValidationEngine class: ${e}`)}}async sort(e=!1,t=Ve(!0)){const r=[],a=async(p,h)=>{const d=[];function y(x){let N=!0;for(let _=0;_<x.length;_++){for(let $=0;$<x.length;$++)if($!==_&&x[_]===x[$]){N=!1;break}if(!N)break}return N}if(X2(p,this.trustedCerts))return[[p]];const A=await this.findIssuer(p,this,h);if(A.length===0)throw new Error("No valid certificate paths found");for(let x=0;x<A.length;x++){if(Se.isEqual(A[x].tbsView,p.tbsView)){d.push([A[x]]);continue}const N=await a(A[x],h);for(let _=0;_<N.length;_++){const $=N[_].slice();$.splice(0,0,A[x]),y($)?d.push($):d.push(N[_])}}return d},n=async p=>{const h=[],d=[],y=[];if(h.push(...r.filter(A=>p.issuer.isEqual(A.subject))),h.length===0)return{status:1,statusMessage:"No certificate's issuers"};if(d.push(...this.crls.filter(A=>A.issuer.isEqual(p.issuer))),d.length===0)return{status:2,statusMessage:"No CRLs for specific certificate issuer"};for(let A=0;A<d.length;A++){const x=d[A];if(!(x.nextUpdate&&x.nextUpdate.value<this.checkDate))for(let N=0;N<h.length;N++)try{if(await d[A].verify({issuerCertificate:h[N]},t)){y.push({crl:d[A],certificate:h[N]});break}}catch{}}return y.length?{status:0,statusMessage:S,result:y}:{status:3,statusMessage:"No valid CRLs found"}},i=async(p,h)=>{const d=t.getAlgorithmByOID(p.signatureAlgorithm.algorithmId);if(!d.name||!d.hash)return 1;for(let y=0;y<this.ocsps.length;y++){const x=await this.ocsps[y].getCertificateStatus(p,h,t);if(x.isForCertificate)return x.status===0?0:1}return 2};async function o(p,h=!1){let d=!1,y=!1,A=!1,x=!1;if(p.extensions){for(let N=0;N<p.extensions.length;N++){const _=p.extensions[N];if(_.critical&&!_.parsedValue)return{result:!1,resultCode:6,resultMessage:`Unable to parse critical certificate extension: ${_.extnID}`};if(_.extnID===sE){A=!0;const $=new Uint8Array(_.parsedValue.valueBlock.valueHex);($[0]&4)===4&&(y=!0),($[0]&2)===2&&(x=!0)}_.extnID===Pm&&"cA"in _.parsedValue&&_.parsedValue.cA===!0&&(d=!0)}if(y===!0&&d===!1)return{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstraints'};if(A===!0&&d===!0&&y===!1)return{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'};if(d===!0&&A===!0&&h&&x===!1)return{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'}}return d===!1?{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"}:{result:!0,resultCode:0,resultMessage:S}}const l=async(p,h)=>{for(let d=0;d<p.length;d++)if(p[d].notBefore.value>h||p[d].notAfter.value<h)return{result:!1,resultCode:8,resultMessage:"The certificate is either not yet valid or expired"};if(p.length<2)return{result:!1,resultCode:9,resultMessage:"Too short certificate path"};for(let d=p.length-2;d>=0;d--)if(p[d].issuer.isEqual(p[d].subject)===!1&&p[d].issuer.isEqual(p[d+1].subject)===!1)return{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"};if(this.crls.length!==0||this.ocsps.length!==0)for(let d=0;d<p.length-1;d++){let y=2,A={status:0,statusMessage:S};if(this.ocsps.length!==0)switch(y=await i(p[d],p[d+1]),y){case 0:continue;case 1:return{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"}}if(this.crls.length!==0){if(A=await n(p[d]),A.status===0&&A.result)for(let x=0;x<A.result.length;x++){if(A.result[x].crl.isCertificateRevoked(p[d]))return{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"};if((await o(A.result[x].certificate,!0)).result===!1)return{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"}}else if(e===!1)throw new yn(Qi.noRevocation,`No revocation values found for one of certificates: ${A.statusMessage}`)}else if(y===2)return{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"};if(y===2&&A.status===2&&e){const x=p[d+1];let N=!1;if(x.extensions)for(const _ of x.extensions)switch(_.extnID){case N1:case Um:case Hm:N=!0;break}if(N)throw new yn(Qi.noRevocation,`No revocation values found for one of certificates: ${A.statusMessage}`)}}for(const[d,y]of p.entries()){if(!d)continue;if(!(await o(y)).result)return{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"}}return{result:!0}};r.push(...this.trustedCerts),r.push(...this.certs);for(let p=0;p<r.length;p++)for(let h=0;h<r.length;h++)if(p!==h&&Se.isEqual(r[p].tbsView,r[h].tbsView)){r.splice(h,1),p=0;break}const u=r[r.length-1];let c;const f=[u];if(c=await a(u,t),c.length===0)throw new yn(Qi.noPath,"Unable to find certificate path");for(let p=c.length-1;p>=0;p--){let h=!1;for(let d=0;d<c[p].length;d++){const y=c[p][d];for(let A=0;A<this.trustedCerts.length;A++)if(Se.isEqual(y.tbsView,this.trustedCerts[A].tbsView)){h=!0;break}if(h)break}h||c.splice(p,1)}if(c.length===0)throw new yn(Qi.noValidPath,"No valid certificate paths found");let g=c[0].length,v=0;for(let p=0;p<c.length;p++)c[p].length<g&&(g=c[p].length,v=p);for(let p=0;p<c[v].length;p++)f.push(c[v][p]);if(c=await l(f,this.checkDate),c.result===!1)throw c;return f}async verify(e={},t=Ve(!0)){function r(l,u){const c=dn(l),f=dn(u),g=c.split("."),v=f.split("."),p=g.length,h=v.length;if(p===0||h===0||p<h)return!1;for(let d=0;d<p;d++)if(g[d].length===0)return!1;for(let d=0;d<h;d++)if(v[d].length===0){if(d===0){if(h===1)return!1;continue}return!1}for(let d=0;d<h;d++)if(v[h-1-d].length!==0&&g[p-1-d].localeCompare(v[h-1-d])!==0)return!1;return!0}function a(l,u){const c=dn(l),f=dn(u),g=c.split("@"),v=f.split("@");if(g.length===0||v.length===0||g.length<v.length)return!1;if(v.length===1){if(r(g[1],v[0])){const h=g[1].split("."),d=v[0].split(".");return d[0].length===0?!0:h.length===d.length}return!1}return c.localeCompare(f)===0}function n(l,u){let c=dn(l);const f=dn(u),g=c.split("/");if(f.split("/").length>1)return!1;if(g.length>1){for(let h=0;h<g.length;h++)if(g[h].length>0&&g[h].charAt(g[h].length-1)!==":"){c=g[h].split(":")[0];break}}if(r(c,f)){const h=c.split("."),d=f.split(".");return d[0].length===0?!0:h.length===d.length}return!1}function i(l,u){const c=l.valueBlock.valueHexView,f=u.valueBlock.valueHexView;if(c.length===4&&f.length===8){for(let g=0;g<4;g++)if((c[g]^f[g])&f[g+4])return!1;return!0}if(c.length===16&&f.length===32){for(let g=0;g<16;g++)if((c[g]^f[g])&f[g+16])return!1;return!0}return!1}function o(l,u){if(l.typesAndValues.length===0||u.typesAndValues.length===0)return!0;if(l.typesAndValues.length<u.typesAndValues.length)return!1;let c=!0,f=0;for(let g=0;g<u.typesAndValues.length;g++){let v=!1;for(let p=f;p<l.typesAndValues.length;p++)if(v=l.typesAndValues[p].isEqual(u.typesAndValues[g]),l.typesAndValues[p].type===u.typesAndValues[g].type&&(c=c&&v),v===!0)if(f===0||f===p){f=p+1;break}else return!1;if(v===!1)return!1}return f===0?!1:c}try{if(this.certs.length===0)throw new Error("Empty certificate array");const l=e.passedWhenNotRevValues||!1,u=e.initialPolicySet||[qr],c=e.initialExplicitPolicy||!1,f=e.initialPolicyMappingInhibit||!1,g=e.initialInhibitPolicy||!1,v=e.initialPermittedSubtreesSet||[],p=e.initialExcludedSubtreesSet||[],h=e.initialRequiredNameForms||[];let d=c,y=f,A=g;const x=[!1,!1,!1];let N=0,_=0,$=0,se=v,te=p;const me=h;let Ce=1;this.certs=await this.sort(l,t);const pe=[];pe.push(qr);const ve=[],it=new Array(this.certs.length-1);for(let re=0;re<this.certs.length-1;re++)it[re]=!0;ve.push(it);const Ye=new Array(this.certs.length-1),Ae=new Array(this.certs.length-1);let Ue=d?this.certs.length-1:-1;for(let re=this.certs.length-2;re>=0;re--,Ce++){const de=this.certs[re];if(de.extensions){for(let ne=0;ne<de.extensions.length;ne++){const ye=de.extensions[ne];if(ye.extnID===T1){Ae[re]=ye.parsedValue;for(let Te=0;Te<pe.length;Te++)if(pe[Te]===qr){delete ve[Te][re];break}for(let Te=0;Te<ye.parsedValue.certificatePolicies.length;Te++){let He=-1;const nt=ye.parsedValue.certificatePolicies[Te].policyIdentifier;for(let Le=0;Le<pe.length;Le++)if(nt===pe[Le]){He=Le;break}if(He===-1){pe.push(nt);const Le=new Array(this.certs.length-1);Le[re]=!0,ve.push(Le)}else ve[He][re]=!0}}if(ye.extnID===_1){if(y)return{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"};Ye[re]=ye.parsedValue}ye.extnID===R1&&d===!1&&(ye.parsedValue.requireExplicitPolicy===0?(d=!0,Ue=re):x[0]===!1?(x[0]=!0,N=ye.parsedValue.requireExplicitPolicy):N=N>ye.parsedValue.requireExplicitPolicy?ye.parsedValue.requireExplicitPolicy:N,ye.parsedValue.inhibitPolicyMapping===0?y=!0:x[1]===!1?(x[1]=!0,_=ye.parsedValue.inhibitPolicyMapping+1):_=_>ye.parsedValue.inhibitPolicyMapping+1?ye.parsedValue.inhibitPolicyMapping+1:_),ye.extnID===fE&&A===!1&&(ye.parsedValue.valueBlock.valueDec===0?A=!0:x[2]===!1?(x[2]=!0,$=ye.parsedValue.valueBlock.valueDec):$=$>ye.parsedValue.valueBlock.valueDec?ye.parsedValue.valueBlock.valueDec:$)}if(A===!0){let ne=-1;for(let ye=0;ye<pe.length;ye++)if(pe[ye]===qr){ne=ye;break}ne!==-1&&delete ve[0][re]}d===!1&&x[0]===!0&&(N--,N===0&&(d=!0,Ue=re,x[0]=!1)),y===!1&&x[1]===!0&&(_--,_===0&&(y=!0,x[1]=!1)),A===!1&&x[2]===!0&&($--,$===0&&(A=!0,x[2]=!1))}}for(let re=0;re<this.certs.length-1;re++)if(re<this.certs.length-2&&typeof Ye[re+1]<"u")for(let de=0;de<Ye[re+1].mappings.length;de++){if(Ye[re+1].mappings[de].issuerDomainPolicy===qr||Ye[re+1].mappings[de].subjectDomainPolicy===qr)return{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'};let ne=-1,ye=-1;for(let Te=0;Te<pe.length;Te++)pe[Te]===Ye[re+1].mappings[de].issuerDomainPolicy&&(ne=Te),pe[Te]===Ye[re+1].mappings[de].subjectDomainPolicy&&(ye=Te);typeof ve[ne][re]<"u"&&delete ve[ne][re];for(let Te=0;Te<Ae[re].certificatePolicies.length;Te++)if(Ye[re+1].mappings[de].subjectDomainPolicy===Ae[re].certificatePolicies[Te].policyIdentifier&&ne!==-1&&ye!==-1)for(let He=0;He<=re;He++)typeof ve[ye][He]<"u"&&(ve[ne][He]=!0,delete ve[ye][He])}for(let re=0;re<pe.length;re++)if(pe[re]===qr)for(let de=0;de<Ue;de++)delete ve[re][de];const oe=[];for(let re=0;re<ve.length;re++){let de=!0;for(let ne=0;ne<this.certs.length-1;ne++){let ye=!1;if(ne<Ue&&pe[re]===qr&&pe.length>1){de=!1;break}if(typeof ve[re][ne]>"u"){if(ne>=Ue){for(let Te=0;Te<pe.length;Te++)if(pe[Te]===qr){ve[Te][ne]===!0&&(ye=!0);break}}if(!ye){de=!1;break}}}de===!0&&oe.push(pe[re])}let xt=[];if(u.length===1&&u[0]===qr&&d===!1)xt=u;else if(oe.length===1&&oe[0]===qr)xt=u;else for(let re=0;re<oe.length;re++)for(let de=0;de<u.length;de++)if(u[de]===oe[re]||u[de]===qr){xt.push(oe[re]);break}const je={result:xt.length>0,resultCode:0,resultMessage:xt.length>0?S:'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:oe,userConstrPolicies:xt,explicitPolicyIndicator:d,policyMappings:Ye,certificatePath:this.certs};if(xt.length===0||je.result===!1)return je;Ce=1;for(let re=this.certs.length-2;re>=0;re--,Ce++){const de=this.certs[re];let ne=[],ye=[],Te=[];if(de.extensions)for(let Ne=0;Ne<de.extensions.length;Ne++){const ce=de.extensions[Ne];ce.extnID===k1&&("permittedSubtrees"in ce.parsedValue&&(ye=ye.concat(ce.parsedValue.permittedSubtrees)),"excludedSubtrees"in ce.parsedValue&&(Te=Te.concat(ce.parsedValue.excludedSubtrees))),ce.extnID===E1&&(ne=ne.concat(ce.parsedValue.altNames))}let He=me.length<=0;for(let Ne=0;Ne<me.length;Ne++)switch(me[Ne].base.type){case 4:{if(me[Ne].base.value.typesAndValues.length!==de.subject.typesAndValues.length)continue;He=!0;for(let ce=0;ce<de.subject.typesAndValues.length;ce++)if(de.subject.typesAndValues[ce].type!==me[Ne].base.value.typesAndValues[ce].type){He=!1;break}if(He===!0)break}break;default:}if(He===!1)throw je.result=!1,je.resultCode=21,je.resultMessage="No necessary name form found",je;const nt=[[],[],[],[],[]];for(let Ne=0;Ne<se.length;Ne++)switch(se[Ne].base.type){case 1:nt[0].push(se[Ne]);break;case 2:nt[1].push(se[Ne]);break;case 4:nt[2].push(se[Ne]);break;case 6:nt[3].push(se[Ne]);break;case 7:nt[4].push(se[Ne]);break;default:}for(let Ne=0;Ne<5;Ne++){let ce=!1,ft=!1;const ot=nt[Ne];for(let lt=0;lt<ot.length;lt++){switch(Ne){case 0:if(ne.length>0)for(let $e=0;$e<ne.length;$e++)ne[$e].type===1&&(ft=!0,ce=ce||a(ne[$e].value,ot[lt].base.value));else for(let $e=0;$e<de.subject.typesAndValues.length;$e++)(de.subject.typesAndValues[$e].type==="1.2.840.113549.1.9.1"||de.subject.typesAndValues[$e].type==="0.9.2342.19200300.100.1.3")&&(ft=!0,ce=ce||a(de.subject.typesAndValues[$e].value.valueBlock.value,ot[lt].base.value));break;case 1:if(ne.length>0)for(let $e=0;$e<ne.length;$e++)ne[$e].type===2&&(ft=!0,ce=ce||r(ne[$e].value,ot[lt].base.value));break;case 2:ft=!0,ce=o(de.subject,ot[lt].base.value);break;case 3:if(ne.length>0)for(let $e=0;$e<ne.length;$e++)ne[$e].type===6&&(ft=!0,ce=ce||n(ne[$e].value,ot[lt].base.value));break;case 4:if(ne.length>0)for(let $e=0;$e<ne.length;$e++)ne[$e].type===7&&(ft=!0,ce=ce||i(ne[$e].value,ot[lt].base.value));break;default:}if(ce)break}if(ce===!1&&ot.length>0&&ft)throw je.result=!1,je.resultCode=41,je.resultMessage='Failed to meet "permitted sub-trees" name constraint',je}let Le=!1;for(let Ne=0;Ne<te.length;Ne++){switch(te[Ne].base.type){case 1:if(ne.length>=0)for(let ce=0;ce<ne.length;ce++)ne[ce].type===1&&(Le=Le||a(ne[ce].value,te[Ne].base.value));else for(let ce=0;ce<de.subject.typesAndValues.length;ce++)(de.subject.typesAndValues[ce].type==="1.2.840.113549.1.9.1"||de.subject.typesAndValues[ce].type==="0.9.2342.19200300.100.1.3")&&(Le=Le||a(de.subject.typesAndValues[ce].value.valueBlock.value,te[Ne].base.value));break;case 2:if(ne.length>0)for(let ce=0;ce<ne.length;ce++)ne[ce].type===2&&(Le=Le||r(ne[ce].value,te[Ne].base.value));break;case 4:Le=Le||o(de.subject,te[Ne].base.value);break;case 6:if(ne.length>0)for(let ce=0;ce<ne.length;ce++)ne[ce].type===6&&(Le=Le||n(ne[ce].value,te[Ne].base.value));break;case 7:if(ne.length>0)for(let ce=0;ce<ne.length;ce++)ne[ce].type===7&&(Le=Le||i(ne[ce].value,te[Ne].base.value));break;default:}if(Le)break}if(Le===!0)throw je.result=!1,je.resultCode=42,je.resultMessage='Failed to meet "excluded sub-trees" name constraint',je;se=se.concat(ye),te=te.concat(Te)}return je}catch(l){return l instanceof Error?l instanceof yn?{result:!1,resultCode:l.code,resultMessage:l.message,error:l}:{result:!1,resultCode:Qi.unknown,resultMessage:l.message,error:l}:l&&typeof l=="object"&&"resultMessage"in l?l:{result:!1,resultCode:-1,resultMessage:`${l}`}}}}const y0="tbsResponseData",Rf="signatureAlgorithm",Vf="signature",Rl="certs",Ah="BasicOCSPResponse",qg=`${Ah}.${y0}`,Jg=`${Ah}.${Rf}`,Gg=`${Ah}.${Vf}`,v0=`${Ah}.${Rl}`,Z2=[qg,Jg,Gg,v0];class Yr extends G{constructor(e={}){super(),this.tbsResponseData=m(e,y0,Yr.defaultValues(y0)),this.signatureAlgorithm=m(e,Rf,Yr.defaultValues(Rf)),this.signature=m(e,Vf,Yr.defaultValues(Vf)),Rl in e&&(this.certs=m(e,Rl,Yr.defaultValues(Rl))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case y0:return new qt;case Rf:return new V;case Vf:return new Pe;case Rl:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"type":{let r=qt.compareWithDefault("tbs",t.tbs)&&qt.compareWithDefault("responderID",t.responderID)&&qt.compareWithDefault("producedAt",t.producedAt)&&qt.compareWithDefault("responses",t.responses);return"responseExtensions"in t&&(r=r&&qt.compareWithDefault("responseExtensions",t.responseExtensions)),r}case Rf:return t.algorithmId===S&&!("algorithmParams"in t);case Vf:return t.isEqual(Yr.defaultValues(e));case Rl:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||Ah,value:[qt.schema(t.tbsResponseData||{names:{blockName:qg}}),V.schema(t.signatureAlgorithm||{names:{blockName:Jg}}),new Pe({name:t.signature||Gg}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new E({value:[new Re({name:v0,value:ze.schema(t.certs||{})})]})]})]})}fromSchema(e){W(e,Z2);const t=j(e,e,Yr.schema());M.assertSchema(t,this.className),this.tbsResponseData=new qt({schema:t.result[qg]}),this.signatureAlgorithm=new V({schema:t.result[Jg]}),this.signature=t.result[Gg],v0 in t.result&&(this.certs=Array.from(t.result[v0],r=>new ze({schema:r})))}toSchema(){const e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[new E({value:Array.from(this.certs,t=>t.toSchema())})]})),new E({value:e})}toJSON(){const e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}async getCertificateStatus(e,t,r=Ve(!0)){const a={isForCertificate:!1,status:2},n={},i=[];for(const o of this.tbsResponseData.responses){const l=r.getAlgorithmByOID(o.certID.hashAlgorithm.algorithmId,!0,"CertID.hashAlgorithm");if(!n[l.name]){n[l.name]=1;const u=new Vt;i.push(u),await u.createForCertificate(e,{hashAlgorithm:l.name,issuerCertificate:t},r)}}for(const o of this.tbsResponseData.responses)for(const l of i)if(o.certID.isEqual(l)){a.isForCertificate=!0;try{switch(o.certStatus.idBlock.isConstructed){case!0:o.certStatus.idBlock.tagNumber===1&&(a.status=1);break;case!1:switch(o.certStatus.idBlock.tagNumber){case 0:a.status=0;break;case 2:a.status=2;break;default:}break;default:}}catch{}return a}return a}async sign(e,t="SHA-1",r=Ve(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await r.getSignatureParameters(e,t),n=a.parameters.algorithm;if(!("name"in n))throw new Error("Empty algorithm");this.signatureAlgorithm=a.signatureAlgorithm,this.tbsResponseData.tbsView=new Uint8Array(this.tbsResponseData.toSchema(!0).toBER());const i=await r.signWithPrivateKey(this.tbsResponseData.tbsView,e,{algorithm:n});this.signature=new Pe({valueHex:i})}async verify(e={},t=Ve(!0)){let r=null,a=-1;const n=e.trustedCerts||[];if(!this.certs)throw new Error("No certificates attached to the BasicOCSPResponse");switch(!0){case this.tbsResponseData.responderID instanceof rt:for(const[u,c]of this.certs.entries())if(c.subject.isEqual(this.tbsResponseData.responderID)){a=u;break}break;case this.tbsResponseData.responderID instanceof z:for(const[u,c]of this.certs.entries()){const f=await t.digest({name:"sha-1"},c.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(wu(f,this.tbsResponseData.responderID.valueBlock.valueHex)){a=u;break}}break;default:throw new Error("Wrong value for responderID")}if(a===-1)throw new Error("Correct certificate was not found in OCSP response");r=this.certs[a];const i=[r];for(const u of this.certs){const c=await H1(u,r);c&&i.push(c)}if(!(await new Nd({certs:i,trustedCerts:n}).verify({},t)).result)throw new Error("Validation of signer's certificate failed");return t.verifyWithPublicKey(this.tbsResponseData.tbsView,this.signature,this.certs[a].subjectPublicKeyInfo,this.signatureAlgorithm)}}Yr.CLASS_NAME="BasicOCSPResponse";const dg="tbs",gg="version",mg="subject",pg="subjectPublicKeyInfo",_o="attributes",$f="signatureAlgorithm",Df="signatureValue",Tu="CertificationRequestInfo",Ym=`${Tu}.version`,zm=`${Tu}.subject`,Xm=`${Tu}.subjectPublicKeyInfo`,od=`${Tu}.attributes`,ex=[Tu,Ym,zm,Xm,od,$f,Df];function tx(s={}){const e=m(s,"names",{});return new E({name:e.CertificationRequestInfo||Tu,value:[new D({name:e.CertificationRequestInfoVersion||Ym}),rt.schema(e.subject||{names:{blockName:zm}}),Ar.schema({names:{blockName:Xm}}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Re({optional:!0,name:e.CertificationRequestInfoAttributes||od,value:gt.schema(e.attributes||{})})]})]})}class os extends G{get tbs(){return Se.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(m(e,dg,os.defaultValues(dg))),this.version=m(e,gg,os.defaultValues(gg)),this.subject=m(e,mg,os.defaultValues(mg)),this.subjectPublicKeyInfo=m(e,pg,os.defaultValues(pg)),_o in e&&(this.attributes=m(e,_o,os.defaultValues(_o))),this.signatureAlgorithm=m(e,$f,os.defaultValues($f)),this.signatureValue=m(e,Df,os.defaultValues(Df)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case dg:return Ot;case gg:return 0;case mg:return new rt;case pg:return new Ar;case _o:return[];case $f:return new V;case Df:return new Pe;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({value:[tx(t.certificationRequestInfo||{}),new E({name:t.signatureAlgorithm||$f,value:[new fe,new ke({optional:!0})]}),new Pe({name:t.signatureValue||Df})]})}fromSchema(e){W(e,ex);const t=j(e,e,os.schema());M.assertSchema(t,this.className),this.tbsView=t.result.CertificationRequestInfo.valueBeforeDecodeView,this.version=t.result[Ym].valueBlock.valueDec,this.subject=new rt({schema:t.result[zm]}),this.subjectPublicKeyInfo=new Ar({schema:t.result[Xm]}),od in t.result&&(this.attributes=Array.from(t.result[od],r=>new gt({schema:r}))),this.signatureAlgorithm=new V({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[new D({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];return _o in this&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes||[],t=>t.toSchema())})),new E({value:e})}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return os.schema();const r=Lt(this.tbsView);M.assert(r,"PKCS#10 Certificate Request"),t=r.result}else t=this.encodeTBS();return new E({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:Ee.ToHex(this.tbsView),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return _o in this&&(e.attributes=Array.from(this.attributes||[],t=>t.toJSON())),e}async sign(e,t="SHA-1",r=Ve(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await r.getSignatureParameters(e,t),n=a.parameters;this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const i=await r.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new Pe({valueHex:i})}async verify(e=Ve(!0)){return e.verifyWithPublicKey(this.tbsView,this.signatureValue,this.subjectPublicKeyInfo,this.signatureAlgorithm)}async getPublicKey(e,t=Ve(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}}os.CLASS_NAME="CertificationRequest";const Oi="digestAlgorithm",Pi="digest",rx=[Oi,Pi];class Xr extends G{constructor(e={}){super(),this.digestAlgorithm=m(e,Oi,Xr.defaultValues(Oi)),this.digest=m(e,Pi,Xr.defaultValues(Pi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Oi:return new V;case Pi:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Oi:return V.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case Pi:return t.isEqual(Xr.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[V.schema(t.digestAlgorithm||{names:{blockName:Oi}}),new z({name:t.digest||Pi})]})}fromSchema(e){W(e,rx);const t=j(e,e,Xr.schema({names:{digestAlgorithm:{names:{blockName:Oi}},digest:Pi}}));M.assertSchema(t,this.className),this.digestAlgorithm=new V({schema:t.result.digestAlgorithm}),this.digest=t.result.digest}toSchema(){return new E({value:[this.digestAlgorithm.toSchema(),this.digest]})}toJSON(){return{digestAlgorithm:this.digestAlgorithm.toJSON(),digest:this.digest.toJSON()}}}Xr.CLASS_NAME="DigestInfo";const Vl="eContentType",ns="eContent",sx=[Vl,ns];class Ir extends G{constructor(e={}){if(super(),this.eContentType=m(e,Vl,Ir.defaultValues(Vl)),ns in e&&(this.eContent=m(e,ns,Ir.defaultValues(ns)),this.eContent.idBlock.tagClass===1&&this.eContent.idBlock.tagNumber===4&&this.eContent.idBlock.isConstructed===!1)){const t=new z({idBlock:{isConstructed:!0},isConstructed:!0});let r=0;const a=this.eContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const i=new Uint8Array(a,r,r+65536>a.byteLength?a.byteLength-r:65536),o=new ArrayBuffer(i.length),l=new Uint8Array(o);for(let u=0;u<l.length;u++)l[u]=i[u];t.valueBlock.value.push(new z({valueHex:o})),n-=i.length,r+=i.length}this.eContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vl:return S;case ns:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Vl:return t===S;case ns:return t.idBlock.tagClass===1&&t.idBlock.tagNumber===4?t.isEqual(Ir.defaultValues(ns)):!1;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.eContentType||S}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ke({name:t.eContent||S})]})]})}fromSchema(e){W(e,sx);const t=j(e,e,Ir.schema({names:{eContentType:Vl,eContent:ns}}));M.assertSchema(t,this.className),this.eContentType=t.result.eContentType.valueBlock.toString(),ns in t.result&&(this.eContent=t.result.eContent)}toSchema(){const e=[];return e.push(new fe({value:this.eContentType})),this.eContent&&Ir.compareWithDefault(ns,this.eContent)===!1&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new E({value:e})}toJSON(){const e={eContentType:this.eContentType};return this.eContent&&Ir.compareWithDefault(ns,this.eContent)===!1&&(e.eContent=this.eContent.toJSON()),e}}Ir.CLASS_NAME="EncapsulatedContentInfo";const Ui="mac",Mi="macSalt",zs="iterations",ax=[Ui,Mi,zs];class vr extends G{constructor(e={}){super(),this.mac=m(e,Ui,vr.defaultValues(Ui)),this.macSalt=m(e,Mi,vr.defaultValues(Mi)),zs in e&&(this.iterations=m(e,zs,vr.defaultValues(zs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ui:return new Xr;case Mi:return new z;case zs:return 1;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ui:return Xr.compareWithDefault("digestAlgorithm",t.digestAlgorithm)&&Xr.compareWithDefault("digest",t.digest);case Mi:return t.isEqual(vr.defaultValues(e));case zs:return t===vr.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,optional:t.optional||!0,value:[Xr.schema(t.mac||{names:{blockName:Ui}}),new z({name:t.macSalt||Mi}),new D({optional:!0,name:t.iterations||zs})]})}fromSchema(e){W(e,ax);const t=j(e,e,vr.schema({names:{mac:{names:{blockName:Ui}},macSalt:Mi,iterations:zs}}));M.assertSchema(t,this.className),this.mac=new Xr({schema:t.result.mac}),this.macSalt=t.result.macSalt,zs in t.result&&(this.iterations=t.result.iterations.valueBlock.valueDec)}toSchema(){const e=[this.mac.toSchema(),this.macSalt];return this.iterations!==void 0&&e.push(new D({value:this.iterations})),new E({value:e})}toJSON(){const e={mac:this.mac.toJSON(),macSalt:this.macSalt.toJSON()};return this.iterations!==void 0&&(e.iterations=this.iterations),e}}vr.CLASS_NAME="MacData";const Yi="hashAlgorithm",zi="hashedMessage",nx=[Yi,zi];class ar extends G{static async create(e,t,r=Ve(!0)){const a=r.getOIDByAlgorithm({name:e},!0,"hashAlgorithm"),n=await r.digest(e,t);return new ar({hashAlgorithm:new V({algorithmId:a,algorithmParams:new kt}),hashedMessage:new z({valueHex:n})})}constructor(e={}){super(),this.hashAlgorithm=m(e,Yi,ar.defaultValues(Yi)),this.hashedMessage=m(e,zi,ar.defaultValues(zi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yi:return new V;case zi:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Yi:return t.algorithmId===S&&!("algorithmParams"in t);case zi:return t.isEqual(ar.defaultValues(e))===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[V.schema(t.hashAlgorithm||{}),new z({name:t.hashedMessage||S})]})}fromSchema(e){W(e,nx);const t=j(e,e,ar.schema({names:{hashAlgorithm:{names:{blockName:Yi}},hashedMessage:zi}}));M.assertSchema(t,this.className),this.hashAlgorithm=new V({schema:t.result.hashAlgorithm}),this.hashedMessage=t.result.hashedMessage}toSchema(){return new E({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}ar.CLASS_NAME="MessageImprint";const $l="reqCert",on="singleRequestExtensions",ix=[$l,on];class ca extends G{constructor(e={}){super(),this.reqCert=m(e,$l,ca.defaultValues($l)),on in e&&(this.singleRequestExtensions=m(e,on,ca.defaultValues(on))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $l:return new Vt;case on:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case $l:return t.isEqual(ca.defaultValues(e));case on:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[Vt.schema(t.reqCert||{}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Rt.schema(t.extensions||{names:{blockName:t.singleRequestExtensions||S}})]})]})}fromSchema(e){W(e,ix);const t=j(e,e,ca.schema({names:{reqCert:{names:{blockName:$l}},extensions:{names:{blockName:on}}}}));M.assertSchema(t,this.className),this.reqCert=new Vt({schema:t.result.reqCert}),on in t.result&&(this.singleRequestExtensions=Array.from(t.result.singleRequestExtensions.valueBlock.value,r=>new Rt({schema:r})))}toSchema(){const e=[];return e.push(this.reqCert.toSchema()),this.singleRequestExtensions&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new E({value:Array.from(this.singleRequestExtensions,t=>t.toSchema())})]})),new E({value:e})}toJSON(){const e={reqCert:this.reqCert.toJSON()};return this.singleRequestExtensions&&(e.singleRequestExtensions=Array.from(this.singleRequestExtensions,t=>t.toJSON())),e}}ca.CLASS_NAME="Request";const e0="tbs",Dl="version",Ll="requestorName",t0="requestList",Ol="requestExtensions",_u="TBSRequest",w0=`${_u}.${Dl}`,S0=`${_u}.${Ll}`,jg=`${_u}.requests`,C0=`${_u}.${Ol}`,ox=[_u,w0,S0,jg,C0];class Xt extends G{get tbs(){return Se.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(m(e,e0,Xt.defaultValues(e0))),Dl in e&&(this.version=m(e,Dl,Xt.defaultValues(Dl))),Ll in e&&(this.requestorName=m(e,Ll,Xt.defaultValues(Ll))),this.requestList=m(e,t0,Xt.defaultValues(t0)),Ol in e&&(this.requestExtensions=m(e,Ol,Xt.defaultValues(Ol))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case e0:return Ot;case Dl:return 0;case Ll:return new Qe;case t0:case Ol:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case e0:return t.byteLength===0;case Dl:return t===Xt.defaultValues(e);case Ll:return t.type===Qe.defaultValues("type")&&Object.keys(t.value).length===0;case t0:case Ol:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||_u,value:[new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new D({name:t.TBSRequestVersion||w0})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Qe.schema(t.requestorName||{names:{blockName:S0}})]}),new E({name:t.requestList||"TBSRequest.requestList",value:[new Re({name:t.requests||jg,value:ca.schema(t.requestNames||{})})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[Pt.schema(t.extensions||{names:{blockName:t.requestExtensions||C0}})]})]})}fromSchema(e){W(e,ox);const t=j(e,e,Xt.schema());M.assertSchema(t,this.className),this.tbsView=t.result.TBSRequest.valueBeforeDecodeView,w0 in t.result&&(this.version=t.result[w0].valueBlock.valueDec),S0 in t.result&&(this.requestorName=new Qe({schema:t.result[S0]})),this.requestList=Array.from(t.result[jg],r=>new ca({schema:r})),C0 in t.result&&(this.requestExtensions=Array.from(t.result[C0].valueBlock.value,r=>new Rt({schema:r})))}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return Xt.schema();const r=Lt(this.tbsView);if(M.assert(r,"TBS Request"),!(r.result instanceof E))throw new Error("ASN.1 result should be SEQUENCE");t=r.result}else{const r=[];this.version!==void 0&&r.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[new D({value:this.version})]})),this.requestorName&&r.push(new T({idBlock:{tagClass:3,tagNumber:1},value:[this.requestorName.toSchema()]})),r.push(new E({value:Array.from(this.requestList,a=>a.toSchema())})),this.requestExtensions&&r.push(new T({idBlock:{tagClass:3,tagNumber:2},value:[new E({value:Array.from(this.requestExtensions,a=>a.toSchema())})]})),t=new E({value:r})}return t}toJSON(){const e={};return this.version!=null&&(e.version=this.version),this.requestorName&&(e.requestorName=this.requestorName.toJSON()),e.requestList=Array.from(this.requestList,t=>t.toJSON()),this.requestExtensions&&(e.requestExtensions=Array.from(this.requestExtensions,t=>t.toJSON())),e}}Xt.CLASS_NAME="TBSRequest";const Ro="signatureAlgorithm",Vo="signature",Ia="certs";class Pr extends G{constructor(e={}){super(),this.signatureAlgorithm=m(e,Ro,Pr.defaultValues(Ro)),this.signature=m(e,Vo,Pr.defaultValues(Vo)),Ia in e&&(this.certs=m(e,Ia,Pr.defaultValues(Ia))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ro:return new V;case Vo:return new Pe;case Ia:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ro:return t.algorithmId===S&&!("algorithmParams"in t);case Vo:return t.isEqual(Pr.defaultValues(e));case Ia:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[V.schema(t.signatureAlgorithm||{}),new Pe({name:t.signature||S}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new E({value:[new Re({name:t.certs||S,value:ze.schema({})})]})]})]})}fromSchema(e){W(e,[Ro,Vo,Ia]);const t=j(e,e,Pr.schema({names:{signatureAlgorithm:{names:{blockName:Ro}},signature:Vo,certs:Ia}}));M.assertSchema(t,this.className),this.signatureAlgorithm=new V({schema:t.result.signatureAlgorithm}),this.signature=t.result.signature,Ia in t.result&&(this.certs=Array.from(t.result.certs,r=>new ze({schema:r})))}toSchema(){const e=[];return e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new E({value:Array.from(this.certs,t=>t.toSchema())})]})),new E({value:e})}toJSON(){const e={signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}}Pr.CLASS_NAME="Signature";const Pl="tbsRequest",ln="optionalSignature",lx=[Pl,ln];class Zf extends G{constructor(e={}){super(),this.tbsRequest=m(e,Pl,Zf.defaultValues(Pl)),ln in e&&(this.optionalSignature=m(e,ln,Zf.defaultValues(ln))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pl:return new Xt;case ln:return new Pr;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Pl:return Xt.compareWithDefault("tbs",t.tbs)&&Xt.compareWithDefault("version",t.version)&&Xt.compareWithDefault("requestorName",t.requestorName)&&Xt.compareWithDefault("requestList",t.requestList)&&Xt.compareWithDefault("requestExtensions",t.requestExtensions);case ln:return Pr.compareWithDefault("signatureAlgorithm",t.signatureAlgorithm)&&Pr.compareWithDefault("signature",t.signature)&&Pr.compareWithDefault("certs",t.certs);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||"OCSPRequest",value:[Xt.schema(t.tbsRequest||{names:{blockName:Pl}}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Pr.schema(t.optionalSignature||{names:{blockName:ln}})]})]})}fromSchema(e){W(e,lx);const t=j(e,e,Zf.schema());M.assertSchema(t,this.className),this.tbsRequest=new Xt({schema:t.result.tbsRequest}),ln in t.result&&(this.optionalSignature=new Pr({schema:t.result.optionalSignature}))}toSchema(e=!1){const t=[];return t.push(this.tbsRequest.toSchema(e)),this.optionalSignature&&t.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.optionalSignature.toSchema()]})),new E({value:t})}toJSON(){const e={tbsRequest:this.tbsRequest.toJSON()};return this.optionalSignature&&(e.optionalSignature=this.optionalSignature.toJSON()),e}async createForCertificate(e,t,r=Ve(!0)){const a=new Vt;await a.createForCertificate(e,t,r),this.tbsRequest.requestList.push(new ca({reqCert:a}))}async sign(e,t="SHA-1",r=Ve(!0)){if(Fe.assertEmpty(e,"privateKey","OCSPRequest.sign method"),!this.optionalSignature)throw new Error('Need to create "optionalSignature" field before signing');const a=await r.getSignatureParameters(e,t),n=a.parameters;this.optionalSignature.signatureAlgorithm=a.signatureAlgorithm;const i=this.tbsRequest.toSchema(!0).toBER(!1),o=await r.signWithPrivateKey(i,e,n);this.optionalSignature.signature=new Pe({valueHex:o})}verify(){}}Zf.CLASS_NAME="OCSPRequest";const Ul="responseType",Ml="response",ux=[Ul,Ml];class fs extends G{constructor(e={}){super(),this.responseType=m(e,Ul,fs.defaultValues(Ul)),this.response=m(e,Ml,fs.defaultValues(Ml)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ul:return S;case Ml:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ul:return t===S;case Ml:return t.isEqual(fs.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new fe({name:t.responseType||S}),new z({name:t.response||S})]})}fromSchema(e){W(e,ux);const t=j(e,e,fs.schema({names:{responseType:Ul,response:Ml}}));M.assertSchema(t,this.className),this.responseType=t.result.responseType.valueBlock.toString(),this.response=t.result.response}toSchema(){return new E({value:[new fe({value:this.responseType}),this.response]})}toJSON(){return{responseType:this.responseType,response:this.response.toJSON()}}}fs.CLASS_NAME="ResponseBytes";const $o="responseStatus",Hs="responseBytes";class iu extends G{constructor(e={}){super(),this.responseStatus=m(e,$o,iu.defaultValues($o)),Hs in e&&(this.responseBytes=m(e,Hs,iu.defaultValues(Hs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $o:return new mo;case Hs:return new fs;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case $o:return t.isEqual(iu.defaultValues(e));case Hs:return fs.compareWithDefault("responseType",t.responseType)&&fs.compareWithDefault("response",t.response);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||"OCSPResponse",value:[new mo({name:t.responseStatus||$o}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[fs.schema(t.responseBytes||{names:{blockName:Hs}})]})]})}fromSchema(e){W(e,[$o,Hs]);const t=j(e,e,iu.schema());M.assertSchema(t,this.className),this.responseStatus=t.result.responseStatus,Hs in t.result&&(this.responseBytes=new fs({schema:t.result.responseBytes}))}toSchema(){const e=[];return e.push(this.responseStatus),this.responseBytes&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:[this.responseBytes.toSchema()]})),new E({value:e})}toJSON(){const e={responseStatus:this.responseStatus.toJSON()};return this.responseBytes&&(e.responseBytes=this.responseBytes.toJSON()),e}async getCertificateStatus(e,t,r=Ve(!0)){let a;const n={isForCertificate:!1,status:2};if(!this.responseBytes||this.responseBytes.responseType!==o0)return n;try{const i=Lt(this.responseBytes.response.valueBlock.valueHexView);M.assert(i,"Basic OCSP response"),a=new Yr({schema:i.result})}catch{return n}return a.getCertificateStatus(e,t,r)}async sign(e,t,r=Ve(!0)){var a;if(this.responseBytes&&this.responseBytes.responseType===o0)return Yr.fromBER(this.responseBytes.response.valueBlock.valueHexView).sign(e,t,r);throw new Error(`Unknown ResponseBytes type: ${((a=this.responseBytes)===null||a===void 0?void 0:a.responseType)||"Unknown"}`)}async verify(e=null,t=Ve(!0)){var r;if(!(Hs in this))throw new Error("Empty ResponseBytes field");if(this.responseBytes&&this.responseBytes.responseType===o0){const a=Yr.fromBER(this.responseBytes.response.valueBlock.valueHexView);return e!==null&&(a.certs||(a.certs=[]),a.certs.push(e)),a.verify({},t)}throw new Error(`Unknown ResponseBytes type: ${((r=this.responseBytes)===null||r===void 0?void 0:r.responseType)||"Unknown"}`)}}iu.CLASS_NAME="OCSPResponse";const Jn="type",Xs="attributes",r0="encodedValue",cx=[Xs];class At extends G{constructor(e={}){super(),this.type=m(e,Jn,At.defaultValues(Jn)),this.attributes=m(e,Xs,At.defaultValues(Xs)),this.encodedValue=m(e,r0,At.defaultValues(r0)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Jn:return-1;case Xs:return[];case r0:return Ot;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Jn:return t===At.defaultValues(Jn);case Xs:return t.length===0;case r0:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new T({name:t.blockName||S,optional:!0,idBlock:{tagClass:3,tagNumber:t.tagNumber||0},value:[new Re({name:t.attributes||S,value:gt.schema()})]})}fromSchema(e){W(e,cx);const t=j(e,e,At.schema({names:{tagNumber:this.type,attributes:Xs}}));M.assertSchema(t,this.className),this.type=t.result.idBlock.tagNumber,this.encodedValue=Se.toArrayBuffer(t.result.valueBeforeDecodeView);const r=new Uint8Array(this.encodedValue);if(r[0]=49,!(Xs in t.result)){if(this.type===0)throw new Error("Wrong structure of SignedUnsignedAttributes");return}this.attributes=Array.from(t.result.attributes,a=>new gt({schema:a}))}toSchema(){if(At.compareWithDefault(Jn,this.type)||At.compareWithDefault(Xs,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new T({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){if(At.compareWithDefault(Jn,this.type)||At.compareWithDefault(Xs,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,e=>e.toJSON())}}}At.CLASS_NAME="SignedAndUnsignedAttributes";const Hl="version",Hi="sid",Kl="digestAlgorithm",un="signedAttrs",Fl="signatureAlgorithm",Lf="signature",cn="unsignedAttrs",Mn="SignerInfo",Wg=`${Mn}.${Hl}`,Of=`${Mn}.${Hi}`,Qg=`${Mn}.${Kl}`,A0=`${Mn}.${un}`,Yg=`${Mn}.${Fl}`,zg=`${Mn}.${Lf}`,b0=`${Mn}.${cn}`,fx=[Wg,Of,Qg,A0,Yg,zg,b0];class It extends G{constructor(e={}){super(),this.version=m(e,Hl,It.defaultValues(Hl)),this.sid=m(e,Hi,It.defaultValues(Hi)),this.digestAlgorithm=m(e,Kl,It.defaultValues(Kl)),un in e&&(this.signedAttrs=m(e,un,It.defaultValues(un))),this.signatureAlgorithm=m(e,Fl,It.defaultValues(Fl)),this.signature=m(e,Lf,It.defaultValues(Lf)),cn in e&&(this.unsignedAttrs=m(e,cn,It.defaultValues(cn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hl:return 0;case Hi:return new ke;case Kl:return new V;case un:return new At({type:0});case Fl:return new V;case Lf:return new z;case cn:return new At({type:1});default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Hl:return It.defaultValues(Hl)===t;case Hi:return t instanceof ke;case Kl:return t instanceof V?t.isEqual(It.defaultValues(Kl)):!1;case un:return At.compareWithDefault("type",t.type)&&At.compareWithDefault("attributes",t.attributes)&&At.compareWithDefault("encodedValue",t.encodedValue);case Fl:return t instanceof V?t.isEqual(It.defaultValues(Fl)):!1;case Lf:case cn:return At.compareWithDefault("type",t.type)&&At.compareWithDefault("attributes",t.attributes)&&At.compareWithDefault("encodedValue",t.encodedValue);default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:Mn,value:[new D({name:t.version||Wg}),new St({value:[Ut.schema(t.sidSchema||{names:{blockName:Of}}),new St({value:[new T({optional:!0,name:t.sid||Of,idBlock:{tagClass:3,tagNumber:0},value:[new z]}),new Be({optional:!0,name:t.sid||Of,idBlock:{tagClass:3,tagNumber:0}})]})]}),V.schema(t.digestAlgorithm||{names:{blockName:Qg}}),At.schema(t.signedAttrs||{names:{blockName:A0,tagNumber:0}}),V.schema(t.signatureAlgorithm||{names:{blockName:Yg}}),new z({name:t.signature||zg}),At.schema(t.unsignedAttrs||{names:{blockName:b0,tagNumber:1}})]})}fromSchema(e){W(e,fx);const t=j(e,e,It.schema());M.assertSchema(t,this.className),this.version=t.result[Wg].valueBlock.valueDec;const r=t.result[Of];r.idBlock.tagClass===1?this.sid=new Ut({schema:r}):this.sid=r,this.digestAlgorithm=new V({schema:t.result[Qg]}),A0 in t.result&&(this.signedAttrs=new At({type:0,schema:t.result[A0]})),this.signatureAlgorithm=new V({schema:t.result[Yg]}),this.signature=t.result[zg],b0 in t.result&&(this.unsignedAttrs=new At({type:1,schema:t.result[b0]}))}toSchema(){if(It.compareWithDefault(Hi,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e=[];return e.push(new D({value:this.version})),this.sid instanceof Ut?e.push(this.sid.toSchema()):e.push(this.sid),e.push(this.digestAlgorithm.toSchema()),this.signedAttrs&&It.compareWithDefault(un,this.signedAttrs)===!1&&e.push(this.signedAttrs.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.unsignedAttrs&&It.compareWithDefault(cn,this.unsignedAttrs)===!1&&e.push(this.unsignedAttrs.toSchema()),new E({value:e})}toJSON(){if(It.compareWithDefault(Hi,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e={version:this.version,digestAlgorithm:this.digestAlgorithm.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.sid instanceof ke||(e.sid=this.sid.toJSON()),this.signedAttrs&&It.compareWithDefault(un,this.signedAttrs)===!1&&(e.signedAttrs=this.signedAttrs.toJSON()),this.unsignedAttrs&&It.compareWithDefault(cn,this.unsignedAttrs)===!1&&(e.unsignedAttrs=this.unsignedAttrs.toJSON()),e}}It.CLASS_NAME="SignerInfo";const Pf="version",Uf="policy",Mf="messageImprint",Hf="serialNumber",Kf="genTime",Ki="ordering",Fi="nonce",ql="accuracy",Jl="tsa",Gl="extensions",vs="TSTInfo",Xg=`${vs}.${Pf}`,Zg=`${vs}.${Uf}`,em=`${vs}.${Mf}`,tm=`${vs}.${Hf}`,rm=`${vs}.${Kf}`,E0=`${vs}.${ql}`,x0=`${vs}.${Ki}`,B0=`${vs}.${Fi}`,I0=`${vs}.${Jl}`,k0=`${vs}.${Gl}`,hx=[Xg,Zg,em,tm,rm,E0,x0,B0,I0,k0];class ur extends G{constructor(e={}){super(),this.version=m(e,Pf,ur.defaultValues(Pf)),this.policy=m(e,Uf,ur.defaultValues(Uf)),this.messageImprint=m(e,Mf,ur.defaultValues(Mf)),this.serialNumber=m(e,Hf,ur.defaultValues(Hf)),this.genTime=m(e,Kf,ur.defaultValues(Kf)),ql in e&&(this.accuracy=m(e,ql,ur.defaultValues(ql))),Ki in e&&(this.ordering=m(e,Ki,ur.defaultValues(Ki))),Fi in e&&(this.nonce=m(e,Fi,ur.defaultValues(Fi))),Jl in e&&(this.tsa=m(e,Jl,ur.defaultValues(Jl))),Gl in e&&(this.extensions=m(e,Gl,ur.defaultValues(Gl))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pf:return 0;case Uf:return S;case Mf:return new ar;case Hf:return new D;case Kf:return new Date(0,0,0);case ql:return new Or;case Ki:return!1;case Fi:return new D;case Jl:return new Qe;case Gl:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Pf:case Uf:case Kf:case Ki:return t===ur.defaultValues(Ki);case Mf:return ar.compareWithDefault(Yi,t.hashAlgorithm)&&ar.compareWithDefault(zi,t.hashedMessage);case Hf:case Fi:return t.isEqual(ur.defaultValues(Fi));case ql:return Or.compareWithDefault(ka,t.seconds)&&Or.compareWithDefault(Na,t.millis)&&Or.compareWithDefault(Ta,t.micros);case Jl:return Qe.compareWithDefault(Xu,t.type)&&Qe.compareWithDefault(Zu,t.value);case Gl:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||vs,value:[new D({name:t.version||Xg}),new fe({name:t.policy||Zg}),ar.schema(t.messageImprint||{names:{blockName:em}}),new D({name:t.serialNumber||tm}),new wt({name:t.genTime||rm}),Or.schema(t.accuracy||{names:{blockName:E0}}),new Ps({name:t.ordering||x0,optional:!0}),new D({name:t.nonce||B0,optional:!0}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Qe.schema(t.tsa||{names:{blockName:I0}})]}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Re({name:t.extensions||k0,value:Rt.schema(t.extension||{})})]})]})}fromSchema(e){W(e,hx);const t=j(e,e,ur.schema());M.assertSchema(t,this.className),this.version=t.result[Xg].valueBlock.valueDec,this.policy=t.result[Zg].valueBlock.toString(),this.messageImprint=new ar({schema:t.result[em]}),this.serialNumber=t.result[tm],this.genTime=t.result[rm].toDate(),E0 in t.result&&(this.accuracy=new Or({schema:t.result[E0]})),x0 in t.result&&(this.ordering=t.result[x0].valueBlock.value),B0 in t.result&&(this.nonce=t.result[B0]),I0 in t.result&&(this.tsa=new Qe({schema:t.result[I0]})),k0 in t.result&&(this.extensions=Array.from(t.result[k0],r=>new Rt({schema:r})))}toSchema(){const e=[];return e.push(new D({value:this.version})),e.push(new fe({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new wt({valueDate:this.genTime})),this.accuracy&&e.push(this.accuracy.toSchema()),this.ordering!==void 0&&e.push(new Ps({value:this.ordering})),this.nonce&&e.push(this.nonce),this.tsa&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),this.extensions&&e.push(new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return this.accuracy&&(e.accuracy=this.accuracy.toJSON()),this.ordering!==void 0&&(e.ordering=this.ordering),this.nonce&&(e.nonce=this.nonce.toJSON()),this.tsa&&(e.tsa=this.tsa.toJSON()),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async verify(e,t=Ve(!0)){if(!e.data)throw new Error('"data" is a mandatory attribute for TST_INFO verification');const r=e.data;if(e.notBefore&&this.genTime<e.notBefore)throw new Error("Generation time for TSTInfo object is less than notBefore value");if(e.notAfter&&this.genTime>e.notAfter)throw new Error("Generation time for TSTInfo object is more than notAfter value");const a=t.getAlgorithmByOID(this.messageImprint.hashAlgorithm.algorithmId,!0,"MessageImprint.hashAlgorithm"),n=await t.digest(a.name,new Uint8Array(r));return Se.isEqual(n,this.messageImprint.hashedMessage.valueBlock.valueHexView)}}ur.CLASS_NAME="TSTInfo";const jl="version",Ff="digestAlgorithms",qf="encapContentInfo",Wl="certificates",Ql="crls",Jf="signerInfos",Wu="ocsps",Ao="SignedData",sm=`${Ao}.${jl}`,N0=`${Ao}.${Ff}`,am=`${Ao}.${qf}`,T0=`${Ao}.${Wl}`,_0=`${Ao}.${Ql}`,R0=`${Ao}.${Jf}`,dx=[sm,N0,am,T0,_0,R0];class lr extends Error{constructor({message:e,code:t=0,date:r=new Date,signatureVerified:a=null,signerCertificate:n=null,signerCertificateVerified:i=null,timestampSerial:o=null,certificatePath:l=[]}){super(e),this.name="SignedDataVerifyError",this.date=r,this.code=t,this.timestampSerial=o,this.signatureVerified=a,this.signerCertificate=n,this.signerCertificateVerified=i,this.certificatePath=l}}class tr extends G{constructor(e={}){super(),this.version=m(e,jl,tr.defaultValues(jl)),this.digestAlgorithms=m(e,Ff,tr.defaultValues(Ff)),this.encapContentInfo=m(e,qf,tr.defaultValues(qf)),Wl in e&&(this.certificates=m(e,Wl,tr.defaultValues(Wl))),Ql in e&&(this.crls=m(e,Ql,tr.defaultValues(Ql))),Wu in e&&(this.ocsps=m(e,Wu,tr.defaultValues(Wu))),this.signerInfos=m(e,Jf,tr.defaultValues(Jf)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case jl:return 0;case Ff:return[];case qf:return new Ir;case Wl:return[];case Ql:return[];case Wu:return[];case Jf:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case jl:return t===tr.defaultValues(jl);case qf:return Ir.compareWithDefault("eContentType",t.eContentType)&&Ir.compareWithDefault("eContent",t.eContent);case Ff:case Wl:case Ql:case Wu:case Jf:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return t.optional===void 0&&(t.optional=!1),new E({name:t.blockName||Ao,optional:t.optional,value:[new D({name:t.version||sm}),new Nt({value:[new Re({name:t.digestAlgorithms||N0,value:V.schema()})]}),Ir.schema(t.encapContentInfo||{names:{blockName:am}}),new T({name:t.certificates||T0,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Ds.schema().valueBlock.value}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:da.schema(t.crls||{names:{crls:_0}}).valueBlock.value}),new Nt({value:[new Re({name:t.signerInfos||R0,value:It.schema()})]})]})}fromSchema(e){W(e,dx);const t=j(e,e,tr.schema());if(M.assertSchema(t,this.className),this.version=t.result[sm].valueBlock.valueDec,N0 in t.result&&(this.digestAlgorithms=Array.from(t.result[N0],r=>new V({schema:r}))),this.encapContentInfo=new Ir({schema:t.result[am]}),T0 in t.result){const r=new Ds({schema:new Nt({value:t.result[T0].valueBlock.value})});this.certificates=r.certificates.slice(0)}_0 in t.result&&(this.crls=Array.from(t.result[_0],r=>r.idBlock.tagClass===1?new Mt({schema:r}):(r.idBlock.tagClass=1,r.idBlock.tagNumber=16,new ha({schema:r})))),R0 in t.result&&(this.signerInfos=Array.from(t.result[R0],r=>new It({schema:r})))}toSchema(e=!1){const t=[];if(this.certificates&&this.certificates.length&&this.certificates.some(r=>r instanceof Vn)||this.crls&&this.crls.length&&this.crls.some(r=>r instanceof ha)?this.version=5:this.certificates&&this.certificates.length&&this.certificates.some(r=>r instanceof Hr)?this.version=4:this.certificates&&this.certificates.length&&this.certificates.some(r=>r instanceof na)||this.signerInfos.some(r=>r.version===3)||this.encapContentInfo.eContentType!==tr.ID_DATA?this.version=3:this.version=1,t.push(new D({value:this.version})),t.push(new Nt({value:Array.from(this.digestAlgorithms,r=>r.toSchema())})),t.push(this.encapContentInfo.toSchema()),this.certificates){const a=new Ds({certificates:this.certificates}).toSchema();t.push(new T({idBlock:{tagClass:3,tagNumber:0},value:a.valueBlock.value}))}return this.crls&&t.push(new T({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,r=>{if(r instanceof ha){const a=r.toSchema();return a.idBlock.tagClass=3,a.idBlock.tagNumber=1,a}return r.toSchema(e)})})),t.push(new Nt({value:Array.from(this.signerInfos,r=>r.toSchema())})),new E({value:t})}toJSON(){const e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,t=>t.toJSON()),encapContentInfo:this.encapContentInfo.toJSON(),signerInfos:Array.from(this.signerInfos,t=>t.toJSON())};return this.certificates&&(e.certificates=Array.from(this.certificates,t=>t.toJSON())),this.crls&&(e.crls=Array.from(this.crls,t=>t.toJSON())),e}async verify({signer:e=-1,data:t=Ot,trustedCerts:r=[],checkDate:a=new Date,checkChain:n=!1,passedWhenNotRevValues:i=!1,extendedMode:o=!1,findOrigin:l=null,findIssuer:u=null}={},c=Ve(!0)){let f=null,g=null;try{let v=Ot,p=S,h=[];const d=this.signerInfos[e];if(!d)throw new lr({date:a,code:1,message:"Unable to get signer by supplied index"});if(!this.certificates)throw new lr({date:a,code:2,message:"No certificates attached to this signed data"});if(d.sid instanceof Ut){for(const N of this.certificates)if(N instanceof ze&&N.issuer.isEqual(d.sid.issuer)&&N.serialNumber.isEqual(d.sid.serialNumber)){f=N;break}}else{const N=d.sid,_=N.idBlock.isConstructed?N.valueBlock.value[0].valueBlock.valueHex:N.valueBlock.valueHex;for(const $ of this.certificates){if(!($ instanceof ze))continue;const se=await c.digest({name:"sha-1"},$.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(wu(se,_)){f=$;break}}}if(!f)throw new lr({date:a,code:3,message:"Unable to find signer certificate"});if(this.encapContentInfo.eContentType===yE){if(!this.encapContentInfo.eContent)throw new lr({date:a,code:15,message:"Error during verification: TSTInfo eContent is empty",signatureVerified:null,signerCertificate:f,timestampSerial:g,signerCertificateVerified:!0});let N;try{N=ur.fromBER(this.encapContentInfo.eContent.valueBlock.valueHexView)}catch{throw new lr({date:a,code:15,message:"Error during verification: TSTInfo wrong ASN.1 schema ",signatureVerified:null,signerCertificate:f,timestampSerial:g,signerCertificateVerified:!0})}if(a=N.genTime,g=N.serialNumber.valueBlock.valueHexView.slice(),t.byteLength===0)throw new lr({date:a,code:4,message:"Missed detached data input array"});if(!await N.verify({data:t},c))throw new lr({date:a,code:15,message:"Error during verification: TSTInfo verification is failed",signatureVerified:!1,signerCertificate:f,timestampSerial:g,signerCertificateVerified:!0})}if(n){const N=this.certificates.filter(te=>te instanceof ze&&!!H1(te,f)),_={checkDate:a,certs:N,trustedCerts:r};u&&(_.findIssuer=u),l&&(_.findOrigin=l);const $=new Nd(_);if($.certs.push(f),this.crls)for(const te of this.crls)"thisUpdate"in te?$.crls.push(te):te.otherRevInfoFormat===o0&&$.ocsps.push(new Yr({schema:te.otherRevInfo}));this.ocsps&&$.ocsps.push(...this.ocsps);const se=await $.verify({passedWhenNotRevValues:i},c).catch(te=>{throw new lr({date:a,code:5,message:`Validation of signer's certificate failed with error: ${te instanceof Object?te.resultMessage:te}`,signerCertificate:f,signerCertificateVerified:!1})});if(se.certificatePath&&(h=se.certificatePath),!se.result)throw new lr({date:a,code:5,message:`Validation of signer's certificate failed: ${se.resultMessage}`,signerCertificate:f,signerCertificateVerified:!1})}const y=c.getAlgorithmByOID(d.digestAlgorithm.algorithmId);if(!("name"in y))throw new lr({date:a,code:7,message:`Unsupported signature algorithm: ${d.digestAlgorithm.algorithmId}`,signerCertificate:f,signerCertificateVerified:!0});p=y.name;const A=this.encapContentInfo.eContent;if(A)A.idBlock.tagClass===1&&A.idBlock.tagNumber===4?t=A.getValue():t=A.valueBlock.valueBeforeDecodeView;else if(t.byteLength===0)throw new lr({date:a,code:8,message:"Missed detached data input array",signerCertificate:f,signerCertificateVerified:!0});if(d.signedAttrs){let N=!1,_=!1;for(const $ of d.signedAttrs.attributes)if($.type==="1.2.840.113549.1.9.3"&&(N=!0),$.type==="1.2.840.113549.1.9.4"&&(_=!0,v=$.values[0].valueBlock.valueHex),N&&_)break;if(N===!1)throw new lr({date:a,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signerCertificate:f,signerCertificateVerified:!0});if(_===!1)throw new lr({date:a,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:f,signerCertificateVerified:!0})}if(d.signedAttrs){const N=await c.digest(p,new Uint8Array(t));if(!wu(N,v))throw new lr({date:a,code:15,message:"Error during verification: Message digest doesn't match",signatureVerified:null,signerCertificate:f,timestampSerial:g,signerCertificateVerified:!0});t=d.signedAttrs.encodedValue}const x=d.signatureAlgorithm.algorithmId==="1.2.840.113549.1.1.1"?await c.verifyWithPublicKey(t,d.signature,f.subjectPublicKeyInfo,d.signatureAlgorithm,p):await c.verifyWithPublicKey(t,d.signature,f.subjectPublicKeyInfo,d.signatureAlgorithm);return o?{date:a,code:14,message:S,signatureVerified:x,signerCertificate:f,timestampSerial:g,signerCertificateVerified:!0,certificatePath:h}:x}catch(v){throw v instanceof lr?v:new lr({date:a,code:15,message:`Error during verification: ${v instanceof Error?v.message:v}`,signatureVerified:null,signerCertificate:f,timestampSerial:g,signerCertificateVerified:!0})}}async sign(e,t,r="SHA-1",a=Ot,n=Ve(!0)){var i;if(!e)throw new Error("Need to provide a private key for signing");const o=this.signerInfos[t];if(!o)throw new RangeError("SignerInfo index is out of range");!(!((i=o.signedAttrs)===null||i===void 0)&&i.attributes.length)&&"hash"in e.algorithm&&"hash"in e.algorithm&&e.algorithm.hash&&(r=e.algorithm.hash.name);const l=n.getOIDByAlgorithm({name:r},!0,"hashAlgorithm");this.digestAlgorithms.filter(g=>g.algorithmId===l).length===0&&this.digestAlgorithms.push(new V({algorithmId:l,algorithmParams:new kt})),o.digestAlgorithm=new V({algorithmId:l,algorithmParams:new kt});const u=await n.getSignatureParameters(e,r),c=u.parameters;if(o.signatureAlgorithm=u.signatureAlgorithm,o.signedAttrs)if(o.signedAttrs.encodedValue.byteLength!==0)a=o.signedAttrs.encodedValue;else{a=o.signedAttrs.toSchema().toBER();const g=Se.toUint8Array(a);g[0]=49}else{const g=this.encapContentInfo.eContent;if(g)g.idBlock.tagClass===1&&g.idBlock.tagNumber===4?a=g.getValue():a=g.valueBlock.valueBeforeDecodeView;else if(a.byteLength===0)throw new Error("Missed detached data input array")}const f=await n.signWithPrivateKey(a,e,c);o.signature=new z({valueHex:f})}}tr.CLASS_NAME="SignedData";tr.ID_DATA=Km;const qi="version",Ji="authSafe",Zs="macData",Qu="parsedValue",gx=[qi,Ji,Zs];class mn extends G{constructor(e={}){super(),this.version=m(e,qi,mn.defaultValues(qi)),this.authSafe=m(e,Ji,mn.defaultValues(Ji)),Zs in e&&(this.macData=m(e,Zs,mn.defaultValues(Zs))),Qu in e&&(this.parsedValue=m(e,Qu,mn.defaultValues(Qu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case qi:return 3;case Ji:return new ct;case Zs:return new vr;case Qu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case qi:return t===mn.defaultValues(e);case Ji:return ct.compareWithDefault("contentType",t.contentType)&&ct.compareWithDefault("content",t.content);case Zs:return vr.compareWithDefault("mac",t.mac)&&vr.compareWithDefault("macSalt",t.macSalt)&&vr.compareWithDefault("iterations",t.iterations);case Qu:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new D({name:t.version||qi}),ct.schema(t.authSafe||{names:{blockName:Ji}}),vr.schema(t.macData||{names:{blockName:Zs,optional:!0}})]})}fromSchema(e){W(e,gx);const t=j(e,e,mn.schema({names:{version:qi,authSafe:{names:{blockName:Ji}},macData:{names:{blockName:Zs}}}}));M.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.authSafe=new ct({schema:t.result.authSafe}),Zs in t.result&&(this.macData=new vr({schema:t.result.macData}))}toSchema(){const e=[new D({value:this.version}),this.authSafe.toSchema()];return this.macData&&e.push(this.macData.toSchema()),new E({value:e})}toJSON(){const e={version:this.version,authSafe:this.authSafe.toJSON()};return this.macData&&(e.macData=this.macData.toJSON()),e}async makeInternalValues(e={},t=Ve(!0)){if(tt.assert(e,"parameters","object"),!this.parsedValue)throw new Error('Please call "parseValues" function first in order to make "parsedValue" data');switch(Fe.assertEmpty(this.parsedValue.integrityMode,"integrityMode","parsedValue"),Fe.assertEmpty(this.parsedValue.authenticatedSafe,"authenticatedSafe","parsedValue"),this.parsedValue.integrityMode){case 0:{if(!("iterations"in e))throw new Fe("iterations");Fe.assertEmpty(e.pbkdf2HashAlgorithm,"pbkdf2HashAlgorithm"),Fe.assertEmpty(e.hmacHashAlgorithm,"hmacHashAlgorithm"),Fe.assertEmpty(e.password,"password");const r=new ArrayBuffer(64),a=new Uint8Array(r);t.getRandomValues(a);const n=this.parsedValue.authenticatedSafe.toSchema().toBER(!1);this.authSafe=new ct({contentType:ct.DATA,content:new z({valueHex:n})});const i=await t.stampDataWithPassword({password:e.password,hashAlgorithm:e.hmacHashAlgorithm,salt:r,iterationCount:e.iterations,contentToStamp:n});this.macData=new vr({mac:new Xr({digestAlgorithm:new V({algorithmId:t.getOIDByAlgorithm({name:e.hmacHashAlgorithm},!0,"hmacHashAlgorithm")}),digest:new z({valueHex:i})}),macSalt:new z({valueHex:r}),iterations:e.iterations})}break;case 1:{if(!("signingCertificate"in e))throw new Fe("signingCertificate");Fe.assertEmpty(e.privateKey,"privateKey"),Fe.assertEmpty(e.hashAlgorithm,"hashAlgorithm");const r=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),a=new tr({version:1,encapContentInfo:new Ir({eContentType:"1.2.840.113549.1.7.1",eContent:new z({valueHex:r})}),certificates:[e.signingCertificate]}),n=await t.digest({name:e.hashAlgorithm},new Uint8Array(r)),i=[];i.push(new gt({type:"1.2.840.113549.1.9.3",values:[new fe({value:"1.2.840.113549.1.7.1"})]})),i.push(new gt({type:"1.2.840.113549.1.9.5",values:[new Cu({valueDate:new Date})]})),i.push(new gt({type:"1.2.840.113549.1.9.4",values:[new z({valueHex:n})]})),a.signerInfos.push(new It({version:1,sid:new Ut({issuer:e.signingCertificate.issuer,serialNumber:e.signingCertificate.serialNumber}),signedAttrs:new At({type:0,attributes:i})})),await a.sign(e.privateKey,0,e.hashAlgorithm,void 0,t),this.authSafe=new ct({contentType:"1.2.840.113549.1.7.2",content:a.toSchema(!0)})}break;default:throw new Error(`Parameter "integrityMode" has unknown value: ${this.parsedValue.integrityMode}`)}}async parseInternalValues(e,t=Ve(!0)){switch(tt.assert(e,"parameters","object"),e.checkIntegrity===void 0&&(e.checkIntegrity=!0),this.parsedValue={},this.authSafe.contentType){case ct.DATA:{Fe.assertEmpty(e.password,"password"),this.parsedValue.integrityMode=0,tt.assert(this.authSafe.content,"authSafe.content",z);const r=this.authSafe.content.getValue();if(this.parsedValue.authenticatedSafe=ho.fromBER(r),e.checkIntegrity){if(!this.macData)throw new Error('Absent "macData" value, can not check PKCS#12 data integrity');const a=t.getAlgorithmByOID(this.macData.mac.digestAlgorithm.algorithmId,!0,"digestAlgorithm");if(!await t.verifyDataStampedWithPassword({password:e.password,hashAlgorithm:a.name,salt:Se.toArrayBuffer(this.macData.macSalt.valueBlock.valueHexView),iterationCount:this.macData.iterations||1,contentToVerify:r,signatureToVerify:Se.toArrayBuffer(this.macData.mac.digest.valueBlock.valueHexView)}))throw new Error("Integrity for the PKCS#12 data is broken!")}}break;case ct.SIGNED_DATA:{this.parsedValue.integrityMode=1;const r=new tr({schema:this.authSafe.content}),a=r.encapContentInfo.eContent;Fe.assert(a,"eContent","cmsSigned.encapContentInfo"),tt.assert(a,"eContent",z);const n=a.getValue();if(this.parsedValue.authenticatedSafe=ho.fromBER(n),!await r.verify({signer:0,checkChain:!1},t))throw new Error("Integrity for the PKCS#12 data is broken!")}break;default:throw new Error(`Incorrect value for "this.authSafe.contentType": ${this.authSafe.contentType}`)}}}mn.CLASS_NAME="PFX";const Yl="status",fn="statusStrings",hn="failInfo",mx=[Yl,fn,hn];var uy;(function(s){s[s.granted=0]="granted",s[s.grantedWithMods=1]="grantedWithMods",s[s.rejection=2]="rejection",s[s.waiting=3]="waiting",s[s.revocationWarning=4]="revocationWarning",s[s.revocationNotification=5]="revocationNotification"})(uy||(uy={}));class zr extends G{constructor(e={}){super(),this.status=m(e,Yl,zr.defaultValues(Yl)),fn in e&&(this.statusStrings=m(e,fn,zr.defaultValues(fn))),hn in e&&(this.failInfo=m(e,hn,zr.defaultValues(hn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yl:return 2;case fn:return[];case hn:return new Pe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Yl:return t===zr.defaultValues(e);case fn:return t.length===0;case hn:return t.isEqual(zr.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||S,value:[new D({name:t.status||S}),new E({optional:!0,value:[new Re({name:t.statusStrings||S,value:new ps})]}),new Pe({name:t.failInfo||S,optional:!0})]})}fromSchema(e){W(e,mx);const t=j(e,e,zr.schema({names:{status:Yl,statusStrings:fn,failInfo:hn}}));M.assertSchema(t,this.className);const r=t.result.status;if(r.valueBlock.isHexOnly===!0||r.valueBlock.valueDec<0||r.valueBlock.valueDec>5)throw new Error('PKIStatusInfo "status" has invalid value');this.status=r.valueBlock.valueDec,fn in t.result&&(this.statusStrings=t.result.statusStrings),hn in t.result&&(this.failInfo=t.result.failInfo)}toSchema(){const e=[];return e.push(new D({value:this.status})),this.statusStrings&&e.push(new E({optional:!0,value:this.statusStrings})),this.failInfo&&e.push(this.failInfo),new E({value:e})}toJSON(){const e={status:this.status};return this.statusStrings&&(e.statusStrings=Array.from(this.statusStrings,t=>t.toJSON())),this.failInfo&&(e.failInfo=this.failInfo.toJSON()),e}}zr.CLASS_NAME="PKIStatusInfo";const Gf="version",jf="messageImprint",zl="reqPolicy",Xl="nonce",ea="certReq",Zl="extensions",bo="TimeStampReq",nm=`${bo}.${Gf}`,im=`${bo}.${jf}`,V0=`${bo}.${zl}`,$0=`${bo}.${Xl}`,D0=`${bo}.${ea}`,L0=`${bo}.${Zl}`,px=[nm,im,V0,$0,D0,L0];class Rr extends G{constructor(e={}){super(),this.version=m(e,Gf,Rr.defaultValues(Gf)),this.messageImprint=m(e,jf,Rr.defaultValues(jf)),zl in e&&(this.reqPolicy=m(e,zl,Rr.defaultValues(zl))),Xl in e&&(this.nonce=m(e,Xl,Rr.defaultValues(Xl))),ea in e&&(this.certReq=m(e,ea,Rr.defaultValues(ea))),Zl in e&&(this.extensions=m(e,Zl,Rr.defaultValues(Zl))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gf:return 0;case jf:return new ar;case zl:return S;case Xl:return new D;case ea:return!1;case Zl:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Gf:case zl:case ea:return t===Rr.defaultValues(e);case jf:return ar.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&ar.compareWithDefault("hashedMessage",t.hashedMessage);case Xl:return t.isEqual(Rr.defaultValues(e));case Zl:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||bo,value:[new D({name:t.version||nm}),ar.schema(t.messageImprint||{names:{blockName:im}}),new fe({name:t.reqPolicy||V0,optional:!0}),new D({name:t.nonce||$0,optional:!0}),new Ps({name:t.certReq||D0,optional:!0}),new T({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Re({name:t.extensions||L0,value:Rt.schema()})]})]})}fromSchema(e){W(e,px);const t=j(e,e,Rr.schema());M.assertSchema(t,this.className),this.version=t.result[nm].valueBlock.valueDec,this.messageImprint=new ar({schema:t.result[im]}),V0 in t.result&&(this.reqPolicy=t.result[V0].valueBlock.toString()),$0 in t.result&&(this.nonce=t.result[$0]),D0 in t.result&&(this.certReq=t.result[D0].valueBlock.value),L0 in t.result&&(this.extensions=Array.from(t.result[L0],r=>new Rt({schema:r})))}toSchema(){const e=[];return e.push(new D({value:this.version})),e.push(this.messageImprint.toSchema()),this.reqPolicy&&e.push(new fe({value:this.reqPolicy})),this.nonce&&e.push(this.nonce),ea in this&&Rr.compareWithDefault(ea,this.certReq)===!1&&e.push(new Ps({value:this.certReq})),this.extensions&&e.push(new T({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.extensions,t=>t.toSchema())})),new E({value:e})}toJSON(){const e={version:this.version,messageImprint:this.messageImprint.toJSON()};return this.reqPolicy!==void 0&&(e.reqPolicy=this.reqPolicy),this.nonce!==void 0&&(e.nonce=this.nonce.toJSON()),this.certReq!==void 0&&Rr.compareWithDefault(ea,this.certReq)===!1&&(e.certReq=this.certReq),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}}Rr.CLASS_NAME="TimeStampReq";const eu="status",tu="timeStampToken",Zm="TimeStampResp",om=`${Zm}.${eu}`,O0=`${Zm}.${tu}`,yx=[om,O0];class eh extends G{constructor(e={}){super(),this.status=m(e,eu,eh.defaultValues(eu)),tu in e&&(this.timeStampToken=m(e,tu,eh.defaultValues(tu))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case eu:return new zr;case tu:return new ct;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case eu:return zr.compareWithDefault(eu,t.status)&&!("statusStrings"in t)&&!("failInfo"in t);case tu:return t.contentType===S&&t.content instanceof ke;default:return super.defaultValues(e)}}static schema(e={}){const t=m(e,"names",{});return new E({name:t.blockName||Zm,value:[zr.schema(t.status||{names:{blockName:om}}),ct.schema(t.timeStampToken||{names:{blockName:O0,optional:!0}})]})}fromSchema(e){W(e,yx);const t=j(e,e,eh.schema());M.assertSchema(t,this.className),this.status=new zr({schema:t.result[om]}),O0 in t.result&&(this.timeStampToken=new ct({schema:t.result[O0]}))}toSchema(){const e=[];return e.push(this.status.toSchema()),this.timeStampToken&&e.push(this.timeStampToken.toSchema()),new E({value:e})}toJSON(){const e={status:this.status.toJSON()};return this.timeStampToken&&(e.timeStampToken=this.timeStampToken.toJSON()),e}async sign(e,t,r=Ve(!0)){return this.assertContentType(),new tr({schema:this.timeStampToken.content}).sign(e,0,t,void 0,r)}async verify(e={signer:0,trustedCerts:[],data:Ot},t=Ve(!0)){return this.assertContentType(),new tr({schema:this.timeStampToken.content}).verify(e,t)}assertContentType(){if(!this.timeStampToken)throw new Error("timeStampToken is absent in TSP response");if(this.timeStampToken.contentType!==V1)throw new Error(`Wrong format of timeStampToken: ${this.timeStampToken.contentType}`)}}eh.CLASS_NAME="TimeStampResp";function vx(){if(typeof self<"u"){if("crypto"in self){let s="webcrypto";"webkitSubtle"in self.crypto&&(s="safari"),jp(s,new z0({name:s,crypto}))}}else if(typeof crypto<"u"&&"webcrypto"in crypto){const s="NodeJS ^15",e=crypto.webcrypto;jp(s,new z0({name:s,crypto:e}))}}vx();function cy(s,e,t){const r=s.slice();return r[68]=e[t],r[70]=t,r}function fy(s,e,t){const r=s.slice();return r[71]=e[t],r[70]=t,r}function hy(s,e,t){const r=s.slice();return r[73]=e[t],r[70]=t,r}function dy(s,e,t){const r=s.slice();return r[75]=e[t],r[70]=t,r}function wx(s){let e;return{c(){e=mt("No")},l(t){e=pt(t,"No")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function Sx(s){let e;return{c(){e=mt("Alias Name")},l(t){e=pt(t,"Alias Name")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function Cx(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p,h,d;return e=new st({props:{class:"!p-4"}}),r=new st({props:{$$slots:{default:[wx]},$$scope:{ctx:s}}}),n=new st({props:{class:"w-64",$$slots:{default:[Sx]},$$scope:{ctx:s}}}),o=new st({props:{class:"w-64"}}),u=new st({props:{class:"w-96"}}),f=new st({props:{class:"w-36"}}),v=new st({}),h=new st({}),{c(){K(e.$$.fragment),t=Z(),K(r.$$.fragment),a=Z(),K(n.$$.fragment),i=Z(),K(o.$$.fragment),l=Z(),K(u.$$.fragment),c=Z(),K(f.$$.fragment),g=Z(),K(v.$$.fragment),p=Z(),K(h.$$.fragment)},l(y){F(e.$$.fragment,y),t=ee(y),F(r.$$.fragment,y),a=ee(y),F(n.$$.fragment,y),i=ee(y),F(o.$$.fragment,y),l=ee(y),F(u.$$.fragment,y),c=ee(y),F(f.$$.fragment,y),g=ee(y),F(v.$$.fragment,y),p=ee(y),F(h.$$.fragment,y)},m(y,A){q(e,y,A),U(y,t,A),q(r,y,A),U(y,a,A),q(n,y,A),U(y,i,A),q(o,y,A),U(y,l,A),q(u,y,A),U(y,c,A),q(f,y,A),U(y,g,A),q(v,y,A),U(y,p,A),q(h,y,A),d=!0},p(y,A){const x={};A[2]&32768&&(x.$$scope={dirty:A,ctx:y}),r.$set(x);const N={};A[2]&32768&&(N.$$scope={dirty:A,ctx:y}),n.$set(N)},i(y){d||(L(e.$$.fragment,y),L(r.$$.fragment,y),L(n.$$.fragment,y),L(o.$$.fragment,y),L(u.$$.fragment,y),L(f.$$.fragment,y),L(v.$$.fragment,y),L(h.$$.fragment,y),d=!0)},o(y){O(e.$$.fragment,y),O(r.$$.fragment,y),O(n.$$.fragment,y),O(o.$$.fragment,y),O(u.$$.fragment,y),O(f.$$.fragment,y),O(v.$$.fragment,y),O(h.$$.fragment,y),d=!1},d(y){J(e,y),y&&P(t),J(r,y),y&&P(a),J(n,y),y&&P(i),J(o,y),y&&P(l),J(u,y),y&&P(c),J(f,y),y&&P(g),J(v,y),y&&P(p),J(h,y)}}}function gy(s){let e,t,r=s[17],a=[];for(let i=0;i<r.length;i+=1)a[i]=my(dy(s,r,i));const n=i=>O(a[i],1,1,()=>{a[i]=null});return{c(){for(let i=0;i<a.length;i+=1)a[i].c();e=Os()},l(i){for(let o=0;o<a.length;o+=1)a[o].l(i);e=Os()},m(i,o){for(let l=0;l<a.length;l+=1)a[l]&&a[l].m(i,o);U(i,e,o),t=!0},p(i,o){if(o[0]&131072){r=i[17];let l;for(l=0;l<r.length;l+=1){const u=dy(i,r,l);a[l]?(a[l].p(u,o),L(a[l],1)):(a[l]=my(u),a[l].c(),L(a[l],1),a[l].m(e.parentNode,e))}for(On(),l=r.length;l<a.length;l+=1)n(l);Pn()}},i(i){if(!t){for(let o=0;o<r.length;o+=1)L(a[o]);t=!0}},o(i){a=a.filter(Boolean);for(let o=0;o<a.length;o+=1)O(a[o]);t=!1},d(i){ld(a,i),i&&P(e)}}}function Ax(s){let e=s[70]+1+"",t;return{c(){t=mt(e)},l(r){t=pt(r,e)},m(r,a){U(r,t,a)},p:ph,d(r){r&&P(t)}}}function bx(s){let e=s[75]+"",t;return{c(){t=mt(e)},l(r){t=pt(r,e)},m(r,a){U(r,t,a)},p(r,a){a[0]&131072&&e!==(e=r[75]+"")&&yo(t,e)},d(r){r&&P(t)}}}function Ex(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p,h,d,y;return e=new we({props:{class:"!p-4"}}),r=new we({props:{class:"w-10",$$slots:{default:[Ax]},$$scope:{ctx:s}}}),n=new we({props:{class:"w-64",$$slots:{default:[bx]},$$scope:{ctx:s}}}),o=new we({props:{class:"w-64"}}),u=new we({props:{class:"w-96"}}),f=new we({props:{class:"w-36"}}),v=new we({}),h=new st({}),{c(){K(e.$$.fragment),t=Z(),K(r.$$.fragment),a=Z(),K(n.$$.fragment),i=Z(),K(o.$$.fragment),l=Z(),K(u.$$.fragment),c=Z(),K(f.$$.fragment),g=Z(),K(v.$$.fragment),p=Z(),K(h.$$.fragment),d=Z()},l(A){F(e.$$.fragment,A),t=ee(A),F(r.$$.fragment,A),a=ee(A),F(n.$$.fragment,A),i=ee(A),F(o.$$.fragment,A),l=ee(A),F(u.$$.fragment,A),c=ee(A),F(f.$$.fragment,A),g=ee(A),F(v.$$.fragment,A),p=ee(A),F(h.$$.fragment,A),d=ee(A)},m(A,x){q(e,A,x),U(A,t,x),q(r,A,x),U(A,a,x),q(n,A,x),U(A,i,x),q(o,A,x),U(A,l,x),q(u,A,x),U(A,c,x),q(f,A,x),U(A,g,x),q(v,A,x),U(A,p,x),q(h,A,x),U(A,d,x),y=!0},p(A,x){const N={};x[2]&32768&&(N.$$scope={dirty:x,ctx:A}),r.$set(N);const _={};x[0]&131072|x[2]&32768&&(_.$$scope={dirty:x,ctx:A}),n.$set(_)},i(A){y||(L(e.$$.fragment,A),L(r.$$.fragment,A),L(n.$$.fragment,A),L(o.$$.fragment,A),L(u.$$.fragment,A),L(f.$$.fragment,A),L(v.$$.fragment,A),L(h.$$.fragment,A),y=!0)},o(A){O(e.$$.fragment,A),O(r.$$.fragment,A),O(n.$$.fragment,A),O(o.$$.fragment,A),O(u.$$.fragment,A),O(f.$$.fragment,A),O(v.$$.fragment,A),O(h.$$.fragment,A),y=!1},d(A){J(e,A),A&&P(t),J(r,A),A&&P(a),J(n,A),A&&P(i),J(o,A),A&&P(l),J(u,A),A&&P(c),J(f,A),A&&P(g),J(v,A),A&&P(p),J(h,A),A&&P(d)}}}function my(s){let e,t;return e=new Un({props:{$$slots:{default:[Ex]},$$scope:{ctx:s}}}),{c(){K(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&131072|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function xx(s){let e,t,r;function a(i){s[33](i)}let n={style:"filled",id:"floating_filled",name:"floating_filled",type:"text",label:"Alias Name"};return s[5]!==void 0&&(n.value=s[5]),e=new yh({props:n}),dh.push(()=>gh(e,"value",a)),{c(){K(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,o){q(e,i,o),r=!0},p(i,o){const l={};!t&&o[0]&32&&(t=!0,l.value=i[5],mh(()=>t=!1)),e.$set(l)},i(i){r||(L(e.$$.fragment,i),r=!0)},o(i){O(e.$$.fragment,i),r=!1},d(i){J(e,i)}}}function Bx(s){let e,t,r;function a(i){s[34](i)}let n={style:"filled",id:"floating_filled2",name:"floating_filled2",type:"text",label:"PKCS#12 Password"};return s[6]!==void 0&&(n.value=s[6]),e=new yh({props:n}),dh.push(()=>gh(e,"value",a)),{c(){K(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,o){q(e,i,o),r=!0},p(i,o){const l={};!t&&o[0]&64&&(t=!0,l.value=i[6],mh(()=>t=!1)),e.$set(l)},i(i){r||(L(e.$$.fragment,i),r=!0)},o(i){O(e.$$.fragment,i),r=!1},d(i){J(e,i)}}}function Ix(s){let e,t,r,a,n,i,o,l,u;return{c(){e=Vs("label"),t=mt("Choose File"),r=Z(),a=Vs("input"),n=Z(),i=Vs("span"),o=mt(s[7]),this.h()},l(c){e=$s(c,"LABEL",{for:!0,class:!0});var f=gu(e);t=pt(f,"Choose File"),f.forEach(P),r=ee(c),a=$s(c,"INPUT",{type:!0,id:!0,class:!0,style:!0}),n=ee(c),i=$s(c,"SPAN",{class:!0});var g=gu(i);o=pt(g,s[7]),g.forEach(P),this.h()},h(){$t(e,"for","MachineCertUpload"),$t(e,"class","text-center font-medium focus:ring-4 focus:outline-none inline-flex items-center justify-center px-5 py-2.5 text-sm text-white bg-gray-800 hover:bg-gray-900 focus:ring-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700 dark:focus:ring-gray-700 rounded-lg"),$t(a,"type","file"),$t(a,"id","MachineCertUpload"),$t(a,"class","block w-full disabled:cursor-not-allowed disabled:opacity-50 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500 bg-gray-50 text-gray-900 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 border-gray-300 dark:border-gray-600 p-2.5 text-sm rounded-lg border !p-0 dark:text-gray-400"),lm(a,"display","none"),$t(i,"class","pl-4")},m(c,f){U(c,e,f),mu(e,t),U(c,r,f),U(c,a,f),U(c,n,f),U(c,i,f),mu(i,o),l||(u=ud(a,"change",s[18]),l=!0)},p(c,f){f[0]&128&&yo(o,c[7])},d(c){c&&P(e),c&&P(r),c&&P(a),c&&P(n),c&&P(i),l=!1,u()}}}function kx(s){let e;return{c(){e=mt("Upload")},l(t){e=pt(t,"Upload")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function Nx(s){let e,t;return e=new cd({props:{color:"dark",$$slots:{default:[kx]},$$scope:{ctx:s}}}),e.$on("click",s[19]),{c(){K(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function Tx(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p,h,d;return e=new we({props:{class:"!p-4"}}),r=new we({props:{class:"w-10"}}),n=new we({props:{class:"w-64",$$slots:{default:[xx]},$$scope:{ctx:s}}}),o=new we({props:{class:"w-64",$$slots:{default:[Bx]},$$scope:{ctx:s}}}),u=new we({props:{class:"w-96",$$slots:{default:[Ix]},$$scope:{ctx:s}}}),f=new we({props:{class:"w-36",$$slots:{default:[Nx]},$$scope:{ctx:s}}}),v=new we({}),h=new we({}),{c(){K(e.$$.fragment),t=Z(),K(r.$$.fragment),a=Z(),K(n.$$.fragment),i=Z(),K(o.$$.fragment),l=Z(),K(u.$$.fragment),c=Z(),K(f.$$.fragment),g=Z(),K(v.$$.fragment),p=Z(),K(h.$$.fragment)},l(y){F(e.$$.fragment,y),t=ee(y),F(r.$$.fragment,y),a=ee(y),F(n.$$.fragment,y),i=ee(y),F(o.$$.fragment,y),l=ee(y),F(u.$$.fragment,y),c=ee(y),F(f.$$.fragment,y),g=ee(y),F(v.$$.fragment,y),p=ee(y),F(h.$$.fragment,y)},m(y,A){q(e,y,A),U(y,t,A),q(r,y,A),U(y,a,A),q(n,y,A),U(y,i,A),q(o,y,A),U(y,l,A),q(u,y,A),U(y,c,A),q(f,y,A),U(y,g,A),q(v,y,A),U(y,p,A),q(h,y,A),d=!0},p(y,A){const x={};A[0]&32|A[2]&32768&&(x.$$scope={dirty:A,ctx:y}),n.$set(x);const N={};A[0]&64|A[2]&32768&&(N.$$scope={dirty:A,ctx:y}),o.$set(N);const _={};A[0]&128|A[2]&32768&&(_.$$scope={dirty:A,ctx:y}),u.$set(_);const $={};A[2]&32768&&($.$$scope={dirty:A,ctx:y}),f.$set($)},i(y){d||(L(e.$$.fragment,y),L(r.$$.fragment,y),L(n.$$.fragment,y),L(o.$$.fragment,y),L(u.$$.fragment,y),L(f.$$.fragment,y),L(v.$$.fragment,y),L(h.$$.fragment,y),d=!0)},o(y){O(e.$$.fragment,y),O(r.$$.fragment,y),O(n.$$.fragment,y),O(o.$$.fragment,y),O(u.$$.fragment,y),O(f.$$.fragment,y),O(v.$$.fragment,y),O(h.$$.fragment,y),d=!1},d(y){J(e,y),y&&P(t),J(r,y),y&&P(a),J(n,y),y&&P(i),J(o,y),y&&P(l),J(u,y),y&&P(c),J(f,y),y&&P(g),J(v,y),y&&P(p),J(h,y)}}}function _x(s){let e,t,r,a=s[16]==1&&gy(s);return t=new Un({props:{$$slots:{default:[Tx]},$$scope:{ctx:s}}}),{c(){a&&a.c(),e=Z(),K(t.$$.fragment)},l(n){a&&a.l(n),e=ee(n),F(t.$$.fragment,n)},m(n,i){a&&a.m(n,i),U(n,e,i),q(t,n,i),r=!0},p(n,i){n[16]==1?a?(a.p(n,i),i[0]&65536&&L(a,1)):(a=gy(n),a.c(),L(a,1),a.m(e.parentNode,e)):a&&(On(),O(a,1,1,()=>{a=null}),Pn());const o={};i[0]&224|i[2]&32768&&(o.$$scope={dirty:i,ctx:n}),t.$set(o)},i(n){r||(L(a),L(t.$$.fragment,n),r=!0)},o(n){O(a),O(t.$$.fragment,n),r=!1},d(n){a&&a.d(n),n&&P(e),J(t,n)}}}function Rx(s){let e,t,r,a;return e=new dd({props:{$$slots:{default:[Cx]},$$scope:{ctx:s}}}),r=new hd({props:{$$slots:{default:[_x]},$$scope:{ctx:s}}}),{c(){K(e.$$.fragment),t=Z(),K(r.$$.fragment)},l(n){F(e.$$.fragment,n),t=ee(n),F(r.$$.fragment,n)},m(n,i){q(e,n,i),U(n,t,i),q(r,n,i),a=!0},p(n,i){const o={};i[2]&32768&&(o.$$scope={dirty:i,ctx:n}),e.$set(o);const l={};i[0]&196832|i[2]&32768&&(l.$$scope={dirty:i,ctx:n}),r.$set(l)},i(n){a||(L(e.$$.fragment,n),L(r.$$.fragment,n),a=!0)},o(n){O(e.$$.fragment,n),O(r.$$.fragment,n),a=!1},d(n){J(e,n),n&&P(t),J(r,n)}}}function Vx(s){let e,t;return e=new fd({props:{shadow:!0,striped:!0,tableNoWFull:!0,$$slots:{default:[Rx]},$$scope:{ctx:s}}}),{c(){K(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&196832|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function $x(s){let e;return{c(){e=mt("No")},l(t){e=pt(t,"No")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function Dx(s){let e;return{c(){e=mt("Alias Name")},l(t){e=pt(t,"Alias Name")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function Lx(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p;return e=new st({props:{class:"!p-4"}}),r=new st({props:{$$slots:{default:[$x]},$$scope:{ctx:s}}}),n=new st({props:{$$slots:{default:[Dx]},$$scope:{ctx:s}}}),o=new st({}),u=new st({}),f=new st({}),v=new st({}),{c(){K(e.$$.fragment),t=Z(),K(r.$$.fragment),a=Z(),K(n.$$.fragment),i=Z(),K(o.$$.fragment),l=Z(),K(u.$$.fragment),c=Z(),K(f.$$.fragment),g=Z(),K(v.$$.fragment)},l(h){F(e.$$.fragment,h),t=ee(h),F(r.$$.fragment,h),a=ee(h),F(n.$$.fragment,h),i=ee(h),F(o.$$.fragment,h),l=ee(h),F(u.$$.fragment,h),c=ee(h),F(f.$$.fragment,h),g=ee(h),F(v.$$.fragment,h)},m(h,d){q(e,h,d),U(h,t,d),q(r,h,d),U(h,a,d),q(n,h,d),U(h,i,d),q(o,h,d),U(h,l,d),q(u,h,d),U(h,c,d),q(f,h,d),U(h,g,d),q(v,h,d),p=!0},p(h,d){const y={};d[2]&32768&&(y.$$scope={dirty:d,ctx:h}),r.$set(y);const A={};d[2]&32768&&(A.$$scope={dirty:d,ctx:h}),n.$set(A)},i(h){p||(L(e.$$.fragment,h),L(r.$$.fragment,h),L(n.$$.fragment,h),L(o.$$.fragment,h),L(u.$$.fragment,h),L(f.$$.fragment,h),L(v.$$.fragment,h),p=!0)},o(h){O(e.$$.fragment,h),O(r.$$.fragment,h),O(n.$$.fragment,h),O(o.$$.fragment,h),O(u.$$.fragment,h),O(f.$$.fragment,h),O(v.$$.fragment,h),p=!1},d(h){J(e,h),h&&P(t),J(r,h),h&&P(a),J(n,h),h&&P(i),J(o,h),h&&P(l),J(u,h),h&&P(c),J(f,h),h&&P(g),J(v,h)}}}function py(s){let e,t,r=s[15],a=[];for(let i=0;i<r.length;i+=1)a[i]=yy(hy(s,r,i));const n=i=>O(a[i],1,1,()=>{a[i]=null});return{c(){for(let i=0;i<a.length;i+=1)a[i].c();e=Os()},l(i){for(let o=0;o<a.length;o+=1)a[o].l(i);e=Os()},m(i,o){for(let l=0;l<a.length;l+=1)a[l]&&a[l].m(i,o);U(i,e,o),t=!0},p(i,o){if(o[0]&32768){r=i[15];let l;for(l=0;l<r.length;l+=1){const u=hy(i,r,l);a[l]?(a[l].p(u,o),L(a[l],1)):(a[l]=yy(u),a[l].c(),L(a[l],1),a[l].m(e.parentNode,e))}for(On(),l=r.length;l<a.length;l+=1)n(l);Pn()}},i(i){if(!t){for(let o=0;o<r.length;o+=1)L(a[o]);t=!0}},o(i){a=a.filter(Boolean);for(let o=0;o<a.length;o+=1)O(a[o]);t=!1},d(i){ld(a,i),i&&P(e)}}}function Ox(s){let e=s[70]+1+"",t;return{c(){t=mt(e)},l(r){t=pt(r,e)},m(r,a){U(r,t,a)},p:ph,d(r){r&&P(t)}}}function Px(s){let e=s[73]+"",t;return{c(){t=mt(e)},l(r){t=pt(r,e)},m(r,a){U(r,t,a)},p(r,a){a[0]&32768&&e!==(e=r[73]+"")&&yo(t,e)},d(r){r&&P(t)}}}function Ux(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p,h;return e=new we({props:{class:"!p-4"}}),r=new we({props:{class:"w-10",$$slots:{default:[Ox]},$$scope:{ctx:s}}}),n=new we({props:{class:"w-64",$$slots:{default:[Px]},$$scope:{ctx:s}}}),o=new we({props:{class:"w-96"}}),u=new we({props:{class:"w-36"}}),f=new we({}),v=new we({}),{c(){K(e.$$.fragment),t=Z(),K(r.$$.fragment),a=Z(),K(n.$$.fragment),i=Z(),K(o.$$.fragment),l=Z(),K(u.$$.fragment),c=Z(),K(f.$$.fragment),g=Z(),K(v.$$.fragment),p=Z()},l(d){F(e.$$.fragment,d),t=ee(d),F(r.$$.fragment,d),a=ee(d),F(n.$$.fragment,d),i=ee(d),F(o.$$.fragment,d),l=ee(d),F(u.$$.fragment,d),c=ee(d),F(f.$$.fragment,d),g=ee(d),F(v.$$.fragment,d),p=ee(d)},m(d,y){q(e,d,y),U(d,t,y),q(r,d,y),U(d,a,y),q(n,d,y),U(d,i,y),q(o,d,y),U(d,l,y),q(u,d,y),U(d,c,y),q(f,d,y),U(d,g,y),q(v,d,y),U(d,p,y),h=!0},p(d,y){const A={};y[2]&32768&&(A.$$scope={dirty:y,ctx:d}),r.$set(A);const x={};y[0]&32768|y[2]&32768&&(x.$$scope={dirty:y,ctx:d}),n.$set(x)},i(d){h||(L(e.$$.fragment,d),L(r.$$.fragment,d),L(n.$$.fragment,d),L(o.$$.fragment,d),L(u.$$.fragment,d),L(f.$$.fragment,d),L(v.$$.fragment,d),h=!0)},o(d){O(e.$$.fragment,d),O(r.$$.fragment,d),O(n.$$.fragment,d),O(o.$$.fragment,d),O(u.$$.fragment,d),O(f.$$.fragment,d),O(v.$$.fragment,d),h=!1},d(d){J(e,d),d&&P(t),J(r,d),d&&P(a),J(n,d),d&&P(i),J(o,d),d&&P(l),J(u,d),d&&P(c),J(f,d),d&&P(g),J(v,d),d&&P(p)}}}function yy(s){let e,t;return e=new Un({props:{$$slots:{default:[Ux]},$$scope:{ctx:s}}}),{c(){K(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&32768|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function Mx(s){let e,t,r;function a(i){s[35](i)}let n={style:"filled",id:"floating_filled",name:"floating_filled",type:"text",label:"Alias Name"};return s[2]!==void 0&&(n.value=s[2]),e=new yh({props:n}),dh.push(()=>gh(e,"value",a)),{c(){K(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,o){q(e,i,o),r=!0},p(i,o){const l={};!t&&o[0]&4&&(t=!0,l.value=i[2],mh(()=>t=!1)),e.$set(l)},i(i){r||(L(e.$$.fragment,i),r=!0)},o(i){O(e.$$.fragment,i),r=!1},d(i){J(e,i)}}}function Hx(s){let e,t,r,a,n,i,o,l,u;return{c(){e=Vs("label"),t=mt("Choose File"),r=Z(),a=Vs("input"),n=Z(),i=Vs("span"),o=mt(s[8]),this.h()},l(c){e=$s(c,"LABEL",{for:!0,class:!0});var f=gu(e);t=pt(f,"Choose File"),f.forEach(P),r=ee(c),a=$s(c,"INPUT",{type:!0,id:!0,class:!0,style:!0}),n=ee(c),i=$s(c,"SPAN",{class:!0});var g=gu(i);o=pt(g,s[8]),g.forEach(P),this.h()},h(){$t(e,"for","CACertUpload"),$t(e,"class","text-center font-medium focus:ring-4 focus:outline-none inline-flex items-center justify-center px-5 py-2.5 text-sm text-white bg-gray-800 hover:bg-gray-900 focus:ring-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700 dark:focus:ring-gray-700 rounded-lg"),$t(a,"type","file"),$t(a,"id","CACertUpload"),$t(a,"class","block w-full disabled:cursor-not-allowed disabled:opacity-50 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500 bg-gray-50 text-gray-900 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 border-gray-300 dark:border-gray-600 p-2.5 text-sm rounded-lg border !p-0 dark:text-gray-400"),lm(a,"display","none"),$t(i,"class","pl-4")},m(c,f){U(c,e,f),mu(e,t),U(c,r,f),U(c,a,f),U(c,n,f),U(c,i,f),mu(i,o),l||(u=ud(a,"change",s[20]),l=!0)},p(c,f){f[0]&256&&yo(o,c[8])},d(c){c&&P(e),c&&P(r),c&&P(a),c&&P(n),c&&P(i),l=!1,u()}}}function Kx(s){let e;return{c(){e=mt("Upload")},l(t){e=pt(t,"Upload")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function Fx(s){let e,t;return e=new cd({props:{color:"dark",$$slots:{default:[Kx]},$$scope:{ctx:s}}}),e.$on("click",s[21]),{c(){K(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function qx(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p;return e=new we({props:{class:"!p-4"}}),r=new we({props:{class:"w-10"}}),n=new we({props:{class:"w-64",$$slots:{default:[Mx]},$$scope:{ctx:s}}}),o=new we({props:{class:"w-96",$$slots:{default:[Hx]},$$scope:{ctx:s}}}),u=new we({props:{class:"w-36",$$slots:{default:[Fx]},$$scope:{ctx:s}}}),f=new we({}),v=new we({}),{c(){K(e.$$.fragment),t=Z(),K(r.$$.fragment),a=Z(),K(n.$$.fragment),i=Z(),K(o.$$.fragment),l=Z(),K(u.$$.fragment),c=Z(),K(f.$$.fragment),g=Z(),K(v.$$.fragment)},l(h){F(e.$$.fragment,h),t=ee(h),F(r.$$.fragment,h),a=ee(h),F(n.$$.fragment,h),i=ee(h),F(o.$$.fragment,h),l=ee(h),F(u.$$.fragment,h),c=ee(h),F(f.$$.fragment,h),g=ee(h),F(v.$$.fragment,h)},m(h,d){q(e,h,d),U(h,t,d),q(r,h,d),U(h,a,d),q(n,h,d),U(h,i,d),q(o,h,d),U(h,l,d),q(u,h,d),U(h,c,d),q(f,h,d),U(h,g,d),q(v,h,d),p=!0},p(h,d){const y={};d[0]&4|d[2]&32768&&(y.$$scope={dirty:d,ctx:h}),n.$set(y);const A={};d[0]&256|d[2]&32768&&(A.$$scope={dirty:d,ctx:h}),o.$set(A);const x={};d[2]&32768&&(x.$$scope={dirty:d,ctx:h}),u.$set(x)},i(h){p||(L(e.$$.fragment,h),L(r.$$.fragment,h),L(n.$$.fragment,h),L(o.$$.fragment,h),L(u.$$.fragment,h),L(f.$$.fragment,h),L(v.$$.fragment,h),p=!0)},o(h){O(e.$$.fragment,h),O(r.$$.fragment,h),O(n.$$.fragment,h),O(o.$$.fragment,h),O(u.$$.fragment,h),O(f.$$.fragment,h),O(v.$$.fragment,h),p=!1},d(h){J(e,h),h&&P(t),J(r,h),h&&P(a),J(n,h),h&&P(i),J(o,h),h&&P(l),J(u,h),h&&P(c),J(f,h),h&&P(g),J(v,h)}}}function Jx(s){let e,t,r,a=s[14]==1&&py(s);return t=new Un({props:{$$slots:{default:[qx]},$$scope:{ctx:s}}}),{c(){a&&a.c(),e=Z(),K(t.$$.fragment)},l(n){a&&a.l(n),e=ee(n),F(t.$$.fragment,n)},m(n,i){a&&a.m(n,i),U(n,e,i),q(t,n,i),r=!0},p(n,i){n[14]==1?a?(a.p(n,i),i[0]&16384&&L(a,1)):(a=py(n),a.c(),L(a,1),a.m(e.parentNode,e)):a&&(On(),O(a,1,1,()=>{a=null}),Pn());const o={};i[0]&260|i[2]&32768&&(o.$$scope={dirty:i,ctx:n}),t.$set(o)},i(n){r||(L(a),L(t.$$.fragment,n),r=!0)},o(n){O(a),O(t.$$.fragment,n),r=!1},d(n){a&&a.d(n),n&&P(e),J(t,n)}}}function Gx(s){let e,t,r,a;return e=new dd({props:{$$slots:{default:[Lx]},$$scope:{ctx:s}}}),r=new hd({props:{$$slots:{default:[Jx]},$$scope:{ctx:s}}}),{c(){K(e.$$.fragment),t=Z(),K(r.$$.fragment)},l(n){F(e.$$.fragment,n),t=ee(n),F(r.$$.fragment,n)},m(n,i){q(e,n,i),U(n,t,i),q(r,n,i),a=!0},p(n,i){const o={};i[2]&32768&&(o.$$scope={dirty:i,ctx:n}),e.$set(o);const l={};i[0]&49412|i[2]&32768&&(l.$$scope={dirty:i,ctx:n}),r.$set(l)},i(n){a||(L(e.$$.fragment,n),L(r.$$.fragment,n),a=!0)},o(n){O(e.$$.fragment,n),O(r.$$.fragment,n),a=!1},d(n){J(e,n),n&&P(t),J(r,n)}}}function jx(s){let e,t;return e=new fd({props:{shadow:!0,striped:!0,tableNoWFull:!0,$$slots:{default:[Gx]},$$scope:{ctx:s}}}),{c(){K(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&49412|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function Wx(s){let e;return{c(){e=mt("No")},l(t){e=pt(t,"No")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function Qx(s){let e;return{c(){e=mt("Alias Name")},l(t){e=pt(t,"Alias Name")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function Yx(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p;return e=new st({props:{class:"!p-4"}}),r=new st({props:{$$slots:{default:[Wx]},$$scope:{ctx:s}}}),n=new st({props:{$$slots:{default:[Qx]},$$scope:{ctx:s}}}),o=new st({}),u=new st({}),f=new st({}),v=new st({}),{c(){K(e.$$.fragment),t=Z(),K(r.$$.fragment),a=Z(),K(n.$$.fragment),i=Z(),K(o.$$.fragment),l=Z(),K(u.$$.fragment),c=Z(),K(f.$$.fragment),g=Z(),K(v.$$.fragment)},l(h){F(e.$$.fragment,h),t=ee(h),F(r.$$.fragment,h),a=ee(h),F(n.$$.fragment,h),i=ee(h),F(o.$$.fragment,h),l=ee(h),F(u.$$.fragment,h),c=ee(h),F(f.$$.fragment,h),g=ee(h),F(v.$$.fragment,h)},m(h,d){q(e,h,d),U(h,t,d),q(r,h,d),U(h,a,d),q(n,h,d),U(h,i,d),q(o,h,d),U(h,l,d),q(u,h,d),U(h,c,d),q(f,h,d),U(h,g,d),q(v,h,d),p=!0},p(h,d){const y={};d[2]&32768&&(y.$$scope={dirty:d,ctx:h}),r.$set(y);const A={};d[2]&32768&&(A.$$scope={dirty:d,ctx:h}),n.$set(A)},i(h){p||(L(e.$$.fragment,h),L(r.$$.fragment,h),L(n.$$.fragment,h),L(o.$$.fragment,h),L(u.$$.fragment,h),L(f.$$.fragment,h),L(v.$$.fragment,h),p=!0)},o(h){O(e.$$.fragment,h),O(r.$$.fragment,h),O(n.$$.fragment,h),O(o.$$.fragment,h),O(u.$$.fragment,h),O(f.$$.fragment,h),O(v.$$.fragment,h),p=!1},d(h){J(e,h),h&&P(t),J(r,h),h&&P(a),J(n,h),h&&P(i),J(o,h),h&&P(l),J(u,h),h&&P(c),J(f,h),h&&P(g),J(v,h)}}}function vy(s){let e,t,r=s[11],a=[];for(let i=0;i<r.length;i+=1)a[i]=wy(fy(s,r,i));const n=i=>O(a[i],1,1,()=>{a[i]=null});return{c(){for(let i=0;i<a.length;i+=1)a[i].c();e=Os()},l(i){for(let o=0;o<a.length;o+=1)a[o].l(i);e=Os()},m(i,o){for(let l=0;l<a.length;l+=1)a[l]&&a[l].m(i,o);U(i,e,o),t=!0},p(i,o){if(o[0]&2048){r=i[11];let l;for(l=0;l<r.length;l+=1){const u=fy(i,r,l);a[l]?(a[l].p(u,o),L(a[l],1)):(a[l]=wy(u),a[l].c(),L(a[l],1),a[l].m(e.parentNode,e))}for(On(),l=r.length;l<a.length;l+=1)n(l);Pn()}},i(i){if(!t){for(let o=0;o<r.length;o+=1)L(a[o]);t=!0}},o(i){a=a.filter(Boolean);for(let o=0;o<a.length;o+=1)O(a[o]);t=!1},d(i){ld(a,i),i&&P(e)}}}function zx(s){let e=s[70]+1+"",t;return{c(){t=mt(e)},l(r){t=pt(r,e)},m(r,a){U(r,t,a)},p:ph,d(r){r&&P(t)}}}function Xx(s){let e=s[71]+"",t;return{c(){t=mt(e)},l(r){t=pt(r,e)},m(r,a){U(r,t,a)},p(r,a){a[0]&2048&&e!==(e=r[71]+"")&&yo(t,e)},d(r){r&&P(t)}}}function Zx(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p,h;return e=new we({props:{class:"!p-4"}}),r=new we({props:{class:"w-10",$$slots:{default:[zx]},$$scope:{ctx:s}}}),n=new we({props:{class:"w-64",$$slots:{default:[Xx]},$$scope:{ctx:s}}}),o=new we({}),u=new we({}),f=new we({}),v=new we({}),{c(){K(e.$$.fragment),t=Z(),K(r.$$.fragment),a=Z(),K(n.$$.fragment),i=Z(),K(o.$$.fragment),l=Z(),K(u.$$.fragment),c=Z(),K(f.$$.fragment),g=Z(),K(v.$$.fragment),p=Z()},l(d){F(e.$$.fragment,d),t=ee(d),F(r.$$.fragment,d),a=ee(d),F(n.$$.fragment,d),i=ee(d),F(o.$$.fragment,d),l=ee(d),F(u.$$.fragment,d),c=ee(d),F(f.$$.fragment,d),g=ee(d),F(v.$$.fragment,d),p=ee(d)},m(d,y){q(e,d,y),U(d,t,y),q(r,d,y),U(d,a,y),q(n,d,y),U(d,i,y),q(o,d,y),U(d,l,y),q(u,d,y),U(d,c,y),q(f,d,y),U(d,g,y),q(v,d,y),U(d,p,y),h=!0},p(d,y){const A={};y[2]&32768&&(A.$$scope={dirty:y,ctx:d}),r.$set(A);const x={};y[0]&2048|y[2]&32768&&(x.$$scope={dirty:y,ctx:d}),n.$set(x)},i(d){h||(L(e.$$.fragment,d),L(r.$$.fragment,d),L(n.$$.fragment,d),L(o.$$.fragment,d),L(u.$$.fragment,d),L(f.$$.fragment,d),L(v.$$.fragment,d),h=!0)},o(d){O(e.$$.fragment,d),O(r.$$.fragment,d),O(n.$$.fragment,d),O(o.$$.fragment,d),O(u.$$.fragment,d),O(f.$$.fragment,d),O(v.$$.fragment,d),h=!1},d(d){J(e,d),d&&P(t),J(r,d),d&&P(a),J(n,d),d&&P(i),J(o,d),d&&P(l),J(u,d),d&&P(c),J(f,d),d&&P(g),J(v,d),d&&P(p)}}}function wy(s){let e,t;return e=new Un({props:{$$slots:{default:[Zx]},$$scope:{ctx:s}}}),{c(){K(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&2048|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function eB(s){let e,t,r;function a(i){s[36](i)}let n={style:"filled",id:"floating_filled",name:"floating_filled",type:"text",label:"Alias Name"};return s[3]!==void 0&&(n.value=s[3]),e=new yh({props:n}),dh.push(()=>gh(e,"value",a)),{c(){K(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,o){q(e,i,o),r=!0},p(i,o){const l={};!t&&o[0]&8&&(t=!0,l.value=i[3],mh(()=>t=!1)),e.$set(l)},i(i){r||(L(e.$$.fragment,i),r=!0)},o(i){O(e.$$.fragment,i),r=!1},d(i){J(e,i)}}}function tB(s){let e,t,r,a,n,i,o,l,u;return{c(){e=Vs("label"),t=mt("Choose File"),r=Z(),a=Vs("input"),n=Z(),i=Vs("span"),o=mt(s[9]),this.h()},l(c){e=$s(c,"LABEL",{for:!0,class:!0});var f=gu(e);t=pt(f,"Choose File"),f.forEach(P),r=ee(c),a=$s(c,"INPUT",{type:!0,id:!0,class:!0,style:!0}),n=ee(c),i=$s(c,"SPAN",{class:!0});var g=gu(i);o=pt(g,s[9]),g.forEach(P),this.h()},h(){$t(e,"for","RemoteCertUpload"),$t(e,"class","text-center font-medium focus:ring-4 focus:outline-none inline-flex items-center justify-center px-5 py-2.5 text-sm text-white bg-gray-800 hover:bg-gray-900 focus:ring-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700 dark:focus:ring-gray-700 rounded-lg"),$t(a,"type","file"),$t(a,"id","RemoteCertUpload"),$t(a,"class","block w-full disabled:cursor-not-allowed disabled:opacity-50 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500 bg-gray-50 text-gray-900 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 border-gray-300 dark:border-gray-600 p-2.5 text-sm rounded-lg border !p-0 dark:text-gray-400"),lm(a,"display","none"),$t(i,"class","pl-4")},m(c,f){U(c,e,f),mu(e,t),U(c,r,f),U(c,a,f),U(c,n,f),U(c,i,f),mu(i,o),l||(u=ud(a,"change",s[24]),l=!0)},p(c,f){f[0]&512&&yo(o,c[9])},d(c){c&&P(e),c&&P(r),c&&P(a),c&&P(n),c&&P(i),l=!1,u()}}}function rB(s){let e;return{c(){e=mt("Upload")},l(t){e=pt(t,"Upload")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function sB(s){let e,t;return e=new cd({props:{color:"dark",$$slots:{default:[rB]},$$scope:{ctx:s}}}),e.$on("click",s[25]),{c(){K(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function aB(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p;return e=new we({props:{class:"!p-4"}}),r=new we({props:{class:"w-10"}}),n=new we({props:{class:"w-64",$$slots:{default:[eB]},$$scope:{ctx:s}}}),o=new we({props:{class:"w-96",$$slots:{default:[tB]},$$scope:{ctx:s}}}),u=new we({props:{class:"w-36",$$slots:{default:[sB]},$$scope:{ctx:s}}}),f=new we({}),v=new we({}),{c(){K(e.$$.fragment),t=Z(),K(r.$$.fragment),a=Z(),K(n.$$.fragment),i=Z(),K(o.$$.fragment),l=Z(),K(u.$$.fragment),c=Z(),K(f.$$.fragment),g=Z(),K(v.$$.fragment)},l(h){F(e.$$.fragment,h),t=ee(h),F(r.$$.fragment,h),a=ee(h),F(n.$$.fragment,h),i=ee(h),F(o.$$.fragment,h),l=ee(h),F(u.$$.fragment,h),c=ee(h),F(f.$$.fragment,h),g=ee(h),F(v.$$.fragment,h)},m(h,d){q(e,h,d),U(h,t,d),q(r,h,d),U(h,a,d),q(n,h,d),U(h,i,d),q(o,h,d),U(h,l,d),q(u,h,d),U(h,c,d),q(f,h,d),U(h,g,d),q(v,h,d),p=!0},p(h,d){const y={};d[0]&8|d[2]&32768&&(y.$$scope={dirty:d,ctx:h}),n.$set(y);const A={};d[0]&512|d[2]&32768&&(A.$$scope={dirty:d,ctx:h}),o.$set(A);const x={};d[2]&32768&&(x.$$scope={dirty:d,ctx:h}),u.$set(x)},i(h){p||(L(e.$$.fragment,h),L(r.$$.fragment,h),L(n.$$.fragment,h),L(o.$$.fragment,h),L(u.$$.fragment,h),L(f.$$.fragment,h),L(v.$$.fragment,h),p=!0)},o(h){O(e.$$.fragment,h),O(r.$$.fragment,h),O(n.$$.fragment,h),O(o.$$.fragment,h),O(u.$$.fragment,h),O(f.$$.fragment,h),O(v.$$.fragment,h),p=!1},d(h){J(e,h),h&&P(t),J(r,h),h&&P(a),J(n,h),h&&P(i),J(o,h),h&&P(l),J(u,h),h&&P(c),J(f,h),h&&P(g),J(v,h)}}}function nB(s){let e,t,r,a=s[10]==1&&vy(s);return t=new Un({props:{$$slots:{default:[aB]},$$scope:{ctx:s}}}),{c(){a&&a.c(),e=Z(),K(t.$$.fragment)},l(n){a&&a.l(n),e=ee(n),F(t.$$.fragment,n)},m(n,i){a&&a.m(n,i),U(n,e,i),q(t,n,i),r=!0},p(n,i){n[10]==1?a?(a.p(n,i),i[0]&1024&&L(a,1)):(a=vy(n),a.c(),L(a,1),a.m(e.parentNode,e)):a&&(On(),O(a,1,1,()=>{a=null}),Pn());const o={};i[0]&520|i[2]&32768&&(o.$$scope={dirty:i,ctx:n}),t.$set(o)},i(n){r||(L(a),L(t.$$.fragment,n),r=!0)},o(n){O(a),O(t.$$.fragment,n),r=!1},d(n){a&&a.d(n),n&&P(e),J(t,n)}}}function iB(s){let e,t,r,a;return e=new dd({props:{$$slots:{default:[Yx]},$$scope:{ctx:s}}}),r=new hd({props:{$$slots:{default:[nB]},$$scope:{ctx:s}}}),{c(){K(e.$$.fragment),t=Z(),K(r.$$.fragment)},l(n){F(e.$$.fragment,n),t=ee(n),F(r.$$.fragment,n)},m(n,i){q(e,n,i),U(n,t,i),q(r,n,i),a=!0},p(n,i){const o={};i[2]&32768&&(o.$$scope={dirty:i,ctx:n}),e.$set(o);const l={};i[0]&3592|i[2]&32768&&(l.$$scope={dirty:i,ctx:n}),r.$set(l)},i(n){a||(L(e.$$.fragment,n),L(r.$$.fragment,n),a=!0)},o(n){O(e.$$.fragment,n),O(r.$$.fragment,n),a=!1},d(n){J(e,n),n&&P(t),J(r,n)}}}function oB(s){let e,t;return e=new fd({props:{shadow:!0,striped:!0,tableNoWFull:!0,$$slots:{default:[iB]},$$scope:{ctx:s}}}),{c(){K(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&3592|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function lB(s){let e,t;return e=new s0({props:{title:"CRL",$$slots:{default:[AB]},$$scope:{ctx:s}}}),e.$on("click",s[30]),{c(){K(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&12304|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function uB(s){let e;return{c(){e=mt("No")},l(t){e=pt(t,"No")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function cB(s){let e;return{c(){e=mt("Alias Name")},l(t){e=pt(t,"Alias Name")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function fB(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p;return e=new st({props:{class:"!p-4"}}),r=new st({props:{$$slots:{default:[uB]},$$scope:{ctx:s}}}),n=new st({props:{$$slots:{default:[cB]},$$scope:{ctx:s}}}),o=new st({}),u=new st({}),f=new st({}),v=new st({}),{c(){K(e.$$.fragment),t=Z(),K(r.$$.fragment),a=Z(),K(n.$$.fragment),i=Z(),K(o.$$.fragment),l=Z(),K(u.$$.fragment),c=Z(),K(f.$$.fragment),g=Z(),K(v.$$.fragment)},l(h){F(e.$$.fragment,h),t=ee(h),F(r.$$.fragment,h),a=ee(h),F(n.$$.fragment,h),i=ee(h),F(o.$$.fragment,h),l=ee(h),F(u.$$.fragment,h),c=ee(h),F(f.$$.fragment,h),g=ee(h),F(v.$$.fragment,h)},m(h,d){q(e,h,d),U(h,t,d),q(r,h,d),U(h,a,d),q(n,h,d),U(h,i,d),q(o,h,d),U(h,l,d),q(u,h,d),U(h,c,d),q(f,h,d),U(h,g,d),q(v,h,d),p=!0},p(h,d){const y={};d[2]&32768&&(y.$$scope={dirty:d,ctx:h}),r.$set(y);const A={};d[2]&32768&&(A.$$scope={dirty:d,ctx:h}),n.$set(A)},i(h){p||(L(e.$$.fragment,h),L(r.$$.fragment,h),L(n.$$.fragment,h),L(o.$$.fragment,h),L(u.$$.fragment,h),L(f.$$.fragment,h),L(v.$$.fragment,h),p=!0)},o(h){O(e.$$.fragment,h),O(r.$$.fragment,h),O(n.$$.fragment,h),O(o.$$.fragment,h),O(u.$$.fragment,h),O(f.$$.fragment,h),O(v.$$.fragment,h),p=!1},d(h){J(e,h),h&&P(t),J(r,h),h&&P(a),J(n,h),h&&P(i),J(o,h),h&&P(l),J(u,h),h&&P(c),J(f,h),h&&P(g),J(v,h)}}}function Sy(s){let e,t,r=s[13],a=[];for(let i=0;i<r.length;i+=1)a[i]=Cy(cy(s,r,i));const n=i=>O(a[i],1,1,()=>{a[i]=null});return{c(){for(let i=0;i<a.length;i+=1)a[i].c();e=Os()},l(i){for(let o=0;o<a.length;o+=1)a[o].l(i);e=Os()},m(i,o){for(let l=0;l<a.length;l+=1)a[l]&&a[l].m(i,o);U(i,e,o),t=!0},p(i,o){if(o[0]&8192){r=i[13];let l;for(l=0;l<r.length;l+=1){const u=cy(i,r,l);a[l]?(a[l].p(u,o),L(a[l],1)):(a[l]=Cy(u),a[l].c(),L(a[l],1),a[l].m(e.parentNode,e))}for(On(),l=r.length;l<a.length;l+=1)n(l);Pn()}},i(i){if(!t){for(let o=0;o<r.length;o+=1)L(a[o]);t=!0}},o(i){a=a.filter(Boolean);for(let o=0;o<a.length;o+=1)O(a[o]);t=!1},d(i){ld(a,i),i&&P(e)}}}function hB(s){let e=s[70]+1+"",t;return{c(){t=mt(e)},l(r){t=pt(r,e)},m(r,a){U(r,t,a)},p:ph,d(r){r&&P(t)}}}function dB(s){let e=s[68]+"",t;return{c(){t=mt(e)},l(r){t=pt(r,e)},m(r,a){U(r,t,a)},p(r,a){a[0]&8192&&e!==(e=r[68]+"")&&yo(t,e)},d(r){r&&P(t)}}}function gB(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p,h;return e=new we({props:{class:"!p-4"}}),r=new we({props:{class:"w-10",$$slots:{default:[hB]},$$scope:{ctx:s}}}),n=new we({props:{class:"w-64",$$slots:{default:[dB]},$$scope:{ctx:s}}}),o=new we({}),u=new we({}),f=new we({}),v=new we({}),{c(){K(e.$$.fragment),t=Z(),K(r.$$.fragment),a=Z(),K(n.$$.fragment),i=Z(),K(o.$$.fragment),l=Z(),K(u.$$.fragment),c=Z(),K(f.$$.fragment),g=Z(),K(v.$$.fragment),p=Z()},l(d){F(e.$$.fragment,d),t=ee(d),F(r.$$.fragment,d),a=ee(d),F(n.$$.fragment,d),i=ee(d),F(o.$$.fragment,d),l=ee(d),F(u.$$.fragment,d),c=ee(d),F(f.$$.fragment,d),g=ee(d),F(v.$$.fragment,d),p=ee(d)},m(d,y){q(e,d,y),U(d,t,y),q(r,d,y),U(d,a,y),q(n,d,y),U(d,i,y),q(o,d,y),U(d,l,y),q(u,d,y),U(d,c,y),q(f,d,y),U(d,g,y),q(v,d,y),U(d,p,y),h=!0},p(d,y){const A={};y[2]&32768&&(A.$$scope={dirty:y,ctx:d}),r.$set(A);const x={};y[0]&8192|y[2]&32768&&(x.$$scope={dirty:y,ctx:d}),n.$set(x)},i(d){h||(L(e.$$.fragment,d),L(r.$$.fragment,d),L(n.$$.fragment,d),L(o.$$.fragment,d),L(u.$$.fragment,d),L(f.$$.fragment,d),L(v.$$.fragment,d),h=!0)},o(d){O(e.$$.fragment,d),O(r.$$.fragment,d),O(n.$$.fragment,d),O(o.$$.fragment,d),O(u.$$.fragment,d),O(f.$$.fragment,d),O(v.$$.fragment,d),h=!1},d(d){J(e,d),d&&P(t),J(r,d),d&&P(a),J(n,d),d&&P(i),J(o,d),d&&P(l),J(u,d),d&&P(c),J(f,d),d&&P(g),J(v,d),d&&P(p)}}}function Cy(s){let e,t;return e=new Un({props:{$$slots:{default:[gB]},$$scope:{ctx:s}}}),{c(){K(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&8192|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function mB(s){let e,t,r;function a(i){s[37](i)}let n={style:"filled",id:"floating_filled",name:"floating_filled",type:"text",label:"Alias Name"};return s[4]!==void 0&&(n.value=s[4]),e=new yh({props:n}),dh.push(()=>gh(e,"value",a)),{c(){K(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,o){q(e,i,o),r=!0},p(i,o){const l={};!t&&o[0]&16&&(t=!0,l.value=i[4],mh(()=>t=!1)),e.$set(l)},i(i){r||(L(e.$$.fragment,i),r=!0)},o(i){O(e.$$.fragment,i),r=!1},d(i){J(e,i)}}}function pB(s){let e,t,r;return{c(){e=Vs("input"),this.h()},l(a){e=$s(a,"INPUT",{type:!0,id:!0,class:!0}),this.h()},h(){$t(e,"type","file"),$t(e,"id","crlUpload"),$t(e,"class","block w-full disabled:cursor-not-allowed disabled:opacity-50 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500 bg-gray-50 text-gray-900 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 border-gray-300 dark:border-gray-600 p-2.5 text-sm rounded-lg border !p-0 dark:text-gray-400")},m(a,n){U(a,e,n),t||(r=ud(e,"change",s[22]),t=!0)},p:ph,d(a){a&&P(e),t=!1,r()}}}function yB(s){let e;return{c(){e=mt("Upload")},l(t){e=pt(t,"Upload")},m(t,r){U(t,e,r)},d(t){t&&P(e)}}}function vB(s){let e,t;return e=new cd({props:{color:"dark",$$slots:{default:[yB]},$$scope:{ctx:s}}}),e.$on("click",s[23]),{c(){K(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function wB(s){let e,t,r,a,n,i,o,l,u,c,f,g,v,p;return e=new we({props:{class:"!p-4"}}),r=new we({props:{class:"w-10"}}),n=new we({props:{class:"w-64",$$slots:{default:[mB]},$$scope:{ctx:s}}}),o=new we({props:{class:"w-96",$$slots:{default:[pB]},$$scope:{ctx:s}}}),u=new we({props:{class:"w-36",$$slots:{default:[vB]},$$scope:{ctx:s}}}),f=new we({}),v=new we({}),{c(){K(e.$$.fragment),t=Z(),K(r.$$.fragment),a=Z(),K(n.$$.fragment),i=Z(),K(o.$$.fragment),l=Z(),K(u.$$.fragment),c=Z(),K(f.$$.fragment),g=Z(),K(v.$$.fragment)},l(h){F(e.$$.fragment,h),t=ee(h),F(r.$$.fragment,h),a=ee(h),F(n.$$.fragment,h),i=ee(h),F(o.$$.fragment,h),l=ee(h),F(u.$$.fragment,h),c=ee(h),F(f.$$.fragment,h),g=ee(h),F(v.$$.fragment,h)},m(h,d){q(e,h,d),U(h,t,d),q(r,h,d),U(h,a,d),q(n,h,d),U(h,i,d),q(o,h,d),U(h,l,d),q(u,h,d),U(h,c,d),q(f,h,d),U(h,g,d),q(v,h,d),p=!0},p(h,d){const y={};d[0]&16|d[2]&32768&&(y.$$scope={dirty:d,ctx:h}),n.$set(y);const A={};d[2]&32768&&(A.$$scope={dirty:d,ctx:h}),o.$set(A);const x={};d[2]&32768&&(x.$$scope={dirty:d,ctx:h}),u.$set(x)},i(h){p||(L(e.$$.fragment,h),L(r.$$.fragment,h),L(n.$$.fragment,h),L(o.$$.fragment,h),L(u.$$.fragment,h),L(f.$$.fragment,h),L(v.$$.fragment,h),p=!0)},o(h){O(e.$$.fragment,h),O(r.$$.fragment,h),O(n.$$.fragment,h),O(o.$$.fragment,h),O(u.$$.fragment,h),O(f.$$.fragment,h),O(v.$$.fragment,h),p=!1},d(h){J(e,h),h&&P(t),J(r,h),h&&P(a),J(n,h),h&&P(i),J(o,h),h&&P(l),J(u,h),h&&P(c),J(f,h),h&&P(g),J(v,h)}}}function SB(s){let e,t,r,a=s[12]==1&&Sy(s);return t=new Un({props:{$$slots:{default:[wB]},$$scope:{ctx:s}}}),{c(){a&&a.c(),e=Z(),K(t.$$.fragment)},l(n){a&&a.l(n),e=ee(n),F(t.$$.fragment,n)},m(n,i){a&&a.m(n,i),U(n,e,i),q(t,n,i),r=!0},p(n,i){n[12]==1?a?(a.p(n,i),i[0]&4096&&L(a,1)):(a=Sy(n),a.c(),L(a,1),a.m(e.parentNode,e)):a&&(On(),O(a,1,1,()=>{a=null}),Pn());const o={};i[0]&16|i[2]&32768&&(o.$$scope={dirty:i,ctx:n}),t.$set(o)},i(n){r||(L(a),L(t.$$.fragment,n),r=!0)},o(n){O(a),O(t.$$.fragment,n),r=!1},d(n){a&&a.d(n),n&&P(e),J(t,n)}}}function CB(s){let e,t,r,a;return e=new dd({props:{$$slots:{default:[fB]},$$scope:{ctx:s}}}),r=new hd({props:{$$slots:{default:[SB]},$$scope:{ctx:s}}}),{c(){K(e.$$.fragment),t=Z(),K(r.$$.fragment)},l(n){F(e.$$.fragment,n),t=ee(n),F(r.$$.fragment,n)},m(n,i){q(e,n,i),U(n,t,i),q(r,n,i),a=!0},p(n,i){const o={};i[2]&32768&&(o.$$scope={dirty:i,ctx:n}),e.$set(o);const l={};i[0]&12304|i[2]&32768&&(l.$$scope={dirty:i,ctx:n}),r.$set(l)},i(n){a||(L(e.$$.fragment,n),L(r.$$.fragment,n),a=!0)},o(n){O(e.$$.fragment,n),O(r.$$.fragment,n),a=!1},d(n){J(e,n),n&&P(t),J(r,n)}}}function AB(s){let e,t;return e=new fd({props:{shadow:!0,striped:!0,tableNoWFull:!0,$$slots:{default:[CB]},$$scope:{ctx:s}}}),{c(){K(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&12304|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function bB(s){let e,t,r,a,n,i,o,l,u,c=0;t=new s0({props:{open:!0,title:"Machine Certificates",$$slots:{default:[Vx]},$$scope:{ctx:s}}}),t.$on("click",s[27]),a=new s0({props:{title:"CA Certificates",$$slots:{default:[jx]},$$scope:{ctx:s}}}),a.$on("click",s[28]),i=new s0({props:{title:"Remote Certificates",$$slots:{default:[oB]},$$scope:{ctx:s}}}),i.$on("click",s[29]);let f=lB(s);return{c(){e=Z(),K(t.$$.fragment),r=Z(),K(a.$$.fragment),n=Z(),K(i.$$.fragment),o=Z(),f&&f.c(),l=Os()},l(g){e=ee(g),F(t.$$.fragment,g),r=ee(g),F(a.$$.fragment,g),n=ee(g),F(i.$$.fragment,g),o=ee(g),f&&f.l(g),l=Os()},m(g,v){U(g,e,v),q(t,g,v),U(g,r,v),q(a,g,v),U(g,n,v),q(i,g,v),U(g,o,v),f&&f.m(g,v),U(g,l,v),u=!0},p(g,v){const p={};v[0]&196832|v[2]&32768&&(p.$$scope={dirty:v,ctx:g}),t.$set(p);const h={};v[0]&49412|v[2]&32768&&(h.$$scope={dirty:v,ctx:g}),a.$set(h);const d={};v[0]&3592|v[2]&32768&&(d.$$scope={dirty:v,ctx:g}),i.$set(d),f.p(g,v)},i(g){u||(L(c),L(t.$$.fragment,g),L(a.$$.fragment,g),L(i.$$.fragment,g),L(f),u=!0)},o(g){O(c),O(t.$$.fragment,g),O(a.$$.fragment,g),O(i.$$.fragment,g),O(f),u=!1},d(g){g&&P(e),J(t,g),g&&P(r),J(a,g),g&&P(n),J(i,g),g&&P(o),f&&f.d(g),g&&P(l)}}}function EB(s){let e,t;return e=new nw({props:{style:"underline",$$slots:{default:[bB]},$$scope:{ctx:s}}}),{c(){K(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const n={};a[0]&262143|a[2]&32768&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){O(e.$$.fragment,r),t=!1},d(r){J(e,r)}}}function xB(s,e,t){let r="",a={},n={},i=0,o=[],l,u;aw.subscribe(be=>{l=be}),rp.subscribe(be=>{o=be}),_d.subscribe(be=>{n=be});let c=null,f="",g="",v=null,p="",h="",d=null,y="",A="",x=null,N="",_="",$="",se="",te="",me="No file chosen",Ce="No file chosen",pe="No file chosen",ve=0,it=[];async function Ye(){const be=await fetch(window.location.origin+"/GetRemotecert",{method:"POST",body:u});be.status==200&&(t(11,it=await be.json()),console.log(it),t(10,ve=1))}let Ae=0,Ue=[];async function oe(){const be=await fetch(window.location.origin+"/GeTCRL",{method:"POST",body:u});be.status==200&&(t(13,Ue=await be.json()),console.log(Ue),t(12,Ae=1))}let xt=0,je=[];async function re(){const be=await fetch(window.location.origin+"/getCaCERt",{method:"POST",body:u});be.status==200&&(t(15,je=await be.json()),console.log(je),t(14,xt=1))}let de=0,ne=[];async function ye(){const be=await fetch(window.location.origin+"/getMachinECert",{method:"POST",body:u});be.status==200&&(t(17,ne=await be.json()),console.log(ne),t(16,de=1))}async function Te(be){const et=be.target.files[0];if(et){if(t(7,me=et.name),x=et,l){const Ft=l.match(/.{1,2}/g).map(_r=>parseInt(_r,16));u=new Uint8Array(Ft)}const Bt=new FileReader;Bt.onload=jt=>{te=new Uint8Array(jt.target.result)},Bt.readAsArrayBuffer(et)}}async function He(){if($==""||se==""||te=="")alert("Alias Name is null or PKCS#12 password is null or machineCertData is null"),console.log($),console.log(se),console.log(te);else if(x&&te!=""){console.log($),console.log(se),console.log(te);let be,et=0;try{const Bt=Er.util.createBuffer(te),jt=Er.asn1.fromDer(Bt);be=Er.pkcs12.pkcs12FromAsn1(jt,se)}catch(Bt){console.log("error: "+Bt),et=1,alert("p12 password is invalid")}if(et==0){const jt=be.getBags({bagType:Er.pki.oids.certBag})[Er.pki.oids.certBag][0];console.log("certBag"),console.log(jt);const Ft=be.getBags({bagType:Er.pki.oids.pkcs8ShroudedKeyBag});console.log("bags2"),console.log(Ft);const _r=Ft[Er.pki.oids.pkcs8ShroudedKeyBag][0];console.log("keyBag"),console.log(_r);let wa="",Eo="",ep=0;if(jt.cert==null){let Ru={type:"CERTIFICATE",body:Er.asn1.toDer(jt.asn1).getBytes()};wa=Er.pem.encode(Ru),console.log(wa),console.log(wa.length)}else wa=Er.pki.certificateToPem(jt.cert),console.log(wa),console.log(wa.length);if(_r.key==null){let Ru={type:"PRIVATE KEY",body:Er.asn1.toDer(_r.asn1).getBytes()};Eo=Er.pem.encode(Ru);let bh="";bh=Er.pki.getPrivateKeyOid(_r.asn1),console.log(bh),bh=="1.2.840.10045.2.1"?(console.log("EC private key"),ep=1):bh=="1.2.840.113549.1.1.1"&&console.log("RSA Private key")}else Eo=Er.pki.privateKeyToPem(_r.key);console.log("KeyPem"),console.log(Eo),console.log(Eo.length);const Td=new TextEncoder;let tp=Td.encode($);N=new Uint8Array(wa.length+u.length+64),N.set(u,0),N.set(tp,u.length);let X1=Td.encode(wa);N.set(X1,u.length+64),_=new Uint8Array(Eo.length+u.length+64),_.set(u,0),_.set(tp,u.length);let Z1=Td.encode(Eo);_.set(Z1,u.length+64),(await fetch(window.location.origin+"/UploadMachineCert",{method:"POST",body:N,headers:{"Content-Type":"application/octet-stream"}})).status==200?console.log("200 Upload machineCertContent"):console.log("error Upload machineCertContent"),ep==1?(await fetch(window.location.origin+"/UploadEcMachinePrivate",{method:"POST",body:_,headers:{"Content-Type":"application/octet-stream"}})).status==200?console.log("200 Upload machineEcPrivateKeyContent"):console.log("error Upload machineEcPrivateKeyContent"):(await fetch(window.location.origin+"/UploadrsaMachinePrivate",{method:"POST",body:_,headers:{"Content-Type":"application/octet-stream"}})).status==200?console.log("200 Upload machineRSAPrivateKeyContent"):console.log("error Upload machineRSAPrivateKeyContent"),ye()}}}async function nt(be){const et=be.target.files[0];if(et){if(t(8,Ce=et.name),c=et,l){const Ft=l.match(/.{1,2}/g).map(_r=>parseInt(_r,16));u=new Uint8Array(Ft)}const Bt=new FileReader;Bt.onload=jt=>{const Ft=new Uint8Array(jt.target.result);f=new Uint8Array(Ft.length+u.length+64),f.set(u,0),f.set(Ft,u.length+64)},Bt.readAsArrayBuffer(et)}}async function Le(){if(g==""||f=="")alert("Alias Name is null or caCertContent is null");else if(c){console.log(g);let et=new TextEncoder().encode(g);console.log("caCertContent"),console.log(f),f.set(et,u.length),console.log(g),(await fetch(window.location.origin+"/UploaDCaCert",{method:"POST",body:f,headers:{"Content-Type":"application/octet-stream"}})).status==200?(console.log("200 UploadCACert"),re()):console.log("error UploadCACert")}}async function Ne(be){const et=be.target.files[0];if(et){if(d=et,l){const Ft=l.match(/.{1,2}/g).map(_r=>parseInt(_r,16));u=new Uint8Array(Ft)}const Bt=new FileReader;Bt.onload=jt=>{const Ft=new Uint8Array(jt.target.result);y=new Uint8Array(Ft.length+u.length+64),y.set(u,0),y.set(Ft,u.length+64)},Bt.readAsArrayBuffer(et)}}async function ce(){if(A==""||y=="")alert("Alias Name is null or content is null");else if(d){console.log(A);let et=new TextEncoder().encode(A);y.set(et,u.length),(await fetch(window.location.origin+"/UpLoaDcrl",{method:"POST",body:y,headers:{"Content-Type":"application/octet-stream"}})).status==200?(console.log("200 Upload crl"),oe()):console.log("error Upload crl")}}async function ft(be){const et=be.target.files[0];if(et){if(v=et,t(9,pe=et.name),l){const Ft=l.match(/.{1,2}/g).map(_r=>parseInt(_r,16));u=new Uint8Array(Ft)}const Bt=new FileReader;Bt.onload=jt=>{const Ft=new Uint8Array(jt.target.result);p=new Uint8Array(Ft.length+u.length+64),p.set(u,0),p.set(Ft,u.length+64)},Bt.readAsArrayBuffer(et)}}async function ot(){if(h==""||p=="")alert("Alias Name is null or content is null");else if(v){console.log(h);let et=new TextEncoder().encode(h);p.set(et,u.length),(await fetch(window.location.origin+"/UpLoadRemoteCert",{method:"POST",body:p,headers:{"Content-Type":"application/octet-stream"}})).status==200?(console.log("200 UploadRemoteCert"),Ye()):console.log("error UploadRemoteCert")}}function lt(){if(console.log("save certificate"),o.length!=0&&(o=[]),a.config.authentication_certificate_certificateSettings.checkCert!=r.config.authentication_certificate_certificateSettings.checkCert){n.config.authentication_certificate_certificateSettings.checkCert=a.config.authentication_certificate_certificateSettings.checkCert;let be="Check the validity period of certificates and CRLs is changed to "+a.config.authentication_certificate_certificateSettings.checkCert;o=[...o,be]}rp.set(o),_d.set(n),console.log(o)}const $e=()=>{t(7,me="No file chosen"),ye()},Jt=()=>{t(8,Ce="No file chosen"),re()},Gt=()=>{t(9,pe="No file chosen"),Ye()},F1=()=>{oe()};async function q1(){const be=await fetch(window.location.origin+"/GetCertificateData",{method:"POST",body:u});be.status==200&&(r=await be.json(),console.log(r),uw.set(r),t(0,a=JSON.parse(JSON.stringify(r))),n=JSON.parse(JSON.stringify(r)),_d.set(n),t(1,i=1))}sw(()=>{if(console.log("certificate sessionid: "),console.log(l),l&&r==""){const et=l.match(/.{1,2}/g).map(Bt=>parseInt(Bt,16));u=new Uint8Array(et),q1(),Ye(),re(),ye(),oe()}else if(l&&r!=""){const et=l.match(/.{1,2}/g).map(Bt=>parseInt(Bt,16));u=new Uint8Array(et),t(1,i=1),o.length==0&&(t(0,a=JSON.parse(JSON.stringify(n))),t(0,a.config.authentication_certificate_certificateSettings=JSON.parse(JSON.stringify(r.config.authentication_certificate_certificateSettings)),a))}});function J1(be){s.$$.not_equal(a.config.authentication_certificate_certificateSettings.checkCert,be)&&(a.config.authentication_certificate_certificateSettings.checkCert=be,t(0,a))}function G1(be){s.$$.not_equal(a.config.authentication_certificate_certificateSettings.checkCert,be)&&(a.config.authentication_certificate_certificateSettings.checkCert=be,t(0,a))}function j1(be){$=be,t(5,$)}function W1(be){se=be,t(6,se)}function Q1(be){g=be,t(2,g)}function Y1(be){h=be,t(3,h)}function z1(be){A=be,t(4,A)}return[a,i,g,h,A,$,se,me,Ce,pe,ve,it,Ae,Ue,xt,je,de,ne,Te,He,nt,Le,Ne,ce,ft,ot,lt,$e,Jt,Gt,F1,J1,G1,j1,W1,Q1,Y1,z1]}class MB extends ew{constructor(e){super(),tw(this,e,xB,EB,rw,{},null,[-1,-1,-1])}}export{MB as default};
