<script>import { page } from '$app/stores';
import Dropdown from './Dropdown.svelte';
import { sessionidG } from "../../src/routes/sessionG.js";
import { dashboadData,VPNdashboad} from "../../src/routes/configG.js";
export let topDiv = 'w-full md:block md:w-auto';
let buttonClass = 'inline-flex items-center text-base text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200';
export let childLi = 'block py-2  text-gray-700 border-b border-gray-100 hover:bg-gray-50 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 text-base';
export let topMenuDiv = 'container flex flex-wrap justify-end mx-auto';
export let topMenus;
export let topul = 'flex flex-col mt-4 md:flex-row md:space-x-8 md:mt-0 md:text-md md:font-medium pt-1 bg-gray-200';
export let topli = 'block py-2 text-gray-700 hover:bg-gray-50 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0';
export let activeDropdownDiv = 'z-10 w-44 text-lg list-none bg-white rounded divide-y divide-gray-100 shadow';
export let activeChildLi = 'block py-2 px-4 text-base text-gray-700 hover:bg-gray-100';
export let dropdownLi = 'flex justify-between items-center py-2 w-full text-base font-medium text-gray-700 border-b border-gray-100 hover:bg-gray-50 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 md:w-auto';

export let svg0background="";
let barHidden = true;


$: activeUrl = $page.url.pathname;

let sessionid='';
let sessionBinary;
let dashboard_data="";
let vpn_dashboard="";


sessionidG.subscribe(val => {
    sessionid = val;
});

dashboadData.subscribe(val => {
    dashboard_data = val;
});

VPNdashboad.subscribe(val => {
    vpn_dashboard = val;
});




  async function getVPNDashboard() {
    const res = await fetch(window.location.origin+"/GetVPNdashboard", {
      method: 'POST',
      body: sessionBinary
    })

    if (res.status == 200)
    {
      vpn_dashboard =await res.json();
      console.log("Top New VPN Dashboard");
      console.log(vpn_dashboard);
      VPNdashboad.set(vpn_dashboard);
    }
  }


  async function getDashboardData() {
    const res = await fetch(window.location.origin+"/getDashboardData", {
      method: 'POST',
      body: sessionBinary
    })

    if (res.status == 200)
    {
      dashboard_data =await res.json();
      console.log("Top New Dashboard");
      console.log(dashboard_data);
      dashboadData.set(dashboard_data);
    }
  }



const handleClickbtn = () => {
    barHidden = !barHidden;
};


function TopRefreshDB()
{
	console.log("TopRefreshDB");
	if (sessionid)
	{      
		const hexArray = sessionid.match(/.{1,2}/g); 
      	const byteValues = hexArray.map(hex => parseInt(hex, 16));
      	sessionBinary = new Uint8Array(byteValues);

      	getDashboardData();
      	getVPNDashboard();

	}
}


</script>



<div class={topMenuDiv}>
	<div class={topDiv}>
		<ul class={topul}>
			{#each topMenus as { id, name, href, rel, child}}
				{#if child}
					<Dropdown {name} {child} {activeChildLi} {activeDropdownDiv} {dropdownLi} />
				{:else}	
					<li class={topli}>
					{#if id==0}
{#if activeUrl == '/dashboard' || activeUrl.substring(0,16)=='/EDashboard.html'}

<button type="button" on:click={TopRefreshDB}>
<svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet" class="text-green-500 mr-2 dark:text-pink-500 w-6 h-6">

<g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" fill="green" stroke="none">
<path d="M4213 5106 c-59 -19 -104 -49 -153 -102 -80 -87 -100 -171 -81 -333
7 -51 10 -95 9 -96 -2 -2 -39 19 -83 47 -131 82 -370 193 -531 247 -731 243
-1503 145 -2139 -273 -630 -414 -1038 -1047 -1141 -1771 -23 -159 -23 -486 0
-638 41 -276 114 -514 231 -752 128 -263 275 -471 480 -683 211 -218 418 -370
690 -503 600 -293 1258 -327 1919 -99 554 191 1027 562 1305 1024 206 340 321
735 325 1111 1 135 0 142 -28 202 -33 73 -104 144 -174 176 -67 31 -207 31
-274 0 -67 -31 -143 -106 -174 -171 -23 -48 -28 -76 -35 -196 -22 -376 -135
-675 -359 -951 -323 -397 -893 -655 -1447 -655 -605 0 -1140 300 -1493 836
-394 597 -398 1340 -12 1934 227 350 589 633 971 760 218 73 295 84 561 84
217 0 244 -2 361 -26 136 -30 284 -78 402 -132 85 -39 221 -116 214 -122 -2
-2 -51 -13 -109 -23 -57 -10 -124 -29 -147 -41 -65 -32 -127 -96 -158 -159
-24 -49 -28 -68 -28 -146 0 -76 4 -99 26 -146 53 -112 161 -187 283 -196 83
-6 1082 174 1151 207 57 28 127 97 154 153 46 95 45 111 -14 631 -31 264 -60
505 -65 534 -28 156 -161 271 -324 279 -42 2 -88 -3 -113 -11z"></path>
</g>
</svg>
</button>
{/if}
					{:else if id==1}

						<a class:active={$page.url.pathname === href} {href} {rel} class={childLi}>					<svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="text-green-500 mr-2 dark:text-pink-500 w-6 h-6" style={svg0background}>
  <path d="M11.35 3.836c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m8.9-4.414c.376.023.75.05 1.124.08 1.131.094 1.976 1.057 1.976 2.192V16.5A2.25 2.25 0 0118 18.75h-2.25m-7.5-10.5H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V18.75m-7.5-10.5h6.375c.621 0 1.125.504 1.125 1.125v9.375m-8.25-3l1.5 1.5 3-3.75" stroke-linecap="round" stroke-linejoin="round"></path>
</svg></a>
					{:else if id== 2}
					<a class:active={$page.url.pathname === href} {href} {rel} class={childLi}><svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="text-green-500 mr-2 dark:text-pink-500 w-6 h-6">
  <path d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" stroke-linecap="round" stroke-linejoin="round"></path>
</svg></a>
					{/if}

					</li>
				{/if}
			{/each}
		</ul>
	</div>
</div>